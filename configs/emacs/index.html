<!DOCTYPE html>
<html lang=""><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Emacs config</title>
    <meta name="description" content="Freedom is a state of mind">
    <meta name="author" content='SqrtMinusOne'>

    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous">

    
    <link rel="stylesheet" href="/sass/researcher.min.css">

    
        <link rel="icon" type="image/ico" href="https://sqrtminusone.xyz/favicon.ico">
    

    
        
    
</head>

    <body><div class="container mt-5">
    <nav class="navbar navbar-expand-sm flex-column flex-sm-row text-nowrap p-0">
        <a class="navbar-brand mx-0 mr-sm-auto" href="https://sqrtminusone.xyz/" title="SqrtMinusOne">
          
          SqrtMinusOne
        </a>
        <div class="navbar-nav flex-row flex-wrap justify-content-center">
            
                
                
                    <a class="nav-item nav-link" href="/" title="Index">
                        Index
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/posts/" title="Posts">
                        Posts
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/configs/readme" title="Configs">
                        Configs
                    </a>
                    
                
            
        </div>
    </nav>
</div>
<hr>
<div id="content">
<script defer language="javascript" type="text/javascript"  src="/js/dynamic-toc.js"></script>
<div class="root">
    <h1 id="title-small-screen">
        Emacs config
        <iframe src="https://ghbtns.com/github-btn.html?user=SqrtMinusOne&repo=dotfiles&type=star&count=true" frameborder="0" scrolling="0" width="150" height="20" title="GitHub"></iframe>
    </h1>
    <div class="container" id="actual-content">
        <h1 id="title-large-screen" class="dotfiles-title">
            Emacs config
            <iframe src="https://ghbtns.com/github-btn.html?user=SqrtMinusOne&repo=dotfiles&type=star&count=true" frameborder="0" scrolling="0" width="150" height="20" title="GitHub"></iframe>
        </h1>
        <blockquote>
<p>One day we won&rsquo;t hate one another, no young boy will march to war and I will clean up my Emacs config. But that day isn&rsquo;t today.</p>
</blockquote>
<h2 id="introduction">Introduction</h2>
<p>My configuration of <a href="https://www.gnu.org/software/emacs/">GNU Emacs</a>, an awesome <del>text editor</del> program that can do almost anything.</p>
<p>At the moment of this writing, this &ldquo;almost anything&rdquo; includes:</p>
<ul>
<li><strong>Writing code</strong>. With LSP &amp; Co Emacs is as good as many IDEs, and is certainly on par with editors like VS Code.<br />
Emacs is also particularly good at writing Lisp code, e.g. Clojure, Common Lisp, and, of course, Emacs Lisp.</li>
<li><strong>Literate programming</strong> with Org Mode. That includes:
<ul>
<li>Configuring the entirety of my software (that can be configured with text files).</li>
<li>Interactive programming like one provided by Jupyter Notebook.</li>
</ul>
</li>
<li><strong>File management</strong>. Dired is my primary file manager.</li>
<li><strong>Email</strong>, with notmuch.</li>
<li><strong>Multimedia management</strong>, with EMMS.</li>
<li><strong>RSS feed reader</strong>, with elfeed.</li>
<li><strong>Task management</strong>, with Org Mode.</li>
<li><strong>Managing passwords</strong>, with pass.</li>
<li><strong>IRC</strong>, with ERC.</li>
<li><strong>Formatting documents</strong>, also with Org Mode. When the document is too complex, I prefer to write plain LaTeX, but I&rsquo;ve come to the conclusion that in most cases Org Mode covers my needs there.</li>
<li><strong>X Window management</strong>, with EXWM. So I could say I literally live in Emacs.</li>
<li>&hellip;</li>
</ul>
<p>As I have hinted above, this file is a piece of literate configuration, where the actual code is interweaved with English-language commentary. One could argue that the commentary, and not the code, is the primary entity of the file.</p>
<p>But at the same time, the configuration is personal, so the primary benefactor of the literate structure is me. The commentary is primarily meant to capture my state of mind at the moment of writing the code, which is immensely helpful for maintaining the code in the future. So the quality and quantity of the commentary are&hellip; varying.</p>
<p>Occasionally I save some promising experimentations from scratch buffers without much comment. Or I may not have enough time to describe things in substantial detail. Or, as it is at the moment when I&rsquo;m writing this, I have the time to write down whatever I consider necessary. Plus I usually incorporate my blog posts back into the config.</p>
<p>Of course, human minds share many similarities, so if you are an avid Emacs user, you have a chance to extract something of value from this document.</p>
<p>If however, by some twist of fate, this document is one of the first things you see about Emacs, it won&rsquo;t be a good resource for you. And you definitely shouldn&rsquo;t try to launch this config as it is. If I could suggest only one resource, I&rsquo;d advise David Wilson&rsquo;s <a href="https://www.youtube.com/c/SystemCrafters">System Crafters</a> YouTube channel.</p>
<h2 id="some-remarks">Some remarks</h2>
<p>I decided not to keep configs for features that I do not use anymore because this config is already huge. But here are the last commits that had these features presented.</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Last commit</th>
</tr>
</thead>
<tbody>
<tr>
<td>org-roam dailies</td>
<td>d2648918fcc338bd5c1cd6d5c0aa60a65077ccf7</td>
</tr>
<tr>
<td>org-roam projects</td>
<td>025278a1e180e86f3aade20242e4ac1cdc1a2f13</td>
</tr>
<tr>
<td>treemacs</td>
<td>3d87852745caacc0863c747f1fa9871d367240d2</td>
</tr>
<tr>
<td>tab-bar.el</td>
<td>19ff54db9fe21fd5bdf404a8d2612176baa8a6f5</td>
</tr>
<tr>
<td>spaceline</td>
<td>19ff54db9fe21fd5bdf404a8d2612176baa8a6f5</td>
</tr>
<tr>
<td>code compass</td>
<td>8594d6f53e42c70bbf903e168607841854818a38</td>
</tr>
<tr>
<td>vue-mode</td>
<td>8594d6f53e42c70bbf903e168607841854818a38</td>
</tr>
<tr>
<td>svelte-mode</td>
<td>8594d6f53e42c70bbf903e168607841854818a38</td>
</tr>
<tr>
<td>pomidor</td>
<td>8594d6f53e42c70bbf903e168607841854818a38</td>
</tr>
<tr>
<td>elfeed-score</td>
<td>8e591e0d2afd909ae5be00caf17f9b17c6cd8b61</td>
</tr>
</tbody>
</table>
<h2 id="bootstrap">Bootstrap</h2>
<p>Setting up the environment, performance tuning and a few basic settings.</p>
<p>First things first, lexical binding.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;; -*- lexical-binding: t -*-</span>
</span></span></code></pre></div><h3 id="packages">Packages</h3>
<h4 id="straight-dot-el">straight.el</h4>
<p>Straight.el is my Emacs package manager of choice. Its advantages &amp; disadvantages over other options are listed pretty thoroughly in the README file in the repo.</p>
<p>The following is a straight.el bootstrap script.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/raxod502/straight.el">straight.el repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defvar</span> <span style="color:#19177c">bootstrap-version</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">let</span> ((<span style="color:#19177c">bootstrap-file</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;straight/repos/straight.el/bootstrap.el&#34;</span> <span style="color:#19177c">user-emacs-directory</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">bootstrap-version</span> <span style="color:#666">5</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#19177c">bootstrap-file</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">with-current-buffer</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">url-retrieve-synchronously</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#ba2121">&#34;https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#19177c">&#39;silent</span> <span style="color:#19177c">&#39;inhibit-cookies</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">goto-char</span> (<span style="color:#00f">point-max</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">eval-print-last-sexp</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">load</span> <span style="color:#19177c">bootstrap-file</span> <span style="color:#800">nil</span> <span style="color:#19177c">&#39;nomessage</span>))
</span></span></code></pre></div><h4 id="use-package">use-package</h4>
<p>A macro to simplify package specification &amp; configuration. Integrates with straight.el.</p>
<p>Set <code>use-package-verbose</code> to <code>t</code> to print out loading times for individual packages.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/jwiegley/use-package">use-package repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">straight-use-package</span> <span style="color:#19177c">&#39;use-package</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">eval-when-compile</span> (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;use-package</span>))
</span></span></code></pre></div><h3 id="variables-and-environment">Variables &amp; environment</h3>
<p>This section is about optioning the Emacs config.</p>
<p>The following is true if Emacs is meant to be used with TRAMP over slow ssh. Take a look at the <a href="#tramp">TRAMP</a> section for more details.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/slow-ssh</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">or</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">string=</span> (<span style="color:#19177c">getenv</span> <span style="color:#ba2121">&#34;IS_TRAMP&#34;</span>) <span style="color:#ba2121">&#34;true&#34;</span>)))
</span></span></code></pre></div><p>The following is true is Emacs is run on a remote server where I don&rsquo;t need stuff like my org workflow</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/remote-server</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">or</span> (<span style="color:#19177c">string=</span> (<span style="color:#19177c">getenv</span> <span style="color:#ba2121">&#34;IS_REMOTE&#34;</span>) <span style="color:#ba2121">&#34;true&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">string=</span> (<span style="color:#00f">system-name</span>) <span style="color:#ba2121">&#34;dev-digital&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">string=</span> (<span style="color:#00f">system-name</span>) <span style="color:#ba2121">&#34;violet&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">string=</span> (<span style="color:#00f">system-name</span>) <span style="color:#ba2121">&#34;viridian&#34;</span>)))
</span></span></code></pre></div><p>And the following is true if Emacs is run from termux on Android.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/is-termux</span> (<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>) <span style="color:#ba2121">&#34;com.termux&#34;</span> (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>)) (<span style="color:#19177c">getenv</span> <span style="color:#ba2121">&#34;HOME&#34;</span>)))
</span></span></code></pre></div><p>Also, I sometimes need to know if a program is running inside Emacs (say, inside a terminal emulator). To do that, I set the following environment variable:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">setenv</span> <span style="color:#ba2121">&#34;IS_EMACS&#34;</span> <span style="color:#ba2121">&#34;true&#34;</span>)
</span></span></code></pre></div><p>Finally, I want to have a minimal Emacs config for debugging purposes. This has just straight.el, use-packages, and evil.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#19177c">&lt;&lt;minimal&gt;&gt;</span>
</span></span></code></pre></div><p>To launch Emacs with this config, run</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>emacs -q -l ~/.emacs.d/init-minimal.el
</span></span></code></pre></div><p>A convinience macro:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defmacro</span> <span style="color:#19177c">with-eval-after-load-norem</span> (<span style="color:#19177c">file</span> <span style="color:#008000">&amp;rest</span> <span style="color:#19177c">body</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">declare</span> (<span style="color:#19177c">indent</span> <span style="color:#666">1</span>) (<span style="color:#19177c">debug</span> (<span style="color:#19177c">form</span> <span style="color:#19177c">def-body</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#666">`</span>(<span style="color:#008000">unless</span> <span style="color:#19177c">my/remote-server</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">with-eval-after-load</span> <span style="color:#666">,</span><span style="color:#19177c">file</span>
</span></span><span style="display:flex;"><span>       <span style="color:#666">,@</span><span style="color:#19177c">body</span>)))
</span></span></code></pre></div><h3 id="performance">Performance</h3>
<h4 id="measure-startup-speed">Measure startup speed</h4>
<p>A small function to print out the loading time and number of GCs during the loading. Can be useful as a point of data for optimizing Emacs startup time.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/emacs-started</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;emacs-startup-hook</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	    (<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;*** Emacs loaded in %s with %d garbage collections.&#34;</span>
</span></span><span style="display:flex;"><span>		     (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;%.2f seconds&#34;</span>
</span></span><span style="display:flex;"><span>			     (<span style="color:#00f">float-time</span>
</span></span><span style="display:flex;"><span>			      (<span style="color:#00f">time-subtract</span> <span style="color:#19177c">after-init-time</span> <span style="color:#19177c">before-init-time</span>)))
</span></span><span style="display:flex;"><span>		     <span style="color:#19177c">gcs-done</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">setq</span> <span style="color:#19177c">my/emacs-started</span> <span style="color:#800">t</span>))
</span></span></code></pre></div><p>Set the following to <code>t</code> to print debug information during the startup. This will include the order in which the packages are loaded and the loading time of individual packages.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (setq use-package-verbose t)</span>
</span></span></code></pre></div><h4 id="garbage-collection">Garbage collection</h4>
<p>Just setting <code>gc-cons-treshold</code> to a larger value.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">gc-cons-threshold</span> <span style="color:#666">80000000</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">read-process-output-max</span> (<span style="color:#00f">*</span> <span style="color:#666">1024</span> <span style="color:#666">1024</span>))
</span></span></code></pre></div><h4 id="run-garbage-collection-when-emacs-is-unfocused">Run garbage collection when Emacs is unfocused</h4>
<p>Run GC when Emacs loses focus. <del>Time will tell if that&rsquo;s a good idea.</del></p>
<p>Some time has passed, and I still don&rsquo;t know if there is any quantifiable advantage to this, but it doesn&rsquo;t hurt.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;emacs-startup-hook</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">if</span> (<span style="color:#00f">boundp</span> <span style="color:#19177c">&#39;after-focus-change-function</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">add-function</span> <span style="color:#008000">:after</span> <span style="color:#19177c">after-focus-change-function</span>
</span></span><span style="display:flex;"><span>			      (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>				(<span style="color:#008000">unless</span> (<span style="color:#19177c">frame-focus-state</span>)
</span></span><span style="display:flex;"><span>				  (<span style="color:#00f">garbage-collect</span>))))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;after-focus-change-function</span> <span style="color:#19177c">&#39;garbage-collect</span>))))
</span></span></code></pre></div><h4 id="measure-ram-usage">Measure RAM usage</h4>
<p>I&rsquo;ve noticed that Emacs occasionally eats a lot of RAM, especially when used with EXWM. This is my attempt to measure RAM usage.</p>
<p>I have some concerns that <code>ps -o rss</code> may be unrepresentative because of <a href="https://stackoverflow.com/questions/131303/how-can-i-measure-the-actual-memory-usage-of-an-application-or-process">shared memory</a>, but I guess this shouldn&rsquo;t be a problem here because there&rsquo;s only one process of Emacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/get-ram-usage-async</span> (<span style="color:#19177c">callback</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">temp-buffer</span> (<span style="color:#19177c">generate-new-buffer</span> <span style="color:#ba2121">&#34;*ps*&#34;</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">proc</span> (<span style="color:#00f">start-process</span> <span style="color:#ba2121">&#34;ps&#34;</span> <span style="color:#19177c">temp-buffer</span> <span style="color:#ba2121">&#34;ps&#34;</span>
</span></span><span style="display:flex;"><span>			      <span style="color:#ba2121">&#34;-p&#34;</span> (<span style="color:#00f">number-to-string</span> (<span style="color:#00f">emacs-pid</span>)) <span style="color:#ba2121">&#34;-o&#34;</span> <span style="color:#ba2121">&#34;rss&#34;</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">set-process-sentinel</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">proc</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">lambda</span> (<span style="color:#19177c">process</span> <span style="color:#19177c">_msg</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">when</span> (<span style="color:#00f">eq</span> (<span style="color:#00f">process-status</span> <span style="color:#19177c">process</span>) <span style="color:#19177c">&#39;exit</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">let*</span> ((<span style="color:#19177c">output</span> (<span style="color:#008000">with-current-buffer</span> <span style="color:#19177c">temp-buffer</span>
</span></span><span style="display:flex;"><span>			  (<span style="color:#00f">buffer-string</span>)))
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">usage</span> (<span style="color:#00f">string-to-number</span> (<span style="color:#00f">nth</span> <span style="color:#666">1</span> (<span style="color:#19177c">split-string</span> <span style="color:#19177c">output</span> <span style="color:#ba2121">&#34;\n&#34;</span>)))))
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">ignore-errors</span>
</span></span><span style="display:flex;"><span>	     (<span style="color:#00f">funcall</span> <span style="color:#19177c">callback</span> <span style="color:#19177c">usage</span>)))
</span></span><span style="display:flex;"><span>	 (<span style="color:#00f">kill-buffer</span> <span style="color:#19177c">temp-buffer</span>))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/ram-usage</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/get-ram-usage-async</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">data</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;%f Gb&#34;</span> (<span style="color:#00f">/</span> (<span style="color:#00f">float</span> <span style="color:#19177c">data</span>) <span style="color:#666">1024</span> <span style="color:#666">1024</span>)))))
</span></span></code></pre></div><h3 id="anaconda">Anaconda</h3>
<p><a href="https://www.anaconda.com/">Anaconda</a> is a free package and environment manager. I currently use it to manage multiple versions of Python and Node.js. Take a look at <a href="/configs/guix/#conda">the corresponding entry</a> in the Guix config for details about using it on Guix.</p>
<p>The following code uses the <code>conda</code> package to activate the base environment on startup if Emacs is launched outside the environment.</p>
<p>Also, some strange things are happening if vterm is launched with conda activated from Emacs, so I advise <code>conda-env-activate</code> to set an auxiliary environment variable. This variable is used in the <a href="/configs/console/#anaconda">shell config</a>.</p>
<p>References:</p>
<ul>
<li><a href="https://docs.anaconda.com/">Anaconda docs</a></li>
<li><a href="https://github.com/necaris/conda.el">conda.el repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">conda</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">executable-find</span> <span style="color:#ba2121">&#34;conda&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">conda-anaconda-home</span> (<span style="color:#19177c">string-replace</span> <span style="color:#ba2121">&#34;/bin/conda&#34;</span> <span style="color:#ba2121">&#34;&#34;</span> (<span style="color:#19177c">executable-find</span> <span style="color:#ba2121">&#34;conda&#34;</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">conda-env-home-directory</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;~/.conda/&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">conda-env-subdirectory</span> <span style="color:#ba2121">&#34;envs&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;conda-env-activate</span> <span style="color:#008000">:after</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">lambda</span> (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">_</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">setenv</span> <span style="color:#ba2121">&#34;EMACS_CONDA_ENV&#34;</span> <span style="color:#19177c">conda-env-current-name</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">setenv</span> <span style="color:#ba2121">&#34;INIT_CONDA&#34;</span> <span style="color:#ba2121">&#34;true&#34;</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;conda-env-deactivate</span> <span style="color:#008000">:after</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">lambda</span> (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">_</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">setenv</span> <span style="color:#ba2121">&#34;EMACS_CONDA_ENV&#34;</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">setenv</span> <span style="color:#ba2121">&#34;INIT_CONDA&#34;</span> <span style="color:#800">nil</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> (<span style="color:#19177c">getenv</span> <span style="color:#ba2121">&#34;CONDA_DEFAULT_ENV&#34;</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">conda-env-activate</span> <span style="color:#ba2121">&#34;general&#34;</span>)))
</span></span></code></pre></div><h3 id="config-files">Config files</h3>
<h4 id="custom-file-location">Custom file location</h4>
<p>By default, <code>custom</code> writes stuff to <code>init.el</code>, which is somewhat annoying. The following makes it write to a separate file <code>custom.el</code></p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">custom-file</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">user-emacs-directory</span> <span style="color:#ba2121">&#34;custom.el&#34;</span>))
</span></span><span style="display:flex;"><span>(<span style="color:#00f">load</span> <span style="color:#19177c">custom-file</span> <span style="color:#19177c">&#39;noerror</span>)
</span></span></code></pre></div><h4 id="authinfo">authinfo</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">auth-source-debug</span> <span style="color:#800">nil</span>)
</span></span></code></pre></div><h4 id="private-config">Private config</h4>
<p>I have some variables which I don&rsquo;t commit to the repo, e.g. my current location. They are stored in <code>private.el</code></p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">let</span> ((<span style="color:#19177c">private-file</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;private.el&#34;</span> <span style="color:#19177c">user-emacs-directory</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#19177c">private-file</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">load-file</span> <span style="color:#19177c">private-file</span>)))
</span></span></code></pre></div><h4 id="no-littering">No littering</h4>
<p>By default Emacs and its packages create a lot files in <code>.emacs.d</code> and in other places. <a href="https://github.com/emacscollective/no-littering">no-littering</a> is a collective effort to redirect all of that to two folders in <code>user-emacs-directory</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">no-littering</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h3 id="prevent-emacs-from-closing">Prevent Emacs from closing</h3>
<p>This adds a confirmation to avoid accidental Emacs closing.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">confirm-kill-emacs</span> <span style="color:#19177c">&#39;y-or-n-p</span>)
</span></span></code></pre></div><h2 id="general-settings">General settings</h2>
<h3 id="keybindings">Keybindings</h3>
<h4 id="general-dot-el">general.el</h4>
<p>general.el provides a convenient interface to manage Emacs keybindings.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/noctuid/general.el">general.el repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">general</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-evil-setup</span>))
</span></span></code></pre></div><h4 id="which-key">which-key</h4>
<p>A package that displays the available keybindings in a popup. The package is pretty useful, as Emacs seems to have more keybindings than I can remember at any given point.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/justbur/emacs-which-key">which-key repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">which-key</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">which-key-idle-delay</span> <span style="color:#666">0.3</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">which-key-popup-type</span> <span style="color:#19177c">&#39;frame</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">which-key-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">which-key-setup-side-window-bottom</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">set-face-attribute</span> <span style="color:#19177c">&#39;which-key-local-map-description-face</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>		      <span style="color:#008000">:weight</span> <span style="color:#19177c">&#39;bold</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h5 id="dump-keybindings">dump keybindings</h5>
<p>A function to dump keybindings starting with a prefix to a buffer in a tree-like form.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dump-bindings-recursive</span> (<span style="color:#19177c">prefix</span> <span style="color:#008000">&amp;optional</span> <span style="color:#19177c">level</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">dolist</span> (<span style="color:#19177c">key</span> (<span style="color:#19177c">which-key--get-bindings</span> (<span style="color:#19177c">kbd</span> <span style="color:#19177c">prefix</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> <span style="color:#19177c">level</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">insert</span> (<span style="color:#00f">make-string</span> <span style="color:#19177c">level</span> <span style="color:#ba2121">? </span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">insert</span> (<span style="color:#00f">apply</span> <span style="color:#00f">#&#39;format</span> <span style="color:#ba2121">&#34;%s%s%s\n&#34;</span> <span style="color:#19177c">key</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> (<span style="color:#19177c">string-match-p</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">rx</span> <span style="color:#19177c">bos</span> <span style="color:#ba2121">&#34;+&#34;</span> (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>))
</span></span><span style="display:flex;"><span>	   (<span style="color:#00f">substring-no-properties</span> (<span style="color:#00f">elt</span> <span style="color:#19177c">key</span> <span style="color:#666">2</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">my/dump-bindings-recursive</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">concat</span> <span style="color:#19177c">prefix</span> <span style="color:#ba2121">&#34; &#34;</span> (<span style="color:#00f">substring-no-properties</span> (<span style="color:#00f">car</span> <span style="color:#19177c">key</span>)))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">+</span> <span style="color:#666">2</span> (<span style="color:#008000">or</span> <span style="color:#19177c">level</span> <span style="color:#666">0</span>))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dump-bindings</span> (<span style="color:#19177c">prefix</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Dump keybindings starting with PREFIX in a tree-like form.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> <span style="color:#ba2121">&#34;sPrefix: &#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">with-current-buffer</span> (<span style="color:#00f">get-buffer-create</span> <span style="color:#ba2121">&#34;bindings&#34;</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">point-max</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">erase-buffer</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">save-excursion</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">my/dump-bindings-recursive</span> <span style="color:#19177c">prefix</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">switch-to-buffer-other-window</span> <span style="color:#ba2121">&#34;bindings&#34;</span>))
</span></span></code></pre></div><h4 id="evil">Evil</h4>
<p>An entire ecosystem of packages that emulates the main features of Vim. Probably the best vim emulator out there.</p>
<p>The only problem is that the package name makes it hard to google anything by just typing &ldquo;evil&rdquo;.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/emacs-evil/evil">evil repo</a></li>
<li><a href="https://www.youtube.com/watch?v=JWD1Fpdd4Pc">(YouTube) Evil Mode: Or, How I Learned to Stop Worrying and Love Emacs</a></li>
</ul>
<h5 id="evil-mode">Evil-mode</h5>
<p>Basic evil configuration.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">evil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">evil-want-integration</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">evil-want-C-u-scroll</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">evil-want-keybinding</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">evil-search-module</span> <span style="color:#19177c">&#39;evil-search</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">evil-split-window-below</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">evil-vsplit-window-right</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> (<span style="color:#19177c">display-graphic-p</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq</span> <span style="color:#19177c">evil-want-C-i-jump</span> <span style="color:#800">nil</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (setq evil-respect-visual-line-mode t)</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-set-undo-system</span> <span style="color:#19177c">&#39;undo-tree</span>))
</span></span></code></pre></div><h5 id="addons">Addons</h5>
<p><a href="https://github.com/emacs-evil/evil-surround">evil-surround</a> emulates one of my favorite vim plugins, surround.vim. Adds a lot of parentheses management options.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">evil-surround</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">evil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">global-evil-surround-mode</span> <span style="color:#666">1</span>))
</span></span></code></pre></div><p><a href="https://github.com/linktohack/evil-commentary">evil-commentary</a> emulates commentary.vim. It provides actions for quick insertion and deletion of comments.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">evil-commentary</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">evil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-commentary-mode</span>))
</span></span></code></pre></div><p><a href="https://github.com/blorbx/evil-quickscope">evil-quickscope</a> emulates quickscope.vim. It highlights certain target characters for f, F, t, T keys.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">evil-quickscope</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">evil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> ((<span style="color:#19177c">prog-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">turn-on-evil-quickscope-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">LaTeX-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">turn-on-evil-quickscope-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">org-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">turn-on-evil-quickscope-mode</span>)))
</span></span></code></pre></div><p><a href="https://github.com/cofi/evil-numbers">evil-numbers</a> allows incrementing and decrementing numbers at point.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">evil-numbers</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">evil-numbers/inc-at-pt</span> <span style="color:#19177c">evil-numbers/dec-at-pt</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-nmap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;g+&#34;</span> <span style="color:#19177c">&#39;evil-numbers/inc-at-pt</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;g-&#34;</span> <span style="color:#19177c">&#39;evil-numbers/dec-at-pt</span>))
</span></span></code></pre></div><p><a href="https://github.com/edkolev/evil-lion">evil-lion</a> provides alignment operators, somewhat similar to vim-easyalign.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">evil-lion</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">evil-lion-left-align-key</span> (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;g a&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">evil-lion-right-align-key</span> (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;g A&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-lion-mode</span>))
</span></span></code></pre></div><p><a href="https://github.com/redguardtoo/evil-matchit">evil-matchit</a> makes &ldquo;%&rdquo; to match things like tags. It doesn&rsquo;t work perfectly, so I <del>occasionally</del> turn it off.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">evil-matchit</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:disabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">global-evil-matchit-mode</span> <span style="color:#666">1</span>))
</span></span></code></pre></div><h5 id="my-additions">My additions</h5>
<p>Do ex search in other buffer. Like <code>*</code>, but switch to other buffer and search there.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/evil-ex-search-word-forward-other-window</span> (<span style="color:#19177c">count</span> <span style="color:#008000">&amp;optional</span> <span style="color:#19177c">symbol</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> (<span style="color:#00f">list</span> (<span style="color:#00f">prefix-numeric-value</span> <span style="color:#19177c">current-prefix-arg</span>)
</span></span><span style="display:flex;"><span>		     <span style="color:#19177c">evil-symbol-word-search</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">save-excursion</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">evil-ex-start-word-search</span> <span style="color:#800">nil</span> <span style="color:#19177c">&#39;forward</span> <span style="color:#19177c">count</span> <span style="color:#19177c">symbol</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">other-window</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-ex-search-next</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;&amp;&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/evil-ex-search-word-forward-other-window</span>)
</span></span></code></pre></div><h5 id="evil-collection">evil-collection</h5>
<p><a href="https://github.com/emacs-evil/evil-collection">evil-collection</a> is a package that provides evil bindings for a lot of different packages. One can see the complete list in the <a href="https://github.com/emacs-evil/evil-collection/tree/master/modes">modes</a> folder.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">evil-collection</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">evil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-collection-init</span>
</span></span><span style="display:flex;"><span>   <span style="color:#666">&#39;</span>(<span style="color:#19177c">eww</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">devdocs</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">proced</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">emms</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">pass</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">calendar</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">dired</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">ivy</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">debug</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">guix</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">calc</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">docker</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">ibuffer</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">geiser</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">pdf</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">info</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">elfeed</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">edebug</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">bookmark</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">company</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">vterm</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">flycheck</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">profiler</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">cider</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">explain-pause-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">notmuch</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">custom</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">xref</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">eshell</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">helpful</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">compile</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">comint</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">git-timemachine</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">magit</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">prodigy</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">slime</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">forge</span>)))
</span></span></code></pre></div><h4 id="avy">Avy</h4>
<p><a href="https://github.com/abo-abo/avy">Avy</a> is a package that helps navigate Emacs in a tree-like manner.</p>
<p>References:</p>
<ul>
<li><a href="https://karthinks.com/software/avy-can-do-anything/">Avy can do anything</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">avy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">avy-timeout-seconds</span> <span style="color:#666">0.5</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">avy-ignored-modes</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">&#39;</span>(<span style="color:#19177c">image-mode</span> <span style="color:#19177c">doc-view-mode</span> <span style="color:#19177c">pdf-view-mode</span> <span style="color:#19177c">exwm-mode</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">motion</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;-&#34;</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;--&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">avy-goto-char-2</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;-=&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">avy-goto-symbol-1</span>))
</span></span></code></pre></div><h4 id="my-keybindings">My keybindings</h4>
<p>Various keybinding settings that I can&rsquo;t put anywhere else.</p>
<h5 id="escape-key">Escape key</h5>
<p>Use the escape key instead of <code>C-g</code> whenever possible.</p>
<p>I must have copied it from somewhere, but as I googled to find out the source, I discovered quite a number of variations of the following code over time. I wonder if Richard Dawkins was inspired by something like this a few decades ago.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">minibuffer-keyboard-quit</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Abort recursive edit.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">In Delete Selection mode, if the mark is active, just deactivate it;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">then it takes a second \\[keyboard-quit] to abort the minibuffer.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">if</span> (<span style="color:#008000">and</span> <span style="color:#19177c">delete-selection-mode</span> <span style="color:#19177c">transient-mark-mode</span> <span style="color:#19177c">mark-active</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">setq</span> <span style="color:#19177c">deactivate-mark</span>  <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> (<span style="color:#00f">get-buffer</span> <span style="color:#ba2121">&#34;*Completions*&#34;</span>) (<span style="color:#19177c">delete-windows-on</span> <span style="color:#ba2121">&#34;*Completions*&#34;</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">abort-recursive-edit</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/escape-key</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-ex-nohighlight</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">keyboard-quit</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">visual</span> <span style="color:#19177c">global</span>)
</span></span><span style="display:flex;"><span> [<span style="color:#19177c">escape</span>] <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/escape-key</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">minibuffer-local-map</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#19177c">minibuffer-local-ns-map</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#19177c">minibuffer-local-completion-map</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#19177c">minibuffer-local-must-match-map</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#19177c">minibuffer-local-isearch-map</span>)
</span></span><span style="display:flex;"><span> [<span style="color:#19177c">escape</span>] <span style="color:#19177c">&#39;minibuffer-keyboard-quit</span>)
</span></span></code></pre></div><h5 id="home-and-end">Home &amp; end</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">general-def</span> <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#00f">insert</span> <span style="color:#19177c">visual</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&lt;home&gt;&#34;</span> <span style="color:#19177c">&#39;beginning-of-line</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&lt;end&gt;&#34;</span> <span style="color:#19177c">&#39;end-of-line</span>)
</span></span></code></pre></div><h5 id="my-leader">My leader</h5>
<p>Using the <code>SPC</code> key as a leader key, like in Doom Emacs or Spacemacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">general-create-definer</span> <span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;override</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:prefix</span> <span style="color:#ba2121">&#34;SPC&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">motion</span> <span style="color:#19177c">emacs</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-def</span> <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">motion</span> <span style="color:#19177c">emacs</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;SPC&#34;</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;M-SPC&#34;</span> (<span style="color:#19177c">general-key</span> <span style="color:#ba2121">&#34;SPC&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-def</span> <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#00f">insert</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;M-SPC&#34;</span> (<span style="color:#19177c">general-key</span> <span style="color:#ba2121">&#34;SPC&#34;</span> <span style="color:#008000">:state</span> <span style="color:#19177c">&#39;normal</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;?&#34;</span> <span style="color:#19177c">&#39;which-key-show-top-level</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;E&#34;</span> <span style="color:#19177c">&#39;eval-expression</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-def</span> <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#00f">insert</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&lt;f1&gt; e&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">eval-expression</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;SPC&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:wk</span> <span style="color:#ba2121">&#34;second level&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;SPC x&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:wk</span> <span style="color:#ba2121">&#34;ctl-x&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;SPC x&#34;</span> <span style="color:#19177c">ctl-x-map</span>)
</span></span></code></pre></div><p><code>general.el</code> has a nice integration with which-key, so I use that to show more descriptive annotations for certain groups of keybindings (the default annotation is just <code>prefix</code>).</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;a&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;apps&#34;</span>))
</span></span></code></pre></div><h5 id="universal-argument">Universal argument</h5>
<p>Change the universal argument to <code>M-u</code>. I use <code>C-u</code> to scroll up, as I&rsquo;m used to from vim.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">general-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;universal-argument-map</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;M-u&#34;</span> <span style="color:#19177c">&#39;universal-argument-more</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;override</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">motion</span> <span style="color:#19177c">emacs</span> <span style="color:#00f">insert</span> <span style="color:#19177c">visual</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;M-u&#34;</span> <span style="color:#19177c">&#39;universal-argument</span>)
</span></span></code></pre></div><h5 id="profiler">Profiler</h5>
<p>The built-in profiler is a magnificent tool to troubleshoot performance issues.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;P&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;profiler&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#19177c">&#39;profiler-start</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;e&#34;</span> <span style="color:#19177c">&#39;profiler-stop</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;p&#34;</span> <span style="color:#19177c">&#39;profiler-report</span>)
</span></span></code></pre></div><h5 id="buffer-switching">Buffer switching</h5>
<p>Some keybindings I used in vim to switch buffers and can&rsquo;t let go of. But I think I started to use these less since I made an attempt in <a href="#i3-integration">i3 integration</a>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;override</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-&lt;right&gt;&#34;</span> <span style="color:#19177c">&#39;evil-window-right</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-&lt;left&gt;&#34;</span> <span style="color:#19177c">&#39;evil-window-left</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-&lt;up&gt;&#34;</span> <span style="color:#19177c">&#39;evil-window-up</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-&lt;down&gt;&#34;</span> <span style="color:#19177c">&#39;evil-window-down</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-h&#34;</span> <span style="color:#19177c">&#39;evil-window-left</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-l&#34;</span> <span style="color:#19177c">&#39;evil-window-right</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-k&#34;</span> <span style="color:#19177c">&#39;evil-window-up</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-j&#34;</span> <span style="color:#19177c">&#39;evil-window-down</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-x h&#34;</span> <span style="color:#19177c">&#39;previous-buffer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;C-x l&#34;</span> <span style="color:#19177c">&#39;next-buffer</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;evil-window-map</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;x&#34;</span> <span style="color:#19177c">&#39;kill-buffer-and-window</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#19177c">&#39;kill-current-buffer</span>)
</span></span></code></pre></div><p><code>winner-mode</code> to keep the history of window states.</p>
<p>It doesn&rsquo;t play too well with perspective.el, that is it has a single history list for all of the perspectives. But it is still quite usable.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">winner-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;evil-window-map</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#19177c">&#39;winner-undo</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;U&#34;</span> <span style="color:#19177c">&#39;winner-redo</span>)
</span></span></code></pre></div><h5 id="buffer-management">Buffer management</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;b&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;buffers&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#666">&#39;</span>((<span style="color:#008000">lambda</span> () (<span style="color:#008000">interactive</span>) (<span style="color:#19177c">switch-to-buffer</span> (<span style="color:#19177c">persp-scratch-buffer</span>)))
</span></span><span style="display:flex;"><span>	<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;*scratch*&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;m&#34;</span> <span style="color:#666">&#39;</span>((<span style="color:#008000">lambda</span> () (<span style="color:#008000">interactive</span>) (<span style="color:#19177c">persp-switch-to-buffer</span> <span style="color:#ba2121">&#34;*Messages*&#34;</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;*Messages*&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;l&#34;</span> <span style="color:#19177c">&#39;next-buffer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;h&#34;</span> <span style="color:#19177c">&#39;previous-buffer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;k&#34;</span> <span style="color:#19177c">&#39;kill-buffer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;b&#34;</span> <span style="color:#19177c">&#39;persp-ivy-switch-buffer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;r&#34;</span> <span style="color:#19177c">&#39;revert-buffer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#19177c">&#39;ibuffer</span>)
</span></span></code></pre></div><h5 id="xref">xref</h5>
<p>Some keybindings for xref and go to definition.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">general-nmap</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;gD&#34;</span> <span style="color:#19177c">&#39;xref-find-definitions-other-window</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;gr&#34;</span> <span style="color:#19177c">&#39;xref-find-references</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;gd&#34;</span> <span style="color:#19177c">&#39;evil-goto-definition</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;fx&#34;</span> <span style="color:#19177c">&#39;xref-find-apropos</span>)
</span></span></code></pre></div><h5 id="folding">Folding</h5>
<p>There are multiple ways to fold text in Emacs.</p>
<p>The most versatile is the built-in <code>hs-minor-mode</code>, which seems to work out of the box for Lisps, C-like languages, and Python. <code>outline-minor-mode</code> works for org-mode, LaTeX and the like. There is a 3rd-party solution <a href="https://github.com/elp-revive/origami.el">origami.el</a>, which I found to be somewhat less stable.</p>
<p>Evil does a pretty good job of abstracting all these packages with a set of vim-like keybindings. I was using <code>SPC</code> in vim, but as now this isn&rsquo;t an option, I set <code>TAB</code> to toggle folding.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">general-nmap</span> <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">hs-minor-mode-map</span> <span style="color:#19177c">outline-minor-mode-map</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;ze&#34;</span> <span style="color:#19177c">&#39;hs-hide-level</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;TAB&#34;</span> <span style="color:#19177c">&#39;evil-toggle-fold</span>)
</span></span></code></pre></div><h5 id="zoom-ui">Zoom UI</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/zoom-in</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Increase font size by 10 points&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">set-face-attribute</span> <span style="color:#19177c">&#39;default</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>		      <span style="color:#008000">:height</span>
</span></span><span style="display:flex;"><span>		      (<span style="color:#00f">+</span> (<span style="color:#19177c">face-attribute</span> <span style="color:#19177c">&#39;default</span> <span style="color:#008000">:height</span>) <span style="color:#666">10</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/zoom-out</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Decrease font size by 10 points&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">set-face-attribute</span> <span style="color:#19177c">&#39;default</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>		      <span style="color:#008000">:height</span>
</span></span><span style="display:flex;"><span>		      (<span style="color:#00f">-</span> (<span style="color:#19177c">face-attribute</span> <span style="color:#19177c">&#39;default</span> <span style="color:#008000">:height</span>) <span style="color:#666">10</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; change font size, interactively</span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">global-set-key</span> (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;C-+&#34;</span>) <span style="color:#19177c">&#39;my/zoom-in</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">global-set-key</span> (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;C-=&#34;</span>) <span style="color:#19177c">&#39;my/zoom-out</span>)
</span></span></code></pre></div><h3 id="i3-integration-1">i3 integration</h3>
<p>UPD <span class="timestamp-wrapper"><span class="timestamp">&lt;2021-11-27 Sat&gt;</span></span>. I have finally switched to EXWM as my window manager, but as long as I keep i3 as a backup solution, this section persists. Check out the <a href="https://sqrtminusone.xyz/posts/2021-10-04-emacs-i3/">post</a> for a somewhat better presentation.</p>
<p>One advantage of EXWM for an Emacs user is that EXWM gives one set of keybindings to manage both Emacs windows and X windows. In every other WM, like my preferred <a href="https://i3wm.org">i3wm</a>, two orthogonal keymaps seem to be necessary. But, as both programs are quite customizable, I want to see whether I can replicate at least some part of the EXWM goodness in i3.</p>
<p>But why not just use EXWM? One key reason is that to my taste (and perhaps on my hardware) EXWM didn&rsquo;t feel snappy enough. Also, I really like i3&rsquo;s tree-based layout structure; I feel like it fits my workflow much better than anything else I tried, including the master/stack paradigm of <a href="https://xmonad.org/">XMonad</a>, for instance.</p>
<p>One common point of criticism of i3 is that it is not extensible enough, especially compared to WMs that are configured in an actual programing language, like the mentioned XMonad, <a href="http://www.qtile.org/">Qtile</a>, <a href="https://awesomewm.org/">Awesome</a>, etc. But I think i3&rsquo;s extensibility is underappreciated, although the contents of this section may lie closer to the limits of how far one can go there.</p>
<p>The basic idea is to launch a normal i3 command with <code>i3-msg</code> in case the current window is not Emacs, otherwise pass that command to Emacs with <code>emacsclient</code>. In Emacs, execute the command if possible, otherwise pass the command back to i3.</p>
<p>This may seem like a lot of overhead, but I didn&rsquo;t feel it even in the worst case (i3 -&gt; Emacs -&gt; i3), so at least in that regard, the interaction feels seamless. The only concern is that this command flow is vulnerable to Emacs getting stuck, but it is still much less of a problem than with EXWM.</p>
<p>One interesting observation here is that Emacs windows and X windows are sort of one-level entities, so I can talk just about &ldquo;windows&rdquo;.</p>
<p>At any rate, we need a script to do the i3 -&gt; Emacs part:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">if</span> <span style="color:#666">[[</span> <span style="color:#008000;font-weight:bold">$(</span>xdotool getactivewindow getwindowname<span style="color:#008000;font-weight:bold">)</span> <span style="color:#666">=</span>~ ^emacs<span style="color:#666">(</span>:.*<span style="color:#666">)</span>?@.* <span style="color:#666">]]</span>; <span style="color:#008000;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#19177c">command</span><span style="color:#666">=</span><span style="color:#ba2121">&#34;(my/emacs-i3-integration \&#34;</span><span style="color:#19177c">$@</span><span style="color:#ba2121">\&#34;)&#34;</span>
</span></span><span style="display:flex;"><span>    emacsclient -e <span style="color:#ba2121">&#34;</span><span style="color:#19177c">$command</span><span style="color:#ba2121">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    i3-msg <span style="color:#19177c">$@</span>
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">fi</span>
</span></span></code></pre></div><p>This script is being run from the <a href="/configs/desktop/#i3wm">i3 configuration</a>.</p>
<p>For this to work, we need to make sure that Emacs starts a server, so here is an expression to do just that:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">unless</span> <span style="color:#19177c">my/remote-server</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;after-init-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">server-start</span>))
</span></span></code></pre></div><p>And here is a simple macro to do the Emacs -&gt; i3 part:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defmacro</span> <span style="color:#19177c">i3-msg</span> (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">args</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#666">`</span>(<span style="color:#00f">start-process</span> <span style="color:#ba2121">&#34;emacs-i3-windmove&#34;</span> <span style="color:#800">nil</span> <span style="color:#ba2121">&#34;i3-msg&#34;</span> <span style="color:#666">,@</span><span style="color:#19177c">args</span>))
</span></span></code></pre></div><p>Now we have to handle the required set of i3 commands. It is worth noting here that I&rsquo;m not trying to implement a general mechanism to apply i3 commands to Emacs, rather I&rsquo;m implementing a small subset that I use in my i3 configuration and that maps reasonably to the Emacs concepts.</p>
<p>Also, I use <a href="https://github.com/emacs-evil/evil">evil-mode</a> and generally configure the software to have vim-style bindings where possible. So if you don&rsquo;t use evil-mode you&rsquo;d have to detangle the given functions from evil, but then, I guess, you do not use super+hjkl to manage windows either.</p>
<p>First, for the <code>focus</code> command I want to move to an Emacs window in the given direction if there is one, otherwise move to an X window in the same direction. Fortunately, i3 and windmove have the same names for directions, so the function is rather straightforward.</p>
<p>One caveat here is that the minibuffer is always the bottom-most Emacs window, so it is necessary to check for that as well.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/emacs-i3-windmove</span> (<span style="color:#19177c">dir</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">other-window</span> (<span style="color:#19177c">windmove-find-other-window</span> <span style="color:#19177c">dir</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> (<span style="color:#008000">or</span> (<span style="color:#00f">null</span> <span style="color:#19177c">other-window</span>) (<span style="color:#00f">window-minibuffer-p</span> <span style="color:#19177c">other-window</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">i3-msg</span> <span style="color:#ba2121">&#34;focus&#34;</span> (<span style="color:#00f">symbol-name</span> <span style="color:#19177c">dir</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">windmove-do-window-select</span> <span style="color:#19177c">dir</span>))))
</span></span></code></pre></div><p>For the <code>move</code> I want the following behavior:</p>
<ul>
<li>if there is space in the required direction, move the Emacs window there;</li>
<li>if there is no space in the required direction, but space in two orthogonal directions, move the Emacs window so that there is no more space in the orthogonal directions;</li>
<li>otherwise, move an X window (Emacs frame).</li>
</ul>
<p>For the first part, <code>window-swap-states</code> with <code>windmove-find-other-window</code> do well enough.</p>
<p><code>evil-move-window</code> works well for the second part. By itself it doesn&rsquo;t behave quite like i3, for instance, <code>(evil-move-window 'right)</code> in a three-column split would move the window from the far left side to the far right side (bypassing center). Hence the combination as described here.</p>
<p>So here is a simple predicate which checks whether there is space in the given direction.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/emacs-i3-direction-exists-p</span> (<span style="color:#19177c">dir</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">cl-some</span> (<span style="color:#008000">lambda</span> (<span style="color:#19177c">dir</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">let</span> ((<span style="color:#19177c">win</span> (<span style="color:#19177c">windmove-find-other-window</span> <span style="color:#19177c">dir</span>)))
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">and</span> <span style="color:#19177c">win</span> (<span style="color:#19177c">not</span> (<span style="color:#00f">window-minibuffer-p</span> <span style="color:#19177c">win</span>)))))
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">pcase</span> <span style="color:#19177c">dir</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">&#39;width</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">left</span> <span style="color:#19177c">right</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">&#39;height</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">up</span> <span style="color:#19177c">down</span>)))))
</span></span></code></pre></div><p>And the implementation of the move command.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/emacs-i3-move-window</span> (<span style="color:#19177c">dir</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">other-window</span> (<span style="color:#19177c">windmove-find-other-window</span> <span style="color:#19177c">dir</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">other-direction</span> (<span style="color:#19177c">my/emacs-i3-direction-exists-p</span>
</span></span><span style="display:flex;"><span>			  (<span style="color:#008000">pcase</span> <span style="color:#19177c">dir</span>
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">&#39;up</span> <span style="color:#19177c">&#39;width</span>)
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">&#39;down</span> <span style="color:#19177c">&#39;width</span>)
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">&#39;left</span> <span style="color:#19177c">&#39;height</span>)
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">&#39;right</span> <span style="color:#19177c">&#39;height</span>)))))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">cond</span>
</span></span><span style="display:flex;"><span>     ((<span style="color:#008000">and</span> <span style="color:#19177c">other-window</span> (<span style="color:#19177c">not</span> (<span style="color:#00f">window-minibuffer-p</span> <span style="color:#19177c">other-window</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">window-swap-states</span> (<span style="color:#00f">selected-window</span>) <span style="color:#19177c">other-window</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">other-direction</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">evil-move-window</span> <span style="color:#19177c">dir</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#800">t</span> (<span style="color:#19177c">i3-msg</span> <span style="color:#ba2121">&#34;move&#34;</span> (<span style="color:#00f">symbol-name</span> <span style="color:#19177c">dir</span>))))))
</span></span></code></pre></div><p>Next on the line are <code>resize grow</code> and <code>resize shrink</code>. <code>evil-window-</code> functions do nicely for this task.</p>
<p>This function also checks whether there is space to resize in the given direction with the help of the predicate defined above. The command is forwarded back to i3 if there is not.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/emacs-i3-resize-window</span> (<span style="color:#19177c">dir</span> <span style="color:#19177c">kind</span> <span style="color:#19177c">value</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">if</span> (<span style="color:#008000">or</span> (<span style="color:#19177c">one-window-p</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">not</span> (<span style="color:#19177c">my/emacs-i3-direction-exists-p</span> <span style="color:#19177c">dir</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">i3-msg</span> <span style="color:#ba2121">&#34;resize&#34;</span> (<span style="color:#00f">symbol-name</span> <span style="color:#19177c">kind</span>) (<span style="color:#00f">symbol-name</span> <span style="color:#19177c">dir</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;%s px or %s ppt&#34;</span> <span style="color:#19177c">value</span> <span style="color:#19177c">value</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq</span> <span style="color:#19177c">value</span> (<span style="color:#00f">/</span> <span style="color:#19177c">value</span> <span style="color:#666">2</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">pcase</span> <span style="color:#19177c">kind</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">&#39;shrink</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">pcase</span> <span style="color:#19177c">dir</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">&#39;width</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">evil-window-decrease-width</span> <span style="color:#19177c">value</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">&#39;height</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">evil-window-decrease-height</span> <span style="color:#19177c">value</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">&#39;grow</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">pcase</span> <span style="color:#19177c">dir</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">&#39;width</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">evil-window-increase-width</span> <span style="color:#19177c">value</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">&#39;height</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">evil-window-increase-height</span> <span style="color:#19177c">value</span>)))))))
</span></span></code></pre></div><p><a href="https://github.com/emacsorphanage/transpose-frame">transpose-frame</a> is a package to &ldquo;transpose&rdquo; the current frame layout, which behaves someone similar to the <code>layout toggle split</code> command in i3, so I&rsquo;ll use it as well.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">transpose-frame</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">transpose-frame</span>))
</span></span></code></pre></div><p>Finally, the entrypoint for the Emacs integration. In addition to the commands defined above, it processes <code>split</code> and <code>kill</code> commands and passes every other command back to i3.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/emacs-i3-integration</span> (<span style="color:#19177c">command</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">pcase</span> <span style="color:#19177c">command</span>
</span></span><span style="display:flex;"><span>    ((<span style="color:#008000">rx</span> <span style="color:#19177c">bos</span> <span style="color:#ba2121">&#34;focus&#34;</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">my/emacs-i3-windmove</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">intern</span> (<span style="color:#00f">elt</span> (<span style="color:#19177c">split-string</span> <span style="color:#19177c">command</span>) <span style="color:#666">1</span>))))
</span></span><span style="display:flex;"><span>    ((<span style="color:#008000">rx</span> <span style="color:#19177c">bos</span> <span style="color:#ba2121">&#34;move&#34;</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">my/emacs-i3-move-window</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">intern</span> (<span style="color:#00f">elt</span> (<span style="color:#19177c">split-string</span> <span style="color:#19177c">command</span>) <span style="color:#666">1</span>))))
</span></span><span style="display:flex;"><span>    ((<span style="color:#008000">rx</span> <span style="color:#19177c">bos</span> <span style="color:#ba2121">&#34;resize&#34;</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">my/emacs-i3-resize-window</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">intern</span> (<span style="color:#00f">elt</span> (<span style="color:#19177c">split-string</span> <span style="color:#19177c">command</span>) <span style="color:#666">2</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">intern</span> (<span style="color:#00f">elt</span> (<span style="color:#19177c">split-string</span> <span style="color:#19177c">command</span>) <span style="color:#666">1</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">string-to-number</span> (<span style="color:#00f">elt</span> (<span style="color:#19177c">split-string</span> <span style="color:#19177c">command</span>) <span style="color:#666">3</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#ba2121">&#34;layout toggle split&#34;</span> (<span style="color:#19177c">transpose-frame</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#ba2121">&#34;split h&#34;</span> (<span style="color:#19177c">evil-window-split</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#ba2121">&#34;split v&#34;</span> (<span style="color:#19177c">evil-window-vsplit</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#ba2121">&#34;kill&#34;</span> (<span style="color:#19177c">evil-quit</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">-</span> (<span style="color:#19177c">i3-msg</span> <span style="color:#19177c">command</span>))))
</span></span></code></pre></div><h3 id="editing-text">Editing text</h3>
<p>Various packages, tricks, and settings that help with the central task of Emacs - editing text.</p>
<h4 id="indentation-and-whitespace">Indentation &amp; whitespace</h4>
<h5 id="aggressive-indent">Aggressive Indent</h5>
<p>A package to keep the code intended.</p>
<p>Doesn&rsquo;t work too well with many ecosystems because the LSP-based indentation is rather slow but nice for Lisps.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/Malabarba/aggressive-indent-mode">aggressive-indent-mode repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">aggressive-indent</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">aggressive-indent-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h5 id="delete-trailing-whitespace">Delete trailing whitespace</h5>
<p>Delete trailing whitespace on save, unless in particular modes where trailing whitespace is important, like Markdown.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/trailing-whitespace-modes</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">markdown-mode</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">require</span> <span style="color:#19177c">&#39;cl-extra</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;before-save-hook</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">unless</span> (<span style="color:#19177c">cl-some</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">derived-mode-p</span> <span style="color:#19177c">my/trailing-whitespace-modes</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">delete-trailing-whitespace</span>))))
</span></span></code></pre></div><h5 id="tabs">Tabs</h5>
<p>Some default settings to manage tabs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">tab-always-indent</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq-default</span> <span style="color:#19177c">default-tab-width</span> <span style="color:#666">4</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq-default</span> <span style="color:#19177c">tab-width</span> <span style="color:#666">4</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq-default</span> <span style="color:#19177c">evil-indent-convert-tabs</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq-default</span> <span style="color:#19177c">indent-tabs-mode</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq-default</span> <span style="color:#19177c">evil-shift-round</span> <span style="color:#800">nil</span>)
</span></span></code></pre></div><h4 id="settings">Settings</h4>
<h5 id="scrolling">Scrolling</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">scroll-conservatively</span> <span style="color:#19177c">scroll-margin</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">scroll-step</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">scroll-preserve-screen-position</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">scroll-error-top-bottom</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">mouse-wheel-progressive-speed</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">mouse-wheel-inhibit-click-time</span> <span style="color:#800">nil</span>)
</span></span></code></pre></div><h5 id="clipboard">Clipboard</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">select-enable-clipboard</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">mouse-yank-at-point</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h5 id="backups">Backups</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">backup-inhibited</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">auto-save-default</span> <span style="color:#800">nil</span>)
</span></span></code></pre></div><h4 id="undo-tree">Undo Tree</h4>
<p>Replaces Emacs built-in sequential undo system with a tree-based one. Probably one of the greatest options of Emacs as a text editor.</p>
<p>References:</p>
<ul>
<li><a href="https://www.emacswiki.org/emacs/UndoTree">UndoTree on EmacsWiki</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">undo-tree</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">global-undo-tree-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">undo-tree-visualizer-diff</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">undo-tree-visualizer-timestamps</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#19177c">&#39;undo-tree-visualize</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">fset</span> <span style="color:#19177c">&#39;undo-auto-amalgamate</span> <span style="color:#19177c">&#39;ignore</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">undo-limit</span> <span style="color:#666">6710886400</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">undo-strong-limit</span> <span style="color:#666">100663296</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">undo-outer-limit</span> <span style="color:#666">1006632960</span>))
</span></span></code></pre></div><h4 id="snippets">Snippets</h4>
<p>A snippet system for Emacs and a collection of pre-built snippets.</p>
<p><code>yasnippet-snippets</code> has to be loaded before <code>yasnippet</code> for user snippets to override the pre-built ones.</p>
<p>Edit <span class="timestamp-wrapper"><span class="timestamp">&lt;2022-04-11 Mon&gt; </span></span> I don&rsquo;t really use <code>yasnippet-snippets</code>, so I&rsquo;d rather write stuff manually.</p>
<p>References:</p>
<ul>
<li><a href="http://joaotavora.github.io/yasnippet/">yasnippet documentation</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">yasnippet-snippets</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:disabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">yasnippet</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">yas-snippet-dirs</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">`</span>(<span style="color:#666">,</span>(<span style="color:#00f">concat</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#19177c">user-emacs-directory</span>) <span style="color:#ba2121">&#34;snippets&#34;</span>)
</span></span><span style="display:flex;"><span>	  <span style="color:#408080;font-style:italic">;; yasnippet-snippets-dir</span>
</span></span><span style="display:flex;"><span>	  ))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">yas-triggers-in-field</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">yas-global-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;yas-minor-mode-map</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:wk</span> <span style="color:#ba2121">&#34;yasnippet&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;n&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">yas-new-snippet</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">yas-insert-snippet</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;v&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">yas-visit-snippet-file</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-imap</span> <span style="color:#ba2121">&#34;M-TAB&#34;</span> <span style="color:#19177c">&#39;company-yasnippet</span>)
</span></span></code></pre></div><h4 id="other-small-packages">Other small packages</h4>
<h5 id="managing-parentheses--smartparens">Managing parentheses (smartparens)</h5>
<p>A minor mode to deal with pairs. Its functionality overlaps with evil-surround, but smartparens provides the most comfortable way to do stuff like automatically insert pairs.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/Fuco1/smartparens">smartparens repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">smartparens</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h5 id="expand-region">Expand region</h5>
<p>A package to select an ever-increasing (or ever-decreasing) region of text.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">expand-region</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">er/expand-region</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-nmap</span> <span style="color:#ba2121">&#34;+&#34;</span> <span style="color:#19177c">&#39;er/expand-region</span>))
</span></span></code></pre></div><h5 id="visual-fill-column-mode">Visual fill column mode</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">visual-fill-column</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">visual-fill-column-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;visual-fill-column-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> () (<span style="color:#008000">setq</span> <span style="color:#19177c">visual-fill-column-center-text</span> <span style="color:#800">t</span>))))
</span></span></code></pre></div><h3 id="working-with-projects">Working with projects</h3>
<p>Packages related to managing projects.</p>
<p>Another important package that also touches this category is <a href="#dired">dired</a>, but it has its separate section in &ldquo;Applications&rdquo;. I used to have <a href="https://github.com/Alexander-Miller/treemacs">Treemacs</a> here, but in the end, decided that dired with <a href="https://github.com/jojojames/dired-sidebar">dired-sidebar</a> does a better job.</p>
<h4 id="projectile">Projectile</h4>
<p><a href="https://github.com/bbatsov/projectile">Projectile</a> gives a bunch of useful functions for managing projects, like finding files within a project, fuzzy-find, replace, etc.</p>
<p><code>defadvice</code> is meant to speed projectile up with TRAMP a bit.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">projectile</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">projectile-mode</span> <span style="color:#666">+1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">projectile-project-search-path</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;~/Code&#34;</span> <span style="color:#ba2121">&#34;~/Documents&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defadvice</span> <span style="color:#19177c">projectile-project-root</span> (<span style="color:#19177c">around</span> <span style="color:#19177c">ignore-remote</span> <span style="color:#19177c">first</span> <span style="color:#19177c">activate</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">unless</span> (<span style="color:#19177c">file-remote-p</span> <span style="color:#19177c">default-directory</span>) <span style="color:#19177c">ad-do-it</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">counsel-projectile</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">counsel</span> <span style="color:#19177c">projectile</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;p&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:keymap</span> <span style="color:#19177c">projectile-command-map</span> <span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;projectile&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-nmap</span> <span style="color:#ba2121">&#34;C-p&#34;</span> <span style="color:#19177c">&#39;counsel-projectile-find-file</span>)
</span></span></code></pre></div><h4 id="git-and-magit">Git &amp; Magit</h4>
<p><a href="https://magit.vc/">Magit</a> is a git interface for Emacs. The closest non-Emacs alternative (sans actual clones) I know is <a href="https://github.com/jesseduffield/lazygit">lazygit</a>, which I used before Emacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">magit</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">magit-status</span> <span style="color:#19177c">magit-file-dispatch</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;m&#34;</span> <span style="color:#19177c">&#39;magit</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;M&#34;</span> <span style="color:#19177c">&#39;magit-file-dispatch</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">magit-blame-styles</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">&#39;</span>((<span style="color:#19177c">margin</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">margin-format</span>    <span style="color:#666">.</span> (<span style="color:#ba2121">&#34;%a %A %s&#34;</span>))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">margin-width</span>     <span style="color:#666">.</span> <span style="color:#666">42</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">margin-face</span>      <span style="color:#666">.</span> <span style="color:#19177c">magit-blame-margin</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">margin-body-face</span> <span style="color:#666">.</span> (<span style="color:#19177c">magit-blame-dimmed</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">headings</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">heading-format</span>   <span style="color:#666">.</span> <span style="color:#ba2121">&#34;%-20a %C %s\n&#34;</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">highlight</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">highlight-face</span>   <span style="color:#666">.</span> <span style="color:#19177c">magit-blame-highlight</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">lines</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">show-lines</span>       <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">show-message</span>     <span style="color:#666">.</span> <span style="color:#800">t</span>)))))
</span></span></code></pre></div><p><a href="https://github.com/magit/forge">forge</a> provides integration with forges, such as GitHub and GitLab.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">forge</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">magit</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;forge-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;gitlab.etu.ru&#34;</span>
</span></span><span style="display:flex;"><span>			      <span style="color:#ba2121">&#34;gitlab.etu.ru/api/v4&#34;</span>
</span></span><span style="display:flex;"><span>			      <span style="color:#ba2121">&#34;gitlab.etu.ru&#34;</span>
</span></span><span style="display:flex;"><span>			      <span style="color:#19177c">forge-gitlab-repository</span>)))
</span></span></code></pre></div><p><a href="https://github.com/emacsorphanage/git-gutter">git-gutter</a> is a package which shows git changes for each line (added/changed/deleted lines).</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">git-gutter</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/slow-ssh</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">global-git-gutter-mode</span> <span style="color:#666">+1</span>))
</span></span></code></pre></div><p><a href="https://github.com/emacsmirror/git-timemachine">git-timemachine</a> allows visiting previous versions of a file.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">git-timemachine</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">git-timemachine</span>))
</span></span></code></pre></div><h4 id="editorconfig">Editorconfig</h4>
<p>Editorconfig support for Emacs.</p>
<p>References:</p>
<ul>
<li><a href="https://editorconfig.org/">Editorconfig reference</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">editorconfig</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> <span style="color:#19177c">my/slow-ssh</span> (<span style="color:#19177c">editorconfig-mode</span> <span style="color:#666">1</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;editorconfig-indentation-alist</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#666">&#39;</span>(<span style="color:#19177c">emmet-mode</span> <span style="color:#19177c">emmet-indentation</span>)))
</span></span></code></pre></div><h4 id="editing-files">Editing files</h4>
<p>A minor mode to remember recently edited files.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">recentf-mode</span> <span style="color:#666">1</span>)
</span></span></code></pre></div><p>Save the last place visited in the file.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">save-place-mode</span> <span style="color:#666">1</span>)
</span></span></code></pre></div><h3 id="completion">Completion</h3>
<h4 id="ivy-counsel-swiper">Ivy, counsel, swiper</h4>
<p>Minibuffer completion tools for Emacs.</p>
<p>References:</p>
<ul>
<li><a href="https://oremacs.com/swiper/">repo</a></li>
<li><a href="https://oremacs.com/swiper/">User Manual</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ivy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">ivy-use-virtual-buffers</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">ivy-mode</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">counsel</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">ivy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">counsel-mode</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">swiper</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h4 id="ivy-rich">ivy-rich</h4>
<p><a href="https://github.com/Yevgnen/ivy-rich">ivy-rich</a> provides a more informative interface for ivy.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ivy-rich</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">ivy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">ivy-rich-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">setcdr</span> (<span style="color:#00f">assq</span> <span style="color:#800">t</span> <span style="color:#19177c">ivy-format-functions-alist</span>) <span style="color:#00f">#&#39;</span><span style="color:#19177c">ivy-format-function-line</span>))
</span></span></code></pre></div><h4 id="prescient">prescient</h4>
<p>A package that enhances sorting &amp; filtering of candidates. <code>ivy-prescient</code> adds integration with Ivy.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/raxod502/prescient.el">prescient.el repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ivy-prescient</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">counsel</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">ivy-prescient-mode</span> <span style="color:#666">+1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">ivy-prescient-retain-classic-highlighting</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">prescient-persist-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">ivy-prescient-sort-commands</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">&#39;</span>(<span style="color:#008000">:not</span> <span style="color:#19177c">swiper</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">swiper-isearch</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">ivy-switch-buffer</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#408080;font-style:italic">;; ivy-resume</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#408080;font-style:italic">;; ivy--restore-session</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">lsp-ivy-workspace-symbol</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">dap-switch-stack-frame</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">my/dap-switch-stack-frame</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">dap-switch-session</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">dap-switch-thread</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-grep</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#408080;font-style:italic">;; counsel-find-file</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-git-grep</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-rg</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-ag</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-ack</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-fzf</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-pt</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-imenu</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-yank-pop</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-recentf</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">counsel-buffer-or-recentf</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">proced-filter-interactive</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">proced-sort-interactive</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">perspective-exwm-switch-perspective</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">my/persp-ivy-switch-buffer-other-window</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">lsp-execute-code-action</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">dired-recent-open</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; Do not use prescient in find-file</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">ivy--alist-set</span> <span style="color:#19177c">&#39;ivy-sort-functions-alist</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">read-file-name-internal</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">ivy-sort-file-function-default</span>))
</span></span></code></pre></div><h4 id="keybindings-1">keybindings</h4>
<p>Setting up quick access to various completions.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;f&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;various completions&#34;</span>)<span style="color:#666">&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; &#34;b&#34; &#39;counsel-switch-buffer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;b&#34;</span> <span style="color:#19177c">&#39;persp-ivy-switch-buffer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;e&#34;</span> <span style="color:#19177c">&#39;conda-env-activate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;f&#34;</span> <span style="color:#19177c">&#39;project-find-file</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#19177c">&#39;counsel-yank-pop</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;a&#34;</span> <span style="color:#19177c">&#39;counsel-rg</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;A&#34;</span> <span style="color:#19177c">&#39;counsel-ag</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#00f">insert</span> <span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;C-y&#34;</span> <span style="color:#19177c">&#39;counsel-yank-pop</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;SPC SPC&#34;</span> <span style="color:#19177c">&#39;ivy-resume</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#19177c">&#39;swiper-isearch</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;S&#34;</span> <span style="color:#19177c">&#39;swiper-all</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">ivy-minibuffer-map</span> <span style="color:#19177c">swiper-map</span>)
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;M-j&#34;</span> <span style="color:#19177c">&#39;ivy-next-line</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;M-k&#34;</span> <span style="color:#19177c">&#39;ivy-previous-line</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;&lt;C-return&gt;&#34;</span> <span style="color:#19177c">&#39;ivy-call</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;M-RET&#34;</span> <span style="color:#19177c">&#39;ivy-immediate-done</span>
</span></span><span style="display:flex;"><span> [<span style="color:#19177c">escape</span>] <span style="color:#19177c">&#39;minibuffer-keyboard-quit</span>)
</span></span></code></pre></div><h4 id="company">company</h4>
<p>A completion framework for Emacs.</p>
<p>References:</p>
<ul>
<li><a href="http://company-mode.github.io/">company homepage</a></li>
<li><a href="https://github.com/sebastiencs/company-box">company-box homepage</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">company</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">global-company-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">company-idle-delay</span> <span style="color:#666">0.125</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">company-dabbrev-downcase</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">company-show-numbers</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-imap</span> <span style="color:#ba2121">&#34;C-SPC&#34;</span> <span style="color:#19177c">&#39;company-complete</span>)
</span></span></code></pre></div><p>A company frontend with nice icons.</p>
<p><del>Disabled since the base company got icons support and since company-box has some issues with spaceline.</del> Enabled back because I didn&rsquo;t like spaceline.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">company-box</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">display-graphic-p</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">company</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">company-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">company-box-mode</span>))
</span></span></code></pre></div><h3 id="help">Help</h3>
<ul>
<li><strong>CREDIT</strong>: Thanks @phundrak on the System Crafters Discord for suggesting <code>help-map</code></li>
</ul>
<p><a href="https://github.com/Wilfred/helpful">helpful</a> package improves the <code>*help*</code> buffer.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">helpful</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">helpful-callable</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">helpful-variable</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">helpful-key</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">helpful-macro</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">helpful-function</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">helpful-command</span>))
</span></span></code></pre></div><p>As I use <code>C-h</code> to switch buffers, I moved the help to <code>SPC-h</code> with the code below.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;h&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:keymap</span> <span style="color:#19177c">help-map</span> <span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;help&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;h&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;help&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;h&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:keymap</span> <span style="color:#19177c">help-map</span> <span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;help-map&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;f&#34;</span> <span style="color:#19177c">&#39;helpful-function</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;k&#34;</span> <span style="color:#19177c">&#39;helpful-key</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;v&#34;</span> <span style="color:#19177c">&#39;helpful-variable</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;o&#34;</span> <span style="color:#19177c">&#39;helpful-symbol</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;help-map</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;f&#34;</span> <span style="color:#19177c">&#39;helpful-function</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;k&#34;</span> <span style="color:#19177c">&#39;helpful-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;v&#34;</span> <span style="color:#19177c">&#39;helpful-variable</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;o&#34;</span> <span style="color:#19177c">&#39;helpful-symbol</span>)
</span></span></code></pre></div><h3 id="time-trackers">Time trackers</h3>
<p>A bunch of time trackers I use.</p>
<p>References:</p>
<ul>
<li><a href="https://wakatime.com">WakaTime</a></li>
<li><a href="https://activitywatch.net/">ActivityWatch</a></li>
</ul>
<h4 id="wakatime">WakaTime</h4>
<p>Before I figure out how to package this for Guix:</p>
<ul>
<li>Clone <a href="https://github.com/wakatime/wakatime-cli">the repo</a></li>
<li>Run <code>go build</code></li>
<li>Copy the binary to the <code>~/bin</code> folder</li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">wakatime-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;SqrtMinusOne/wakatime-mode&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> (<span style="color:#008000">or</span> <span style="color:#19177c">my/is-termux</span> <span style="color:#19177c">my/remote-server</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">wakatime-ignore-exit-codes</span> <span style="color:#666">&#39;</span>(<span style="color:#666">0</span> <span style="color:#666">1</span> <span style="color:#666">102</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;wakatime-init</span> <span style="color:#008000">:after</span> (<span style="color:#008000">lambda</span> () (<span style="color:#008000">setq</span> <span style="color:#19177c">wakatime-cli-path</span> <span style="color:#ba2121">&#34;/home/pavel/bin/wakatime-cli&#34;</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (setq wakatime-cli-path (executable-find &#34;wakatime&#34;))</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">global-wakatime-mode</span>))
</span></span></code></pre></div><h4 id="activitywatch">ActivityWatch</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">request</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">activity-watch-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> (<span style="color:#008000">or</span> <span style="color:#19177c">my/is-termux</span> <span style="color:#19177c">my/remote-server</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">global-activity-watch-mode</span>))
</span></span></code></pre></div><h2 id="ui-settings">UI settings</h2>
<h3 id="general-settings-1">General settings</h3>
<h4 id="miscellaneous">Miscellaneous</h4>
<p>Disable GUI elements</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">unless</span> <span style="color:#19177c">my/is-termux</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">tool-bar-mode</span> <span style="color:#666">-1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">menu-bar-mode</span> <span style="color:#666">-1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">scroll-bar-mode</span> <span style="color:#666">-1</span>))
</span></span></code></pre></div><p>Transparency. Not setting it now, as I&rsquo;m using <a href="/configs/desktop/#picom">picom</a>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (set-frame-parameter (selected-frame) &#39;alpha &#39;(90 . 90))</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (add-to-list &#39;default-frame-alist &#39;(alpha . (90 . 90)))</span>
</span></span></code></pre></div><p>Prettify symbols. Also not setting it, ligatures seem to be enough for me.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (global-prettify-symbols-mode)</span>
</span></span></code></pre></div><p>Do not show GUI dialogs</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">use-dialog-box</span> <span style="color:#800">nil</span>)
</span></span></code></pre></div><p>No start screen</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">inhibit-startup-screen</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><p>Visual bell</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">visible-bell</span> <span style="color:#666">0</span>)
</span></span></code></pre></div><p>y or n instead of yes or no</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defalias</span> <span style="color:#19177c">&#39;yes-or-no-p</span> <span style="color:#19177c">&#39;y-or-n-p</span>)
</span></span></code></pre></div><p>Hide mouse cursor while typing</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">make-pointer-invisible</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><p>Show pairs</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">show-paren-mode</span> <span style="color:#666">1</span>)
</span></span></code></pre></div><p>Highlight the current line</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">global-hl-line-mode</span> <span style="color:#666">1</span>)
</span></span></code></pre></div><h4 id="line-numbers">Line numbers</h4>
<p>Line numbers. There seems to be a catch with the relative number setting:</p>
<ul>
<li><code>visual</code> doesn&rsquo;t take folding into account but also doesn&rsquo;t take wrapped lines into account (i.e. there are multiple numbers for a single wrapped line)</li>
<li><code>relative</code> makes a single number for a wrapped line, but counts folded lines.</li>
</ul>
<p><code>visual</code> option seems to be less of a problem in most cases.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">global-display-line-numbers-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">line-number-mode</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">display-line-numbers-type</span> <span style="color:#19177c">&#39;visual</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">column-number-mode</span>)
</span></span></code></pre></div><h4 id="word-wrapping">Word wrapping</h4>
<p>Word wrapping. These settings aren&rsquo;t too obvious compared to <code>:set wrap</code> from vim:</p>
<ul>
<li><code>word-wrap</code> means just &ldquo;don&rsquo;t split one word between two lines&rdquo;. So, if there isn&rsquo;t enough place to put a word at the end of the line, it will be put on a new one. Run <code>M-x toggle-word-wrap</code> to toggle that.</li>
<li><code>visual-line-mode</code> seems to be a superset of <code>word-wrap</code>. It also enables some editing commands to work on visual lines instead of logical ones, hence the naming.</li>
<li><code>auto-fill-mode</code> does the same as <code>word-wrap</code>, except it actually <strong>edits the buffer</strong> to make lines break in the appropriate places.</li>
<li><code>truncate-lines</code> truncates long lines instead of continuing them. Run <code>M-x toggle-truncate-lines</code> to toggle that. I find that <code>truncate-lines</code> behaves strangely when <code>visual-line-mode</code> is on, so I use one or another.</li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">word-wrap</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">global-visual-line-mode</span> <span style="color:#666">1</span>)
</span></span></code></pre></div><h4 id="custom-frame-format">Custom frame format</h4>
<p>Title format, which looks something like <code>emacs:project@hostname</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq-default</span> <span style="color:#19177c">frame-title-format</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ba2121">&#34;emacs&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#408080;font-style:italic">;; (:eval</span>
</span></span><span style="display:flex;"><span>		<span style="color:#408080;font-style:italic">;;  (let ((project-name (projectile-project-name)))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#408080;font-style:italic">;;    (if (not (string= &#34;-&#34; project-name))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#408080;font-style:italic">;;        (format &#34;:%s@%s&#34; project-name (system-name))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#408080;font-style:italic">;;      (format &#34;@%s&#34; (system-name)))))</span>
</span></span><span style="display:flex;"><span>		))
</span></span></code></pre></div><h4 id="olivetti">Olivetti</h4>
<p><a href="https://github.com/rnkn/olivetti">Olivetti</a> is a package that limits the current text body width. It&rsquo;s pretty nice to use when writing texts.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">olivetti</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">olivetti-body-width</span> <span style="color:#666">86</span>))
</span></span></code></pre></div><h4 id="keycast">Keycast</h4>
<p>Showing the last pressed key. Occasionally useful.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">keycast</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">define-minor-mode</span> <span style="color:#19177c">keycast-mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;Keycast mode&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:global</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> <span style="color:#19177c">keycast-mode</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;global-mode-string</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;&#34;</span> <span style="color:#19177c">keycast-mode-line</span> <span style="color:#ba2121">&#34; &#34;</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;pre-command-hook</span> <span style="color:#19177c">&#39;keycast--update</span> <span style="color:#800">t</span>) )
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">remove-hook</span> <span style="color:#19177c">&#39;pre-command-hook</span> <span style="color:#19177c">&#39;keycast--update</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">setq</span> <span style="color:#19177c">global-mode-string</span> (<span style="color:#00f">delete</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;&#34;</span> <span style="color:#19177c">keycast-mode-line</span> <span style="color:#ba2121">&#34; &#34;</span>) <span style="color:#19177c">global-mode-string</span>)))))
</span></span></code></pre></div><h3 id="themes-and-colors">Themes and colors</h3>
<h4 id="doom-themes">Doom themes</h4>
<p>My colorscheme of choice.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">doom-themes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/is-termux</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-themes-enable-bold</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>	<span style="color:#19177c">doom-themes-enable-italic</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">if</span> <span style="color:#19177c">my/remote-server</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">load-theme</span> <span style="color:#19177c">&#39;doom-gruvbox</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">load-theme</span> <span style="color:#19177c">&#39;doom-palenight</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">doom-themes-visual-bell-config</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-themes-treemacs-theme</span> <span style="color:#ba2121">&#34;doom-colors&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">doom-themes-treemacs-config</span>))
</span></span></code></pre></div><h4 id="custom-theme">Custom theme</h4>
<p>Here I define a custom theme, dependent on colors from <code>doom-themes</code>.</p>
<p>A custom theme is necessary because if one calls <code>custom-set-faces</code> and <code>custom-set-variables</code> in code, whenever a variable is changed and saved in a customize buffer, data from all calls of these functions is saved as well.</p>
<p>To make defining colors a bit easier, here is a function to blend two colors, taken from <a href="https://oremacs.com/2015/04/28/blending-faces/">this post</a> by abo-abo.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/color-join</span> (<span style="color:#19177c">r</span> <span style="color:#19177c">g</span> <span style="color:#19177c">b</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Build a color from R G B.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">Inverse of </span><span style="color:#19177c">`color-values&#39;</span><span style="color:#ba2121">.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;#%02x%02x%02x&#34;</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">ash</span> <span style="color:#19177c">r</span> <span style="color:#666">-8</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">ash</span> <span style="color:#19177c">g</span> <span style="color:#666">-8</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">ash</span> <span style="color:#19177c">b</span> <span style="color:#666">-8</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/color-blend</span> (<span style="color:#19177c">c1</span> <span style="color:#19177c">c2</span> <span style="color:#008000">&amp;optional</span> <span style="color:#19177c">alpha</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Blend the two colors C1 and C2 with ALPHA.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">C1 and C2 are in the format of </span><span style="color:#19177c">`color-values&#39;</span><span style="color:#ba2121">.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">ALPHA is a number between 0.0 and 1.0 which corresponds to the
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">influence of C1 on the result.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">alpha</span> (<span style="color:#008000">or</span> <span style="color:#19177c">alpha</span> <span style="color:#666">0.5</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">apply</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/color-join</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">cl-mapcar</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">lambda</span> (<span style="color:#19177c">x</span> <span style="color:#19177c">y</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#00f">round</span> (<span style="color:#00f">+</span> (<span style="color:#00f">*</span> <span style="color:#19177c">x</span> <span style="color:#19177c">alpha</span>) (<span style="color:#00f">*</span> <span style="color:#19177c">y</span> (<span style="color:#00f">-</span> <span style="color:#666">1</span> <span style="color:#19177c">alpha</span>)))))
</span></span><span style="display:flex;"><span>	  <span style="color:#19177c">c1</span> <span style="color:#19177c">c2</span>)))
</span></span></code></pre></div><p>Defining the theme itself.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">deftheme</span> <span style="color:#19177c">my-theme-1</span>)
</span></span></code></pre></div><p>A macro to simplify defining custom colors.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defvar</span> <span style="color:#19177c">my/doom-theme-update-colors-hook</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defmacro</span> <span style="color:#19177c">my/use-doom-colors</span> (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">data</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#666">`</span>(<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;my/doom-theme-update-colors-hook</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">custom-theme-set-faces</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#19177c">&#39;my-theme-1</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#666">,@</span>(<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">i</span> <span style="color:#19177c">in</span> <span style="color:#19177c">data</span> <span style="color:#19177c">collect</span>
</span></span><span style="display:flex;"><span>			     <span style="color:#666">`</span>(<span style="color:#666">,</span><span style="color:#19177c">&#39;\`</span>
</span></span><span style="display:flex;"><span>			       (<span style="color:#666">,</span>(<span style="color:#00f">car</span> <span style="color:#19177c">i</span>)
</span></span><span style="display:flex;"><span>				((<span style="color:#800">t</span> (<span style="color:#666">,@</span>(<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> (<span style="color:#19177c">key</span> <span style="color:#19177c">value</span>) <span style="color:#19177c">on</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">i</span>) <span style="color:#19177c">by</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">cddr</span>
</span></span><span style="display:flex;"><span>						<span style="color:#00f">append</span> <span style="color:#666">`</span>(<span style="color:#666">,</span><span style="color:#19177c">key</span> (<span style="color:#666">,</span><span style="color:#19177c">&#39;\,</span> <span style="color:#666">,</span><span style="color:#19177c">value</span>))))))))))))
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">when</span> (<span style="color:#008000">and</span> (<span style="color:#00f">fboundp</span> <span style="color:#19177c">&#39;doom-color</span>) <span style="color:#19177c">my/emacs-started</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">my/update-my-theme</span>))))
</span></span></code></pre></div><p>This macro puts lambdas to <code>my/doom-theme-update-colors-hook</code> that updates faces in <code>my-theme-1</code>. Now I have to call this hook:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/update-my-theme</span> (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">_</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">run-hooks</span> <span style="color:#19177c">&#39;my/doom-theme-update-colors-hook</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">enable-theme</span> <span style="color:#19177c">&#39;my-theme-1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">unless</span> <span style="color:#19177c">my/is-termux</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;load-theme</span> <span style="color:#008000">:after</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/update-my-theme</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#00f">fboundp</span> <span style="color:#19177c">&#39;doom-color</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/update-my-theme</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;emacs-startup-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/update-my-theme</span>))
</span></span></code></pre></div><p>Defining colors for <code>tab-bar.el</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my/use-doom-colors</span>
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">tab-bar-tab</span> <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;bg</span>)
</span></span><span style="display:flex;"><span>	      <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>)
</span></span><span style="display:flex;"><span>	      <span style="color:#008000">:underline</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>))
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">tab-bar</span> <span style="color:#008000">:background</span> <span style="color:#800">nil</span> <span style="color:#008000">:foreground</span> <span style="color:#800">nil</span>))
</span></span></code></pre></div><h4 id="dim-inactive-buffers">Dim inactive buffers</h4>
<p>Dim inactive buffers.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">auto-dim-other-buffers</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">display-graphic-p</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">auto-dim-other-buffers-mode</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/use-doom-colors</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">auto-dim-other-buffers-face</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:background</span> (<span style="color:#19177c">color-darken-name</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;bg</span>) <span style="color:#666">3</span>))))
</span></span></code></pre></div><h4 id="toggle-light-dark">Toggle light/dark</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/toggle-dark-light-theme</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">is-dark</span> (<span style="color:#00f">member</span> <span style="color:#19177c">&#39;doom-palenight</span> <span style="color:#19177c">custom-enabled-themes</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> <span style="color:#19177c">is-dark</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">load-theme</span> <span style="color:#19177c">&#39;doom-one-light</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">disable-theme</span> <span style="color:#19177c">&#39;doom-palenight</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">load-theme</span> <span style="color:#19177c">&#39;doom-palenight</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">disable-theme</span> <span style="color:#19177c">&#39;doom-one-light</span>))))
</span></span></code></pre></div><h4 id="ansi-colors">ANSI colors</h4>
<p><code>ansi-color.el</code> is a built-in Emacs package that translates ANSI color escape codes into faces.</p>
<p>It is used by many other packages but doesn&rsquo;t seem to have an integration with <code>doom-themes</code>, so here is one.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;ansi-color</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/use-doom-colors</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-black</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;base2</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;base0</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-red</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;red</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;red</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-green</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;green</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;green</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-yellow</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-blue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;dark-blue</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;dark-blue</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-magenta</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;violet</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;violet</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-cyan</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;dark-cyan</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;dark-cyan</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-white</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;base8</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;base8</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-bright-black</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;base5</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;base5</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-bright-red</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;orange</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;orange</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-bright-green</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;teal</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;teal</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-bright-yellow</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-bright-blue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;blue</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;blue</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-bright-magenta</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;magenta</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;magenta</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-bright-cyan</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;cyan</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;cyan</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">ansi-color-bright-white</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;fg</span>) <span style="color:#008000">:background</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;fg</span>))))
</span></span></code></pre></div><h3 id="fonts">Fonts</h3>
<h4 id="frame-font">Frame font</h4>
<p>To install a font, download the font and unpack it into the <code>.local/share/fonts</code> directory. Create one if it doesn&rsquo;t exist.</p>
<p>As I use nerd fonts elsewhere, I use one in Emacs as well.</p>
<p>References:</p>
<ul>
<li><a href="https://nerdfonts.com">nerd fonts homepage</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">when</span> (<span style="color:#19177c">display-graphic-p</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">if</span> (<span style="color:#00f">x-list-fonts</span> <span style="color:#ba2121">&#34;JetBrainsMono Nerd Font&#34;</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">set-frame-font</span> <span style="color:#ba2121">&#34;JetBrainsMono Nerd Font 10&#34;</span> <span style="color:#800">nil</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;Install JetBrainsMono Nerd Font!&#34;</span>)))
</span></span></code></pre></div><p>To make the icons work (e.g. in the Doom Modeline), run <code>M-x all-the-icons-install-fonts</code>. The package definition is somewhere later in the config.</p>
<h4 id="ligatures">Ligatures</h4>
<p>Ligature setup for the JetBrainsMono font.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ligature</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;mickeynp/ligature.el&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">display-graphic-p</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">ligature-set-ligatures</span>
</span></span><span style="display:flex;"><span>   <span style="color:#666">&#39;</span>(
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">typescript-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">js2-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">vue-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">svelte-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">scss-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">php-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">python-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">js-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">markdown-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">clojure-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">go-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">sh-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">haskell-mode</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">web-mode</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;--&#34;</span> <span style="color:#ba2121">&#34;---&#34;</span> <span style="color:#ba2121">&#34;==&#34;</span> <span style="color:#ba2121">&#34;===&#34;</span> <span style="color:#ba2121">&#34;!=&#34;</span> <span style="color:#ba2121">&#34;!==&#34;</span> <span style="color:#ba2121">&#34;=!=&#34;</span> <span style="color:#ba2121">&#34;=:=&#34;</span> <span style="color:#ba2121">&#34;=/=&#34;</span> <span style="color:#ba2121">&#34;&lt;=&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;&gt;=&#34;</span> <span style="color:#ba2121">&#34;&amp;&amp;&#34;</span> <span style="color:#ba2121">&#34;&amp;&amp;&amp;&#34;</span> <span style="color:#ba2121">&#34;&amp;=&#34;</span> <span style="color:#ba2121">&#34;++&#34;</span> <span style="color:#ba2121">&#34;+++&#34;</span> <span style="color:#ba2121">&#34;***&#34;</span> <span style="color:#ba2121">&#34;;;&#34;</span> <span style="color:#ba2121">&#34;!!&#34;</span> <span style="color:#ba2121">&#34;??&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;?:&#34;</span> <span style="color:#ba2121">&#34;?.&#34;</span> <span style="color:#ba2121">&#34;?=&#34;</span> <span style="color:#ba2121">&#34;&lt;:&#34;</span> <span style="color:#ba2121">&#34;:&lt;&#34;</span> <span style="color:#ba2121">&#34;:&gt;&#34;</span> <span style="color:#ba2121">&#34;&gt;:&#34;</span> <span style="color:#ba2121">&#34;&lt;&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;&lt;&lt;&#34;</span> <span style="color:#ba2121">&#34;&gt;&gt;&gt;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;&lt;&lt;&#34;</span> <span style="color:#ba2121">&#34;&gt;&gt;&#34;</span> <span style="color:#ba2121">&#34;||&#34;</span> <span style="color:#ba2121">&#34;-|&#34;</span> <span style="color:#ba2121">&#34;_|_&#34;</span> <span style="color:#ba2121">&#34;|-&#34;</span> <span style="color:#ba2121">&#34;||-&#34;</span> <span style="color:#ba2121">&#34;|=&#34;</span> <span style="color:#ba2121">&#34;||=&#34;</span> <span style="color:#ba2121">&#34;##&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;###&#34;</span> <span style="color:#ba2121">&#34;####&#34;</span> <span style="color:#ba2121">&#34;#{&#34;</span> <span style="color:#ba2121">&#34;#[&#34;</span> <span style="color:#ba2121">&#34;]#&#34;</span> <span style="color:#ba2121">&#34;#(&#34;</span> <span style="color:#ba2121">&#34;#?&#34;</span> <span style="color:#ba2121">&#34;#_&#34;</span> <span style="color:#ba2121">&#34;#_(&#34;</span> <span style="color:#ba2121">&#34;#:&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;#!&#34;</span> <span style="color:#ba2121">&#34;#=&#34;</span> <span style="color:#ba2121">&#34;^=&#34;</span> <span style="color:#ba2121">&#34;&lt;$&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;$&#34;</span> <span style="color:#ba2121">&#34;$&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;+&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;+&#34;</span> <span style="color:#ba2121">&#34;+&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;*&gt;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;&lt;*&#34;</span> <span style="color:#ba2121">&#34;*&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;/&#34;</span> <span style="color:#ba2121">&#34;&lt;/&gt;&#34;</span> <span style="color:#ba2121">&#34;/&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;!--&#34;</span> <span style="color:#ba2121">&#34;&lt;#--&#34;</span> <span style="color:#ba2121">&#34;--&gt;&#34;</span> <span style="color:#ba2121">&#34;-&gt;&#34;</span> <span style="color:#ba2121">&#34;-&gt;&gt;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;&lt;&lt;-&#34;</span> <span style="color:#ba2121">&#34;&lt;-&#34;</span> <span style="color:#ba2121">&#34;&lt;=&lt;&#34;</span> <span style="color:#ba2121">&#34;=&lt;&lt;&#34;</span> <span style="color:#ba2121">&#34;&lt;&lt;=&#34;</span> <span style="color:#ba2121">&#34;&lt;==&#34;</span> <span style="color:#ba2121">&#34;&lt;=&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;==&gt;&#34;</span> <span style="color:#ba2121">&#34;==&gt;&#34;</span> <span style="color:#ba2121">&#34;=&gt;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;=&gt;&gt;&#34;</span> <span style="color:#ba2121">&#34;&gt;=&gt;&#34;</span> <span style="color:#ba2121">&#34;&gt;&gt;=&#34;</span> <span style="color:#ba2121">&#34;&gt;&gt;-&#34;</span> <span style="color:#ba2121">&#34;&gt;-&#34;</span> <span style="color:#ba2121">&#34;&gt;--&#34;</span> <span style="color:#ba2121">&#34;-&lt;&#34;</span> <span style="color:#ba2121">&#34;-&lt;&lt;&#34;</span> <span style="color:#ba2121">&#34;&gt;-&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;-&lt;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;&lt;-|&#34;</span> <span style="color:#ba2121">&#34;&lt;=|&#34;</span> <span style="color:#ba2121">&#34;|=&gt;&#34;</span> <span style="color:#ba2121">&#34;|-&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;-&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;~~&#34;</span> <span style="color:#ba2121">&#34;&lt;~&#34;</span> <span style="color:#ba2121">&#34;&lt;~&gt;&#34;</span> <span style="color:#ba2121">&#34;~~&#34;</span> <span style="color:#ba2121">&#34;~~&gt;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;~&gt;&#34;</span> <span style="color:#ba2121">&#34;~-&#34;</span> <span style="color:#ba2121">&#34;-~&#34;</span> <span style="color:#ba2121">&#34;~@&#34;</span> <span style="color:#ba2121">&#34;[||]&#34;</span> <span style="color:#ba2121">&#34;|]&#34;</span> <span style="color:#ba2121">&#34;[|&#34;</span> <span style="color:#ba2121">&#34;|}&#34;</span> <span style="color:#ba2121">&#34;{|&#34;</span> <span style="color:#ba2121">&#34;[&lt;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;&gt;]&#34;</span> <span style="color:#ba2121">&#34;|&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;|&#34;</span> <span style="color:#ba2121">&#34;||&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;||&#34;</span> <span style="color:#ba2121">&#34;|||&gt;&#34;</span> <span style="color:#ba2121">&#34;&lt;|||&#34;</span> <span style="color:#ba2121">&#34;&lt;|&gt;&#34;</span> <span style="color:#ba2121">&#34;...&#34;</span> <span style="color:#ba2121">&#34;..&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;.=&#34;</span> <span style="color:#ba2121">&#34;.-&#34;</span> <span style="color:#ba2121">&#34;..&lt;&#34;</span> <span style="color:#ba2121">&#34;.?&#34;</span> <span style="color:#ba2121">&#34;::&#34;</span> <span style="color:#ba2121">&#34;:::&#34;</span> <span style="color:#ba2121">&#34;:=&#34;</span> <span style="color:#ba2121">&#34;::=&#34;</span> <span style="color:#ba2121">&#34;:?&#34;</span> <span style="color:#ba2121">&#34;:?&gt;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;//&#34;</span> <span style="color:#ba2121">&#34;///&#34;</span> <span style="color:#ba2121">&#34;/*&#34;</span> <span style="color:#ba2121">&#34;*/&#34;</span> <span style="color:#ba2121">&#34;/=&#34;</span> <span style="color:#ba2121">&#34;//=&#34;</span> <span style="color:#ba2121">&#34;/==&#34;</span> <span style="color:#ba2121">&#34;@_&#34;</span> <span style="color:#ba2121">&#34;__&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">global-ligature-mode</span> <span style="color:#800">t</span>))
</span></span></code></pre></div><h4 id="icons">Icons</h4>
<p>Run <code>M-x all-the-icons-install-fonts</code> at first setup.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">all-the-icons</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">display-graphic-p</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h3 id="text-highlight">Text highlight</h3>
<p>Highlight indent guides.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">highlight-indent-guides</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> (<span style="color:#008000">or</span> <span style="color:#19177c">my/remote-server</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> ((<span style="color:#19177c">prog-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">highlight-indent-guides-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">LaTeX-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">highlight-indent-guides-mode</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">highlight-indent-guides-method</span> <span style="color:#19177c">&#39;bitmap</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">highlight-indent-guides-bitmap-function</span> <span style="color:#19177c">&#39;highlight-indent-guides--bitmap-line</span>))
</span></span></code></pre></div><p>Rainbow parentheses.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">rainbow-delimiters</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> ((<span style="color:#19177c">prog-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">rainbow-delimiters-mode</span>)))
</span></span></code></pre></div><p>Highlight colors</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">rainbow-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">rainbow-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><p>Highlight TODOs and stuff</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">hl-todo</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">prog-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">hl-todo-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h3 id="doom-modeline">Doom Modeline</h3>
<p>A modeline from Doom Emacs. A big advantage of this package is that it just works out of the box and does not require much customization.</p>
<p>I tried a bunch of other options, including <a href="https://github.com/TheBB/spaceline">spaceline</a>, but in the end, decided that Doom Modeline works best for me.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/seagle0128/doom-modeline">Doom Modeline</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">doom-modeline</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; :if (not (display-graphic-p))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-modeline-env-enable-python</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-modeline-env-enable-go</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-modeline-buffer-encoding</span> <span style="color:#19177c">&#39;nondefault</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-modeline-hud</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-modeline-persp-icon</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-modeline-persp-name</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-modeline-minor-modes</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-modeline-irc</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">doom-modeline-buffer-state-icon</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">doom-modeline-mode</span> <span style="color:#666">1</span>))
</span></span></code></pre></div><h3 id="perspective-dot-el">perspective.el</h3>
<p><a href="https://github.com/nex3/perspective-el">perspective.el</a> is a package that provides gives Emacs capacities to group buffers into &ldquo;perspectives&rdquo;, which are like workspaces in tiling WMs.</p>
<p>An advantage over <code>tab-bar.el</code> is that <code>perspective.el</code> has better capacities for managing buffers, e.g. gives an ibuffer-like interface inside a perspective.</p>
<p>However, I don&rsquo;t like that list of workspaces is displayed inside the modeline rather than in an actual bar on the top of the frame. I may look into that later.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">perspective</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (setq persp-show-modestring &#39;header)</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">persp-sort</span> <span style="color:#19177c">&#39;created</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">persp-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;x&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:keymap</span> <span style="color:#19177c">perspective-map</span> <span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;perspective&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;override</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">emacs</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gt&#34;</span> <span style="color:#19177c">&#39;persp-next</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gT&#34;</span> <span style="color:#19177c">&#39;persp-prev</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gn&#34;</span> <span style="color:#19177c">&#39;persp-switch</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gN&#34;</span> <span style="color:#19177c">&#39;persp-kill</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;perspective-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;b&#34;</span> <span style="color:#19177c">&#39;persp-ivy-switch-buffer</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;x&#34;</span> <span style="color:#19177c">&#39;persp-ivy-switch-buffer</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#19177c">&#39;persp-ibuffer</span>))
</span></span></code></pre></div><h4 id="functions-to-manage-buffers">Functions to manage buffers</h4>
<p>Move the current buffer to a perspective and switch to it.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/persp-move-window-and-switch</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">buffer</span> (<span style="color:#00f">current-buffer</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">call-interactively</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">persp-switch</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">persp-set-buffer</span> (<span style="color:#00f">buffer-name</span> <span style="color:#19177c">buffer</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">switch-to-buffer</span> <span style="color:#19177c">buffer</span>)))
</span></span></code></pre></div><p>Copy the current buffer to a perspective and switch to it.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/persp-copy-window-and-switch</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">buffer</span> (<span style="color:#00f">current-buffer</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">call-interactively</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">persp-switch</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">persp-add-buffer</span> (<span style="color:#00f">buffer-name</span> <span style="color:#19177c">buffer</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">switch-to-buffer</span> <span style="color:#19177c">buffer</span>)))
</span></span></code></pre></div><p>Switch to a perspective buffer in other window.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/persp-ivy-switch-buffer-other-window</span> (<span style="color:#19177c">arg</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> <span style="color:#ba2121">&#34;P&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">declare-function</span> <span style="color:#19177c">ivy-switch-buffer-other-window</span> <span style="color:#ba2121">&#34;ivy.el&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">persp--switch-buffer-ivy-counsel-helper</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">arg</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">ivy-read</span> <span style="color:#ba2121">&#34;Switch to buffer in other window: &#34;</span> <span style="color:#00f">#&#39;internal-complete-buffer</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#008000">:keymap</span> <span style="color:#19177c">ivy-switch-buffer-map</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#008000">:preselect</span> (<span style="color:#00f">buffer-name</span> (<span style="color:#00f">other-buffer</span> (<span style="color:#00f">current-buffer</span>)))
</span></span><span style="display:flex;"><span>	       <span style="color:#008000">:action</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">ivy--switch-buffer-other-window-action</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#008000">:matcher</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">ivy--switch-buffer-matcher</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#008000">:caller</span> <span style="color:#19177c">&#39;ivy-switch-buffer</span>))))
</span></span></code></pre></div><p>Add keybindings to the default map.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;perspective</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;perspective-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;m&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/persp-move-window-and-switch</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;f&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/persp-copy-window-and-switch</span>))
</span></span></code></pre></div><h4 id="automating-perspectives">Automating perspectives</h4>
<p>I&rsquo;d like to have various Emacs apps open up in their designated perspectives (also in their designated workspaces when I&rsquo;m using EXWM).</p>
<p>So, here is a macro to run something in a given perspective in a given workspace. This is meant to be used in general.el keybindings.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defmacro</span> <span style="color:#19177c">my/command-in-persp</span> (<span style="color:#19177c">command-name</span> <span style="color:#19177c">persp-name</span> <span style="color:#19177c">workspace-index</span> <span style="color:#008000">&amp;rest</span> <span style="color:#19177c">args</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#666">`&#39;</span>((<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">when</span> (<span style="color:#008000">and</span> <span style="color:#666">,</span><span style="color:#19177c">workspace-index</span> (<span style="color:#00f">fboundp</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">exwm-workspace-switch-create</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">exwm-workspace-switch-create</span> <span style="color:#666">,</span><span style="color:#19177c">workspace-index</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">persp-switch</span> <span style="color:#666">,</span><span style="color:#19177c">persp-name</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">delete-other-windows</span>)
</span></span><span style="display:flex;"><span>       <span style="color:#666">,@</span><span style="color:#19177c">args</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#008000">:wk</span> <span style="color:#666">,</span><span style="color:#19177c">command-name</span>))
</span></span></code></pre></div><h2 id="programming">Programming</h2>
<h3 id="general-setup">General setup</h3>
<h4 id="treemacs">Treemacs</h4>
<p><a href="https://github.com/Alexander-Miller/treemacs">Treemacs</a> is a quite large &amp; powerful package, but as of now I&rsquo;ve replaced it with dired. I still have a small configuration because lsp-mode and dap-mode depend on it.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">treemacs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (setq treemacs-follow-mode nil)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (setq treemacs-follow-after-init nil)</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">treemacs-space-between-root-nodes</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (treemacs-git-mode &#39;extended)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (add-to-list &#39;treemacs-pre-file-insert-predicates #&#39;treemacs-is-file-git-ignored?)</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;treemacs-mode-map</span>
</span></span><span style="display:flex;"><span>   [<span style="color:#19177c">mouse-1</span>] <span style="color:#00f">#&#39;</span><span style="color:#19177c">treemacs-single-click-expand-action</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-l&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">treemacs-root-down</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-h&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">treemacs-root-up</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">treemacs-quit</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;treemacs-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">emacs</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#19177c">&#39;treemacs-quit</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">treemacs-evil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">treemacs</span> <span style="color:#19177c">evil</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h4 id="lsp">LSP</h4>
<p>LSP-mode provides an IDE-like experience for Emacs - real-time diagnostics, code actions, intelligent autocompletion, etc.</p>
<p>References:</p>
<ul>
<li><a href="https://emacs-lsp.github.io/lsp-mode/">lsp-mode homepage</a></li>
</ul>
<h5 id="setup">Setup</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lsp-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> (<span style="color:#008000">or</span> <span style="color:#19177c">my/slow-ssh</span> <span style="color:#19177c">my/is-termux</span> <span style="color:#19177c">my/remote-server</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">typescript-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">js-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">vue-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">go-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">svelte-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#408080;font-style:italic">;; (python-mode . lsp)</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">json-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">haskell-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">haskell-literate-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">java-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#408080;font-style:italic">;; (csharp-mode . lsp)</span>
</span></span><span style="display:flex;"><span>	 )
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> <span style="color:#19177c">lsp</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-keymap-prefix</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-idle-delay</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-eslint-server-command</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;node&#34;</span> <span style="color:#ba2121">&#34;/home/pavel/.emacs.d/.cache/lsp/eslint/unzipped/extension/server/out/eslintServer.js&#34;</span> <span style="color:#ba2121">&#34;--stdio&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-eslint-run</span> <span style="color:#ba2121">&#34;onSave&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-signature-render-documentation</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (lsp-headerline-breadcrumb-mode nil)</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-headerline-breadcrumb-enable</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-modeline-code-actions-enable</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-modeline-diagnostics-enable</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;lsp-language-id-configuration</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">svelte-mode</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;svelte&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lsp-ui</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> <span style="color:#19177c">lsp-ui-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-ui-doc-delay</span> <span style="color:#666">2</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-ui-sideline-show-hover</span> <span style="color:#800">nil</span>))
</span></span></code></pre></div><h5 id="integrations">Integrations</h5>
<p>The only integration left now is treemacs.</p>
<p>Origami should&rsquo;ve leveraged LSP folding, but it was too unstable at the moment I tried it.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (use-package helm-lsp</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   :straight t</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   :commands helm-lsp-workspace-symbol)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (use-package origami</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   :straight t</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   :hook (prog-mode . origami-mode))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (use-package lsp-origami</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   :straight t</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   :config</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   (add-hook &#39;lsp-after-open-hook #&#39;lsp-origami-try-enable))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lsp-treemacs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> <span style="color:#19177c">lsp-treemacs-errors-list</span>)
</span></span></code></pre></div><h5 id="keybindings-2">Keybindings</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;l&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;lsp&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#19177c">&#39;lsp-ui-peek-find-definitions</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;r&#34;</span> <span style="color:#19177c">&#39;lsp-rename</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#19177c">&#39;lsp-ui-peek-find-references</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#19177c">&#39;lsp-ui-find-workspace-symbol</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;l&#34;</span> <span style="color:#19177c">&#39;lsp-execute-code-action</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;e&#34;</span> <span style="color:#19177c">&#39;list-flycheck-errors</span>)
</span></span></code></pre></div><h4 id="flycheck">Flycheck</h4>
<p>A syntax checking extension for Emacs. Integrates with LSP-mode, but can also use various standalone checkers.</p>
<p>References:</p>
<ul>
<li><a href="https://www.flycheck.org/en/latest/">Flycheck homepage</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">flycheck</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">global-flycheck-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">flycheck-check-syntax-automatically</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">save</span> <span style="color:#19177c">idle-buffer-switch</span> <span style="color:#19177c">mode-enabled</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (add-hook &#39;evil-insert-state-exit-hook</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;;           (lambda ()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;;             (if flycheck-checker</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;;                 (flycheck-buffer))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;;             ))</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;flycheck-eslint-config-exists-p</span> <span style="color:#008000">:override</span> (<span style="color:#008000">lambda</span>() <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;display-buffer-alist</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#666">`</span>(<span style="color:#666">,</span>(<span style="color:#008000">rx</span> <span style="color:#19177c">bos</span> <span style="color:#ba2121">&#34;*Flycheck errors*&#34;</span> <span style="color:#19177c">eos</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">display-buffer-reuse-window</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#19177c">display-buffer-in-side-window</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">side</span>            <span style="color:#666">.</span> <span style="color:#19177c">bottom</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">reusable-frames</span> <span style="color:#666">.</span> <span style="color:#19177c">visible</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">window-height</span>   <span style="color:#666">.</span> <span style="color:#666">0.33</span>))))
</span></span></code></pre></div><h4 id="tree-sitter">Tree Sitter</h4>
<p>An incremental code parsing system, constructing a syntax tree at runtime.</p>
<p>Right now it doesn&rsquo;t do much except provide a better syntax highlighting than regexes, but this integration is a rather recent development. There are already some major modes built on top of this thing.</p>
<p>Also, it seems to break if run from mmm-mode, so there is a small workaround.</p>
<p>References:</p>
<ul>
<li><a href="https://tree-sitter.github.io/tree-sitter/">Tree-sitter library</a></li>
<li><a href="https://ubolonton.github.io/emacs-tree-sitter/">Emacs Tree-sitter</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/tree-sitter-if-not-mmm</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#19177c">not</span> (<span style="color:#008000">and</span> (<span style="color:#00f">boundp</span> <span style="color:#19177c">&#39;mmm-temp-buffer-name</span>)
</span></span><span style="display:flex;"><span>		  (<span style="color:#00f">string-equal</span> <span style="color:#19177c">mmm-temp-buffer-name</span> (<span style="color:#00f">buffer-name</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">tree-sitter-mode</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">tree-sitter-hl-mode</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">tree-sitter</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> ((<span style="color:#19177c">typescript-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">my/tree-sitter-if-not-mmm</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">js-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">my/tree-sitter-if-not-mmm</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">python-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">tree-sitter-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">python-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">tree-sitter-hl-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">csharp-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">tree-sitter-mode</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">tree-sitter-langs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">tree-sitter</span>)
</span></span></code></pre></div><h4 id="dap">DAP</h4>
<p>An Emacs client for Debugger Adapter Protocol.</p>
<p>As of the time of this writing, I mostly debug TypeScript, so the main competitor is Chrome Inspector for node.js.</p>
<p>References:</p>
<ul>
<li><a href="https://emacs-lsp.github.io/dap-mode/">dap-mode homepage</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dap-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">dap-debug</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-enable-dap-auto-configure</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">dap-ui-variable-length</span> <span style="color:#666">100</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">dap-auto-show-output</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;dap-node</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dap-node-setup</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;dap-chrome</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dap-chrome-setup</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;dap-python</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;dap-php</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dap-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dap-ui-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dap-tooltip-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">tooltip-mode</span> <span style="color:#666">1</span>))
</span></span></code></pre></div><h5 id="controls">Controls</h5>
<p>I don&rsquo;t like some keybindings in the built-in hydra, and there seems to be no easy way to modify the existing hydra, so I create my own. I tried to use transient, but the transient buffer seems to conflict with special buffers of DAP, and hydra does not.</p>
<p>Also, I want the hydra to toggle UI windows instead of just opening them, so here is a macro that defines such functions:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;dap-mode</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defmacro</span> <span style="color:#19177c">my/define-dap-ui-window-toggler</span> (<span style="color:#19177c">name</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#666">`</span>(<span style="color:#008000">defun</span> <span style="color:#666">,</span>(<span style="color:#00f">intern</span> (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;my/dap-ui-toggle-&#34;</span> <span style="color:#19177c">name</span>)) ()
</span></span><span style="display:flex;"><span>       <span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;Toggle DAP &#34;</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;buffer&#34;</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">if-let</span> (<span style="color:#19177c">window</span> (<span style="color:#00f">get-buffer-window</span> <span style="color:#666">,</span>(<span style="color:#00f">intern</span> (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;dap-ui--&#34;</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;-buffer&#34;</span>))))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">quit-window</span> <span style="color:#800">nil</span> <span style="color:#19177c">window</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#666">,</span>(<span style="color:#00f">intern</span> (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;dap-ui-&#34;</span> <span style="color:#19177c">name</span>))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/define-dap-ui-window-toggler</span> <span style="color:#ba2121">&#34;locals&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/define-dap-ui-window-toggler</span> <span style="color:#ba2121">&#34;expressions&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/define-dap-ui-window-toggler</span> <span style="color:#ba2121">&#34;sessions&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/define-dap-ui-window-toggler</span> <span style="color:#ba2121">&#34;breakpoints&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/define-dap-ui-window-toggler</span> <span style="color:#ba2121">&#34;repl&#34;</span>))
</span></span></code></pre></div><p>And here is the hydra:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">defhydra</span> <span style="color:#19177c">my/dap-hydra</span> (<span style="color:#008000">:color</span> <span style="color:#19177c">pink</span> <span style="color:#008000">:hint</span> <span style="color:#800">nil</span> <span style="color:#008000">:foreign-keys</span> <span style="color:#19177c">run</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">^Stepping^         ^UI^                     ^Switch^                   ^Breakpoints^         ^Debug^                     ^Expressions
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">^^^^^^^^------------------------------------------------------------------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">_n_: Next          _uc_: Controls           _ss_: Session              _bb_: Toggle          _dd_: Debug                 _ee_: Eval
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">_i_: Step in       _ue_: Expressions        _st_: Thread               _bd_: Delete          _dr_: Debug recent          _er_: Eval region
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">_o_: Step out      _ul_: Locals             _sf_: Stack frame          _ba_: Add             _dl_: Debug last            _es_: Eval thing at point
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">_c_: Continue      _ur_: REPL               _su_: Up stack frame       _bc_: Set condition   _de_: Edit debug template   _ea_: Add expression
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">_r_: Restart frame _uo_: Output             _sd_: Down stack frame     _bh_: Set hit count   _Q_:  Disconnect            _ed_: Remove expression
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">		 _us_: Sessions           _sF_: Stack frame filtered _bl_: Set log message                           _eu_: Refresh expressions
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">		 _ub_: Breakpoints                                                                               &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;n&#34;</span> <span style="color:#19177c">dap-next</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;i&#34;</span> <span style="color:#19177c">dap-step-in</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;o&#34;</span> <span style="color:#19177c">dap-step-out</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#19177c">dap-continue</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;r&#34;</span> <span style="color:#19177c">dap-restart-frame</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;uc&#34;</span> <span style="color:#19177c">dap-ui-controls-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;ue&#34;</span> <span style="color:#19177c">my/dap-ui-toggle-expressions</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;ul&#34;</span> <span style="color:#19177c">my/dap-ui-toggle-locals</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;ur&#34;</span> <span style="color:#19177c">my/dap-ui-toggle-repl</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;uo&#34;</span> <span style="color:#19177c">dap-go-to-output-buffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;us&#34;</span> <span style="color:#19177c">my/dap-ui-toggle-sessions</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;ub&#34;</span> <span style="color:#19177c">my/dap-ui-toggle-breakpoints</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;ss&#34;</span> <span style="color:#19177c">dap-switch-session</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;st&#34;</span> <span style="color:#19177c">dap-switch-thread</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;sf&#34;</span> <span style="color:#19177c">dap-switch-stack-frame</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;sF&#34;</span> <span style="color:#19177c">my/dap-switch-stack-frame</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;su&#34;</span> <span style="color:#19177c">dap-up-stack-frame</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;sd&#34;</span> <span style="color:#19177c">dap-down-stack-frame</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;bb&#34;</span> <span style="color:#19177c">dap-breakpoint-toggle</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;ba&#34;</span> <span style="color:#19177c">dap-breakpoint-add</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;bd&#34;</span> <span style="color:#19177c">dap-breakpoint-delete</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;bc&#34;</span> <span style="color:#19177c">dap-breakpoint-condition</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;bh&#34;</span> <span style="color:#19177c">dap-breakpoint-hit-condition</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;bl&#34;</span> <span style="color:#19177c">dap-breakpoint-log-message</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;dd&#34;</span> <span style="color:#19177c">dap-debug</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;dr&#34;</span> <span style="color:#19177c">dap-debug-recent</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;dl&#34;</span> <span style="color:#19177c">dap-debug-last</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;de&#34;</span> <span style="color:#19177c">dap-debug-edit-template</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;ee&#34;</span> <span style="color:#19177c">dap-eval</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;ea&#34;</span> <span style="color:#19177c">dap-ui-expressions-add</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;er&#34;</span> <span style="color:#19177c">dap-eval-region</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;es&#34;</span> <span style="color:#19177c">dap-eval-thing-at-point</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;ed&#34;</span> <span style="color:#19177c">dap-ui-expressions-remove</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;eu&#34;</span> <span style="color:#19177c">dap-ui-expressions-refresh</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#800">nil</span> <span style="color:#ba2121">&#34;quit&#34;</span> <span style="color:#008000">:color</span> <span style="color:#19177c">blue</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#ba2121">&#34;Q&#34;</span> <span style="color:#19177c">dap-disconnect</span> <span style="color:#008000">:color</span> <span style="color:#19177c">red</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/dap-hydra/body</span>)
</span></span></code></pre></div><h5 id="ui-fixes">UI Fixes</h5>
<p>There are some problems with DAP UI in my setup.</p>
<p>First, DAP uses Treemacs buffers quite extensively, and they hide the doom modeline for some reason, so I can&rsquo;t tell which buffer is active and can&rsquo;t see borders between buffers.</p>
<p>Second, lines are truncated in some strange way, but calling <code>toggle-truncate-lines</code> seems to fix that.</p>
<p>So I define a macro that creates a function that I can further use in advices.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defvar</span> <span style="color:#19177c">my/dap-mode-buffer-fixed</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;dap-mode</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defmacro</span> <span style="color:#19177c">my/define-dap-tree-buffer-fixer</span> (<span style="color:#19177c">buffer-var</span> <span style="color:#00f">buffer-name</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#666">`</span>(<span style="color:#008000">defun</span> <span style="color:#666">,</span>(<span style="color:#00f">intern</span> (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;my/fix-dap-ui-&#34;</span> <span style="color:#00f">buffer-name</span> <span style="color:#ba2121">&#34;-buffer&#34;</span>)) (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">_</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">with-current-buffer</span> <span style="color:#666">,</span><span style="color:#19177c">buffer-var</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">unless</span> <span style="color:#19177c">my/dap-mode-buffer-fixed</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">toggle-truncate-lines</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">doom-modeline-set-modeline</span> <span style="color:#19177c">&#39;info</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">setq-local</span> <span style="color:#19177c">my/dap-mode-buffer-fixed</span> <span style="color:#800">t</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/define-dap-tree-buffer-fixer</span> <span style="color:#19177c">dap-ui--locals-buffer</span> <span style="color:#ba2121">&#34;locals&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/define-dap-tree-buffer-fixer</span> <span style="color:#19177c">dap-ui--expressions-buffer</span> <span style="color:#ba2121">&#34;expressions&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/define-dap-tree-buffer-fixer</span> <span style="color:#19177c">dap-ui--sessions-buffer</span> <span style="color:#ba2121">&#34;sessions&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/define-dap-tree-buffer-fixer</span> <span style="color:#19177c">dap-ui--breakpoints-buffer</span> <span style="color:#ba2121">&#34;breakpoints&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;dap-ui-locals</span> <span style="color:#008000">:after</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/fix-dap-ui-locals-buffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;dap-ui-expressions</span> <span style="color:#008000">:after</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/fix-dap-ui-expressions-buffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;dap-ui-sessions</span> <span style="color:#008000">:after</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/fix-dap-ui-sessions-buffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;dap-ui-breakpoints</span> <span style="color:#008000">:after</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/fix-dap-ui-breakpoints-buffer</span>))
</span></span></code></pre></div><h5 id="helper-functions">Helper functions</h5>
<p>Some helper functions that make debugging with DAP easier.</p>
<p>DAP seems to mess with window parameters from time to time. This function clears &ldquo;bad&rdquo; window parameters.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/clear-bad-window-parameters</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Clear window parameters that interrupt my workflow.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">window</span> (<span style="color:#00f">get-buffer-window</span> (<span style="color:#00f">current-buffer</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">set-window-parameter</span> <span style="color:#19177c">window</span> <span style="color:#19177c">&#39;no-delete-other-windows</span> <span style="color:#800">nil</span>)))
</span></span></code></pre></div><p>A function to kill a value from a treemacs node.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dap-yank-value-at-point</span> (<span style="color:#19177c">node</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> (<span style="color:#00f">list</span> (<span style="color:#19177c">treemacs-node-at-point</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">kill-new</span> (<span style="color:#00f">message</span> (<span style="color:#00f">plist-get</span> (<span style="color:#19177c">button-get</span> <span style="color:#19177c">node</span> <span style="color:#008000">:item</span>) <span style="color:#008000">:value</span>))))
</span></span></code></pre></div><p>A function to open a value from a treemacs node in a new buffer.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dap-display-value</span> (<span style="color:#19177c">node</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> (<span style="color:#00f">list</span> (<span style="color:#19177c">treemacs-node-at-point</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">value</span> (<span style="color:#00f">plist-get</span> (<span style="color:#19177c">button-get</span> <span style="color:#19177c">node</span> <span style="color:#008000">:item</span>) <span style="color:#008000">:value</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> <span style="color:#19177c">value</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">let</span> ((<span style="color:#19177c">buffer</span> (<span style="color:#19177c">generate-new-buffer</span> <span style="color:#ba2121">&#34;dap-value&#34;</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">with-current-buffer</span> <span style="color:#19177c">buffer</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">insert</span> <span style="color:#19177c">value</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">select-window</span> (<span style="color:#19177c">display-buffer</span> <span style="color:#19177c">buffer</span>))))))
</span></span></code></pre></div><h5 id="switch-to-stack-frame-with-filter">Switch to stack frame with filter</h5>
<p>One significant improvement over Chrome Inspector for my particular stack is an ability to filter the stack frame list, for instance, to see only frames that relate to my current project.</p>
<p>So, here are functions that customize the filters:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;dap-mode</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">my/dap-stack-frame-filters</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">`</span>((<span style="color:#ba2121">&#34;node_modules,node:internal&#34;</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#008000">rx</span> (<span style="color:#008000">or</span> <span style="color:#ba2121">&#34;node_modules&#34;</span> <span style="color:#ba2121">&#34;node:internal&#34;</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#ba2121">&#34;node_modules&#34;</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#008000">rx</span> (<span style="color:#008000">or</span> <span style="color:#ba2121">&#34;node_modules&#34;</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#ba2121">&#34;node:internal&#34;</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#008000">rx</span> (<span style="color:#008000">or</span> <span style="color:#ba2121">&#34;node:internal&#34;</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">my/dap-stack-frame-current-filter</span> (<span style="color:#19177c">cdar</span> <span style="color:#19177c">my/dap-stack-frame-filters</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">my/dap-stack-frame-filter-set</span> ()
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq</span> <span style="color:#19177c">my/dap-stack-frame-current-filter</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">cdr</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#00f">assoc</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#00f">completing-read</span> <span style="color:#ba2121">&#34;Filter: &#34;</span> <span style="color:#19177c">my/dap-stack-frame-filters</span>)
</span></span><span style="display:flex;"><span>	    <span style="color:#19177c">my/dap-stack-frame-filters</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">my/dap-stack-frame-filter</span> (<span style="color:#19177c">frame</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">when-let</span> (<span style="color:#19177c">path</span> (<span style="color:#19177c">dap--get-path-for-frame</span> <span style="color:#19177c">frame</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">not</span> (<span style="color:#00f">string-match</span> <span style="color:#19177c">my/dap-stack-frame-current-filter</span> <span style="color:#19177c">path</span>)))))
</span></span></code></pre></div><p>And here is a version of <code>dap-switch-stack-frame</code> that uses the said filter.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dap-switch-stack-frame</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Switch stackframe by selecting another stackframe stackframes from current thread.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#19177c">not</span> (<span style="color:#19177c">dap--cur-session</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#d2413a;font-weight:bold">error</span> <span style="color:#ba2121">&#34;There is no active session&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">-if-let</span> (<span style="color:#19177c">thread-id</span> (<span style="color:#19177c">dap--debug-session-thread-id</span> (<span style="color:#19177c">dap--cur-session</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">-if-let</span> (<span style="color:#19177c">stack-frames</span>
</span></span><span style="display:flex;"><span>		(<span style="color:#00f">gethash</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#19177c">thread-id</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">dap--debug-session-thread-stack-frames</span> (<span style="color:#19177c">dap--cur-session</span>))))
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">index</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">stack-framces-filtered</span>
</span></span><span style="display:flex;"><span>		  (<span style="color:#19177c">-filter</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/dap-stack-frame-filter</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#19177c">stack-frames</span>))
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">new-stack-frame</span>
</span></span><span style="display:flex;"><span>		  (<span style="color:#19177c">dap--completing-read</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#ba2121">&#34;Select active frame: &#34;</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#19177c">stack-framces-filtered</span>
</span></span><span style="display:flex;"><span>		   (<span style="color:#19177c">-lambda</span> ((<span style="color:#19177c">frame</span> <span style="color:#19177c">&amp;as</span> <span style="color:#19177c">&amp;hash</span> <span style="color:#ba2121">&#34;name&#34;</span>))
</span></span><span style="display:flex;"><span>		     (<span style="color:#19177c">if-let</span> (<span style="color:#19177c">frame-path</span> (<span style="color:#19177c">dap--get-path-for-frame</span> <span style="color:#19177c">frame</span>))
</span></span><span style="display:flex;"><span>			 (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;%s: %s (in %s)&#34;</span>
</span></span><span style="display:flex;"><span>				 (<span style="color:#008000">cl-incf</span> <span style="color:#19177c">index</span>) <span style="color:#19177c">name</span> <span style="color:#19177c">frame-path</span>)
</span></span><span style="display:flex;"><span>		       (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;%s: %s&#34;</span> (<span style="color:#008000">cl-incf</span> <span style="color:#19177c">index</span>) <span style="color:#19177c">name</span>)))
</span></span><span style="display:flex;"><span>		   <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#800">t</span>)))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">dap--go-to-stack-frame</span> (<span style="color:#19177c">dap--cur-session</span>) <span style="color:#19177c">new-stack-frame</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">-&gt;&gt;</span> (<span style="color:#19177c">dap--cur-session</span>)
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">dap--debug-session-name</span>
</span></span><span style="display:flex;"><span>	     (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;Current session %s is not stopped&#34;</span>)
</span></span><span style="display:flex;"><span>	     <span style="color:#d2413a;font-weight:bold">error</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#d2413a;font-weight:bold">error</span> <span style="color:#ba2121">&#34;No thread is currently active %s&#34;</span> (<span style="color:#19177c">dap--debug-session-name</span> (<span style="color:#19177c">dap--cur-session</span>)))))
</span></span></code></pre></div><h5 id="smarter-switch-to-stack-frame">Smarter switch to stack frame</h5>
<ul>
<li><strong>CREDIT</strong>: Thanks @yyoncho on the Emacs LSP Discord for helping me with this!</li>
</ul>
<p>By default, when a breakpoint is hit, dap always pop us the buffer in the active EXWM workspace and in the active perspective. I&rsquo;d like it to switch to an existing buffer instead.</p>
<p>So first we need to locate EXWM workspace for the file with <code>path</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/exwm-perspective-find-buffer</span> (<span style="color:#19177c">path</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Find a buffer with PATH in all EXWM perspectives.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">Returns (&lt;buffer&gt; . &lt;workspace-index&gt;) or nil.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">buf</span> (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">buf</span> <span style="color:#19177c">being</span> <span style="color:#19177c">buffers</span>
</span></span><span style="display:flex;"><span>		       <span style="color:#008000">if</span> (<span style="color:#008000">and</span> (<span style="color:#00f">buffer-file-name</span> <span style="color:#19177c">buf</span>)
</span></span><span style="display:flex;"><span>			       (<span style="color:#19177c">f-equal-p</span> (<span style="color:#00f">buffer-file-name</span> <span style="color:#19177c">buf</span>) <span style="color:#19177c">path</span>))
</span></span><span style="display:flex;"><span>		       <span style="color:#008000">return</span> <span style="color:#19177c">buf</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">target-workspace</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">and</span> <span style="color:#19177c">buf</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">frame</span> <span style="color:#19177c">in</span> <span style="color:#19177c">exwm-workspace--list</span>
</span></span><span style="display:flex;"><span>			<span style="color:#008000">if</span> (<span style="color:#008000">with-selected-frame</span> <span style="color:#19177c">frame</span>
</span></span><span style="display:flex;"><span>			     (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">persp-name</span> <span style="color:#19177c">being</span> <span style="color:#19177c">the</span> <span style="color:#19177c">hash-keys</span> <span style="color:#19177c">of</span> (<span style="color:#19177c">perspectives-hash</span>)
</span></span><span style="display:flex;"><span>				      <span style="color:#008000">if</span> (<span style="color:#00f">member</span> <span style="color:#19177c">buf</span> (<span style="color:#19177c">persp-buffers</span>
</span></span><span style="display:flex;"><span>						      (<span style="color:#00f">gethash</span> <span style="color:#19177c">persp-name</span> (<span style="color:#19177c">perspectives-hash</span>))))
</span></span><span style="display:flex;"><span>				      <span style="color:#008000">return</span> <span style="color:#19177c">persp-name</span>))
</span></span><span style="display:flex;"><span>			<span style="color:#008000">return</span> (<span style="color:#19177c">cl-position</span> <span style="color:#19177c">frame</span> <span style="color:#19177c">exwm-workspace--list</span>)))))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> <span style="color:#19177c">target-workspace</span> (<span style="color:#00f">cons</span> <span style="color:#19177c">buf</span> <span style="color:#19177c">target-workspace</span>))))
</span></span></code></pre></div><p>And override <code>dap--go-to-stack-frame</code> to take that into account. For some reason, evaluating this before <code>dap-mode</code> doesn&rsquo;t work.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dap--go-to-stack-frame-override</span> (<span style="color:#19177c">debug-session</span> <span style="color:#19177c">stack-frame</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Make STACK-FRAME the active STACK-FRAME of DEBUG-SESSION.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">with-lsp-workspace</span> (<span style="color:#19177c">dap--debug-session-workspace</span> <span style="color:#19177c">debug-session</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> <span style="color:#19177c">stack-frame</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">-let*</span> (((<span style="color:#19177c">&amp;hash</span> <span style="color:#ba2121">&#34;line&#34;</span> <span style="color:#19177c">line</span> <span style="color:#ba2121">&#34;column&#34;</span> <span style="color:#19177c">column</span> <span style="color:#ba2121">&#34;name&#34;</span> <span style="color:#19177c">name</span>) <span style="color:#19177c">stack-frame</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">path</span> (<span style="color:#19177c">dap--get-path-for-frame</span> <span style="color:#19177c">stack-frame</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">setf</span> (<span style="color:#19177c">dap--debug-session-active-frame</span> <span style="color:#19177c">debug-session</span>) <span style="color:#19177c">stack-frame</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#408080;font-style:italic">;; If we have a source file with path attached, open it and</span>
</span></span><span style="display:flex;"><span>	<span style="color:#408080;font-style:italic">;; position the point in the line/column referenced in the</span>
</span></span><span style="display:flex;"><span>	<span style="color:#408080;font-style:italic">;; stack trace.</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">if</span> (<span style="color:#008000">and</span> <span style="color:#19177c">path</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#19177c">path</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">let</span> ((<span style="color:#19177c">exwm-target</span> (<span style="color:#19177c">my/exwm-perspective-find-buffer</span> <span style="color:#19177c">path</span>)))
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">if</span> <span style="color:#19177c">exwm-target</span>
</span></span><span style="display:flex;"><span>		    (<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>		      (<span style="color:#008000">unless</span> (<span style="color:#00f">=</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">exwm-target</span>) <span style="color:#19177c">exwm-workspace-current-index</span>)
</span></span><span style="display:flex;"><span>			(<span style="color:#19177c">exwm-workspace-switch</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">exwm-target</span>)))
</span></span><span style="display:flex;"><span>		      (<span style="color:#19177c">persp-switch-to-buffer</span> (<span style="color:#00f">car</span> <span style="color:#19177c">exwm-target</span>)))
</span></span><span style="display:flex;"><span>		  (<span style="color:#00f">select-window</span> (<span style="color:#19177c">get-mru-window</span> (<span style="color:#00f">selected-frame</span>) <span style="color:#800">nil</span>))
</span></span><span style="display:flex;"><span>		  (<span style="color:#19177c">find-file</span> <span style="color:#19177c">path</span>)))
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">goto-char</span> (<span style="color:#00f">point-min</span>))
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">forward-line</span> (<span style="color:#00f">1-</span> <span style="color:#19177c">line</span>))
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">forward-char</span> <span style="color:#19177c">column</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;No source code for %s. Cursor at %s:%s.&#34;</span> <span style="color:#19177c">name</span> <span style="color:#19177c">line</span> <span style="color:#19177c">column</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">run-hook-with-args</span> <span style="color:#19177c">&#39;dap-stack-frame-changed-hook</span> <span style="color:#19177c">debug-session</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;exwm</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;dap-mode</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">dap--go-to-stack-frame</span> <span style="color:#008000">:override</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/dap--go-to-stack-frame-override</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (advice-remove #&#39;dap--go-to-stack-frame #&#39;my/dap--go-to-stack-frame-override)</span>
</span></span></code></pre></div><h5 id="debug-templates">Debug templates</h5>
<p>Some debug templates I frequently use.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;dap-mode</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dap-register-debug-template</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;Node::Nest.js&#34;</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">list</span> <span style="color:#008000">:type</span> <span style="color:#ba2121">&#34;node&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:request</span> <span style="color:#ba2121">&#34;attach&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:name</span> <span style="color:#ba2121">&#34;Node::Attach&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:port</span> <span style="color:#666">9229</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:outFiles</span> [<span style="color:#ba2121">&#34;${workspaceFolder}/dist/**/*.js&#34;</span>]
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:sourceMaps</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:program</span> <span style="color:#ba2121">&#34;${workspaceFolder}/src/app.ts&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dap-register-debug-template</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;Node::Babel&#34;</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">list</span> <span style="color:#008000">:type</span> <span style="color:#ba2121">&#34;node&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:request</span> <span style="color:#ba2121">&#34;attach&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:name</span> <span style="color:#ba2121">&#34;Node::Attach&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:port</span> <span style="color:#666">9229</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:program</span> <span style="color:#ba2121">&#34;${workspaceFolder}/dist/bin/www.js&#34;</span>)))
</span></span></code></pre></div><h4 id="reformatter">Reformatter</h4>
<p>A general-purpose package to run formatters on files. While the most popular formatters are already packaged for Emacs, those that aren&rsquo;t can be invoked with this package.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">reformatter</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h4 id="copilot">copilot</h4>
<p><a href="https://copilot.github.com/">GitHub Copilot</a> is a project of GitHub and OpenAI that provides code completions. It&rsquo;s somewhat controversial in the Emacs community but I opt in using it for now.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/copilot-tab</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">or</span> (<span style="color:#19177c">copilot-accept-completion</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> (<span style="color:#19177c">my/should-run-emmet-p</span>) (<span style="color:#19177c">my/emmet-or-tab</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> (<span style="color:#008000">and</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">evil-state</span> <span style="color:#19177c">&#39;normal</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#008000">or</span> <span style="color:#19177c">hs-minor-mode</span> <span style="color:#19177c">outline-minor-mode</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">evil-toggle-fold</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">indent-for-tab-command</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">copilot</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;SqrtMinusOne/copilot.el&#34;</span> <span style="color:#008000">:files</span> (<span style="color:#ba2121">&#34;dist&#34;</span> <span style="color:#ba2121">&#34;*.el&#34;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">copilot-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;prog-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">copilot-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;company-active-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;&lt;backtab&gt;&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/copilot-tab</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;copilot-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;&lt;tab&gt;&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/copilot-tab</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-j&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">copilot-accept-completion-by-line</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-l&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">copilot-accept-completion-by-word</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">copilot-lispy-integration</span> <span style="color:#800">t</span>))
</span></span></code></pre></div><h4 id="general-additional-config">General additional config</h4>
<p>Make smartparens behave the way I like for C-like languages.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/set-smartparens-indent</span> (<span style="color:#19177c">mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">sp-local-pair</span> <span style="color:#19177c">mode</span> <span style="color:#ba2121">&#34;{&#34;</span> <span style="color:#800">nil</span> <span style="color:#008000">:post-handlers</span> <span style="color:#666">&#39;</span>((<span style="color:#ba2121">&#34;|| &#34;</span> <span style="color:#ba2121">&#34;SPC&#34;</span>) (<span style="color:#ba2121">&#34;||\n[i]&#34;</span> <span style="color:#ba2121">&#34;RET&#34;</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">sp-local-pair</span> <span style="color:#19177c">mode</span> <span style="color:#ba2121">&#34;[&#34;</span> <span style="color:#800">nil</span> <span style="color:#008000">:post-handlers</span> <span style="color:#666">&#39;</span>((<span style="color:#ba2121">&#34;|| &#34;</span> <span style="color:#ba2121">&#34;SPC&#34;</span>) (<span style="color:#ba2121">&#34;||\n[i]&#34;</span> <span style="color:#ba2121">&#34;RET&#34;</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">sp-local-pair</span> <span style="color:#19177c">mode</span> <span style="color:#ba2121">&#34;(&#34;</span> <span style="color:#800">nil</span> <span style="color:#008000">:post-handlers</span> <span style="color:#666">&#39;</span>((<span style="color:#ba2121">&#34;|| &#34;</span> <span style="color:#ba2121">&#34;SPC&#34;</span>) (<span style="color:#ba2121">&#34;||\n[i]&#34;</span> <span style="color:#ba2121">&#34;RET&#34;</span>))))
</span></span></code></pre></div><p>Override flycheck checker with eslint.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/set-flycheck-eslint</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Override flycheck checker with eslint.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">lsp-diagnostic-package</span> <span style="color:#008000">:none</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">flycheck-checker</span> <span style="color:#19177c">&#39;javascript-eslint</span>))
</span></span></code></pre></div><h3 id="web-development">Web development</h3>
<p>Configs for various web development technologies I&rsquo;m using.</p>
<h4 id="emmet">Emmet</h4>
<p><a href="https://emmet.io/">Emmet</a> is a toolkit which greatly speeds up typing HTML &amp; CSS.</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>TODO</td>
<td>make expand div[disabled] as &lt;div disabled&gt;&lt;/div&gt;</td>
</tr>
</tbody>
</table>
<p>My bit of config here:</p>
<ul>
<li>makes <code>TAB</code> the only key I have to use</li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/should-run-emmet-p</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">and</span> (<span style="color:#19177c">bound-and-true-p</span> <span style="color:#19177c">emmet-mode</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">or</span> (<span style="color:#008000">and</span> (<span style="color:#19177c">derived-mode-p</span> <span style="color:#19177c">&#39;web-mode</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#00f">member</span> (<span style="color:#19177c">web-mode-language-at-pos</span>) <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;html&#34;</span> <span style="color:#ba2121">&#34;css&#34;</span>)))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">not</span> (<span style="color:#19177c">derived-mode-p</span> <span style="color:#19177c">&#39;web-mode</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">emmet-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> ((<span style="color:#19177c">vue-html-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">emmet-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">svelte-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">emmet-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">web-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">emmet-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">html-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">emmet-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">css-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">emmet-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">scss-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">emmet-mode</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">my/emmet-or-tab</span> (<span style="color:#008000">&amp;optional</span> <span style="color:#19177c">arg</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> (<span style="color:#19177c">my/should-run-emmet-p</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">or</span> (<span style="color:#19177c">emmet-expand-line</span> <span style="color:#19177c">arg</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">emmet-go-to-edit-point</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">indent-for-tab-command</span> <span style="color:#19177c">arg</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">indent-for-tab-command</span> <span style="color:#19177c">arg</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-imap</span> <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;emmet-mode-keymap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;TAB&#34;</span> <span style="color:#19177c">&#39;my/emmet-or-tab</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;&lt;backtab&gt;&#34;</span> <span style="color:#19177c">&#39;emmet-prev-edit-point</span>))
</span></span></code></pre></div><h4 id="prettier">Prettier</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">prettier</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">prettier-prettify</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">js-mode-map</span> <span style="color:#19177c">web-mode-map</span> <span style="color:#19177c">typescript-mode-map</span> <span style="color:#19177c">vue-mode-map</span> <span style="color:#19177c">svelte-mode-map</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;rr&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">prettier-prettify</span>))
</span></span></code></pre></div><h4 id="typescript">TypeScript</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">typescript-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.ts\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;typescript-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;typescript-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">rainbow-delimiters-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;typescript-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">hs-minor-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;typescript-mode</span>))
</span></span></code></pre></div><h4 id="javascript">JavaScript</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;js-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;js-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">hs-minor-mode</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;js-mode</span>)
</span></span></code></pre></div><h4 id="jest">Jest</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">jest-test-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> ((<span style="color:#19177c">typescript-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">jest-test-mode</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">js-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">jest-test-mode</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;jest-test-mode-map</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;t&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;t&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">jest-test-run-at-point</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">jest-test-debug-run-at-point</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;r&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">jest-test-run</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;a&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">jest-test-run-all-tests</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defmacro</span> <span style="color:#19177c">my/jest-test-with-debug-flags</span> (<span style="color:#19177c">form</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;Execute FORM with debugger flags set.&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">declare</span> (<span style="color:#19177c">indent</span> <span style="color:#666">0</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#666">`</span>(<span style="color:#008000">let</span> ((<span style="color:#19177c">jest-test-options</span> (<span style="color:#19177c">seq-concatenate</span> <span style="color:#19177c">&#39;list</span> <span style="color:#19177c">jest-test-options</span> (<span style="color:#00f">list</span> <span style="color:#ba2121">&#34;--runInBand&#34;</span>) ))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">jest-test-npx-options</span> (<span style="color:#19177c">seq-concatenate</span> <span style="color:#19177c">&#39;list</span> <span style="color:#19177c">jest-test-npx-options</span> (<span style="color:#00f">list</span> <span style="color:#ba2121">&#34;--node-options&#34;</span> <span style="color:#ba2121">&#34;--inspect-brk&#34;</span>))))
</span></span><span style="display:flex;"><span>       <span style="color:#666">,</span><span style="color:#19177c">form</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">my/jest-test-debug</span> ()
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;Run the test with an inline debugger attached.&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/jest-test-with-debug-flags</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">jest-test-run</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">my/jest-test-debug-rerun-test</span> ()
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;Run the test with an inline debugger attached.&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/jest-test-with-debug-flags</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">jest-test-rerun-test</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">my/jest-test-debug-run-at-point</span> ()
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;Run the test with an inline debugger attached.&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/jest-test-with-debug-flags</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">jest-test-run-at-point</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">jest-test-debug</span> <span style="color:#008000">:override</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/jest-test-debug</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">jest-test-debug-rerun-test</span> <span style="color:#008000">:override</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/jest-test-debug-rerun-test</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">jest-test-debug-run-at-point</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#008000">:override</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/jest-test-debug-run-at-point</span>))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/jest-test-run-at-point-copy</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Run the top level describe block of the current buffer&#39;s point.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">filename</span> (<span style="color:#19177c">jest-test-find-file</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">example</span>  (<span style="color:#19177c">jest-test-unit-at-point</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> (<span style="color:#008000">and</span> <span style="color:#19177c">filename</span> <span style="color:#19177c">example</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">jest-test-from-project-directory</span> <span style="color:#19177c">filename</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">let</span> ((<span style="color:#19177c">jest-test-options</span> (<span style="color:#19177c">seq-concatenate</span> <span style="color:#19177c">&#39;list</span> <span style="color:#19177c">jest-test-options</span> (<span style="color:#00f">list</span> <span style="color:#ba2121">&#34;-t&#34;</span> <span style="color:#19177c">example</span>))))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">kill-new</span> (<span style="color:#19177c">jest-test-command</span> <span style="color:#19177c">filename</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">message</span> <span style="color:#19177c">jest-test-not-found-message</span>))))
</span></span></code></pre></div><h4 id="web-mode">web-mode</h4>
<p><a href="https://web-mode.org/">web-mode.el</a> is a major mode to edit various web templates.</p>
<p>Trying this one out instead of vue-mode and svelte-mode, because this one seems to have better support for tree-sitter and generally less problems.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">web-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">web-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;auto-mode-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;\\.svelte\\&#39;&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">web-mode</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;auto-mode-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;\\.vue\\&#39;&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">web-mode</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;web-mode-hook</span> <span style="color:#19177c">&#39;smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;web-mode-hook</span> <span style="color:#19177c">&#39;hs-minor-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;web-mode</span>))
</span></span></code></pre></div><p>Hooking this up with lsp.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/web-mode-lsp-extensions</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">`</span>(<span style="color:#666">,</span>(<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;.svelte&#34;</span> <span style="color:#19177c">eos</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#666">,</span>(<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;.vue&#34;</span> <span style="color:#19177c">eos</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/web-mode-lsp</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#19177c">seq-some</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">lambda</span> (<span style="color:#19177c">regex</span>) (<span style="color:#19177c">string-match-p</span> <span style="color:#19177c">regex</span> (<span style="color:#00f">buffer-name</span>)))
</span></span><span style="display:flex;"><span>	 <span style="color:#19177c">my/web-mode-lsp-extensions</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">lsp-deferred</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;web-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/web-mode-lsp</span>)
</span></span></code></pre></div><p>Vue settings</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/web-mode-vue-setup</span> (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">_</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;.vue&#34;</span> <span style="color:#19177c">eos</span>) (<span style="color:#00f">buffer-name</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq-local</span> <span style="color:#19177c">web-mode-script-padding</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq-local</span> <span style="color:#19177c">web-mode-style-padding</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq-local</span> <span style="color:#19177c">create-lockfiles</span> <span style="color:#800">nil</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;web-mode-hook</span> <span style="color:#19177c">&#39;my/web-mode-vue-setup</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;editorconfig-after-apply-functions</span> <span style="color:#19177c">&#39;my/web-mode-vue-setup</span>)
</span></span></code></pre></div><h3 id="latex">LaTeX</h3>
<h4 id="auctex">AUCTeX</h4>
<p>The best LaTeX editing environment I&rsquo;ve found so far.</p>
<p>References:</p>
<ul>
<li><a href="https://www.gnu.org/software/auctex/">AUCTeX homepage</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">tex</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#19177c">auctex</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">TeX-auto-save</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">TeX-parse-self</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">TeX-PDF-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; Use XeLaTeX &amp; stuff</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">TeX-engine</span> <span style="color:#19177c">&#39;xetex</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">TeX-command-extra-options</span> <span style="color:#ba2121">&#34;-shell-escape&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">TeX-source-correlate-method</span> <span style="color:#19177c">&#39;synctex</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">TeX-source-correlate-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">TeX-source-correlate-start-server</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">LaTeX-math-menu-unicode</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">font-latex-fontify-sectioning</span> <span style="color:#666">1.3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; Scale preview for my DPI</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-default</span> <span style="color:#19177c">preview-scale-function</span> <span style="color:#666">1.4</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#00f">boundp</span> <span style="color:#19177c">&#39;tex--prettify-symbols-alist</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">assoc-delete-all</span> <span style="color:#ba2121">&#34;--&#34;</span> <span style="color:#19177c">tex--prettify-symbols-alist</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">assoc-delete-all</span> <span style="color:#ba2121">&#34;---&#34;</span> <span style="color:#19177c">tex--prettify-symbols-alist</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;LaTeX-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">TeX-fold-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">outline-minor-mode</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;TeX-view-program-selection</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#666">&#39;</span>(<span style="color:#19177c">output-pdf</span> <span style="color:#ba2121">&#34;Zathura&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; Do not run lsp within templated TeX files</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;LaTeX-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">unless</span> (<span style="color:#00f">string-match</span> <span style="color:#ba2121">&#34;\.hogan\.tex$&#34;</span> (<span style="color:#00f">buffer-name</span>))
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">lsp</span>))
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">setq-local</span> <span style="color:#19177c">lsp-diagnostic-package</span> <span style="color:#008000">:none</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">setq-local</span> <span style="color:#19177c">flycheck-checker</span> <span style="color:#19177c">&#39;tex-chktex</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;LaTeX-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">rainbow-delimiters-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;LaTeX-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;LaTeX-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">prettify-symbols-mode</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;LaTeX-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;smartparens-latex</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-nmap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">LaTeX-mode-map</span> <span style="color:#19177c">latex-mode-map</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;RET&#34;</span> <span style="color:#19177c">&#39;TeX-command-run-all</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;C-c t&#34;</span> <span style="color:#19177c">&#39;orgtbl-mode</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">&lt;&lt;init-greek-latex-snippets&gt;&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">&lt;&lt;init-english-latex-snippets&gt;&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">&lt;&lt;init-math-latex-snippets&gt;&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">&lt;&lt;init-section-latex-snippets&gt;&gt;</span>)
</span></span></code></pre></div><h4 id="bibtex">BibTeX</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ivy-bibtex</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">ivy-bibtex</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;fB&#34;</span> <span style="color:#19177c">&#39;ivy-bibtex</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;bibtex-mode</span> <span style="color:#19177c">&#39;smartparens-mode</span>)
</span></span></code></pre></div><h4 id="import-dot-sty">Import *.sty</h4>
<p>A function to import <code>.sty</code> files to the LaTeX document.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/list-sty</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">reverse</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">sort</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">seq-filter</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file</span>) (<span style="color:#008000">if</span> (<span style="color:#00f">string-match</span> <span style="color:#ba2121">&#34;.*\.sty$&#34;</span> <span style="color:#19177c">file</span>) <span style="color:#666">1</span> <span style="color:#800">nil</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">directory-files</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">seq-some</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">lambda</span> (<span style="color:#19177c">dir</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">if</span> (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">f-directory-p</span> <span style="color:#19177c">dir</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">seq-some</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file</span>) (<span style="color:#00f">string-match</span> <span style="color:#ba2121">&#34;.*\.sty$&#34;</span> <span style="color:#19177c">file</span>))
</span></span><span style="display:flex;"><span>	       (<span style="color:#00f">directory-files</span> <span style="color:#19177c">dir</span>))
</span></span><span style="display:flex;"><span>	      ) <span style="color:#19177c">dir</span> <span style="color:#800">nil</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">list</span> <span style="color:#ba2121">&#34;./styles&#34;</span> <span style="color:#ba2121">&#34;../styles/&#34;</span> <span style="color:#ba2121">&#34;.&#34;</span> <span style="color:#ba2121">&#34;..&#34;</span>)) <span style="color:#008000">:full</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">lambda</span> (<span style="color:#19177c">f1</span> <span style="color:#19177c">f2</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">let</span> ((<span style="color:#19177c">f1b</span> (<span style="color:#19177c">file-name-base</span> <span style="color:#19177c">f1</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">f1b</span> (<span style="color:#19177c">file-name-base</span> <span style="color:#19177c">f2</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">cond</span>
</span></span><span style="display:flex;"><span>	 ((<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;.*BibTex&#34;</span> <span style="color:#19177c">f1</span>) <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>	 ((<span style="color:#008000">and</span> (<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;.*Locale&#34;</span> <span style="color:#19177c">f1</span>) (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;.*BibTex&#34;</span> <span style="color:#19177c">f2</span>))) <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>	 ((<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;.*Preamble&#34;</span> <span style="color:#19177c">f2</span>) <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#800">t</span> (<span style="color:#00f">string-lessp</span> <span style="color:#19177c">f1</span> <span style="color:#19177c">f2</span>))))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/import-sty</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">insert</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">apply</span> <span style="color:#00f">#&#39;concat</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">cl-mapcar</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file</span>) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;\\usepackage{&#34;</span> (<span style="color:#19177c">file-name-sans-extension</span> (<span style="color:#19177c">file-relative-name</span> <span style="color:#19177c">file</span> <span style="color:#19177c">default-directory</span>)) <span style="color:#ba2121">&#34;}\n&#34;</span>))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">my/list-sty</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/import-sty-org</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">insert</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">apply</span> <span style="color:#00f">#&#39;concat</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">cl-mapcar</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file</span>) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;#+LATEX_HEADER: \\usepackage{&#34;</span> (<span style="color:#19177c">file-name-sans-extension</span> (<span style="color:#19177c">file-relative-name</span> <span style="color:#19177c">file</span> <span style="color:#19177c">default-directory</span>)) <span style="color:#ba2121">&#34;}\n&#34;</span>))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">my/list-sty</span>)))))
</span></span></code></pre></div><h4 id="snippets-1">Snippets</h4>
<table>
<thead>
<tr>
<th>Note</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>TODO</td>
<td>Move yasnippet snippets here? Maybe extract to a separate file?</td>
</tr>
</tbody>
</table>
<h5 id="greek-letters">Greek letters</h5>
<p>Autogenerate snippets for greek letters. I have a few blocks like this because it&rsquo;s faster &amp; more flexible than usual yasnippet snippets.</p>
<p>Noweb points to the AUCTeX config block.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/greek-alphabet</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>((<span style="color:#ba2121">&#34;a&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\alpha&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;b&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\beta&#34;</span> )
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;g&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\gamma&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\delta&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;e&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\epsilon&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;z&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\zeta&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;h&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\eta&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;o&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\theta&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;i&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\iota&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;k&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\kappa&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;l&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\lambda&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;m&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\mu&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;n&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\nu&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;x&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\xi&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;p&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\pi&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;r&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\rho&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\sigma&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;t&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\tau&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\upsilon&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;f&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\phi&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\chi&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;v&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\psi&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;g&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\omega&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/latex-greek-prefix</span> <span style="color:#ba2121">&#34;&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; The same for capitalized letters</span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">dolist</span> (<span style="color:#19177c">elem</span> <span style="color:#19177c">my/greek-alphabet</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">key</span> (<span style="color:#00f">car</span> <span style="color:#19177c">elem</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">value</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">elem</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> (<span style="color:#00f">string-equal</span> <span style="color:#19177c">key</span> (<span style="color:#00f">downcase</span> <span style="color:#19177c">key</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;my/greek-alphabet</span>
</span></span><span style="display:flex;"><span>		   (<span style="color:#00f">cons</span>
</span></span><span style="display:flex;"><span>		    (<span style="color:#00f">capitalize</span> (<span style="color:#00f">car</span> <span style="color:#19177c">elem</span>))
</span></span><span style="display:flex;"><span>		    (<span style="color:#00f">concat</span>
</span></span><span style="display:flex;"><span>		     (<span style="color:#00f">substring</span> <span style="color:#19177c">value</span> <span style="color:#666">0</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>		     (<span style="color:#00f">capitalize</span> (<span style="color:#00f">substring</span> <span style="color:#19177c">value</span> <span style="color:#666">1</span> <span style="color:#666">2</span>))
</span></span><span style="display:flex;"><span>		     (<span style="color:#00f">substring</span> <span style="color:#19177c">value</span> <span style="color:#666">2</span>)))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">yas-define-snippets</span>
</span></span><span style="display:flex;"><span> <span style="color:#19177c">&#39;latex-mode</span>
</span></span><span style="display:flex;"><span> (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">lambda</span> (<span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">list</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">my/latex-greek-prefix</span> (<span style="color:#00f">car</span> <span style="color:#19177c">elem</span>)) (<span style="color:#00f">cdr</span> <span style="color:#19177c">elem</span>) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;Greek letter &#34;</span> (<span style="color:#00f">car</span> <span style="color:#19177c">elem</span>))))
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">my/greek-alphabet</span>))
</span></span></code></pre></div><h5 id="english-letters">English letters</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/english-alphabet</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;a&#34;</span> <span style="color:#ba2121">&#34;b&#34;</span> <span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#ba2121">&#34;e&#34;</span> <span style="color:#ba2121">&#34;f&#34;</span> <span style="color:#ba2121">&#34;g&#34;</span> <span style="color:#ba2121">&#34;h&#34;</span> <span style="color:#ba2121">&#34;i&#34;</span> <span style="color:#ba2121">&#34;j&#34;</span> <span style="color:#ba2121">&#34;k&#34;</span> <span style="color:#ba2121">&#34;l&#34;</span> <span style="color:#ba2121">&#34;m&#34;</span> <span style="color:#ba2121">&#34;n&#34;</span> <span style="color:#ba2121">&#34;o&#34;</span> <span style="color:#ba2121">&#34;p&#34;</span> <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#ba2121">&#34;r&#34;</span> <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#ba2121">&#34;t&#34;</span> <span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#ba2121">&#34;v&#34;</span> <span style="color:#ba2121">&#34;w&#34;</span> <span style="color:#ba2121">&#34;x&#34;</span> <span style="color:#ba2121">&#34;y&#34;</span> <span style="color:#ba2121">&#34;z&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">dolist</span> (<span style="color:#19177c">elem</span> <span style="color:#19177c">my/english-alphabet</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#00f">string-equal</span> <span style="color:#19177c">elem</span> (<span style="color:#00f">downcase</span> <span style="color:#19177c">elem</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;my/english-alphabet</span> (<span style="color:#00f">upcase</span> <span style="color:#19177c">elem</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/latex-mathbb-prefix</span> <span style="color:#ba2121">&#34;`&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">yas-define-snippets</span>
</span></span><span style="display:flex;"><span> <span style="color:#19177c">&#39;latex-mode</span>
</span></span><span style="display:flex;"><span> (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">lambda</span> (<span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">list</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">my/latex-mathbb-prefix</span> <span style="color:#19177c">elem</span>) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;\\mathbb{&#34;</span> <span style="color:#19177c">elem</span> <span style="color:#ba2121">&#34;}&#34;</span>) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;Mathbb letter &#34;</span> <span style="color:#19177c">elem</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">my/english-alphabet</span>))
</span></span></code></pre></div><h5 id="math-symbols">Math symbols</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/latex-math-symbols</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>((<span style="color:#ba2121">&#34;x&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\times&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;.&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\cdot&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;v&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\forall&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\sum_{$1}^{$2}$0&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;p&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\prod_{$1}^{$2}$0&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\partial&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;e&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\exists&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;i&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\int_{$1}^{$2}$0&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\cap&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\cup&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;0&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\emptyset&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;^&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\widehat{$1}$0&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;_&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\overline{$1}$0&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;~&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\sim&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;|&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\mid&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;_|&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\perp&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/latex-math-prefix</span> <span style="color:#ba2121">&#34;;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">yas-define-snippets</span>
</span></span><span style="display:flex;"><span> <span style="color:#19177c">&#39;latex-mode</span>
</span></span><span style="display:flex;"><span> (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">lambda</span> (<span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">let</span> ((<span style="color:#19177c">key</span> (<span style="color:#00f">car</span> <span style="color:#19177c">elem</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">value</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">elem</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">list</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">my/latex-math-prefix</span> <span style="color:#19177c">key</span>) <span style="color:#19177c">value</span> (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;Math symbol &#34;</span> <span style="color:#19177c">value</span>))))
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">my/latex-math-symbols</span>))
</span></span></code></pre></div><h5 id="section-snippets">Section snippets</h5>
<p>Section snippets. The code turned out to be more complicated than just writing the snippets by hand.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/latex-section-snippets</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>((<span style="color:#ba2121">&#34;ch&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\chapter{$1}&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;sec&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\section{$1}&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;ssec&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\subsection{$1}&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;sssec&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\subsubsection{$1}&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;par&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\paragraph{$1}}&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/latex-section-snippets</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">lambda</span> (<span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#666">`</span>(<span style="color:#666">,</span>(<span style="color:#00f">car</span> <span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#666">,</span>(<span style="color:#00f">cdr</span> <span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#666">,</span>(<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">string-match</span> <span style="color:#ba2121">&#34;[a-z]+&#34;</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">elem</span>))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">match-string</span> <span style="color:#666">0</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">elem</span>)))))
</span></span><span style="display:flex;"><span>       <span style="color:#19177c">my/latex-section-snippets</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">dolist</span> (<span style="color:#19177c">elem</span> <span style="color:#19177c">my/latex-section-snippets</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">key</span> (<span style="color:#00f">nth</span> <span style="color:#666">0</span> <span style="color:#19177c">elem</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">value</span> (<span style="color:#00f">nth</span> <span style="color:#666">1</span> <span style="color:#19177c">elem</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">desc</span> (<span style="color:#00f">nth</span> <span style="color:#666">2</span> <span style="color:#19177c">elem</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">star-index</span> (<span style="color:#00f">string-match</span> <span style="color:#ba2121">&#34;\{\$1\}&#34;</span> <span style="color:#19177c">value</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;my/latex-section-snippets</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#666">`</span>(<span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#19177c">key</span> <span style="color:#ba2121">&#34;*&#34;</span>)
</span></span><span style="display:flex;"><span>		   <span style="color:#666">,</span>(<span style="color:#00f">concat</span>
</span></span><span style="display:flex;"><span>		     (<span style="color:#00f">substring</span> <span style="color:#19177c">value</span> <span style="color:#666">0</span> <span style="color:#19177c">star-index</span>)
</span></span><span style="display:flex;"><span>		     <span style="color:#ba2121">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>		     (<span style="color:#00f">substring</span> <span style="color:#19177c">value</span> <span style="color:#19177c">star-index</span>))
</span></span><span style="display:flex;"><span>		   <span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#19177c">desc</span> <span style="color:#ba2121">&#34; with *&#34;</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;my/latex-section-snippets</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#666">`</span>(<span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#19177c">key</span> <span style="color:#ba2121">&#34;l&#34;</span>)
</span></span><span style="display:flex;"><span>		   <span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#19177c">value</span> <span style="color:#ba2121">&#34;%\n\\label{sec:$2}&#34;</span>)
</span></span><span style="display:flex;"><span>		   <span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#19177c">desc</span> <span style="color:#ba2121">&#34; with label&#34;</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">dolist</span> (<span style="color:#19177c">elem</span> <span style="color:#19177c">my/latex-section-snippets</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setf</span> (<span style="color:#00f">nth</span> <span style="color:#666">1</span> <span style="color:#19177c">elem</span>) (<span style="color:#00f">concat</span> (<span style="color:#00f">nth</span> <span style="color:#666">1</span> <span style="color:#19177c">elem</span>) <span style="color:#ba2121">&#34;\n$0&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">yas-define-snippets</span>
</span></span><span style="display:flex;"><span> <span style="color:#19177c">&#39;latex-mode</span>
</span></span><span style="display:flex;"><span> <span style="color:#19177c">my/latex-section-snippets</span>)
</span></span></code></pre></div><h3 id="other-markup-and-natural-languages">Other markup &amp; natural languages</h3>
<h4 id="markdown">Markdown</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">markdown-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.md\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">markdown-command</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">concat</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#ba2121">&#34;pandoc&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#ba2121">&#34; --from=markdown --to=html&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#ba2121">&#34; --standalone --mathjax --highlight-style=pygments&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#ba2121">&#34; --css=pandoc.css&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#ba2121">&#34; --quiet&#34;</span>
</span></span><span style="display:flex;"><span>	 ))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">markdown-live-preview-delete-export</span> <span style="color:#19177c">&#39;delete-on-export</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">markdown-asymmetric-header</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">markdown-open-command</span> <span style="color:#ba2121">&#34;/home/pavel/bin/scripts/chromium-sep&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;markdown-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;markdown-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-&lt;left&gt;&#34;</span> <span style="color:#19177c">&#39;markdown-promote</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-&lt;right&gt;&#34;</span> <span style="color:#19177c">&#39;markdown-demote</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (use-package livedown</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   :straight (:host github :repo &#34;shime/emacs-livedown&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   :commands livedown-preview</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   :config</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;;   (setq livedown-browser &#34;qutebrowser&#34;))</span>
</span></span></code></pre></div><h4 id="plantuml">PlantUML</h4>
<table>
<thead>
<tr>
<th>Guix dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td>plantuml</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">plantuml-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;(\\.\\(plantuml?\\|uml\\|puml\\)\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">plantuml-executable-path</span> <span style="color:#ba2121">&#34;/home/pavel/.guix-extra-profiles/emacs/emacs/bin/plantuml&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">plantuml-default-exec-mode</span> <span style="color:#19177c">&#39;executable</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">plantuml-indent-level</span> <span style="color:#666">2</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">my/plantuml-indent-regexp-return</span> <span style="color:#ba2121">&#34;^\s*return\s+.+$&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">&#39;plantuml-indent-regexp-end</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">my/plantuml-indent-regexp-return</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;auto-mode-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;\\.plantuml\\&#39;&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">plantuml-mode</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;auto-mode-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;\\.uml\\&#39;&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">plantuml-mode</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;plantuml-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-nmap</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;plantuml-mode-map</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;RET&#34;</span> <span style="color:#19177c">&#39;plantuml-preview</span>)
</span></span></code></pre></div><h4 id="subtitles">Subtitles</h4>
<p>A major mode to work with subtitles.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">subed</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;rndusr/subed&#34;</span> <span style="color:#008000">:files</span> (<span style="color:#ba2121">&#34;subed/*.el&#34;</span>)
</span></span><span style="display:flex;"><span>		   <span style="color:#008000">:build</span> (<span style="color:#008000">:not</span> <span style="color:#19177c">native-compile</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">subed-mode-map</span> <span style="color:#19177c">subed-vtt-mode-map</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gp&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">subed-mpv-toggle-pause</span>))
</span></span></code></pre></div><h4 id="languagetool">LanguageTool</h4>
<p>LanguageTool is a great offline spell checker. For some reason, the download link is nowhere to be found on the home page, so it is listed in the references as well.</p>
<p>References:</p>
<ul>
<li><a href="https://languagetool.org/">LanguageTool homepage</a></li>
<li><a href="https://dev.languagetool.org/http-server">LanguageTool http server</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">langtool</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">langtool-check</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">langtool-language-tool-server-jar</span> <span style="color:#ba2121">&#34;/home/pavel/bin/LanguageTool-5.7/languagetool-server.jar&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">langtool-mother-tongue</span> <span style="color:#ba2121">&#34;ru&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">langtool-default-language</span> <span style="color:#ba2121">&#34;en-US&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;L&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;languagetool&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#19177c">&#39;langtool-check</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#19177c">&#39;langtool-server-stop</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#19177c">&#39;langtool-check-done</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;n&#34;</span> <span style="color:#19177c">&#39;langtool-goto-next-error</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;p&#34;</span> <span style="color:#19177c">&#39;langtool-goto-previous-error</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;l&#34;</span> <span style="color:#19177c">&#39;langtool-correct-buffer</span>)
</span></span></code></pre></div><h3 id="lisp">Lisp</h3>
<figure><img src="/ox-hugo/lisp_cycles.png"/>
</figure>

<h4 id="meta-lisp">Meta Lisp</h4>
<p>Some packages for editing various Lisps.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lispy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">lispy-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lispyville</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">lispy-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">lispyville-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">sp-with-modes</span> <span style="color:#19177c">sp-lisp-modes</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">sp-local-pair</span> <span style="color:#ba2121">&#34;&#39;&#34;</span> <span style="color:#800">nil</span> <span style="color:#008000">:actions</span> <span style="color:#800">nil</span>))
</span></span></code></pre></div><h4 id="emacs-lisp">Emacs Lisp</h4>
<h5 id="package-lint">Package Lint</h5>
<p>A package that checks for the metadata in Emacs Lisp packages.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">flycheck-package</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">flycheck</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">flycheck-package-setup</span>))
</span></span></code></pre></div><h5 id="general-settings-2">General settings</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;emacs-lisp-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">aggressive-indent-mode</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (add-hook &#39;emacs-lisp-mode-hook #&#39;smartparens-strict-mode)</span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;emacs-lisp-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">lispy-mode</span>)
</span></span></code></pre></div><h4 id="common-lisp">Common lisp</h4>
<h5 id="slime">SLIME</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">slime</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">slime</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">inferior-lisp-program</span> <span style="color:#ba2121">&#34;sbcl&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;slime-repl-mode</span> <span style="color:#19177c">&#39;smartparens-mode</span>))
</span></span></code></pre></div><h5 id="general-settings-3">General settings</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;lisp-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">aggressive-indent-mode</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (add-hook &#39;emacs-lisp-mode-hook #&#39;smartparens-strict-mode)</span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;lisp-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">lispy-mode</span>)
</span></span></code></pre></div><h4 id="clojure">Clojure</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">clojure-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.clj[sc]?\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (add-hook &#39;clojure-mode-hook #&#39;smartparens-strict-mode)</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;clojure-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">lispy-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;clojure-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">aggressive-indent-mode</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">cider</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">clojure-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h4 id="hy">Hy</h4>
<p>Python requirements:</p>
<ul>
<li><code>hy</code></li>
<li><code>jedhy</code></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">hy-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.hy\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;hy-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">lispy-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;hy-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">aggressive-indent-mode</span>))
</span></span></code></pre></div><h4 id="scheme">Scheme</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">geiser</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">geiser</span> <span style="color:#19177c">run-geiser</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">geiser-default-implementation</span> <span style="color:#19177c">&#39;guile</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">geiser-guile</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">geiser</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;scheme-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">aggressive-indent-mode</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;scheme-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">lispy-mode</span>)
</span></span></code></pre></div><h4 id="clips">CLIPS</h4>
<p>An honorary Lisp</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">clips-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.cl\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;clips-mode</span> <span style="color:#19177c">&#39;lispy-mode</span>))
</span></span></code></pre></div><h3 id="python">Python</h3>
<h4 id="ein">ein</h4>
<p><a href="https://github.com/millejoh/emacs-ipython-notebook">ein</a> is a package that allows for running Jupyter notebooks in Emacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ein</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h4 id="pyright">pyright</h4>
<p>For some reason it doesn&rsquo;t use pipenv python executable, so here is a small workaround.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/pipenv-python-alist</span> <span style="color:#666">&#39;</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/get-pipenv-python</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">default-directory</span> (<span style="color:#19177c">projectile-project-root</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#ba2121">&#34;Pipfile&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">let</span> ((<span style="color:#19177c">asc</span> (<span style="color:#00f">assoc</span> <span style="color:#19177c">default-directory</span> <span style="color:#19177c">my/pipenv-python-alist</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">if</span> <span style="color:#19177c">asc</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">cdr</span> <span style="color:#19177c">asc</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">let</span> ((<span style="color:#19177c">python-executable</span>
</span></span><span style="display:flex;"><span>		   (<span style="color:#19177c">string-trim</span> (<span style="color:#19177c">shell-command-to-string</span> <span style="color:#ba2121">&#34;PIPENV_IGNORE_VIRTUALENVS=1 pipenv run which python 2&gt;/dev/null&#34;</span>))))
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">if</span> (<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;.*not found.*&#34;</span> <span style="color:#19177c">python-executable</span>)
</span></span><span style="display:flex;"><span>		  (<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;Pipfile found, but not pipenv executable!&#34;</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#00f">message</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;Found pipenv python: %s&#34;</span> <span style="color:#19177c">python-executable</span>))
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;my/pipenv-python-alist</span> (<span style="color:#00f">cons</span> <span style="color:#19177c">default-directory</span> <span style="color:#19177c">python-executable</span>))
</span></span><span style="display:flex;"><span>		<span style="color:#19177c">python-executable</span>))))
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;python&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lsp-pyright</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/slow-ssh</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">python-mode</span> <span style="color:#666">.</span> (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>			 (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;lsp-pyright</span>)
</span></span><span style="display:flex;"><span>			 (<span style="color:#008000">setq-local</span> <span style="color:#19177c">lsp-pyright-python-executable-cmd</span> (<span style="color:#19177c">my/get-pipenv-python</span>))
</span></span><span style="display:flex;"><span>			 (<span style="color:#19177c">lsp</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;python-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;python-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">hs-minor-mode</span>)
</span></span></code></pre></div><h4 id="pipenv">pipenv</h4>
<p><a href="https://github.com/pypa/pipenv">Pipenv</a> is a package manager for Python.</p>
<p>Automatically creates &amp; manages virtualenvs and stores data in <code>Pipfile</code> and <code>Pipfile.lock</code> (like npm&rsquo;s <code>package.json</code> and <code>package-lock.json</code>).</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">pipenv</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">python-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">pipenv-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/slow-ssh</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">pipenv-projectile-after-switch-function</span>
</span></span><span style="display:flex;"><span>   <span style="color:#00f">#&#39;</span><span style="color:#19177c">pipenv-projectile-after-switch-extended</span>))
</span></span></code></pre></div><h4 id="yapf">yapf</h4>
<p><a href="https://github.com/google/yapf">yapf</a> is a formatter for Python files.</p>
<table>
<thead>
<tr>
<th>Guix dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td>python-yapf</td>
</tr>
</tbody>
</table>
<p>References:</p>
<ul>
<li><a href="https://github.com/google/yapf">yapf repo</a></li>
<li><a href="https://github.com/JorisE/yapfify">yapfify.el repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">yapfify</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;JorisE/yapfify&#34;</span> <span style="color:#008000">:host</span> <span style="color:#19177c">github</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">yapfify-region</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">yapfify-buffer</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">yapfify-region-or-buffer</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">yapf-mode</span>))
</span></span></code></pre></div><p>Global config:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">[style]</span>
</span></span><span style="display:flex;"><span><span style="color:#7d9029">based_on_style</span> <span style="color:#666">=</span> <span style="color:#ba2121">facebook</span>
</span></span><span style="display:flex;"><span><span style="color:#7d9029">column_limit</span> <span style="color:#666">=</span> <span style="color:#ba2121">80</span>
</span></span></code></pre></div><h4 id="isort">isort</h4>
<p><a href="https://github.com/PyCQA/isort">isort</a> is a Python package to sort Python imports.</p>
<table>
<thead>
<tr>
<th>Guix dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td>python-isort</td>
</tr>
</tbody>
</table>
<p>References:</p>
<ul>
<li><a href="https://pycqa.github.io/isort/">isort docs</a></li>
<li><a href="https://github.com/paetzke/py-isort.el">py-isort.el repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">py-isort</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">py-isort-buffer</span> <span style="color:#19177c">py-isort-region</span>))
</span></span></code></pre></div><p>The following binding calls yapf &amp; isort on the buffer</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;python-mode-map</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;rr&#34;</span> (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">unless</span> (<span style="color:#008000">and</span> (<span style="color:#00f">fboundp</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-src-edit-buffer-p</span>) (<span style="color:#19177c">org-src-edit-buffer-p</span>))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">py-isort-buffer</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">yapfify-buffer</span>)))
</span></span></code></pre></div><h4 id="sphinx-doc">sphinx-doc</h4>
<p>A package to generate sphinx-compatible docstrings.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">sphinx-doc</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">python-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">sphinx-doc-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;sphinx-doc-mode-map</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;rd&#34;</span> <span style="color:#19177c">&#39;sphinx-doc</span>))
</span></span></code></pre></div><h4 id="pytest">pytest</h4>
<p><a href="https://docs.pytest.org/en/6.2.x/">pytest</a> is a unit testing framework for Python.</p>
<p>Once again a function to set pytest executable from pipenv.</p>
<p>References:</p>
<ul>
<li><a href="https://docs.pytest.org/en/6.2.x/">pytest docs</a></li>
<li><a href="https://github.com/wbolster/emacs-python-pytest">emacs-python-pytest</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/set-pipenv-pytest</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">python-pytest-executable</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">concat</span> (<span style="color:#19177c">my/get-pipenv-python</span>) <span style="color:#ba2121">&#34; -m pytest&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">python-pytest</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">python-pytest-dispatch</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;python-mode-map</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;t&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;t&#34;</span> <span style="color:#19177c">&#39;python-pytest-dispatch</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">&lt;&lt;override-pytest-run&gt;&gt;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;python-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/set-pipenv-pytest</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#19177c">derived-mode-p</span> <span style="color:#19177c">&#39;python-mode</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/set-pipenv-pytest</span>)))
</span></span></code></pre></div><h5 id="fix-comint-buffer-width">Fix comint buffer width</h5>
<p>For some reason, the default comint output width is way too large.</p>
<p>To fix that, I&rsquo;ve modified the following function in the <code>python-pytest</code> package.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">cl-defun</span> <span style="color:#19177c">python-pytest--run-as-comint</span> (<span style="color:#008000">&amp;key</span> <span style="color:#19177c">command</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Run a pytest comint session for COMMAND.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">buffer</span> (<span style="color:#19177c">python-pytest--get-buffer</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">process</span> (<span style="color:#00f">get-buffer-process</span> <span style="color:#19177c">buffer</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">with-current-buffer</span> <span style="color:#19177c">buffer</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> (<span style="color:#19177c">comint-check-proc</span> <span style="color:#19177c">buffer</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">unless</span> (<span style="color:#008000">or</span> <span style="color:#19177c">compilation-always-kill</span>
</span></span><span style="display:flex;"><span>		    (<span style="color:#00f">yes-or-no-p</span> <span style="color:#ba2121">&#34;Kill running pytest process?&#34;</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;Aborting; pytest still running&#34;</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> <span style="color:#19177c">process</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">delete-process</span> <span style="color:#19177c">process</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">let</span> ((<span style="color:#19177c">inhibit-read-only</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">erase-buffer</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">unless</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">major-mode</span> <span style="color:#19177c">&#39;python-pytest-mode</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">python-pytest-mode</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">compilation-forget-errors</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">display-buffer</span> <span style="color:#19177c">buffer</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">setq</span> <span style="color:#19177c">command</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;export COLUMNS=%s; %s&#34;</span>
</span></span><span style="display:flex;"><span>			    (<span style="color:#00f">-</span> (<span style="color:#19177c">window-width</span> (<span style="color:#00f">get-buffer-window</span> <span style="color:#19177c">buffer</span>)) <span style="color:#666">5</span>)
</span></span><span style="display:flex;"><span>			    <span style="color:#19177c">command</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">insert</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;cwd: %s\ncmd: %s\n\n&#34;</span> <span style="color:#19177c">default-directory</span> <span style="color:#19177c">command</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">setq</span> <span style="color:#19177c">python-pytest--current-command</span> <span style="color:#19177c">command</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> <span style="color:#19177c">python-pytest-pdb-track</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">add-hook</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#19177c">&#39;comint-output-filter-functions</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#19177c">&#39;python-pdbtrack-comint-output-filter-function</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#800">nil</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">run-hooks</span> <span style="color:#19177c">&#39;python-pytest-setup-hook</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">make-comint-in-buffer</span> <span style="color:#ba2121">&#34;pytest&#34;</span> <span style="color:#19177c">buffer</span> <span style="color:#ba2121">&#34;bash&#34;</span> <span style="color:#800">nil</span> <span style="color:#ba2121">&#34;-c&#34;</span> <span style="color:#19177c">command</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">run-hooks</span> <span style="color:#19177c">&#39;python-pytest-started-hook</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">setq</span> <span style="color:#19177c">process</span> (<span style="color:#00f">get-buffer-process</span> <span style="color:#19177c">buffer</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">set-process-sentinel</span> <span style="color:#19177c">process</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">python-pytest--process-sentinel</span>))))
</span></span></code></pre></div><h4 id="code-cells">code-cells</h4>
<p>Support for text with magic comments.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">code-cells</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">code-cells-mode</span>))
</span></span></code></pre></div><h4 id="tensorboard">tensorboard</h4>
<p>A function to start up <a href="https://www.tensorflow.org/tensorboard">TensorBoard</a>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/tensorboard-buffer</span> <span style="color:#ba2121">&#34;TensorBoard-out&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/tensorboard</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">start-process</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;tensorboard&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">my/tensorboard-buffer</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;tensorboard&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;serve&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;--logdir&#34;</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">car</span> (<span style="color:#19177c">find-file-read-args</span> <span style="color:#ba2121">&#34;Directory: &#34;</span> <span style="color:#800">t</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">display-buffer</span> <span style="color:#19177c">my/tensorboard-buffer</span>))
</span></span></code></pre></div><h3 id="data-serialization">Data serialization</h3>
<h4 id="json">JSON</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">json-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.json\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;json-mode</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;json-mode</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">hs-minor-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;json-mode</span>))
</span></span></code></pre></div><h4 id="csv">CSV</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">csv-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.csv\\&#39;&#34;</span>)
</span></span></code></pre></div><h4 id="yaml">YAML</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">yaml-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.yml\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;yaml-mode-hook</span> <span style="color:#19177c">&#39;smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;yaml-mode-hook</span> <span style="color:#19177c">&#39;highlight-indent-guides-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;auto-mode-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;\\.yml\\&#39;&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">yaml-mode</span>)))
</span></span></code></pre></div><h3 id="configuration">Configuration</h3>
<h4 id="dot-env">.env</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dotenv-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.env\\..*\\&#39;&#34;</span>)
</span></span></code></pre></div><h4 id="dot-gitignore">.gitignore</h4>
<p>A package to quickly create <code>.gitignore</code> files.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">gitignore-templates</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">gitignore-templates-insert</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">gitignore-templates-new-file</span>))
</span></span></code></pre></div><h4 id="docker">Docker</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dockerfile-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;Dockerfile\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;dockerfile-mode</span> <span style="color:#19177c">&#39;smartparens-mode</span>))
</span></span></code></pre></div><h4 id="jenkins">Jenkins</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">jenkinsfile-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;jenkinsfile-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;jenkinsfile-mode</span>))
</span></span></code></pre></div><h4 id="crontab">crontab</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">crontab-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h3 id="shell">Shell</h3>
<h4 id="sh">sh</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;sh-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span></code></pre></div><h4 id="fish">fish</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">fish-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.fish\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;fish-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>))
</span></span></code></pre></div><h3 id="x509">x509</h3>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">x509-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h3 id="java">Java</h3>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lsp-java</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">lsp</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-java-jdt-download-url</span> <span style="color:#ba2121">&#34;https://download.eclipse.org/jdtls/milestones/0.57.0/jdt-language-server-0.57.0-202006172108.tar.gz&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;java-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (add-hook &#39;java-mode-hook #&#39;hs-minor-mode)</span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;java-mode</span>)
</span></span></code></pre></div><h3 id="go">Go</h3>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">go-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.go\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;go-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;go-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;go-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">hs-minor-mode</span>))
</span></span></code></pre></div><h3 id="dot-net">.NET</h3>
<h4 id="c">C#</h4>
<table>
<thead>
<tr>
<th>Guix dependencies</th>
<th>Disabled</th>
</tr>
</thead>
<tbody>
<tr>
<td>omnisharp</td>
<td>t</td>
</tr>
<tr>
<td>dotnet</td>
<td>t</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">csharp-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.cs\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lsp-csharp-server-path</span> (<span style="color:#19177c">executable-find</span> <span style="color:#ba2121">&#34;omnisharp-wrapper&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;csharp-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">csharp-tree-sitter-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;csharp-tree-sitter-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;csharp-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">hs-minor-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;csharp-tree-sitter-mode</span>))
</span></span></code></pre></div><h4 id="msbuild">MSBuild</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">csproj-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.csproj\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;csproj-mode</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>))
</span></span></code></pre></div><h3 id="haskell">Haskell</h3>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">haskell-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.hs\\&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lsp-haskell</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">lsp</span> <span style="color:#19177c">haskell-mode</span>))
</span></span></code></pre></div><h3 id="nix">nix</h3>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">nix-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.nix\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;nix-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;nix-mode</span>))
</span></span></code></pre></div><h3 id="lua">Lua</h3>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lua-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> <span style="color:#ba2121">&#34;\\.lua\\&#39;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">lua-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">smartparens-mode</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my/set-smartparens-indent</span> <span style="color:#19177c">&#39;lua-mode</span>)
</span></span></code></pre></div><h3 id="sql">SQL</h3>
<p><a href="https://github.com/zeroturnaround/sql-formatter">sql-formatter</a> is a nice JavaScript package for pretty-printing SQL queries. It is not packaged for Emacs, so the easiest way to use it seems to be to define a custom formatter via <a href="https://github.com/purcell/emacs-reformatter">reformatter</a>.</p>
<p>Also, I&rsquo;ve made a simple function to switch dialects because I often alternate between them.</p>
<p>So far I didn&rsquo;t find a nice SQL client for Emacs, but I occasionally run SQL queries in Org Mode, so this quite package is handy.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/sqlformatter-dialect-choice</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;db2&#34;</span> <span style="color:#ba2121">&#34;mariadb&#34;</span> <span style="color:#ba2121">&#34;mysql&#34;</span> <span style="color:#ba2121">&#34;n1ql&#34;</span> <span style="color:#ba2121">&#34;plsql&#34;</span> <span style="color:#ba2121">&#34;postgresql&#34;</span> <span style="color:#ba2121">&#34;redshift&#34;</span> <span style="color:#ba2121">&#34;spark&#34;</span> <span style="color:#ba2121">&#34;sql&#34;</span> <span style="color:#ba2121">&#34;tsql&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/sqlformatter-dialect</span> <span style="color:#ba2121">&#34;postgresql&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/sqlformatter-set-dialect</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Set dialect for sql-formatter&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">my/sqlformatter-dialect</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">completing-read</span> <span style="color:#ba2121">&#34;Dialect: &#34;</span> <span style="color:#19177c">my/sqlformatter-dialect-choice</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">reformatter-define</span> <span style="color:#19177c">sqlformat</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:program</span> (<span style="color:#19177c">executable-find</span> <span style="color:#ba2121">&#34;sql-formatter&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:args</span> <span style="color:#666">`</span>(<span style="color:#ba2121">&#34;-l&#34;</span> <span style="color:#666">,</span><span style="color:#19177c">my/sqlformatter-dialect,</span> <span style="color:#ba2121">&#34;-u&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">sql-mode-map</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;rr&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sqlformat-buffer</span>)
</span></span></code></pre></div><h3 id="sparql">SPARQL</h3>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">sparql-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h2 id="org-mode">Org Mode</h2>
<p><strong>Org mode</strong> is a tool that leverages plain-text files for various tasks like making notes, literate programming, task management, etc.</p>
<p>References:</p>
<ul>
<li><a href="https://orgmode.org/">Org Mode homepage</a></li>
<li><a href="https://orgmode.org/manual/">Manual</a></li>
</ul>
<h3 id="installation-and-basic-settings">Installation &amp; basic settings</h3>
<p>Use the built-in org mode.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-directory</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;~/Documents/org-mode&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#19177c">org-directory</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">mkdir</span> <span style="color:#19177c">org-directory</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-startup-indented</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-return-follows-link</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-src-tab-acts-natively</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-mode-hook</span> <span style="color:#19177c">&#39;smartparens-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-agenda-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">visual-line-mode</span> <span style="color:#666">-1</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">toggle-truncate-lines</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">display-line-numbers-mode</span> <span style="color:#666">0</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">rainbow-delimiters-mode</span> <span style="color:#666">-1</span>))))
</span></span></code></pre></div><h4 id="encryption">Encryption</h4>
<p>Setting up <code>org-crypt</code> to encrypt a part of a file.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">with-eval-after-load-norem</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;org-crypt</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-crypt-use-before-save-magic</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-tags-exclude-from-inheritance</span> (<span style="color:#008000">quote</span> (<span style="color:#ba2121">&#34;crypt&#34;</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-crypt-key</span> <span style="color:#ba2121">&#34;C1EC867E478472439CC82410DE004F32AFA00205&#34;</span>))
</span></span></code></pre></div><p>This enables encryption for Org segments which are tagged <code>:crypt:</code>.</p>
<p>Another way to encrypt org files is to save them with extension <code>.org.gpg</code>. That way by default epa always prompts for a key, which is not what I want when there is in fact only one key to select. So I make the following advice:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/epa--select-keys-around</span> (<span style="color:#19177c">fun</span> <span style="color:#19177c">prompt</span> <span style="color:#19177c">keys</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">if</span> (<span style="color:#00f">=</span> (<span style="color:#19177c">seq-length</span> <span style="color:#19177c">keys</span>) <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#19177c">keys</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">funcall</span> <span style="color:#19177c">fun</span> <span style="color:#19177c">prompt</span> <span style="color:#19177c">keys</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;epa</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">epa--select-keys</span> <span style="color:#008000">:around</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/epa--select-keys-around</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">epa-file-encrypt-to</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;DE004F32AFA00205&#34;</span>))
</span></span></code></pre></div><h4 id="org-contrib">org-contrib</h4>
<p><code>org-contrib</code> is a package with various additions to Org. I use the following:</p>
<ul>
<li><code>ox-extra</code> - extensions for org export</li>
<li><code>ol-notmuch</code> - integration with notmuch</li>
</ul>
<p>Excluding <code>org-contacts</code> from here because byte compilation breaks it for some reason.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-contrib</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#19177c">org-contrib</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#008000">:type</span> <span style="color:#19177c">git</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;https://git.sr.ht/~bzg/org-contrib&#34;</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#008000">:files</span> (<span style="color:#008000">:defaults</span> (<span style="color:#008000">:exclude</span> <span style="color:#ba2121">&#34;lisp/org-contacts.el&#34;</span>))
</span></span><span style="display:flex;"><span>	     <span style="color:#008000">:build</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;ox-extra</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;ol-notmuch</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">ox-extras-activate</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">latex-header-blocks</span> <span style="color:#19177c">ignore-headlines</span>)))
</span></span></code></pre></div><h4 id="org-tempo">org-tempo</h4>
<p><code>org-tempo</code> is a convinient package that provides snippets for various org blocks.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;org-tempo</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;org-structure-template-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;el&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;src emacs-lisp&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;org-structure-template-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;py&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;src python&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;org-structure-template-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;sq&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;src sql&#34;</span>)))
</span></span></code></pre></div><h4 id="evil-org">evil-org</h4>
<p>Better integration with evil-mode.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">evil-org</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">org-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">evil-org-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;evil-org-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">evil-org-set-key-theme</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">navigation</span> <span style="color:#00f">insert</span> <span style="color:#19177c">textobjects</span> <span style="color:#19177c">additional</span> <span style="color:#19177c">calendar</span> <span style="color:#19177c">todo</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;evil-emacs-state-modes</span> <span style="color:#19177c">&#39;org-agenda-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;evil-org-agenda</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-org-agenda-set-keys</span>))
</span></span></code></pre></div><h3 id="literate-programing">Literate programing</h3>
<h4 id="python-and-jupyter">Python &amp; Jupyter</h4>
<p>Use jupyter kernels for Org Mode.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/nnicandro/emacs-jupyter">emacs-jupyter repo</a></li>
<li><a href="https://github.com/jkitchin/scimax/blob/master/scimax.org">SCIMAX manual</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">jupyter</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;ar&#34;</span> <span style="color:#19177c">&#39;jupyter-run-repl</span>))
</span></span></code></pre></div><p>Refresh kernelspecs.</p>
<p>Kernelspecs by default are hashed, so even switching Anaconda environments doesn&rsquo;t change the kernel (i.e. kernel from the first environment is run after the switch to the second one).</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/jupyter-refresh-kernelspecs</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Refresh Jupyter kernelspecs&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">jupyter-available-kernelspecs</span> <span style="color:#800">t</span>))
</span></span></code></pre></div><p>Also, if some kernel wasn&rsquo;t present at the moment of the load of <code>emacs-jupyter</code>, it won&rsquo;t be added to the <code>org-src-lang-modes</code> list. E.g. I have Hy kernel installed in a separate Anaconda environment, so if Emacs hasn&rsquo;t been launched in this environment, I wouldn&rsquo;t be able to use <code>hy</code> in org-src blocks.</p>
<p>Fortunately, <code>emacs-jupyter</code> provides a function for that problem as well.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/jupyter-refesh-langs</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Refresh Jupyter languages&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-babel-jupyter-aliases-from-kernelspecs</span> <span style="color:#800">t</span>))
</span></span></code></pre></div><h4 id="hy-1">Hy</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ob-hy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h4 id="view-html-in-browser">View HTML in browser</h4>
<p>Open HTML in the <code>begin_export</code> block with xdg-open.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/org-view-html-tmp-dir</span> <span style="color:#ba2121">&#34;/tmp/org-html-preview/&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">f</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-view-html</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">elem</span> (<span style="color:#19177c">org-element-at-point</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">temp-file-path</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">my/org-view-html-tmp-dir</span> (<span style="color:#00f">number-to-string</span> (<span style="color:#00f">random</span> (<span style="color:#00f">expt</span> <span style="color:#666">2</span> <span style="color:#666">32</span>))) <span style="color:#ba2121">&#34;.html&#34;</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">cond</span>
</span></span><span style="display:flex;"><span>     ((<span style="color:#19177c">not</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">&#39;export-block</span> (<span style="color:#00f">car</span> <span style="color:#19177c">elem</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;Not in an export block!&#34;</span>))
</span></span><span style="display:flex;"><span>     ((<span style="color:#19177c">not</span> (<span style="color:#00f">string-equal</span> (<span style="color:#00f">plist-get</span> (<span style="color:#00f">car</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">elem</span>)) <span style="color:#008000">:type</span>) <span style="color:#ba2121">&#34;HTML&#34;</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;Export block is not HTML!&#34;</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#800">t</span> (<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">f-mkdir</span> <span style="color:#19177c">my/org-view-html-tmp-dir</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">f-write</span> (<span style="color:#00f">plist-get</span> (<span style="color:#00f">car</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">elem</span>)) <span style="color:#008000">:value</span>) <span style="color:#19177c">&#39;utf-8</span> <span style="color:#19177c">temp-file-path</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">start-process</span> <span style="color:#ba2121">&#34;org-html-preview&#34;</span> <span style="color:#800">nil</span> <span style="color:#ba2121">&#34;xdg-open&#34;</span> <span style="color:#19177c">temp-file-path</span>))))))
</span></span></code></pre></div><h4 id="plantuml-1">PlantUML</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-plantuml-executable-path</span> <span style="color:#ba2121">&#34;/home/pavel/.guix-extra-profiles/emacs/emacs/bin/plantuml&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-plantuml-exec-mode</span> <span style="color:#19177c">&#39;plantuml</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;org-src-lang-modes</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;plantuml&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">plantuml</span>)))
</span></span></code></pre></div><h4 id="restclient">Restclient</h4>
<p><a href="https://github.com/pashky/restclient.el">restclient.el</a> is an Emacs package to send HTTP requests. <a href="https://github.com/alf/ob-restclient.el">ob-restclient</a> provides interaction with Org Babel.</p>
<p>References:</p>
<ul>
<li><a href="https://joseph8th.github.io/posts/wow-writing-literate-api-documentation-in-emacs-org-mode/">WOW! Writing Literate API Documentation in Emacs Org Mode</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">restclient</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ob-restclient</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org</span> <span style="color:#19177c">restclient</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h4 id="setup-1">Setup</h4>
<p>Enable languages</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">with-eval-after-load-norem</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-babel-do-load-languages</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">&#39;org-babel-load-languages</span>
</span></span><span style="display:flex;"><span>   <span style="color:#666">&#39;</span>((<span style="color:#19177c">emacs-lisp</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">python</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">sql</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#408080;font-style:italic">;; (typescript .t)</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">hy</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">shell</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">plantuml</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">octave</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">jupyter</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">sparql</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-babel-after-execute-hook</span> <span style="color:#19177c">&#39;org-redisplay-inline-images</span>))
</span></span></code></pre></div><p>Use Jupyter block instead of built-in Python.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;ob-jupyter</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-babel-jupyter-override-src-block</span> <span style="color:#ba2121">&#34;python&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-babel-jupyter-override-src-block</span> <span style="color:#ba2121">&#34;hy&#34;</span>))
</span></span></code></pre></div><p>Turn of some minor modes in source blocks.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-src-mode-hook</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	    <span style="color:#408080;font-style:italic">;; (hs-minor-mode -1)</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#408080;font-style:italic">;; (electric-indent-local-mode -1)</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#408080;font-style:italic">;; (rainbow-delimiters-mode -1)</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">highlight-indent-guides-mode</span> <span style="color:#666">-1</span>)))
</span></span></code></pre></div><p>Async code blocks evaluations. Jupyter blocks have a built-in async, so they are set as ignored.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ob-async</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">ob-async-no-async-languages-alist</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;python&#34;</span> <span style="color:#ba2121">&#34;hy&#34;</span> <span style="color:#ba2121">&#34;jupyter-python&#34;</span> <span style="color:#ba2121">&#34;jupyter-octave&#34;</span> <span style="color:#ba2121">&#34;restclient&#34;</span>)))
</span></span></code></pre></div><h4 id="managing-jupyter-kernels">Managing Jupyter kernels</h4>
<p>Functions for managing local Jupyter kernels.</p>
<p><code>my/insert-jupyter-kernel</code> inserts a path to an active Jupyter kernel to the buffer. Useful to quickly write a header like:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#+PROPERTY: header-args:python :session &lt;path-to-kernel&gt;
</span></span></code></pre></div><p><code>my/jupyter-connect-repl</code> opens a <code>emacs-jupyter</code> REPL, connected to an active kernel. <code>my/jupyter-qtconsole</code> runs a standalone Jupyter QtConsole.</p>
<p>Requirements: <code>ss</code></p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/jupyter-runtime-folder</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;~/.local/share/jupyter/runtime&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/get-open-ports</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>   <span style="color:#00f">#&#39;string-to-number</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">split-string</span> (<span style="color:#19177c">shell-command-to-string</span> <span style="color:#ba2121">&#34;ss -tulpnH | awk &#39;{print $5}&#39; | sed -e &#39;s/.*://&#39;&#34;</span>) <span style="color:#ba2121">&#34;\n&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/list-jupyter-kernel-files</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file</span>) (<span style="color:#00f">cons</span> (<span style="color:#00f">car</span> <span style="color:#19177c">file</span>) (<span style="color:#00f">cdr</span> (<span style="color:#00f">assq</span> <span style="color:#19177c">&#39;shell_port</span> (<span style="color:#19177c">json-read-file</span> (<span style="color:#00f">car</span> <span style="color:#19177c">file</span>))))))
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">sort</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">directory-files-and-attributes</span> <span style="color:#19177c">my/jupyter-runtime-folder</span> <span style="color:#800">t</span> <span style="color:#ba2121">&#34;.*kernel.*json$&#34;</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">lambda</span> (<span style="color:#19177c">x</span> <span style="color:#19177c">y</span>) (<span style="color:#19177c">not</span> (<span style="color:#00f">time-less-p</span> (<span style="color:#00f">nth</span> <span style="color:#666">6</span> <span style="color:#19177c">x</span>) (<span style="color:#00f">nth</span> <span style="color:#666">6</span> <span style="color:#19177c">y</span>)))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/select-jupyter-kernel</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">ports</span> (<span style="color:#19177c">my/get-open-ports</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">files</span> (<span style="color:#19177c">my/list-jupyter-kernel-files</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">completing-read</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;Jupyter kernels: &#34;</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">seq-filter</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">member</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">file</span>) <span style="color:#19177c">ports</span>))
</span></span><span style="display:flex;"><span>      <span style="color:#19177c">files</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/insert-jupyter-kernel</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Insert a path to an active Jupyter kernel into the buffer&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">insert</span> (<span style="color:#19177c">my/select-jupyter-kernel</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/jupyter-connect-repl</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Open an emacs-jupyter REPL, connected to a Jupyter kernel&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">jupyter-connect-repl</span> (<span style="color:#19177c">my/select-jupyter-kernel</span>) <span style="color:#800">nil</span> <span style="color:#800">nil</span> <span style="color:#800">nil</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/jupyter-qtconsole</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Open Jupyter QtConsole, connected to a Jupyter kernel&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">start-process</span> <span style="color:#ba2121">&#34;jupyter-qtconsole&#34;</span> <span style="color:#800">nil</span> <span style="color:#ba2121">&#34;setsid&#34;</span> <span style="color:#ba2121">&#34;jupyter&#34;</span> <span style="color:#ba2121">&#34;qtconsole&#34;</span> <span style="color:#ba2121">&#34;--existing&#34;</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#00f">file-name-nondirectory</span> (<span style="color:#19177c">my/select-jupyter-kernel</span>))))
</span></span></code></pre></div><p>I&rsquo;ve also noticed that there are JSON files left in the runtime folder whenever the kernel isn&rsquo;t stopped correctly. So here is a cleanup function.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/jupyter-cleanup-kernels</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">ports</span> (<span style="color:#19177c">my/get-open-ports</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">files</span> (<span style="color:#19177c">my/list-jupyter-kernel-files</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">to-delete</span> (<span style="color:#19177c">seq-filter</span>
</span></span><span style="display:flex;"><span>		     (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file</span>)
</span></span><span style="display:flex;"><span>		       (<span style="color:#19177c">not</span> (<span style="color:#00f">member</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">file</span>) <span style="color:#19177c">ports</span>)))
</span></span><span style="display:flex;"><span>		     <span style="color:#19177c">files</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> (<span style="color:#008000">and</span> (<span style="color:#19177c">length&gt;</span> <span style="color:#19177c">to-delete</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">y-or-n-p</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;Delete %d files?&#34;</span> (<span style="color:#00f">length</span> <span style="color:#19177c">to-delete</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">dolist</span> (<span style="color:#19177c">file</span> <span style="color:#19177c">to-delete</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">delete-file</span> (<span style="color:#00f">car</span> <span style="color:#19177c">file</span>))))))
</span></span></code></pre></div><h4 id="output-post-processing">Output post-processing</h4>
<h5 id="do-not-wrap-the-output-in-emacs-jupyter">Do not wrap the output in emacs-jupyter</h5>
<p>Emacs-jupyter has its own insertion mechanisms, which always prepends output statements with <code>:</code>. That is not desirable in cases where a kernel supports only plain output, e.g. calysto_hy kernel.</p>
<p>So there we have a minor mode that overrides this behavior.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/jupyter-org-scalar</span> (<span style="color:#19177c">value</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">cond</span>
</span></span><span style="display:flex;"><span>   ((<span style="color:#00f">stringp</span> <span style="color:#19177c">value</span>) <span style="color:#19177c">value</span>)
</span></span><span style="display:flex;"><span>   (<span style="color:#800">t</span> (<span style="color:#19177c">jupyter-org-scalar</span> <span style="color:#19177c">value</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">define-minor-mode</span> <span style="color:#19177c">my/emacs-jupyter-raw-output</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Make emacs-jupyter do raw output&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/jupyter-org-scalar-around</span> (<span style="color:#19177c">fun</span> <span style="color:#19177c">value</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">if</span> <span style="color:#19177c">my/emacs-jupyter-raw-output</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">my/jupyter-org-scalar</span> <span style="color:#19177c">value</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">funcall</span> <span style="color:#19177c">fun</span> <span style="color:#19177c">value</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;jupyter</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;jupyter-org-scalar</span> <span style="color:#008000">:around</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/jupyter-org-scalar-around</span>))
</span></span></code></pre></div><h5 id="wrap-source-code-output">Wrap source code output</h5>
<p>A function to remove the :RESULTS: drawer from results. Once again, it&rsquo;s necessary because emacs-jupyter doesn&rsquo;t seem to respect <code>:results raw</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-strip-results</span> (<span style="color:#19177c">data</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">replace-regexp-in-string</span> <span style="color:#ba2121">&#34;:\\(RESULTS\\|END\\):\n&#34;</span> <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#19177c">data</span>))
</span></span></code></pre></div><p>And an all-in-one function to:</p>
<ul>
<li>prepend <code>#+NAME:</code> and <code>#+CAPTION:</code> to the source block output. Useful if the output is an image.</li>
<li>strip the :RESULTS: drawer from the output, if necessary</li>
<li>wrap results in the <code>src</code> block</li>
</ul>
<p>As for now, it looks sufficient to format source code outputs to get a tolerable LaTeX.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-caption-wrap</span> (<span style="color:#19177c">data</span> <span style="color:#008000">&amp;optional</span> <span style="color:#19177c">name</span> <span style="color:#19177c">caption</span> <span style="color:#19177c">attrs</span> <span style="color:#19177c">strip-drawer</span> <span style="color:#19177c">src-wrap</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">data-s</span> (<span style="color:#008000">if</span> (<span style="color:#008000">and</span> <span style="color:#19177c">strip-drawer</span> (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">strip-drawer</span>)))
</span></span><span style="display:flex;"><span>		     (<span style="color:#19177c">my/org-strip-results</span> <span style="color:#19177c">data</span>)
</span></span><span style="display:flex;"><span>		   <span style="color:#19177c">data</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">drawer-start</span> (<span style="color:#008000">if</span> (<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;^:RESULTS:.*&#34;</span> <span style="color:#19177c">data-s</span>) <span style="color:#666">10</span> <span style="color:#666">0</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">concat</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">substring</span> <span style="color:#19177c">data-s</span> <span style="color:#666">0</span> <span style="color:#19177c">drawer-start</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">and</span> <span style="color:#19177c">name</span> (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">name</span>)) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;#+NAME:&#34;</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">and</span> <span style="color:#19177c">caption</span> (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">caption</span>)) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;#+CAPTION:&#34;</span> <span style="color:#19177c">caption</span> <span style="color:#ba2121">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">and</span> <span style="color:#19177c">attrs</span> (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">attrs</span>)) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;#+ATTR_LATEX:&#34;</span> <span style="color:#19177c">attrs</span> <span style="color:#ba2121">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">if</span> (<span style="color:#008000">and</span> <span style="color:#19177c">src-wrap</span> (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">src-wrap</span>)))
</span></span><span style="display:flex;"><span>	 (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;#+begin_src &#34;</span> <span style="color:#19177c">src-wrap</span> <span style="color:#ba2121">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#00f">substring</span> <span style="color:#19177c">data-s</span> <span style="color:#19177c">drawer-start</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#008000">when</span> (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;.*\n&#34;</span> <span style="color:#19177c">data-s</span>)) <span style="color:#ba2121">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>		 <span style="color:#ba2121">&#34;#+end_src&#34;</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">substring</span> <span style="color:#19177c">data-s</span> <span style="color:#19177c">drawer-start</span>)))))
</span></span></code></pre></div><p>To use, add the following snippet to the org file:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#+NAME: out_wrap
</span></span><span style="display:flex;"><span>#+begin_src emacs-lisp :var data=&#34;&#34; caption=&#34;&#34; name=&#34;&#34; attrs=&#34;&#34; strip-drawer=&#34;&#34; src-wrap=&#34;&#34; :tangle no :exports none
</span></span><span style="display:flex;"><span>(my/org-caption-wrap data name caption attrs strip-drawer src-wrap)
</span></span><span style="display:flex;"><span>#+end_src
</span></span></code></pre></div><p>Example usage:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>:post out_wrap(name=&#34;fig:chart&#34;, caption=&#34;&#34;, data=*this*)
</span></span></code></pre></div><h5 id="apply-ansi-color-codes">Apply ANSI color codes</h5>
<p><strong>SOURCE</strong>: <a href="https://emacs.stackexchange.com/questions/44664/apply-ansi-color-escape-sequences-for-org-babel-results">Apply ANSI color escape sequences for Org Babel results</a></p>
<p>A minor mode to apply ANSI color codes after execution.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/babel-ansi</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">when-let</span> ((<span style="color:#19177c">beg</span> (<span style="color:#19177c">org-babel-where-is-src-block-result</span> <span style="color:#800">nil</span> <span style="color:#800">nil</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">save-excursion</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">goto-char</span> <span style="color:#19177c">beg</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> (<span style="color:#00f">looking-at</span> <span style="color:#19177c">org-babel-result-regexp</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">let</span> ((<span style="color:#19177c">end</span> (<span style="color:#19177c">org-babel-result-end</span>))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">ansi-color-context-region</span> <span style="color:#800">nil</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">ansi-color-apply-on-region</span> <span style="color:#19177c">beg</span> <span style="color:#19177c">end</span>))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">define-minor-mode</span> <span style="color:#19177c">org-babel-ansi-colors-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Apply ANSI color codes to Org Babel results.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:global</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after-hook</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">if</span> <span style="color:#19177c">org-babel-ansi-colors-mode</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-babel-after-execute-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/babel-ansi</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">remove-hook</span> <span style="color:#19177c">&#39;org-babel-after-execute-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/babel-ansi</span>)))
</span></span></code></pre></div><h4 id="executing-stuff">Executing stuff</h4>
<p>A few convinient functions and keybindings to execute things in an org buffer.</p>
<p>First, execute things above and below the point:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-babel-execute-buffer-below</span> (<span style="color:#008000">&amp;optional</span> <span style="color:#19177c">arg</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> <span style="color:#ba2121">&#34;P&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-babel-eval-wipe-error-buffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#00f">point</span> (<span style="color:#00f">point</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">org-save-outline-visibility</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">org-babel-map-executables</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">when</span> (<span style="color:#00f">&gt;=</span> (<span style="color:#00f">point</span>) <span style="color:#00f">point</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">if</span> (<span style="color:#00f">memq</span> (<span style="color:#19177c">org-element-type</span> (<span style="color:#19177c">org-element-context</span>))
</span></span><span style="display:flex;"><span>			    <span style="color:#666">&#39;</span>(<span style="color:#19177c">babel-call</span> <span style="color:#19177c">inline-babel-call</span>))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">org-babel-lob-execute-maybe</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">org-babel-execute-src-block</span> <span style="color:#19177c">arg</span>)))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-babel-execute-buffer-above</span> (<span style="color:#008000">&amp;optional</span> <span style="color:#19177c">arg</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> <span style="color:#ba2121">&#34;P&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-babel-eval-wipe-error-buffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#00f">point</span> (<span style="color:#00f">point</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">org-save-outline-visibility</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">org-babel-map-executables</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">when</span> (<span style="color:#00f">&lt;=</span> (<span style="color:#00f">point</span>) <span style="color:#00f">point</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">if</span> (<span style="color:#00f">memq</span> (<span style="color:#19177c">org-element-type</span> (<span style="color:#19177c">org-element-context</span>))
</span></span><span style="display:flex;"><span>			    <span style="color:#666">&#39;</span>(<span style="color:#19177c">babel-call</span> <span style="color:#19177c">inline-babel-call</span>))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">org-babel-lob-execute-maybe</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">org-babel-execute-src-block</span> <span style="color:#19177c">arg</span>)))))))
</span></span></code></pre></div><p>Some keybindings:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-babel-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;B&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/org-babel-execute-buffer-below</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;A&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/org-babel-execute-buffer-above</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-mode-map</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;SPC b&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:wk</span> <span style="color:#ba2121">&#34;org-babel&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;SPC b&#34;</span> <span style="color:#19177c">org-babel-map</span>))
</span></span></code></pre></div><h4 id="managing-a-literate-programming-project">Managing a literate programming project</h4>
<p>A few tricks to do literate programming.</p>
<p>I prefer to put the org files to a separate directory (e.g. <code>org</code>). So I&rsquo;ve come up with the following solution to avoid manually prefixing the <code>:tangle</code> arguments.</p>
<p>Set up the following argument with the path to the project root:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#+PROPERTY: PRJ-DIR ..
</span></span></code></pre></div><p>A function to do the prefixing:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-prj-dir</span> (<span style="color:#19177c">path</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">expand-file-name</span> <span style="color:#19177c">path</span> (<span style="color:#19177c">org-entry-get</span> <span style="color:#800">nil</span> <span style="color:#ba2121">&#34;PRJ-DIR&#34;</span> <span style="color:#800">t</span>)))
</span></span></code></pre></div><p>Example usage is as follows:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>:tangle (my/org-prj-dir &#34;sqrt_data/api/__init__.py&#34;)
</span></span></code></pre></div><h3 id="tools">Tools</h3>
<p>Various small packages.</p>
<h4 id="presentations">Presentations</h4>
<p>Doing presentations with <a href="https://github.com/rlister/org-present">org-present</a>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">hide-mode-line</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org-present</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/present-next-with-latex</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-present-next</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-latex-preview</span> <span style="color:#666">&#39;</span>(<span style="color:#666">16</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/present-prev-with-latex</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-present-prev</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-latex-preview</span> <span style="color:#666">&#39;</span>(<span style="color:#666">16</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-present</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;rlister/org-present&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">org-present</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-present-mode-keymap</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;&lt;next&gt;&#34;</span> <span style="color:#19177c">&#39;my/present-next-with-latex</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;&lt;prior&gt;&#34;</span> <span style="color:#19177c">&#39;my/present-prev-with-latex</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-present-mode-hook</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">list</span> (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">blink-cursor-mode</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-present-big</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-bars-mode</span> <span style="color:#666">-1</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#408080;font-style:italic">;; (org-display-inline-images)</span>
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-present-hide-cursor</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-present-read-only</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">display-line-numbers-mode</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">hide-mode-line-mode</span> <span style="color:#666">+1</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">setq-local</span> <span style="color:#19177c">org-format-latex-options</span>
</span></span><span style="display:flex;"><span>			    (<span style="color:#00f">plist-put</span> <span style="color:#19177c">org-format-latex-options</span>
</span></span><span style="display:flex;"><span>				       <span style="color:#008000">:scale</span> (<span style="color:#00f">*</span> <span style="color:#19177c">org-present-text-scale</span> <span style="color:#19177c">my/org-latex-scale</span> <span style="color:#666">0.5</span>)))
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-latex-preview</span> <span style="color:#666">&#39;</span>(<span style="color:#666">16</span>))
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">setq-local</span> <span style="color:#19177c">olivetti-body-width</span> <span style="color:#666">60</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">olivetti-mode</span> <span style="color:#666">1</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-present-mode-quit-hook</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">list</span> (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">blink-cursor-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-present-small</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-bars-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#408080;font-style:italic">;; (org-remove-inline-images)</span>
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-present-show-cursor</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-present-read-write</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">display-line-numbers-mode</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">hide-mode-line-mode</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">setq-local</span> <span style="color:#19177c">org-format-latex-options</span> (<span style="color:#00f">plist-put</span> <span style="color:#19177c">org-format-latex-options</span> <span style="color:#008000">:scale</span> <span style="color:#19177c">my/org-latex-scale</span>))
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-latex-preview</span> <span style="color:#666">&#39;</span>(<span style="color:#666">64</span>))
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">olivetti-mode</span> <span style="color:#666">-1</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">setq-local</span> <span style="color:#19177c">olivetti-body-width</span> (<span style="color:#00f">default-value</span> <span style="color:#19177c">&#39;olivetti-body-width</span>))))))
</span></span></code></pre></div><h4 id="toc">TOC</h4>
<p>Make a TOC inside the org file.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/alphapapa/org-make-toc">alphapapa/org-make-toc</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-make-toc</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-make-toc</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">org-make-toc-insert</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">org-make-toc-set</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">org-make-toc-at-point</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h4 id="screenshots">Screenshots</h4>
<p>A nice package to make screenshots and insert them to the Org document.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-attach-screenshot</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">org-attach-screenshot</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><h4 id="transclusion">Transclusion</h4>
<p>A package that implements transclusions in Org Mode, i.e. rendering part of one file inside another file.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-transclusion</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">org</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;nobiot/org-transclusion&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;org-transclusion-extensions</span> <span style="color:#19177c">&#39;org-transclusion-indent-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;org-transclusion-indent-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">org-transclusion-map</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;RET&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-transclusion-open-source</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gr&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-transclusion-refresh</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">org-mode-map</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#19177c">&#39;normal</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-c t a&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-transclusion-add</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-c t A&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-transclusion-add-all</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-c t t&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-transclusion-mode</span>))
</span></span></code></pre></div><h3 id="productivity-and-knowledge-management">Productivity &amp; Knowledge management</h3>
<p>My ongoing effort to get a productivity setup in Org.</p>
<p>Some inspiration:</p>
<ul>
<li><a href="https://www.labri.fr/perso/nrougier/GTD/index.html">Nicolas P. Rougier. Get Things Done with Emacs</a></li>
<li><a href="https://blog.jethro.dev/posts/org_mode_workflow_preview/">Jetro Kuan. Org-mode Workflow</a></li>
<li><a href="https://www.alexeyshmalko.com/how-i-note/">Alexey Shmalko: How I note</a></li>
<li><a href="https://rgoswami.me/posts/org-note-workflow/">Rohit Goswami: An Orgmode Note Workflow</a></li>
</ul>
<p>Used files</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-roam-directory</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">org-directory</span> <span style="color:#ba2121">&#34;/roam&#34;</span>))
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-agenda-files</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;inbox.org&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; (setq org-default-notes-file (concat org-directory &#34;/notes.org&#34;))</span>
</span></span></code></pre></div><p>Hotkeys</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;o&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;org-mode&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#19177c">&#39;org-capture</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;a&#34;</span> <span style="color:#19177c">&#39;org-agenda</span>)
</span></span></code></pre></div><p>Refile targets</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-refile-targets</span> <span style="color:#666">&#39;</span>())
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-refile-use-outline-path</span> <span style="color:#19177c">&#39;file</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-outline-path-complete-in-steps</span> <span style="color:#800">nil</span>)
</span></span></code></pre></div><h4 id="capture-templates-and-various-settings">Capture templates &amp; various settings</h4>
<p>Settings for Org capture mode. The goal here is to have a non-disruptive process to capture various ideas.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/generate-inbox-note-name</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">format</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;%s/inbox-notes/%s.org&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">org-directory</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">format-time-string</span> <span style="color:#ba2121">&#34;%Y%m%d%H%M%S&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-capture-templates</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">`</span>((<span style="color:#ba2121">&#34;i&#34;</span> <span style="color:#ba2121">&#34;Inbox&#34;</span> <span style="color:#19177c">entry</span>  (<span style="color:#19177c">file</span> <span style="color:#ba2121">&#34;inbox.org&#34;</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;* TODO %?\n&#34;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#ba2121">&#34;/Entered on/ %U&#34;</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;e&#34;</span> <span style="color:#ba2121">&#34;email&#34;</span> <span style="color:#19177c">entry</span> (<span style="color:#19177c">file</span> <span style="color:#ba2121">&#34;inbox.org&#34;</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;* TODO %:from %:subject \n&#34;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#ba2121">&#34;/Entered on/ %U\n&#34;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#ba2121">&#34;/Received on/ %:date-timestamp-inactive\n&#34;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#ba2121">&#34;%a\n&#34;</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;f&#34;</span> <span style="color:#ba2121">&#34;elfeed&#34;</span> <span style="color:#19177c">entry</span> (<span style="color:#19177c">file</span> <span style="color:#ba2121">&#34;inbox.org&#34;</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;* TODO %:elfeed-entry-title\n&#34;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#ba2121">&#34;/Entered on/ %U\n&#34;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#ba2121">&#34;%a\n&#34;</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;n&#34;</span> <span style="color:#ba2121">&#34;note&#34;</span> <span style="color:#19177c">entry</span> (<span style="color:#19177c">file</span> <span style="color:#19177c">my/generate-inbox-note-name</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#666">,</span>(<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;* %?\n&#34;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#ba2121">&#34;/Entered on/ %U&#34;</span>))))
</span></span></code></pre></div><p>Effort estimation</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">with-eval-after-load-norem</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;org-global-properties</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;Effort_ALL&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;0 0:05 0:10 0:15 0:30 0:45 1:00 2:00 4:00&#34;</span>)))
</span></span></code></pre></div><p>Log DONE time</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-log-done</span> <span style="color:#19177c">&#39;time</span>)
</span></span></code></pre></div><h4 id="off--trello-sync"><span class="org-todo done OFF">OFF</span> (OFF) Trello sync</h4>
<p>UPD <span class="timestamp-wrapper"><span class="timestamp">&lt;2022-03-27 Sun&gt;</span></span>: disabling this for now.</p>
<p>Some of the projects I&rsquo;m participating in are managed via Trello, so I use <a href="http://org-trello.github.io/">org-trello</a> to keep track of them. The package has a remarkably awkward keybindings setup, so my effort to call <code>my-leader-def</code> to set keybindings I like is no less awkward.</p>
<p>Also, trello files are huge and have a lot of information and tasks which do not concern me, so I don&rsquo;t add them to <code>org-agenda-files</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">unless</span> (<span style="color:#00f">file-exists-p</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">org-directory</span> <span style="color:#ba2121">&#34;/trello&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">mkdir</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">org-directory</span> <span style="color:#ba2121">&#34;/trello&#34;</span>) <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-trello-files</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">thread-last</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">org-directory</span> <span style="color:#ba2121">&#34;/trello&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">directory-files</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">seq-filter</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">lambda</span> (<span style="color:#19177c">f</span>) (<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;.org&#34;</span> <span style="color:#19177c">eos</span>) <span style="color:#19177c">f</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">lambda</span> (<span style="color:#19177c">f</span>) (<span style="color:#00f">concat</span> <span style="color:#19177c">org-directory</span> <span style="color:#ba2121">&#34;/trello/&#34;</span> <span style="color:#19177c">f</span>)))))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-trello</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:build</span> (<span style="color:#008000">:not</span> <span style="color:#19177c">native-compile</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">org-trello-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:disabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-trello-current-prefix-keybinding</span> <span style="color:#ba2121">&#34;C-c o&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-trello-add-tags</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">when</span> (<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;trello&#34;</span>) (<span style="color:#008000">or</span> (<span style="color:#00f">buffer-file-name</span>) <span style="color:#ba2121">&#34;&#34;</span>))
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-trello-mode</span>))))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">eval</span>
</span></span><span style="display:flex;"><span>   <span style="color:#666">`</span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;o t&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">org-trello-mode-map</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;trello&#34;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#666">,@</span>(<span style="color:#19177c">mapcan</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">lambda</span> (<span style="color:#19177c">b</span>) (<span style="color:#00f">list</span> (<span style="color:#00f">nth</span> <span style="color:#666">1</span> <span style="color:#19177c">b</span>) (<span style="color:#19177c">macroexp-quote</span> (<span style="color:#00f">nth</span> <span style="color:#666">0</span> <span style="color:#19177c">b</span>))))
</span></span><span style="display:flex;"><span>	 <span style="color:#19177c">org-trello-interactive-command-binding-couples</span>))))
</span></span></code></pre></div><h4 id="org-ql">org-ql</h4>
<p><a href="https://github.com/alphapapa/org-ql">org-ql</a> is a package to query the org files. I&rsquo;m using it in my review workflow and for custom agenda views.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-ql</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:fetcher</span> <span style="color:#19177c">github</span>
</span></span><span style="display:flex;"><span>		      <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;alphapapa/org-ql&#34;</span>
</span></span><span style="display:flex;"><span>		      <span style="color:#008000">:files</span> (<span style="color:#008000">:defaults</span> (<span style="color:#008000">:exclude</span> <span style="color:#ba2121">&#34;helm-org-ql.el&#34;</span>))))
</span></span></code></pre></div><h4 id="custom-agendas">Custom agendas</h4>
<p>Some custom agendas to fit my workflow.</p>
<p>Despite the fact that I don&rsquo;t add <code>org-trello-files</code> to <code>org-agenda-files</code> I still want to see them in agenda, so I use <code>org-ql-block</code> from <code>org-ql</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-scheduled-get-time</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">scheduled</span> (<span style="color:#19177c">org-get-scheduled-time</span> (<span style="color:#00f">point</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> <span style="color:#19177c">scheduled</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">format-time-string</span> <span style="color:#ba2121">&#34;%Y-%m-%d&#34;</span> <span style="color:#19177c">scheduled</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-agenda-hide-tags-regexp</span> (<span style="color:#008000">rx</span> (<span style="color:#008000">or</span> <span style="color:#ba2121">&#34;org&#34;</span> <span style="color:#ba2121">&#34;log&#34;</span> <span style="color:#ba2121">&#34;log_here&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-agenda-custom-commands</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">`</span>((<span style="color:#ba2121">&#34;p&#34;</span> <span style="color:#ba2121">&#34;My outline&#34;</span>
</span></span><span style="display:flex;"><span>	 ((<span style="color:#19177c">agenda</span> <span style="color:#ba2121">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">todo</span> <span style="color:#ba2121">&#34;NEXT&#34;</span>
</span></span><span style="display:flex;"><span>		((<span style="color:#19177c">org-agenda-prefix-format</span> <span style="color:#ba2121">&#34;  %i %-12:c [%e] &#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">org-agenda-overriding-header</span> <span style="color:#ba2121">&#34;Next tasks&#34;</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">tags-todo</span> <span style="color:#ba2121">&#34;inbox&#34;</span>
</span></span><span style="display:flex;"><span>		     ((<span style="color:#19177c">org-agenda-overriding-header</span> <span style="color:#ba2121">&#34;Inbox&#34;</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#19177c">org-agenda-prefix-format</span> <span style="color:#ba2121">&#34; %i %-12:c&#34;</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#19177c">org-agenda-hide-tags-regexp</span> <span style="color:#ba2121">&#34;.&#34;</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">tags-todo</span> <span style="color:#ba2121">&#34;+waitlist+SCHEDULED&lt;=\&#34;&lt;+14d&gt;\&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		     ((<span style="color:#19177c">org-agenda-overriding-header</span> <span style="color:#ba2121">&#34;Waitlist&#34;</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#19177c">org-agenda-hide-tags-regexp</span> <span style="color:#ba2121">&#34;waitlist&#34;</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#19177c">org-agenda-prefix-format</span> <span style="color:#ba2121">&#34; %i %-12:c %-12(my/org-scheduled-get-time)&#34;</span>)))))))
</span></span></code></pre></div><h4 id="org-journal">Org Journal</h4>
<p><a href="https://github.com/bastibe/org-journal">org-journal</a> is a plugin for maintaining a journal in org mode. I want(ed) to have its entries separate from my knowledge base.</p>
<p>I&rsquo;ve tried switching to Org Roam Dailies, but in the end decided that org-journal fits my workflow better.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-journal</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;oj&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;org-journal&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;j&#34;</span> <span style="color:#19177c">&#39;org-journal-new-entry</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;o&#34;</span> <span style="color:#19177c">&#39;org-journal-open-current-journal-file</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#19177c">&#39;org-journal-tags-status</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">org</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-journal-dir</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">org-directory</span> <span style="color:#ba2121">&#34;/journal&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-journal-file-type</span> <span style="color:#19177c">&#39;weekly</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-journal-file-format</span> <span style="color:#ba2121">&#34;%Y-%m-%d.org&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-journal-date-format</span> <span style="color:#ba2121">&#34;%A, %Y-%m-%d&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-journal-enable-encryption</span> <span style="color:#800">t</span>))
</span></span></code></pre></div><p><a href="https://github.com/SqrtMinusOne/org-journal-tags">org-journal-tags</a> is my package that implements a tagging system for org-journal.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-journal-tags</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;SqrtMinusOne/org-journal-tags&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org-journal</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-journal-tags-autosync-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-journal-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-c t&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-journal-tags-insert-tag</span>))
</span></span></code></pre></div><p>I also want to store some information in the journal as properties of the record. So below is a function that does just that.</p>
<p>As of now, it stores Emacs version, hostname, location, and current EMMS track if there is one.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/set-journal-header</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-set-property</span> <span style="color:#ba2121">&#34;Emacs&#34;</span> <span style="color:#19177c">emacs-version</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-set-property</span> <span style="color:#ba2121">&#34;Hostname&#34;</span> <span style="color:#00f">system-name</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-journal-tags-prop-apply-delta</span> <span style="color:#008000">:add</span> (<span style="color:#00f">list</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;host.%s&#34;</span> (<span style="color:#00f">system-name</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#00f">boundp</span> <span style="color:#19177c">&#39;my/location</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">org-set-property</span> <span style="color:#ba2121">&#34;Location&#34;</span> <span style="color:#19177c">my/location</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#00f">boundp</span> <span style="color:#19177c">&#39;my/loc-tag</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">org-journal-tags-prop-apply-delta</span> <span style="color:#008000">:add</span> (<span style="color:#00f">list</span> <span style="color:#19177c">my/loc-tag</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#00f">fboundp</span> <span style="color:#19177c">&#39;emms-playlist-current-selected-track</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">let</span> ((<span style="color:#19177c">track</span> (<span style="color:#19177c">emms-playlist-current-selected-track</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> <span style="color:#19177c">track</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">let</span> ((<span style="color:#19177c">album</span> (<span style="color:#00f">cdr</span> (<span style="color:#00f">assoc</span> <span style="color:#19177c">&#39;info-album</span> <span style="color:#19177c">track</span>)))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">artist</span> (<span style="color:#008000">or</span> (<span style="color:#00f">cdr</span> (<span style="color:#00f">assoc</span> <span style="color:#19177c">&#39;info-albumartist</span> <span style="color:#19177c">track</span>))
</span></span><span style="display:flex;"><span>			  (<span style="color:#00f">cdr</span> (<span style="color:#00f">assoc</span> <span style="color:#19177c">&#39;info-album</span> <span style="color:#19177c">track</span>))))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">title</span> (<span style="color:#00f">cdr</span> (<span style="color:#00f">assoc</span> <span style="color:#19177c">&#39;info-title</span> <span style="color:#19177c">track</span>)))
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">string</span> <span style="color:#ba2121">&#34;&#34;</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">when</span> <span style="color:#19177c">artist</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">setq</span> <span style="color:#00f">string</span> (<span style="color:#00f">concat</span> <span style="color:#00f">string</span> <span style="color:#ba2121">&#34;[&#34;</span> <span style="color:#19177c">artist</span> <span style="color:#ba2121">&#34;] &#34;</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">when</span> <span style="color:#19177c">album</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">setq</span> <span style="color:#00f">string</span> (<span style="color:#00f">concat</span> <span style="color:#00f">string</span> <span style="color:#19177c">album</span> <span style="color:#ba2121">&#34; - &#34;</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">when</span> <span style="color:#19177c">title</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">setq</span> <span style="color:#00f">string</span> (<span style="color:#00f">concat</span> <span style="color:#00f">string</span> <span style="color:#19177c">title</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">when</span> (<span style="color:#00f">&gt;</span> (<span style="color:#00f">length</span> <span style="color:#00f">string</span>) <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">org-set-property</span> <span style="color:#ba2121">&#34;EMMS_Track&#34;</span> <span style="color:#00f">string</span>)))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-journal-after-entry-create-hook</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/set-journal-header</span>)
</span></span></code></pre></div><h4 id="org-roam">Org Roam</h4>
<p><a href="https://github.com/org-roam/org-roam">org-roam</a> is a plain-text knowledge database.</p>
<p>I tried to do various things with Org Roam, like <a href="https://systemcrafters.net/build-a-second-brain-in-emacs/5-org-roam-hacks/">managing projects</a>, but ended up prefferring plain Org for most of the stuff.</p>
<h5 id="basic-package-configuration">Basic package configuration</h5>
<table>
<thead>
<tr>
<th>Guix dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td>emacs-emacsql-sqlite3</td>
</tr>
<tr>
<td>graphviz</td>
</tr>
</tbody>
</table>
<p>About installing the package on Guix (<strong>CREDIT</strong>: thanks @Ashraz on the SystemCrafters discord)</p>
<blockquote>
<p>So, for all those interested: unfortunately, org-roam (or rather emacsql-sqlite) cannot compile the sqlite.c and emacsql.c due to missing headers (linux/falloc.h) on Guix. You would have to properly set all the include paths on Guix, and also adjust the PATH to have gcc actually find as later on in the compilation process.</p>
<p>Instead, you should remove all Org-Roam related packages from your Emacs installation (via M-x package-delete org-roam RET and  M-x package-autoremove RET y RET) and then use the Guix package called emacs-org-roam.</p>
</blockquote>
<p>References:</p>
<ul>
<li><a href="https://github.com/org-roam/org-roam/wiki/Hitchhiker%27s-Rough-Guide-to-Org-roam-V2">Hitchhiker&rsquo;s Rough Guide to Org roam V2</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">emacsql-sqlite</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:type</span> <span style="color:#19177c">built-in</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-roam</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;org-roam/org-roam&#34;</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#008000">:files</span> (<span style="color:#008000">:defaults</span> <span style="color:#ba2121">&#34;extensions/*.el&#34;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">org</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-roam-file-extensions</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;org&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-roam-v2-ack</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">orb-insert-interface</span> <span style="color:#19177c">&#39;ivy-bibtex</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-roam-setup</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;org-roam-protocol</span>))
</span></span></code></pre></div><h5 id="capture-templates">Capture templates</h5>
<p>Capture templates for <code>org-roam-capture</code>. As for now, nothing too complicated here.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-roam-capture-templates</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">`</span>((<span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#ba2121">&#34;default&#34;</span> <span style="color:#19177c">plain</span> <span style="color:#ba2121">&#34;%?&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:if-new</span> (<span style="color:#19177c">file+head</span> <span style="color:#ba2121">&#34;%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34;</span> <span style="color:#ba2121">&#34;#+title: ${title}\n&#34;</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:unnarrowed</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;e&#34;</span> <span style="color:#ba2121">&#34;encrypted&#34;</span> <span style="color:#19177c">plain</span> <span style="color:#ba2121">&#34;%?&#34;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:if-new</span> (<span style="color:#19177c">file+head</span> <span style="color:#ba2121">&#34;%&lt;%Y%m%d%H%M%S&gt;-${slug}.org.gpg&#34;</span> <span style="color:#ba2121">&#34;#+title: ${title}\n&#34;</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#008000">:unnarrowed</span> <span style="color:#800">t</span>)))
</span></span></code></pre></div><h5 id="keybindings-3">Keybindings</h5>
<p>A set of keybindings to quickly access things in Org Roam.</p>
<p>I used to have multiple categories of nodes in Org Roam (projects, dailies, etc), but as of now, only Zettelkasten remains.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;org-roam</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;or&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;org-roam&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;i&#34;</span> <span style="color:#19177c">&#39;org-roam-node-insert</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;r&#34;</span> <span style="color:#19177c">&#39;org-roam-node-find</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;g&#34;</span> <span style="color:#19177c">&#39;org-roam-graph</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#19177c">&#39;org-roam-capture</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;b&#34;</span> <span style="color:#19177c">&#39;org-roam-buffer-toggle</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-roam-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;TAB&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">magit-section-toggle</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">quit-window</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;k&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">magit-section-backward</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;j&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">magit-section-forward</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gr&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">revert-buffer</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;RET&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-roam-buffer-visit-thing</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:keymap</span> <span style="color:#19177c">&#39;org-mode-map</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;or&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;t&#34;</span> <span style="color:#19177c">&#39;org-roam-tag-add</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;T&#34;</span> <span style="color:#19177c">&#39;org-toam-tag-remove</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#19177c">&#39;org-roam-db-autosync-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymap</span> <span style="color:#19177c">&#39;org-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-c i&#34;</span> <span style="color:#19177c">&#39;org-id-get-create</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-c l o&#34;</span> <span style="color:#19177c">&#39;org-roam-node-insert</span>))
</span></span></code></pre></div><h5 id="org-roam-ui">Org Roam UI</h5>
<p>A browser frontend to visualize a Roam directory in a form of a graph.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-roam-ui</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;org-roam/org-roam-ui&#34;</span> <span style="color:#008000">:branch</span> <span style="color:#ba2121">&#34;main&#34;</span> <span style="color:#008000">:files</span> (<span style="color:#ba2121">&#34;*.el&#34;</span> <span style="color:#ba2121">&#34;out&#34;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">org-roam</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; :hook (org-roam . org-roam-ui-mode)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;oru&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-roam-ui-mode</span>))
</span></span></code></pre></div><h5 id="org-roam-protocol">Org Roam Protocol</h5>
<p>Open links such as <code>org-protocol://</code> from browser. Run <code>M-x server-start</code> for org-protocol to work.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cfg" data-lang="cfg"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">[Desktop Entry]</span>
</span></span><span style="display:flex;"><span><span style="color:#7d9029">Name</span><span style="color:#666">=</span><span style="color:#ba2121">Org-Protocol</span>
</span></span><span style="display:flex;"><span><span style="color:#7d9029">Exec</span><span style="color:#666">=</span><span style="color:#ba2121">emacsclient %u</span>
</span></span><span style="display:flex;"><span><span style="color:#7d9029">Icon</span><span style="color:#666">=</span><span style="color:#ba2121">emacs-icon</span>
</span></span><span style="display:flex;"><span><span style="color:#7d9029">Type</span><span style="color:#666">=</span><span style="color:#ba2121">Application</span>
</span></span><span style="display:flex;"><span><span style="color:#7d9029">Terminal</span><span style="color:#666">=</span><span style="color:#ba2121">false</span>
</span></span><span style="display:flex;"><span><span style="color:#7d9029">MimeType</span><span style="color:#666">=</span><span style="color:#ba2121">x-scheme-handler/org-protocol</span>
</span></span></code></pre></div><p>Don&rsquo;t forget to run the following after setup:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xdg-mime default org-protocol.desktop x-scheme-handler/org-protocol
</span></span></code></pre></div><h4 id="review-workflow">Review workflow</h4>
<p>UPD <span class="timestamp-wrapper"><span class="timestamp">&lt;2022-03-27 Sun&gt;</span></span>. Out of action for now</p>
<p>My take on a review workflow. As a baseline, I want to have a template that lists the important changes since the last review and other basic information. I&rsquo;m doing reviews regularly, but the time intervals still may vary, hence this flexibility.</p>
<p>This section has seen some updates over time.</p>
<h5 id="data-from-git">Data from git</h5>
<p>First, as I have <a href="/configs/console/#autocommit">autocommit</a> set up in my org directory, here is a handy function to get an alist of changed files of a form <code>(status . path)</code>. In principle, the <code>rev</code> parameter can be a commit, tag, etc but here I&rsquo;m interested in a form like <code>@{2021-08-30}</code>.</p>
<p>Also in principle, Org Roam DB also stores stuff like creation time and modification time, but I started this section before I started using Org Roam extensively, so git works fine for me.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/git-diff-status</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>((<span style="color:#ba2121">&#34;A&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">added</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;C&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">copied</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;D&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">deleted</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;M&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">modified</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;R&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">renamed</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;T&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">type-changed</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;U&#34;</span> <span style="color:#666">.</span> <span style="color:#19177c">unmerged</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/get-files-status</span> (<span style="color:#19177c">rev</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">files</span> (<span style="color:#19177c">shell-command-to-string</span> (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;git diff --name-status &#34;</span> <span style="color:#19177c">rev</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">let</span> ((<span style="color:#19177c">elems</span> (<span style="color:#19177c">split-string</span> <span style="color:#19177c">file</span> <span style="color:#ba2121">&#34;\t&#34;</span>)))
</span></span><span style="display:flex;"><span>	 (<span style="color:#00f">cons</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">cdr</span> (<span style="color:#00f">assoc</span> (<span style="color:#00f">car</span> <span style="color:#19177c">elems</span>) <span style="color:#19177c">my/git-diff-status</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">nth</span> <span style="color:#666">1</span> <span style="color:#19177c">elems</span>))))
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">split-string</span> <span style="color:#19177c">files</span> <span style="color:#ba2121">&#34;\n&#34;</span> <span style="color:#800">t</span>))))
</span></span></code></pre></div><p>I&rsquo;ll use it to get a list of added and changed files in the Org directory since the last review. The date should be in a format <code>YYYY-MM-DD</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-changed-files-since-date</span> (<span style="color:#19177c">date</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">default-directory</span> <span style="color:#19177c">org-directory</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/get-files-status</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;@{%s}&#34;</span> <span style="color:#19177c">date</span>))))
</span></span></code></pre></div><h5 id="data-from-org-roam">Data from org-roam</h5>
<p>Now that we have the list of new &amp; changed files, I want to sort into a bunch of categories: projects, log entries, etc. The categories are defined by tags.</p>
<p>So here is a list of plists that sets these categories. The properties are as follows:</p>
<ul>
<li><code>:status</code> is a git status for the file</li>
<li><code>:tags</code> is a plist that sets up the following conditions for the Roam node
<ul>
<li><code>:include</code> - should be empty or one of these should be present</li>
<li><code>:exclude</code> - should be empty or none of these should be present</li>
</ul>
</li>
<li><code>:title</code> is the name of category as I want it to be seen in the review template</li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/org-review-roam-queries</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>((<span style="color:#008000">:status</span> <span style="color:#19177c">added</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#008000">:tags</span> (<span style="color:#008000">:include</span> (<span style="color:#ba2121">&#34;org&#34;</span>))
</span></span><span style="display:flex;"><span>		 <span style="color:#008000">:title</span> <span style="color:#ba2121">&#34;New Project Entries&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">:status</span> <span style="color:#19177c">changed</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#008000">:tags</span> (<span style="color:#008000">:include</span> (<span style="color:#ba2121">&#34;org&#34;</span>))
</span></span><span style="display:flex;"><span>		 <span style="color:#008000">:title</span> <span style="color:#ba2121">&#34;Changed Project Entries&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">:status</span> <span style="color:#19177c">added</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#008000">:tags</span> (<span style="color:#008000">:exclude</span> (<span style="color:#ba2121">&#34;org&#34;</span>))
</span></span><span style="display:flex;"><span>		 <span style="color:#008000">:title</span> <span style="color:#ba2121">&#34;New Zettelkasten Entries&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">:status</span> <span style="color:#19177c">changed</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#008000">:tags</span> (<span style="color:#008000">:exclude</span> (<span style="color:#ba2121">&#34;org&#34;</span>))
</span></span><span style="display:flex;"><span>		 <span style="color:#008000">:title</span> <span style="color:#ba2121">&#34;Changed Zettelkasten Entries&#34;</span>)))
</span></span></code></pre></div><p>This list is used to extract &amp; format the relevant section of the review template.</p>
<p><code>cl-loop</code> seems pretty good as a control flow structure, but I&rsquo;ll see if it is also pretty good at producing poorly maintainable code. At least at the moment of this writing, the function below looks rather concise.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-review-format-roam</span> (<span style="color:#19177c">changes</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">query</span> <span style="color:#19177c">in</span> <span style="color:#19177c">my/org-review-roam-queries</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#19177c">with</span> <span style="color:#19177c">nodes</span> <span style="color:#00f">=</span> (<span style="color:#19177c">org-roam-node-list</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#19177c">with</span> <span style="color:#19177c">node-tags</span> <span style="color:#00f">=</span> (<span style="color:#00f">mapcar</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-roam-node-tags</span> <span style="color:#19177c">nodes</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#19177c">for</span> <span style="color:#19177c">include-tags</span> <span style="color:#00f">=</span> (<span style="color:#00f">plist-get</span> (<span style="color:#00f">plist-get</span> <span style="color:#19177c">query</span> <span style="color:#008000">:tags</span>) <span style="color:#008000">:include</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#19177c">for</span> <span style="color:#19177c">exclude-tags</span> <span style="color:#00f">=</span> (<span style="color:#00f">plist-get</span> (<span style="color:#00f">plist-get</span> <span style="color:#19177c">query</span> <span style="color:#008000">:tags</span>) <span style="color:#008000">:exclude</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#408080;font-style:italic">;; List of nodes filtered by :tags in query</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#19177c">for</span> <span style="color:#19177c">filtered-nodes</span> <span style="color:#00f">=</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">node</span> <span style="color:#19177c">in</span> <span style="color:#19177c">nodes</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#19177c">for</span> <span style="color:#19177c">tags</span> <span style="color:#19177c">in</span> <span style="color:#19177c">node-tags</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#008000">if</span> (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>			(<span style="color:#008000">or</span> (<span style="color:#19177c">seq-empty-p</span> <span style="color:#19177c">include-tags</span>)
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">seq-intersection</span> <span style="color:#19177c">include-tags</span> <span style="color:#19177c">tags</span>))
</span></span><span style="display:flex;"><span>			(<span style="color:#008000">or</span> (<span style="color:#19177c">seq-empty-p</span> <span style="color:#19177c">exclude-tags</span>)
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">not</span> (<span style="color:#19177c">seq-intersection</span> <span style="color:#19177c">exclude-tags</span> <span style="color:#19177c">tags</span>))))
</span></span><span style="display:flex;"><span>		    <span style="color:#19177c">collect</span> <span style="color:#19177c">node</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#408080;font-style:italic">;; List of changes filtered by :status in query</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#19177c">for</span> <span style="color:#19177c">filtered-changes</span> <span style="color:#00f">=</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">change</span> <span style="color:#19177c">in</span> <span style="color:#19177c">changes</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#008000">if</span> (<span style="color:#008000">and</span> (<span style="color:#00f">eq</span> (<span style="color:#00f">car</span> <span style="color:#19177c">change</span>) (<span style="color:#00f">plist-get</span> <span style="color:#19177c">query</span> <span style="color:#008000">:status</span>))
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> <span style="color:#19177c">bos</span> <span style="color:#ba2121">&#34;roam&#34;</span>) (<span style="color:#00f">cdr</span> <span style="color:#19177c">change</span>)))
</span></span><span style="display:flex;"><span>		    <span style="color:#19177c">collect</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">change</span>))
</span></span><span style="display:flex;"><span>	   <span style="color:#408080;font-style:italic">;; Intersection of the two filtered lists</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#19177c">for</span> <span style="color:#19177c">final-nodes</span> <span style="color:#00f">=</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">node</span> <span style="color:#19177c">in</span> <span style="color:#19177c">filtered-nodes</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#19177c">for</span> <span style="color:#19177c">path</span> <span style="color:#00f">=</span> (<span style="color:#19177c">file-relative-name</span> (<span style="color:#19177c">org-roam-node-file</span> <span style="color:#19177c">node</span>)
</span></span><span style="display:flex;"><span>						   <span style="color:#19177c">org-directory</span>)
</span></span><span style="display:flex;"><span>		    <span style="color:#008000">if</span> (<span style="color:#00f">member</span> <span style="color:#19177c">path</span> <span style="color:#19177c">filtered-changes</span>)
</span></span><span style="display:flex;"><span>		    <span style="color:#19177c">collect</span> <span style="color:#19177c">node</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#408080;font-style:italic">;; If the intersction list is not empty, format it to the result</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#008000">if</span> <span style="color:#19177c">final-nodes</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#00f">concat</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;** %s\n&#34;</span> (<span style="color:#00f">plist-get</span> <span style="color:#19177c">query</span> <span style="color:#008000">:title</span>))
</span></span><span style="display:flex;"><span>	   <span style="color:#408080;font-style:italic">;; FInal list of links, sorted by title</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#008000">and</span> <span style="color:#00f">concat</span> (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">node</span> <span style="color:#19177c">in</span> (<span style="color:#19177c">seq-sort</span>
</span></span><span style="display:flex;"><span>					    (<span style="color:#008000">lambda</span> (<span style="color:#19177c">node1</span> <span style="color:#19177c">node2</span>)
</span></span><span style="display:flex;"><span>					      (<span style="color:#00f">string-lessp</span>
</span></span><span style="display:flex;"><span>					       (<span style="color:#19177c">org-roam-node-title</span> <span style="color:#19177c">node1</span>)
</span></span><span style="display:flex;"><span>					       (<span style="color:#19177c">org-roam-node-title</span> <span style="color:#19177c">node2</span>)))
</span></span><span style="display:flex;"><span>					    <span style="color:#19177c">final-nodes</span>)
</span></span><span style="display:flex;"><span>			       <span style="color:#00f">concat</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;- [[id:%s][%s]]\n&#34;</span>
</span></span><span style="display:flex;"><span>					      (<span style="color:#19177c">org-roam-node-id</span> <span style="color:#19177c">node</span>)
</span></span><span style="display:flex;"><span>					      (<span style="color:#19177c">org-roam-node-title</span> <span style="color:#19177c">node</span>)))))
</span></span></code></pre></div><h5 id="data-from-org-agenda-via-org-ql">Data from org-agenda via org-ql</h5>
<p><del>Third</del> second, I want to list some changes in my agenda. This section will change depending on what I&rsquo;m currently working on.</p>
<p>So, here is a list of queries results of which I want to see in the review template. The format is <code>(name date-field order-by-field query)</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/org-ql-review-queries</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">`</span>((<span style="color:#ba2121">&#34;Waitlist&#34;</span> <span style="color:#19177c">scheduled</span> <span style="color:#19177c">scheduled</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">done</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">tags-inherited</span> <span style="color:#ba2121">&#34;waitlist&#34;</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;Personal tasks done&#34;</span> <span style="color:#19177c">closed</span> <span style="color:#666">,</span><span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">tags-inherited</span> <span style="color:#ba2121">&#34;personal&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">todo</span> <span style="color:#ba2121">&#34;DONE&#34;</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;Attended meetings&#34;</span> <span style="color:#19177c">closed</span> <span style="color:#19177c">scheduled</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">tags-inherited</span> <span style="color:#ba2121">&#34;meeting&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">todo</span> <span style="color:#ba2121">&#34;PASSED&#34;</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#ba2121">&#34;Done project tasks&#34;</span> <span style="color:#19177c">closed</span> <span style="color:#19177c">deadline</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">todo</span> <span style="color:#ba2121">&#34;DONE&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">ancestors</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">heading</span> <span style="color:#ba2121">&#34;Tasks&#34;</span>))))))
</span></span></code></pre></div><p>The query will be executed like this: <code>(and (date-field :from rev-date) query)</code></p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-review-exec-ql</span> (<span style="color:#19177c">saved</span> <span style="color:#19177c">rev-date</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">query</span> <span style="color:#666">`</span>(<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#666">,</span>(<span style="color:#00f">nth</span> <span style="color:#666">1</span> <span style="color:#19177c">saved</span>) <span style="color:#008000">:from</span> <span style="color:#666">,</span><span style="color:#19177c">rev-date</span>)
</span></span><span style="display:flex;"><span>		 <span style="color:#666">,</span>(<span style="color:#00f">nth</span> <span style="color:#666">3</span> <span style="color:#19177c">saved</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">org-ql-query</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008000">:select</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">element</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008000">:from</span> (<span style="color:#19177c">org-agenda-files</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#008000">:where</span> <span style="color:#19177c">query</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008000">:order-by</span> (<span style="color:#00f">nth</span> <span style="color:#666">2</span> <span style="color:#19177c">saved</span>))))
</span></span></code></pre></div><p>Format one element of the query result.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-review-format-element</span> (<span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">concat</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">string-pad</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">plist-get</span> (<span style="color:#19177c">cadr</span> <span style="color:#19177c">elem</span>) <span style="color:#008000">:raw-value</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#666">40</span>)
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">when-let</span> (<span style="color:#19177c">scheduled</span> (<span style="color:#00f">plist-get</span> (<span style="color:#19177c">cadr</span> <span style="color:#19177c">elem</span>) <span style="color:#008000">:scheduled</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34; [SCHEDULED: &#34;</span> (<span style="color:#00f">plist-get</span> (<span style="color:#19177c">cadr</span> <span style="color:#19177c">scheduled</span>) <span style="color:#008000">:raw-value</span>) <span style="color:#ba2121">&#34;]&#34;</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">when-let</span> (<span style="color:#19177c">deadline</span> (<span style="color:#00f">plist-get</span> (<span style="color:#19177c">cadr</span> <span style="color:#19177c">elem</span>) <span style="color:#008000">:deadline</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34; [DEADLINE: &#34;</span> (<span style="color:#00f">plist-get</span> (<span style="color:#19177c">cadr</span> <span style="color:#19177c">deadline</span>) <span style="color:#008000">:raw-value</span>) <span style="color:#ba2121">&#34;]&#34;</span>))))
</span></span></code></pre></div><p>Execute all the saved queries and format an Org list for the capture template.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-review-format-queries</span> (<span style="color:#19177c">rev-date</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">mapconcat</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">results</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;** &#34;</span> (<span style="color:#00f">car</span> <span style="color:#19177c">results</span>) <span style="color:#ba2121">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>	     (<span style="color:#19177c">string-join</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">mapcar</span> (<span style="color:#008000">lambda</span> (<span style="color:#19177c">r</span>) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;- &#34;</span> <span style="color:#19177c">r</span>)) (<span style="color:#00f">cdr</span> <span style="color:#19177c">results</span>))
</span></span><span style="display:flex;"><span>	      <span style="color:#ba2121">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>	     <span style="color:#ba2121">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">seq-filter</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">lambda</span> (<span style="color:#19177c">result</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">not</span> (<span style="color:#19177c">seq-empty-p</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">result</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">lambda</span> (<span style="color:#19177c">saved</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">cons</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">car</span> <span style="color:#19177c">saved</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/org-review-format-element</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">my/org-review-exec-ql</span> <span style="color:#19177c">saved</span> <span style="color:#19177c">rev-date</span>))))
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">my/org-ql-review-queries</span>))
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;\n&#34;</span>))
</span></span></code></pre></div><h5 id="capture-template">Capture template</h5>
<p>Now, we have to put all this together and define a capture template for the review.</p>
<p><del>I&rsquo;ll use a separate directory for the review files, just like for org-journal and org-roam.</del> I&rsquo;ll store the review files in org-roam. Time will tell if that&rsquo;s a good idea. The filename will have a format <code>YYYY-MM-DD.org</code>, which will also free me from the effort of storing the last review date somewhere.</p>
<p>If somehow there are no files in the folder, fallback to the current date minus one two week. Also featuring the most awkward date transformation I&rsquo;ve ever done just to add one date.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/org-review-directory</span> <span style="color:#ba2121">&#34;review&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/get-last-review-date</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">-&gt;</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">substring</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">or</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">-max-by</span>
</span></span><span style="display:flex;"><span>      <span style="color:#19177c">&#39;string-greaterp</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">-filter</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">lambda</span> (<span style="color:#19177c">f</span>) (<span style="color:#19177c">not</span> (<span style="color:#008000">or</span> (<span style="color:#00f">string-equal</span> <span style="color:#19177c">f</span> <span style="color:#ba2121">&#34;.&#34;</span>) (<span style="color:#00f">string-equal</span> <span style="color:#19177c">f</span> <span style="color:#ba2121">&#34;..&#34;</span>))))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">directory-files</span> (<span style="color:#19177c">f-join</span> <span style="color:#19177c">org-roam-directory</span> <span style="color:#19177c">my/org-review-directory</span>))))
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">format-time-string</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;%Y-%m-%d&#34;</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">time-subtract</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">current-time</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">seconds-to-time</span> (<span style="color:#00f">*</span> <span style="color:#666">60</span> <span style="color:#666">60</span> <span style="color:#666">24</span> <span style="color:#666">14</span>)))))
</span></span><span style="display:flex;"><span>    <span style="color:#666">0</span> <span style="color:#666">10</span>)
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;T00:00:00-00:00&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">parse-time-string</span>
</span></span><span style="display:flex;"><span>   <span style="color:#00f">encode-time</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">time-add</span> (<span style="color:#19177c">seconds-to-time</span> (<span style="color:#00f">*</span> <span style="color:#666">60</span> <span style="color:#666">60</span> <span style="color:#666">24</span>)))
</span></span><span style="display:flex;"><span>   ((<span style="color:#008000">lambda</span> (<span style="color:#19177c">time</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">format-time-string</span> <span style="color:#ba2121">&#34;%Y-%m-%d&#34;</span> <span style="color:#19177c">time</span>)))))
</span></span></code></pre></div><p>A template looks like this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/org-review-capture-template</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">`</span>(<span style="color:#ba2121">&#34;r&#34;</span> <span style="color:#ba2121">&#34;Review&#34;</span> <span style="color:#19177c">plain</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">,</span>(<span style="color:#19177c">string-join</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;#+title: %&lt;%Y-%m-%d&gt;: REVIEW&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;#+category: REVIEW&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;#+filetags: log review&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;#+STARTUP: overview&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;Last review date: %(org-timestamp-translate (org-timestamp-from-string (format \&#34;&lt;%s&gt;\&#34; (my/get-last-review-date))))&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;* Roam&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;%(my/org-review-format-roam (my/org-changed-files-since-date (my/get-last-review-date)))&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;* Agenda&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;%(my/org-review-format-queries (my/get-last-review-date))&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;* Thoughts&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;%?&#34;</span>)
</span></span><span style="display:flex;"><span>	  <span style="color:#ba2121">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#008000">:if-new</span> (<span style="color:#19177c">file</span> <span style="color:#ba2121">&#34;review/%&lt;%Y-%m-%d&gt;.org.gpg&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-roam-capture-review</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-roam-capture-</span> <span style="color:#008000">:node</span> (<span style="color:#19177c">org-roam-node-create</span>)
</span></span><span style="display:flex;"><span>		     <span style="color:#008000">:templates</span> <span style="color:#666">`</span>(<span style="color:#666">,</span><span style="color:#19177c">my/org-review-capture-template</span>)))
</span></span></code></pre></div><h4 id="org-ref">org-ref</h4>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>TODO</td>
<td>Figure out how not to load Helm</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/jkitchin/org-ref">org-ref</a> is a package that provides support for various citations &amp; references in Org mode.</p>
<p>Useful to use BibTeX citations in LaTeX export.</p>
<p>As of now, this package loads Helm on start. To avoid this, I have to exclude Helm from the <code>Package-requires</code> in the <a href=".emacs.d/straight/repos/org-ref/org-ref.el">org-ref.el</a> file. I haven&rsquo;t found a way to do this without modifying the package source yet.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-ref</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:files</span> (<span style="color:#008000">:defaults</span> (<span style="color:#008000">:exclude</span> <span style="color:#ba2121">&#34;*helm*&#34;</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-ref-completion-library</span> <span style="color:#19177c">&#39;org-ref-ivy-cite</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">bibtex-dialect</span> <span style="color:#19177c">&#39;biblatex</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-ref-default-bibliography</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;~/Documents/org-mode/bibliography.bib&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">reftex-default-bibliography</span> <span style="color:#19177c">org-ref-default-bibliography</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">bibtex-completion-bibliography</span> <span style="color:#19177c">org-ref-default-bibliography</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-c l&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-ref-insert-link-hydra/body</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;bibtex-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-RET&#34;</span> <span style="color:#19177c">&#39;org-ref-bibtex-hydra/body</span>)
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">setq</span> <span style="color:#19177c">bibtex-completion-display-formats</span>
</span></span><span style="display:flex;"><span>     <span style="color:#666">&#39;</span>((<span style="color:#800">t</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;${author:36} ${title:*} ${note:10} ${year:4} ${=has-pdf=:1}${=type=:7}&#34;</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-ref-select-bibliograhy</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">org-ref-default-bibliography</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#666">`</span>(<span style="color:#666">,</span>(<span style="color:#19177c">read-file-name</span> <span style="color:#ba2121">&#34;Bibliograhy: &#34;</span> <span style="color:#800">nil</span> <span style="color:#800">nil</span> <span style="color:#800">t</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">reftex-default-bibliography</span> <span style="color:#19177c">org-ref-default-bibliography</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">bibtex-completion-bibliography</span> <span style="color:#19177c">org-ref-default-bibliography</span>))
</span></span></code></pre></div><h4 id="org-roam-bibtex">org-roam-bibtex</h4>
<p>Integration with bibtex and org-ref.</p>
<p>There are some problems with org roam v2, so I disabled it as of now. I will probably use another way of managing bibliography notes anyway.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-roam-bibtex</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;org-roam/org-roam-bibtex&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">org-roam</span> <span style="color:#19177c">org-ref</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:disabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-roam-bibtex-mode</span>))
</span></span></code></pre></div><h4 id="org-contacts">org-contacts</h4>
<p><code>org-contacts</code> is the <code>org-contrib</code> package to store contacts in an org file. The package is somewhat outdated, for instance it uses <code>lexical-let</code> so I have to <code>(require 'cl)</code>.</p>
<p>I think it will take a little more work to tune the package exactly to my liking, but it seems to serve the original function just fine.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-contacts</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:type</span> <span style="color:#19177c">git</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;https://git.sr.ht/~bzg/org-contrib&#34;</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#008000">:files</span> (<span style="color:#ba2121">&#34;lisp/org-contacts.el&#34;</span>)
</span></span><span style="display:flex;"><span>		   <span style="color:#008000">:build</span> (<span style="color:#008000">:not</span> <span style="color:#19177c">compile</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">notmuch</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">org-contacts</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;cl</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-contacts-files</span> (<span style="color:#00f">list</span>
</span></span><span style="display:flex;"><span>			    (<span style="color:#00f">concat</span> <span style="color:#19177c">org-directory</span> <span style="color:#ba2121">&#34;/contacts.org&#34;</span>))))
</span></span></code></pre></div><p>An example contact entry can look like this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>* Pavel Korytov
</span></span><span style="display:flex;"><span>:PROPERTIES:
</span></span><span style="display:flex;"><span>:TYPE:     person
</span></span><span style="display:flex;"><span>:EMAIL:    thexcloud@gmail.com
</span></span><span style="display:flex;"><span>:EMAIL+:   pvkorytov@etu.ru
</span></span><span style="display:flex;"><span>:BIRTHDAY: [1998-08-14]
</span></span><span style="display:flex;"><span>:END:
</span></span></code></pre></div><h4 id="managing-tables">Managing tables</h4>
<p>I use Org to manage some small tables which I want to process further. So here is a function that saves each table to a CSV file.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/export-org-tables-to-csv</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">org-table-map-tables</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">when-let</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">name</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">plist-get</span> (<span style="color:#19177c">cadr</span> (<span style="color:#19177c">org-element-at-point</span>)) <span style="color:#008000">:name</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">org-table-export</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">concat</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#00f">file-name-directory</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">buffer-file-name</span>))
</span></span><span style="display:flex;"><span>	 <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;.csv&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ba2121">&#34;orgtbl-to-csv&#34;</span>)))))
</span></span></code></pre></div><h3 id="ui">UI</h3>
<h4 id="off--instant-equations-preview"><span class="org-todo done OFF">OFF</span> (OFF) Instant equations preview</h4>
<p>Instant math previews for org mode.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/yangsheng6810/org-latex-impatient">org-latex-impatient repo</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-latex-impatient</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;yangsheng6810/org-latex-impatient&#34;</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#008000">:branch</span> <span style="color:#ba2121">&#34;master&#34;</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#008000">:host</span> <span style="color:#19177c">github</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">org-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">org-latex-impatient-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:disabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-latex-impatient-tex2svg-bin</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ba2121">&#34;/home/pavel/Programs/miniconda3/lib/node_modules/mathjax-node-cli/bin/tex2svg&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-latex-impatient-scale</span> <span style="color:#666">1.75</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-latex-impatient-delay</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-latex-impatient-border-color</span> <span style="color:#ba2121">&#34;#ffffff&#34;</span>))
</span></span></code></pre></div><h4 id="latex-fragments">LaTeX fragments</h4>
<p>A function to enable LaTeX native highlighting. Not setting this as default, because it loads LaTeX stuff.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/enable-org-latex</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">customize-set-variable</span> <span style="color:#19177c">&#39;org-highlight-latex-and-related</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">native</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-mode-hook</span> (<span style="color:#008000">lambda</span> () (<span style="color:#19177c">yas-activate-extra-mode</span> <span style="color:#19177c">&#39;LaTeX-mode</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">sp-local-pair</span> <span style="color:#19177c">&#39;org-mode</span> <span style="color:#ba2121">&#34;$&#34;</span> <span style="color:#ba2121">&#34;$&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">sp--remove-local-pair</span> <span style="color:#ba2121">&#34;&#39;&#34;</span>))
</span></span></code></pre></div><p>Call the function before opening an org file or reopen a buffer after calling the function.</p>
<p>Scale latex fragments preview.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">with-eval-after-load-norem</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">my/org-latex-scale</span> <span style="color:#666">1.75</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-format-latex-options</span> (<span style="color:#00f">plist-put</span> <span style="color:#19177c">org-format-latex-options</span> <span style="color:#008000">:scale</span> <span style="color:#19177c">my/org-latex-scale</span>)))
</span></span></code></pre></div><p>Also, LaTeX fragments preview tends to break whenever the are custom <code>#+LATEX_HEADER</code> entries. To circumvent this, I add a custom header and modify the <code>org-preview-latex-process-alist</code> variable</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">with-eval-after-load-norem</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">my/latex-preview-header</span> <span style="color:#ba2121">&#34;\\documentclass{article}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage[usenames]{color}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{graphicx}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{grffile}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{longtable}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{wrapfig}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{rotating}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage[normalem]{ulem}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{amsmath}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{textcomp}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{amssymb}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{capt-of}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\usepackage{hyperref}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">\\pagestyle{empty}&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-preview-latex-process-alist</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">lambda</span> (<span style="color:#19177c">item</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#00f">cons</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#00f">car</span> <span style="color:#19177c">item</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#00f">plist-put</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">item</span>) <span style="color:#008000">:latex-header</span> <span style="color:#19177c">my/latex-preview-header</span>)))
</span></span><span style="display:flex;"><span>	 <span style="color:#19177c">org-preview-latex-process-alist</span>)))
</span></span></code></pre></div><h4 id="better-headers">Better headers</h4>
<p><a href="https://github.com/integral-dw/org-superstar-mode">org-superstar-mode</a> is a package that makes Org heading lines look a bit prettier.</p>
<p>Disabled it for now because of overlapping functionality with org-bars.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-superstar</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:disabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">org-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">org-superstar-mode</span>))
</span></span></code></pre></div><p><a href="https://github.com/tonyaldon/org-bars">org-bars</a> highlights Org indentation with bars.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">org-bars</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;tonyaldon/org-bars&#34;</span> <span style="color:#008000">:host</span> <span style="color:#19177c">github</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">display-graphic-p</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">org-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">org-bars-mode</span>))
</span></span></code></pre></div><p>Remove the ellipsis at the end of folded headlines, as it seems unnecessary with <code>org-bars</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-no-ellipsis-in-headlines</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">remove-from-invisibility-spec</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">outline</span> <span style="color:#666">.</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-invisibility-spec</span> <span style="color:#19177c">&#39;outline</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;org-bars</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/org-no-ellipsis-in-headlines</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">major-mode</span> <span style="color:#19177c">&#39;org-mode</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/org-no-ellipsis-in-headlines</span>)))
</span></span></code></pre></div><h4 id="override-colors">Override colors</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my/use-doom-colors</span>
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">org-block</span> <span style="color:#008000">:background</span> (<span style="color:#19177c">color-darken-name</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;bg</span>) <span style="color:#666">3</span>))
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">org-block-begin-line</span> <span style="color:#008000">:background</span> (<span style="color:#19177c">color-darken-name</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;bg</span>) <span style="color:#666">3</span>)
</span></span><span style="display:flex;"><span>		       <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;grey</span>)))
</span></span></code></pre></div><h3 id="export">Export</h3>
<h4 id="hugo">Hugo</h4>
<p>A package for exporting Org to Hugo. That&rsquo;s how I manage my <a href="https://sqrtminusone.xyz">sqrtminusone.xyz</a>.</p>
<p>References:</p>
<ul>
<li><a href="https://ox-hugo.scripter.co/">ox-hugo homepage</a></li>
<li><a href="https://github.com/SqrtMinusOne/sqrtminusone.github.io">Source code for sqrtminusone.xyz</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ox-hugo</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">ox</span>)
</span></span></code></pre></div><h4 id="jupyter-notebook">Jupyter Notebook</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ox-ipynb</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;jkitchin/ox-ipynb&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">ox</span>)
</span></span></code></pre></div><h4 id="html-export">Html export</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">htmlize</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">ox</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-html-htmlize-output-type</span> <span style="color:#19177c">&#39;css</span>))
</span></span></code></pre></div><h4 id="latex-1">LaTeX</h4>
<p>Add a custom LaTeX template without default packages. Packages are indented to be imported with function from <a href="#import-dot-sty-1">Import *.sty</a>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/setup-org-latex</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-latex-prefer-user-labels</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-latex-compiler</span> <span style="color:#ba2121">&#34;xelatex&#34;</span>) <span style="color:#408080;font-style:italic">;; Probably not necessary</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-latex-pdf-process</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;latexmk -outdir=%o %f&#34;</span>)) <span style="color:#408080;font-style:italic">;; Use latexmk</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-latex-listings</span> <span style="color:#19177c">&#39;minted</span>) <span style="color:#408080;font-style:italic">;; Use minted to highlight source code</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">org-latex-minted-options</span>    <span style="color:#408080;font-style:italic">;; Some minted options I like</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">&#39;</span>((<span style="color:#ba2121">&#34;breaklines&#34;</span> <span style="color:#ba2121">&#34;true&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#ba2121">&#34;tabsize&#34;</span> <span style="color:#ba2121">&#34;4&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#ba2121">&#34;autogobble&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#ba2121">&#34;linenos&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#ba2121">&#34;numbersep&#34;</span> <span style="color:#ba2121">&#34;0.5cm&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#ba2121">&#34;xleftmargin&#34;</span> <span style="color:#ba2121">&#34;1cm&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#ba2121">&#34;frame&#34;</span> <span style="color:#ba2121">&#34;single&#34;</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; Use extarticle without the default packages</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;org-latex-classes</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;org-plain-extarticle&#34;</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#ba2121">&#34;\\documentclass{extarticle}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">[NO-DEFAULT-PACKAGES]
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">[PACKAGES]
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">[EXTRA]&#34;</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\section{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\section*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\subsection{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\subsection*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\subsubsection{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\subsubsection*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\paragraph{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\paragraph*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\subparagraph{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\subparagraph*{%s}&#34;</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;org-latex-classes</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;org-plain-extreport&#34;</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#ba2121">&#34;\\documentclass{extreport}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">[NO-DEFAULT-PACKAGES]
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">[PACKAGES]
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">[EXTRA]&#34;</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\chapter{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\chapter*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\section{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\section*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\subsection{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\subsection*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\subsubsection{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\subsubsection*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;\\paragraph{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\paragraph*{%s}&#34;</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; Use beamer without the default packages</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;org-latex-classes</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;org-latex-beamer&#34;</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#ba2121">&#34;\\documentclass{beamer}
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">[NO-DEFAULT-PACKAGES]
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">[PACKAGES]
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">[EXTRA]&#34;</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#ba2121">&#34;beamer&#34;</span> <span style="color:#ba2121">&#34;\\documentclass[presentation]{beamer}&#34;</span>
</span></span><span style="display:flex;"><span>		  (<span style="color:#ba2121">&#34;\\section{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\section*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		  (<span style="color:#ba2121">&#34;\\subsection{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\subsection*{%s}&#34;</span>)
</span></span><span style="display:flex;"><span>		  (<span style="color:#ba2121">&#34;\\subsubsection{%s}&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;\\subsubsection*{%s}&#34;</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; Make sure to eval the function when org-latex-classes list already exists</span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">with-eval-after-load-norem</span> <span style="color:#19177c">&#39;ox-latex</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/setup-org-latex</span>))
</span></span></code></pre></div><h3 id="keybindings-and-stuff">Keybindings &amp; stuff</h3>
<h4 id="general-keybindings">General keybindings</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">with-eval-after-load-norem</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-c d&#34;</span> <span style="color:#19177c">&#39;org-decrypt-entry</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-c e&#34;</span> <span style="color:#19177c">&#39;org-encrypt-entry</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-p&#34;</span> <span style="color:#19177c">&#39;org-latex-preview</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-o&#34;</span> <span style="color:#19177c">&#39;org-redisplay-inline-images</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">emacs</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;L&#34;</span> <span style="color:#19177c">&#39;org-shiftright</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;H&#34;</span> <span style="color:#19177c">&#39;org-shiftleft</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;S-&lt;next&gt;&#34;</span> <span style="color:#19177c">&#39;org-next-visible-heading</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;S-&lt;prior&gt;&#34;</span> <span style="color:#19177c">&#39;org-previous-visible-heading</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-0&#34;</span> <span style="color:#19177c">&#39;org-next-visible-heading</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-9&#34;</span> <span style="color:#19177c">&#39;org-previous-visible-heading</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-]&#34;</span> <span style="color:#19177c">&#39;org-babel-next-src-block</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-[&#34;</span> <span style="color:#19177c">&#39;org-babel-previous-src-block</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-agenda-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-]&#34;</span> <span style="color:#19177c">&#39;org-agenda-later</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-[&#34;</span> <span style="color:#19177c">&#39;org-agenda-earlier</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-nmap</span> <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-mode-map</span> <span style="color:#ba2121">&#34;RET&#34;</span> <span style="color:#19177c">&#39;org-ctrl-c-ctrl-c</span>))
</span></span></code></pre></div><h4 id="copy-a-link">Copy a link</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-link-copy</span> (<span style="color:#008000">&amp;optional</span> <span style="color:#19177c">arg</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Extract URL from org-mode link and add it to kill ring.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> <span style="color:#ba2121">&#34;P&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">link</span> (<span style="color:#19177c">org-element-lineage</span> (<span style="color:#19177c">org-element-context</span>) <span style="color:#666">&#39;</span>(<span style="color:#19177c">link</span>) <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">type</span> (<span style="color:#19177c">org-element-property</span> <span style="color:#008000">:type</span> <span style="color:#19177c">link</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">url</span> (<span style="color:#19177c">org-element-property</span> <span style="color:#008000">:path</span> <span style="color:#19177c">link</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">url</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">type</span> <span style="color:#ba2121">&#34;:&#34;</span> <span style="color:#19177c">url</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">kill-new</span> <span style="color:#19177c">url</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">message</span> (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;Copied URL: &#34;</span> <span style="color:#19177c">url</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">with-eval-after-load-norem</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-nmap</span> <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-mode-map</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;C-x C-l&#34;</span> <span style="color:#19177c">&#39;my/org-link-copy</span>))
</span></span></code></pre></div><h4 id="navigating-source-blocks">Navigating source blocks</h4>
<p>An idea born from discussing Org Mode navigation with @Infu.</p>
<p>Modifying <code>org-babel-next-src-block</code> and <code>org-babel-previous-src-block</code> to ignore hidden source blocks.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-babel-next-visible-src-block</span> (<span style="color:#19177c">arg</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Move to the next visible source block.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">With ARG, repeats or can move backward if negative.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> <span style="color:#ba2121">&#34;p&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">regexp</span> <span style="color:#19177c">org-babel-src-block-regexp</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> (<span style="color:#00f">&lt;</span> <span style="color:#19177c">arg</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#00f">beginning-of-line</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">end-of-line</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">while</span> (<span style="color:#008000">and</span> (<span style="color:#00f">&lt;</span> <span style="color:#19177c">arg</span> <span style="color:#666">0</span>) (<span style="color:#00f">re-search-backward</span> <span style="color:#19177c">regexp</span> <span style="color:#800">nil</span> <span style="color:#008000">:move</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">unless</span> (<span style="color:#00f">bobp</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">while</span> (<span style="color:#008000">pcase</span> (<span style="color:#00f">get-char-property-and-overlay</span> (<span style="color:#00f">point</span>) <span style="color:#19177c">&#39;invisible</span>)
</span></span><span style="display:flex;"><span>			 (<span style="color:#666">`</span>(<span style="color:#19177c">outline</span> <span style="color:#666">.</span> <span style="color:#666">,</span><span style="color:#19177c">o</span>)
</span></span><span style="display:flex;"><span>			  (<span style="color:#00f">goto-char</span> (<span style="color:#00f">overlay-start</span> <span style="color:#19177c">o</span>))
</span></span><span style="display:flex;"><span>			  (<span style="color:#00f">re-search-backward</span> <span style="color:#19177c">regexp</span> <span style="color:#800">nil</span> <span style="color:#008000">:move</span>))
</span></span><span style="display:flex;"><span>			 (<span style="color:#19177c">_</span> <span style="color:#800">nil</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">cl-incf</span> <span style="color:#19177c">arg</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">while</span> (<span style="color:#008000">and</span> (<span style="color:#00f">&gt;</span> <span style="color:#19177c">arg</span> <span style="color:#666">0</span>) (<span style="color:#00f">re-search-forward</span> <span style="color:#19177c">regexp</span> <span style="color:#800">nil</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">while</span> (<span style="color:#008000">pcase</span> (<span style="color:#00f">get-char-property-and-overlay</span> (<span style="color:#00f">point</span>) <span style="color:#19177c">&#39;invisible</span>)
</span></span><span style="display:flex;"><span>		   (<span style="color:#666">`</span>(<span style="color:#19177c">outline</span> <span style="color:#666">.</span> <span style="color:#666">,</span><span style="color:#19177c">o</span>)
</span></span><span style="display:flex;"><span>			(<span style="color:#00f">goto-char</span> (<span style="color:#00f">overlay-end</span> <span style="color:#19177c">o</span>))
</span></span><span style="display:flex;"><span>			(<span style="color:#00f">re-search-forward</span> <span style="color:#19177c">regexp</span> <span style="color:#800">nil</span> <span style="color:#008000">:move</span>))
</span></span><span style="display:flex;"><span>		   (<span style="color:#19177c">_</span> (<span style="color:#00f">end-of-line</span>) <span style="color:#800">nil</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">re-search-backward</span> <span style="color:#19177c">regexp</span> <span style="color:#800">nil</span> <span style="color:#008000">:move</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">cl-decf</span> <span style="color:#19177c">arg</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> (<span style="color:#00f">&gt;</span> <span style="color:#19177c">arg</span> <span style="color:#666">0</span>) (<span style="color:#00f">goto-char</span> (<span style="color:#00f">point-max</span>)) (<span style="color:#00f">beginning-of-line</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-babel-previous-visible-src-block</span> (<span style="color:#19177c">arg</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Move to the prevous visible source block.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">With ARG, repeats or can move backward if negative.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> <span style="color:#ba2121">&#34;p&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/org-babel-next-visible-src-block</span> (<span style="color:#00f">-</span> <span style="color:#19177c">arg</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;org</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;org-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">emacs</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-]&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/org-babel-next-visible-src-block</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-[&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/org-babel-previous-visible-src-block</span>))
</span></span></code></pre></div><h4 id="open-a-file-from-org-directory">Open a file from <code>org-directory</code></h4>
<p>A function to open a file from <code>org-directory</code>, excluding a few directories like <code>roam</code> and <code>journal</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/org-file-open</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">default-directory</span> <span style="color:#19177c">org-directory</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">project-files</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">seq-filter</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">f</span>)
</span></span><span style="display:flex;"><span>	     (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>) <span style="color:#ba2121">&#34;.org&#34;</span> <span style="color:#19177c">eos</span>) <span style="color:#19177c">f</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> (<span style="color:#19177c">|</span> <span style="color:#ba2121">&#34;journal&#34;</span> <span style="color:#ba2121">&#34;roam&#34;</span> <span style="color:#ba2121">&#34;review&#34;</span> <span style="color:#ba2121">&#34;archive&#34;</span> <span style="color:#ba2121">&#34;figured-out&#34;</span>)) <span style="color:#19177c">f</span>))))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">projectile-current-project-files</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">find-file</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">concat</span> <span style="color:#19177c">org-directory</span> <span style="color:#ba2121">&#34;/&#34;</span> (<span style="color:#00f">completing-read</span> <span style="color:#ba2121">&#34;Org file: &#34;</span> <span style="color:#19177c">project-files</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;o o&#34;</span> <span style="color:#19177c">&#39;my/org-file-open</span>)
</span></span></code></pre></div><h3 id="system-configuration">System configuration</h3>
<p>Functions related to literate configuration.</p>
<h4 id="tables-for-guix-dependencies">Tables for Guix Dependencies</h4>
<p>This section deals with using <a href="https://guix.gnu.org/en/cookbook/en/html_node/Advanced-package-management.html#Advanced-package-management">using profiles in GNU Guix</a>.</p>
<p>A &ldquo;profile&rdquo; in Guix is a way to group package installations. For instance, I have a &ldquo;music&rdquo; profile that has software like <a href="https://www.musicpd.org/">MPD</a>, <a href="https://github.com/ncmpcpp/ncmpcpp">ncmpcpp</a> that I&rsquo;m still occasionally using because of its tag editor, etc. Corresponding to that profile, there&rsquo;s a manifest named <code>music.scm</code> that looks like this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00f">specifications-&gt;manifest</span>
</span></span><span style="display:flex;"><span> <span style="color:#666">&#39;</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;flac&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;cuetools&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;shntool&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;mpd-mpc&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;mpd-watcher&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;picard&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;ncmpcpp&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;mpd&#34;</span>))
</span></span></code></pre></div><p>I could generate this file with <code>org-babel</code> as any other, but that is often not so convenient. For example, I have a <a href="https://github.com/polybar/polybar">polybar</a> module that uses <a href="https://github.com/risacher/sunwait">sunwait</a> to show sunset and sunrise times, and ideally, I want to declare <code>sunwait</code> to be in the &ldquo;desktop-polybar&rdquo; profile in the same section that has the polybar module definition and the bash script.</p>
<p>So here&rsquo;s an approach I came up with. The relevant section of the config looks like this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>*** sun
</span></span><span style="display:flex;"><span>| Category        | Guix dependency |
</span></span><span style="display:flex;"><span>|-----------------+-----------------|
</span></span><span style="display:flex;"><span>| desktop-polybar | sunwait         |
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Prints out the time of sunrise/sunset. Uses [[https://github.com/risacher/sunwait][sunwait]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#+begin_src bash :tangle ./bin/polybar/sun.sh :noweb no-export
</span></span><span style="display:flex;"><span>...script...
</span></span><span style="display:flex;"><span>#+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#+begin_src ini :noweb no-export
</span></span><span style="display:flex;"><span>...polybar module definition...
</span></span><span style="display:flex;"><span>#+end_src
</span></span></code></pre></div><p>So <code>sunwait</code> is declared in an Org table with <code>Guix dependency</code> in the header. Such tables are spread through my configuration files.</p>
<p>Thus I made a function that extracts packages from all such tables from the current Org buffer. The rules are as follows:</p>
<ul>
<li>If a column name matches <code>[G|g]uix.*dep</code>, its contents are added to the result.</li>
<li>If <code>CATEGORY</code> is passed, a column with name <code>[C|c]ategory</code> is used to filter results. That way, one Org file can be used to produce multiple manifests.</li>
<li>If <code>CATEGORY</code> is not passed, entries with the non-empty category are filtered out</li>
<li>If there is a <code>[D|d]isabled</code> column, entries that have a non-empty value in this column are filtered out.</li>
</ul>
<p>And here is the implementation:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/extract-guix-dependencies</span> (<span style="color:#008000">&amp;optional</span> <span style="color:#19177c">category</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">dependencies</span> <span style="color:#666">&#39;</span>()))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">org-table-map-tables</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">let*</span> ((<span style="color:#19177c">table</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">seq-filter</span>
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">lambda</span> (<span style="color:#19177c">q</span>) (<span style="color:#19177c">not</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">q</span> <span style="color:#19177c">&#39;hline</span>)))
</span></span><span style="display:flex;"><span>		(<span style="color:#19177c">org-table-to-lisp</span>)))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">dep-name-index</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">cl-position</span>
</span></span><span style="display:flex;"><span>		<span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>		(<span style="color:#00f">mapcar</span> <span style="color:#00f">#&#39;substring-no-properties</span> (<span style="color:#00f">nth</span> <span style="color:#666">0</span> <span style="color:#19177c">table</span>))
</span></span><span style="display:flex;"><span>		<span style="color:#008000">:test</span> (<span style="color:#008000">lambda</span> (<span style="color:#19177c">_</span> <span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>			(<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;[G|g]uix.*dep&#34;</span> <span style="color:#19177c">elem</span>))))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">category-name-index</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">cl-position</span>
</span></span><span style="display:flex;"><span>		<span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>		(<span style="color:#00f">mapcar</span> <span style="color:#00f">#&#39;substring-no-properties</span> (<span style="color:#00f">nth</span> <span style="color:#666">0</span> <span style="color:#19177c">table</span>))
</span></span><span style="display:flex;"><span>		<span style="color:#008000">:test</span> (<span style="color:#008000">lambda</span> (<span style="color:#19177c">_</span> <span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>			(<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;.*[C|c]ategory.*&#34;</span> <span style="color:#19177c">elem</span>))))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">disabled-name-index</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">cl-position</span>
</span></span><span style="display:flex;"><span>		<span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>		(<span style="color:#00f">mapcar</span> <span style="color:#00f">#&#39;substring-no-properties</span> (<span style="color:#00f">nth</span> <span style="color:#666">0</span> <span style="color:#19177c">table</span>))
</span></span><span style="display:flex;"><span>		<span style="color:#008000">:test</span> (<span style="color:#008000">lambda</span> (<span style="color:#19177c">_</span> <span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>			(<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;.*[D|d]isabled.*&#34;</span> <span style="color:#19177c">elem</span>)))))
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">when</span> <span style="color:#19177c">dep-name-index</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">dolist</span> (<span style="color:#19177c">elem</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">table</span>))
</span></span><span style="display:flex;"><span>	     (<span style="color:#008000">when</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#408080;font-style:italic">;; Category</span>
</span></span><span style="display:flex;"><span>		  (<span style="color:#008000">or</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#408080;font-style:italic">;; Category not set and not present in the table</span>
</span></span><span style="display:flex;"><span>		   (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>		    (<span style="color:#008000">or</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">category</span>) (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">category</span>))
</span></span><span style="display:flex;"><span>		    (<span style="color:#19177c">not</span> <span style="color:#19177c">category-name-index</span>))
</span></span><span style="display:flex;"><span>		   <span style="color:#408080;font-style:italic">;; Category is set and present in the table</span>
</span></span><span style="display:flex;"><span>		   (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#19177c">category-name-index</span>
</span></span><span style="display:flex;"><span>		    (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">category</span>))
</span></span><span style="display:flex;"><span>		    (<span style="color:#19177c">string-match-p</span> <span style="color:#19177c">category</span> (<span style="color:#00f">nth</span> <span style="color:#19177c">category-name-index</span> <span style="color:#19177c">elem</span>))))
</span></span><span style="display:flex;"><span>		  <span style="color:#408080;font-style:italic">;; Not disabled</span>
</span></span><span style="display:flex;"><span>		  (<span style="color:#008000">or</span>
</span></span><span style="display:flex;"><span>		   (<span style="color:#19177c">not</span> <span style="color:#19177c">disabled-name-index</span>)
</span></span><span style="display:flex;"><span>		   (<span style="color:#19177c">string-empty-p</span> (<span style="color:#00f">nth</span> <span style="color:#19177c">disabled-name-index</span> <span style="color:#19177c">elem</span>))))
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">add-to-list</span>
</span></span><span style="display:flex;"><span>		<span style="color:#19177c">&#39;dependencies</span>
</span></span><span style="display:flex;"><span>		(<span style="color:#00f">substring-no-properties</span> (<span style="color:#00f">nth</span> <span style="color:#19177c">dep-name-index</span> <span style="color:#19177c">elem</span>)))))))))
</span></span><span style="display:flex;"><span>    <span style="color:#19177c">dependencies</span>))
</span></span></code></pre></div><p>To make it work in the configuration, it is necessary to format the list so that Scheme could read it:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/format-guix-dependencies</span> (<span style="color:#008000">&amp;optional</span> <span style="color:#19177c">category</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">mapconcat</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">e</span>) (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;\&#34;&#34;</span> <span style="color:#19177c">e</span> <span style="color:#ba2121">&#34;\&#34;&#34;</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">my/extract-guix-dependencies</span> <span style="color:#19177c">category</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;\n&#34;</span>))
</span></span></code></pre></div><p>And we need an Org snippet such as this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#+NAME: packages
</span></span><span style="display:flex;"><span>#+begin_src emacs-lisp :tangle no :var category=&#34;&#34;
</span></span><span style="display:flex;"><span>(my/format-guix-dependencies category)
</span></span><span style="display:flex;"><span>#+end_src
</span></span></code></pre></div><p>Now, creating a manifest, for example, for the <code>desktop-polybar</code> profile is as simple as:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#+begin_src scheme :tangle ~/.config/guix/manifests/desktop-polybar.scm :noweb no-export
</span></span><span style="display:flex;"><span>(specifications-&gt;manifest
</span></span><span style="display:flex;"><span> &#39;(
</span></span><span style="display:flex;"><span>   &lt;&lt;packages(&#34;desktop-polybar&#34;)&gt;&gt;))
</span></span><span style="display:flex;"><span>#+end_src
</span></span></code></pre></div><p>There&rsquo;s a newline symbol between &ldquo;(&rdquo; and <code>&lt;&lt;packages(&quot;desktop-polybar&quot;)&gt;&gt;</code> because whenever a noweb expression expands into multiple lines, for each new line noweb duplicates contents between the start of the line and the start of the expression.</p>
<p>One reason this is so is to support languages where indentation is a part of the syntax, for instance, Python:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">class</span> <span style="color:#00f;font-weight:bold">TestClass</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#666">&lt;&lt;</span>class<span style="color:#666">-</span>contents<span style="color:#666">&gt;&gt;</span>
</span></span></code></pre></div><p>So every line of <code>&lt;&lt;class-contents&gt;&gt;</code> will be indented appropriately. In our case though, it is a minor inconvenience to be aware of.</p>
<h4 id="noweb-evaluations">Noweb evaluations</h4>
<p>One note is that by default running these commands will require the user to confirm evaluation of each code block. To avoid that, I set <code>org-confirm-babel-evaluate</code> to <code>nil</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/org-config-files</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;/home/pavel/Emacs.org&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ba2121">&#34;/home/pavel/Desktop.org&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ba2121">&#34;/home/pavel/Console.org&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ba2121">&#34;/home/pavel/Guix.org&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ba2121">&#34;/home/pavel/Mail.org&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;org-mode-hook</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">when</span> (<span style="color:#00f">member</span> (<span style="color:#00f">buffer-file-name</span>) <span style="color:#19177c">my/org-config-files</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">setq-local</span> <span style="color:#19177c">org-confirm-babel-evaluate</span> <span style="color:#800">nil</span>))))
</span></span></code></pre></div><h4 id="yadm-hook">yadm hook</h4>
<p>A script to run tangle from CLI.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">require</span> <span style="color:#19177c">&#39;org</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">org-babel-do-load-languages</span>
</span></span><span style="display:flex;"><span> <span style="color:#19177c">&#39;org-babel-load-languages</span>
</span></span><span style="display:flex;"><span> <span style="color:#666">&#39;</span>((<span style="color:#19177c">emacs-lisp</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">shell</span> <span style="color:#666">.</span> <span style="color:#800">t</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; Do not ask to confirm evaluations</span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">org-confirm-babel-evaluate</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#19177c">&lt;&lt;guix-tables&gt;&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">;; A few dummy modes to avoid being prompted for comment systax</span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">define-derived-mode</span> <span style="color:#19177c">fish-mode</span> <span style="color:#19177c">prog-mode</span> <span style="color:#ba2121">&#34;Fish&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">comment-start</span> <span style="color:#ba2121">&#34;# &#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">comment-start-skip</span> <span style="color:#ba2121">&#34;#+[\t ]*&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">define-derived-mode</span> <span style="color:#19177c">yaml-mode</span> <span style="color:#19177c">text-mode</span> <span style="color:#ba2121">&#34;YAML&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">comment-start</span> <span style="color:#ba2121">&#34;# &#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">comment-start-skip</span> <span style="color:#ba2121">&#34;#+ *&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#00f">mapcar</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">org-babel-tangle-file</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;/home/pavel/Emacs.org&#34;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#ba2121">&#34;/home/pavel/Desktop.org&#34;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#ba2121">&#34;/home/pavel/Console.org&#34;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#ba2121">&#34;/home/pavel/Guix.org&#34;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#ba2121">&#34;/home/pavel/Mail.org&#34;</span>))
</span></span></code></pre></div><p>To launch from CLI, run:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>emacs -Q --batch -l run-tangle.el
</span></span></code></pre></div><p>I have added this line to yadm&rsquo;s <code>post_alt</code> hook, so tangle is run after <code>yadm alt</code></p>
<h2 id="applications">Applications</h2>
<h3 id="dired-1">Dired</h3>
<p>Dired is a built-in file manager. I currently use it as my primary file manager.</p>
<h4 id="basic-config-and-keybindings">Basic config &amp; keybindings</h4>
<p>My config mostly follows ranger&rsquo;s and vifm&rsquo;s keybindings which I&rsquo;m used to.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dired</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:ensure</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:custom</span> ((<span style="color:#19177c">dired-listing-switches</span> <span style="color:#ba2121">&#34;-alh --group-directories-first&#34;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">dired</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">dired-dwim-target</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">wdired-allow-to-change-permissions</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">wdired-create-parent-directories</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">dired-recursive-copies</span> <span style="color:#19177c">&#39;always</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">dired-recursive-deletes</span> <span style="color:#19177c">&#39;always</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">dired-kill-when-opening-new-dired-buffer</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;dired-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">setq</span> <span style="color:#19177c">truncate-lines</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">visual-line-mode</span> <span style="color:#800">nil</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;dired-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;h&#34;</span> <span style="color:#19177c">&#39;dired-up-directory</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;l&#34;</span> <span style="color:#19177c">&#39;dired-find-file</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;=&#34;</span> <span style="color:#19177c">&#39;dired-narrow</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;-&#34;</span> <span style="color:#19177c">&#39;dired-create-empty-file</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;~&#34;</span> <span style="color:#19177c">&#39;vterm</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-r&#34;</span> <span style="color:#19177c">&#39;wdired-change-to-wdired-mode</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;&lt;left&gt;&#34;</span> <span style="color:#19177c">&#39;dired-up-directory</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;&lt;right&gt;&#34;</span> <span style="color:#19177c">&#39;dired-find-file</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-&lt;return&gt;&#34;</span> <span style="color:#19177c">&#39;dired-open-xdg</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dired-home</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Open dired at $HOME&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dired</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;~&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;ad&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">dired</span>)
</span></span></code></pre></div><h4 id="addons-1">Addons</h4>
<p>I used to use <a href="https://www.emacswiki.org/emacs/DiredPlus">dired+</a>, which provides a lot of extensions for dired functionality, but it also creates some new problems, so I opt out of it. Fortunately, the one feature I want from this package - adding more colors to dired buffers - is available as a separate package.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">diredfl</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">dired</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">diredfl-global-mode</span> <span style="color:#666">1</span>))
</span></span></code></pre></div><p><a href="https://github.com/Fuco1/dired-hacks#dired-subtree">dired-subtree</a> is a package that enables managing Dired buffers in a tree-like manner. By default <code>evil-collection</code> maps <code>dired-subtree-toggle</code> to <code>TAB</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dired-subtree</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">dired</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><p><a href="https://github.com/jojojames/dired-sidebar">dired-sidebar</a> enables opening Dired in sidebar. For me, with dired-subtree this makes dired a better option than Treemacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dired-sidebar</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">dired</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">dired-sidebar-toggle-sidebar</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">override</span> <span style="color:#19177c">global</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-n&#34;</span> <span style="color:#19177c">&#39;dired-sidebar-toggle-sidebar</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">my/dired-sidebar-setup</span> ()
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">toggle-truncate-lines</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">display-line-numbers-mode</span> <span style="color:#666">-1</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq-local</span> <span style="color:#19177c">dired-subtree-use-backgrounds</span> <span style="color:#800">nil</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;dired-sidebar-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">emacs</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;l&#34;</span> <span style="color:#19177c">&#39;dired-sidebar-find-file</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;h&#34;</span> <span style="color:#19177c">&#39;dired-sidebar-up-directory</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;=&#34;</span> <span style="color:#19177c">&#39;dired-narrow</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;dired-sidebar-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/dired-sidebar-setup</span>))
</span></span></code></pre></div><p><a href="https://github.com/vifon/dired-recent.el">dired-recent.el</a> adds history to dired.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dired-recent</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">dired</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">dired-recent-open</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dired-recent-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;dired-recent-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-x C-d&#34;</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;aD&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">dired-recent-open</span> <span style="color:#008000">:wk</span> <span style="color:#ba2121">&#34;dired history&#34;</span>)))
</span></span></code></pre></div><p><del>Reuse the current dired buffer instead of spamming new ones.</del> Looks like not necessary with Emacs 28.1</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dired-single</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">dired</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:disabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><p>Display icons for files.</p>
<table>
<thead>
<tr>
<th>Note</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ACHTUNG</strong></td>
<td>This plugin is slow as hell with TRAMP or in <code>gnu/store</code></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">all-the-icons-dired</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> (<span style="color:#008000">or</span> <span style="color:#19177c">my/slow-ssh</span> (<span style="color:#19177c">not</span> (<span style="color:#19177c">display-graphic-p</span>))))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">dired-mode</span> <span style="color:#666">.</span> (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>			(<span style="color:#008000">unless</span> (<span style="color:#19177c">string-match-p</span> <span style="color:#ba2121">&#34;/gnu/store&#34;</span> <span style="color:#19177c">default-directory</span>)
</span></span><span style="display:flex;"><span>			  (<span style="color:#19177c">all-the-icons-dired-mode</span>))))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;dired-add-entry</span> <span style="color:#008000">:around</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">all-the-icons-dired--refresh-advice</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;dired-remove-entry</span> <span style="color:#008000">:around</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">all-the-icons-dired--refresh-advice</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;dired-kill-subdir</span> <span style="color:#008000">:around</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">all-the-icons-dired--refresh-advice</span>))
</span></span></code></pre></div><p>Provides stuff like <code>dired-open-xdg</code></p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dired-open</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">dired-open-xdg</span>))
</span></span></code></pre></div><p><a href="https://elpa.gnu.org/packages/dired-du.html">dired-du</a> is a package that shows directory sizes</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dired-du</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">dired-du-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">dired-du-size-format</span> <span style="color:#800">t</span>))
</span></span></code></pre></div><p>vifm-like filter</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dired-narrow</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">dired-narrow</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;dired-narrow-map</span>
</span></span><span style="display:flex;"><span>   [<span style="color:#19177c">escape</span>] <span style="color:#19177c">&#39;keyboard-quit</span>))
</span></span></code></pre></div><p>Display git info, such as the last commit for file and stuff. It&rsquo;s pretty useful but also slows down Dired a bit, hence I don&rsquo;t turn it out by default.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">dired-git-info</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">dired</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/slow-ssh</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymap</span> <span style="color:#19177c">&#39;dired-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#19177c">emacs</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;)&#34;</span> <span style="color:#19177c">&#39;dired-git-info-mode</span>))
</span></span></code></pre></div><p><a href="https://github.com/SqrtMinusOne/avy-dired">avy-dired</a> is my experimentation with Avy &amp; Dired. It&rsquo;s somewhat unstable.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">avy-dired</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;SqrtMinusOne/avy-dired&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">dired</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;aa&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">avy-dired-goto-line</span>))
</span></span></code></pre></div><h4 id="subdirectories">Subdirectories</h4>
<p>Subdirectories are one of the interesting features of Dired. It allows displaying multiple folders on the same window.</p>
<p>I add my own keybindings and some extra functionality.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dired-open-this-subdir</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dired</span> (<span style="color:#19177c">dired-current-directory</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dired-kill-all-subdirs</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">dir</span> <span style="color:#19177c">dired-directory</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">kill-buffer</span> (<span style="color:#00f">current-buffer</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">dired</span> <span style="color:#19177c">dir</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;dired</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;dired-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;ss&#34;</span> <span style="color:#19177c">&#39;dired-maybe-insert-subdir</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sl&#34;</span> <span style="color:#19177c">&#39;dired-maybe-insert-subdir</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sq&#34;</span> <span style="color:#19177c">&#39;dired-kill-subdir</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sk&#34;</span> <span style="color:#19177c">&#39;dired-prev-subdir</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sj&#34;</span> <span style="color:#19177c">&#39;dired-next-subdir</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sS&#34;</span> <span style="color:#19177c">&#39;my/dired-open-this-subdir</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sQ&#34;</span> <span style="color:#19177c">&#39;my/dired-kill-all-subdirs</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;TAB&#34;</span>) <span style="color:#19177c">&#39;dired-hide-subdir</span>))
</span></span></code></pre></div><h4 id="tramp-1">TRAMP</h4>
<p>TRAMP is a package that provides remote editing capacities. It is particularly useful for remote server management.</p>
<p>One of the reasons why TRAMP may be slow is that some plugins do too many requests to the filesystem. To debug these issues, set the following variable to 6:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">tramp-verbose</span> <span style="color:#666">1</span>)
</span></span></code></pre></div><p>To check if a file is remote, you can use <code>file-remote-p</code>. E.g. <code>(file-remote-p default-directory)</code> for a current buffer. The problem with this approach is that it&rsquo;s rather awkward to add these checks in every hook, especially for global modes, so for now, I just set an environment variable for Emacs which disables these modes.</p>
<p>So far I have found the following problematic plugins:</p>
<table>
<thead>
<tr>
<th>Plugin</th>
<th>Note</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>editorconfig</td>
<td>looks for .editorconfig in the file tree</td>
<td>do not enable globally</td>
</tr>
<tr>
<td>all-the-icons-dired</td>
<td>runs test on every file in the directory</td>
<td>disable</td>
</tr>
<tr>
<td>projectile</td>
<td>looks for .git, .svn, etc</td>
<td>advice <code>projectile-file-name</code></td>
</tr>
<tr>
<td>lsp</td>
<td>does a whole lot of stuff</td>
<td>disable</td>
</tr>
<tr>
<td>git-gutter</td>
<td>runs git</td>
<td>disable</td>
</tr>
<tr>
<td>vterm</td>
<td>no proper TRAMP integration</td>
<td>use eshell or shell</td>
</tr>
</tbody>
</table>
<p>At any rate, it&rsquo;s usable, although not perfect.</p>
<p>Some other optimization settings:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">remote-file-name-inhibit-cache</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">vc-ignore-dir-regexp</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;\\(%s\\)\\|\\(%s\\)&#34;</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#19177c">vc-ignore-dir-regexp</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#19177c">tramp-file-name-regexp</span>))
</span></span></code></pre></div><p>Set the default shell to <code>bin/bash</code> for TRAMP or on a remote server.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">when</span> (<span style="color:#008000">or</span> <span style="color:#19177c">my/remote-server</span> <span style="color:#19177c">my/slow-ssh</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">explicit-shell-file-name</span> <span style="color:#ba2121">&#34;/bin/bash&#34;</span>))
</span></span></code></pre></div><p>Also, here is a hack to make TRAMP find <code>ls</code> on Guix:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;tramp</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">tramp-remote-path</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">append</span> <span style="color:#19177c">tramp-remote-path</span>
</span></span><span style="display:flex;"><span>		<span style="color:#666">&#39;</span>(<span style="color:#19177c">tramp-own-remote-path</span>))))
</span></span></code></pre></div><h4 id="bookmarks">Bookmarks</h4>
<p>A simple bookmark list for Dired, mainly to use with TRAMP. I may look into a proper bookmarking system later.</p>
<p>Bookmarks are listed in the <a href=".emacs.d/private.el">private.el</a> file, which has an expression like this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>(setq my/dired-bookmarks
</span></span><span style="display:flex;"><span>      &#39;((&#34;sudo&#34; . &#34;/sudo::/&#34;)))
</span></span></code></pre></div><p>The file itself is encrypted with yadm.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/dired-bookmark-open</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">bookmarks</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">lambda</span> (<span style="color:#19177c">el</span>) (<span style="color:#00f">cons</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;%-30s %s&#34;</span> (<span style="color:#00f">car</span> <span style="color:#19177c">el</span>) (<span style="color:#00f">cdr</span> <span style="color:#19177c">el</span>)) (<span style="color:#00f">cdr</span> <span style="color:#19177c">el</span>)))
</span></span><span style="display:flex;"><span>	  <span style="color:#19177c">my/dired-bookmarks</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">dired</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">cdr</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">assoc</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">completing-read</span> <span style="color:#ba2121">&#34;Dired: &#34;</span> <span style="color:#19177c">bookmarks</span> <span style="color:#800">nil</span> <span style="color:#800">nil</span> <span style="color:#ba2121">&#34;^&#34;</span>)
</span></span><span style="display:flex;"><span>       <span style="color:#19177c">bookmarks</span>)))))
</span></span></code></pre></div><h3 id="shells">Shells</h3>
<h4 id="vterm">vterm</h4>
<p>My terminal emulator of choice.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/akermu/emacs-libvterm">emacs-libvterm repo</a></li>
</ul>
<h5 id="configuration-1">Configuration</h5>
<p>I use the package from the Guix repository to avoid building libvterm.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">vterm</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; :straight t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">vterm</span> <span style="color:#19177c">vterm-other-window</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">vterm-kill-buffer-on-exit</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;vterm-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">setq-local</span> <span style="color:#19177c">global-display-line-numbers-mode</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">display-line-numbers-mode</span> <span style="color:#666">0</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;evil-collection-vterm-insert</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#008000">:before</span> (<span style="color:#008000">lambda</span> (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">args</span>)
</span></span><span style="display:flex;"><span>			(<span style="color:#008000">ignore-errors</span>
</span></span><span style="display:flex;"><span>			  (<span style="color:#00f">apply</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">vterm-reset-cursor-point</span> <span style="color:#19177c">args</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;vterm-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-q&#34;</span> <span style="color:#19177c">&#39;vterm-send-escape</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-h&#34;</span> <span style="color:#19177c">&#39;evil-window-left</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-l&#34;</span> <span style="color:#19177c">&#39;evil-window-right</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-k&#34;</span> <span style="color:#19177c">&#39;evil-window-up</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-j&#34;</span> <span style="color:#19177c">&#39;evil-window-down</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-&lt;right&gt;&#34;</span> <span style="color:#19177c">&#39;evil-window-right</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-&lt;left&gt;&#34;</span> <span style="color:#19177c">&#39;evil-window-left</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-&lt;up&gt;&#34;</span> <span style="color:#19177c">&#39;evil-window-up</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-&lt;down&gt;&#34;</span> <span style="color:#19177c">&#39;evil-window-down</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-&lt;left&gt;&#34;</span> <span style="color:#19177c">&#39;vterm-send-left</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-&lt;right&gt;&#34;</span> <span style="color:#19177c">&#39;vterm-send-right</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-&lt;up&gt;&#34;</span> <span style="color:#19177c">&#39;vterm-send-up</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-&lt;down&gt;&#34;</span> <span style="color:#19177c">&#39;vterm-send-down</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;vterm-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#00f">insert</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;&lt;home&gt;&#34;</span> <span style="color:#19177c">&#39;vterm-beginning-of-line</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;&lt;end&gt;&#34;</span> <span style="color:#19177c">&#39;vterm-end-of-line</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;vterm-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#00f">insert</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-r&#34;</span> <span style="color:#19177c">&#39;vterm-send-C-r</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-k&#34;</span> <span style="color:#19177c">&#39;vterm-send-C-k</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-j&#34;</span> <span style="color:#19177c">&#39;vterm-send-C-j</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-l&#34;</span> <span style="color:#19177c">&#39;vterm-send-right</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-h&#34;</span> <span style="color:#19177c">&#39;vterm-send-left</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-k&#34;</span> <span style="color:#19177c">&#39;vterm-send-up</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;M-j&#34;</span> <span style="color:#19177c">&#39;vterm-send-down</span>))
</span></span></code></pre></div><h5 id="subterminal">Subterminal</h5>
<p>Open a terminal in the lower third of the frame with the <code>`</code> key.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;display-buffer-alist</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#666">`</span>(<span style="color:#666">,</span><span style="color:#ba2121">&#34;vterm-subterminal.*&#34;</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">display-buffer-reuse-window</span>
</span></span><span style="display:flex;"><span>		<span style="color:#19177c">display-buffer-in-side-window</span>)
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">side</span> <span style="color:#666">.</span> <span style="color:#19177c">bottom</span>)
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">reusable-frames</span> <span style="color:#666">.</span> <span style="color:#19177c">visible</span>)
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">window-height</span> <span style="color:#666">.</span> <span style="color:#666">0.33</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/toggle-vterm-subteminal</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Toogle subteminal.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span>
</span></span><span style="display:flex;"><span>      ((<span style="color:#19177c">vterm-window</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">seq-find</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">lambda</span> (<span style="color:#19177c">window</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#00f">string-match</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#ba2121">&#34;vterm-subterminal.*&#34;</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#00f">buffer-name</span> (<span style="color:#00f">window-buffer</span> <span style="color:#19177c">window</span>))))
</span></span><span style="display:flex;"><span>	 (<span style="color:#00f">window-list</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> <span style="color:#19177c">vterm-window</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">if</span> (<span style="color:#00f">eq</span> (<span style="color:#00f">get-buffer-window</span> (<span style="color:#00f">current-buffer</span>)) <span style="color:#19177c">vterm-window</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#00f">kill-buffer</span> (<span style="color:#00f">current-buffer</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">select-window</span> <span style="color:#19177c">vterm-window</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">vterm-other-window</span> <span style="color:#ba2121">&#34;vterm-subterminal&#34;</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">unless</span> <span style="color:#19177c">my/slow-ssh</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-nmap</span> <span style="color:#ba2121">&#34;`&#34;</span> <span style="color:#19177c">&#39;my/toggle-vterm-subteminal</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-nmap</span> <span style="color:#ba2121">&#34;~&#34;</span> <span style="color:#19177c">&#39;vterm</span>))
</span></span></code></pre></div><h5 id="dired-integration">Dired integration</h5>
<p>A function to get pwd for vterm. Couldn&rsquo;t find a built-in function for some reason, but this seems to be working fine:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/vterm-get-pwd</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">if</span> <span style="color:#19177c">vterm--process</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">file-truename</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;/proc/%d/cwd&#34;</span> (<span style="color:#00f">process-id</span> <span style="color:#19177c">vterm--process</span>)))
</span></span><span style="display:flex;"><span>    <span style="color:#19177c">default-directory</span>))
</span></span></code></pre></div><p>Now we can open dired for vterm pwd:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/vterm-dired-other-window</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Open dired in vterm pwd in other window&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">dired-other-window</span> (<span style="color:#19177c">my/vterm-get-pwd</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/vterm-dired-replace</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Replace vterm with dired&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">pwd</span> (<span style="color:#19177c">my/vterm-get-pwd</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">kill-process</span> <span style="color:#19177c">vterm--process</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">dired</span> <span style="color:#19177c">pwd</span>)))
</span></span></code></pre></div><p>The second function is particularly handy because that way I can alternate between vterm and dired.</p>
<p>Keybindings:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;vterm</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;vterm-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gd&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/vterm-dired-other-window</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gD&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/vterm-dired-replace</span>))
</span></span></code></pre></div><h5 id="with-editor-integration">With-editor integration</h5>
<p>A package used by Magit to use the current Emacs instance as the <code>$EDITOR</code>.</p>
<p>That is, with the help of <a href="/configs/console/#functions">this function</a>, I can just write <code>e &lt;filename&gt;</code>, edit the file, and then return to the same vterm buffer. No more running vim inside Emacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">with-editor</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">vterm</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;vterm-mode-hook</span> <span style="color:#19177c">&#39;with-editor-export-editor</span>))
</span></span></code></pre></div><h4 id="eshell">Eshell</h4>
<p>A shell written in Emacs lisp. I don&rsquo;t use it as of now, but keep the config just in case.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/configure-eshell</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;eshell-pre-command-hook</span> <span style="color:#19177c">&#39;eshell-save-some-history</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;eshell-output-filter-functions</span> <span style="color:#19177c">&#39;eshell-truncate-buffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">eshell-history-size</span> <span style="color:#666">10000</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">eshell-hist-ingnoredups</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">eshell-buffer-maximum-lines</span> <span style="color:#666">10000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-define-key</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#00f">insert</span> <span style="color:#19177c">visual</span>) <span style="color:#19177c">eshell-mode-map</span> (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;&lt;home&gt;&#34;</span>) <span style="color:#19177c">&#39;eshell-bol</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">evil-define-key</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span> <span style="color:#00f">insert</span> <span style="color:#19177c">visual</span>) <span style="color:#19177c">eshell-mode-map</span> (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;C-r&#34;</span>) <span style="color:#19177c">&#39;counsel-esh-history</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;eshell-mode-map</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;C-h&#34;</span>) <span style="color:#19177c">&#39;evil-window-left</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;C-l&#34;</span>) <span style="color:#19177c">&#39;evil-window-right</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;C-k&#34;</span>) <span style="color:#19177c">&#39;evil-window-up</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;C-j&#34;</span>) <span style="color:#19177c">&#39;evil-window-down</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">eshell</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:ensure</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">evil-collection</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">eshell</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/use-doom-colors</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">epe-pipeline-delimiter-face</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;green</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">epe-pipeline-host-face</span>      <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;blue</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">epe-pipeline-time-face</span>      <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">epe-pipeline-user-face</span>      <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;red</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;eshell-first-time-mode-hook</span> <span style="color:#19177c">&#39;my/configure-eshell</span> <span style="color:#666">90</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> <span style="color:#19177c">my/slow-ssh</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;eshell-mode-hook</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">setq-local</span> <span style="color:#19177c">company-idle-delay</span> <span style="color:#666">1000</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">eshell-banner-message</span> <span style="color:#ba2121">&#34;&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">aweshell</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;manateelazycat/aweshell&#34;</span> <span style="color:#008000">:host</span> <span style="color:#19177c">github</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">eshell</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/use-doom-colors</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">aweshell-alert-buffer-face</span>  <span style="color:#008000">:background</span> (<span style="color:#19177c">color-darken-name</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;bg</span>) <span style="color:#666">3</span>))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">aweshell-alert-command-face</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;red</span>) <span style="color:#008000">:weight</span> <span style="color:#19177c">&#39;bold</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">eshell-highlight-prompt</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">eshell-prompt-function</span> <span style="color:#19177c">&#39;epe-theme-pipeline</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">eshell-info-banner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/slow-ssh</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#19177c">eshell-info-banner</span> <span style="color:#008000">:type</span> <span style="color:#19177c">git</span>
</span></span><span style="display:flex;"><span>				<span style="color:#008000">:host</span> <span style="color:#19177c">github</span>
</span></span><span style="display:flex;"><span>				<span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;phundrak/eshell-info-banner.el&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">eshell-banner-load</span> <span style="color:#666">.</span> <span style="color:#19177c">eshell-info-banner-update-banner</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">when</span> <span style="color:#19177c">my/slow-ssh</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-nmap</span> <span style="color:#ba2121">&#34;`&#34;</span> <span style="color:#19177c">&#39;aweshell-dedicated-toggle</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-nmap</span> <span style="color:#ba2121">&#34;~&#34;</span> <span style="color:#19177c">&#39;eshell</span>))
</span></span></code></pre></div><h3 id="managing-dotfiles">Managing dotfiles</h3>
<p>A bunch of functions for managing dotfiles with yadm.</p>
<h4 id="open-emacs-config">Open Emacs config</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#408080;font-style:italic">;; &#34;C-c c&#34; (my/command-in-persp &#34;Emacs.org&#34; &#34;conf&#34; 1 (find-file &#34;~/Emacs.org&#34;))</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;C-c c&#34;</span> <span style="color:#666">`</span>(<span style="color:#666">,</span>(<span style="color:#008000">lambda</span> () (<span style="color:#008000">interactive</span>) (<span style="color:#19177c">find-file</span> <span style="color:#ba2121">&#34;~/Emacs.org&#34;</span>)) <span style="color:#008000">:wk</span> <span style="color:#ba2121">&#34;Emacs.org&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;c&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;configuration&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; &#34;c&#34; (my/command-in-persp &#34;Emacs.org&#34; &#34;conf&#34; 1 (find-file &#34;~/Emacs.org&#34;))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#666">`</span>(<span style="color:#666">,</span>(<span style="color:#008000">lambda</span> () (<span style="color:#008000">interactive</span>) (<span style="color:#19177c">find-file</span> <span style="color:#ba2121">&#34;~/Emacs.org&#34;</span>)) <span style="color:#008000">:wk</span> <span style="color:#ba2121">&#34;Emacs.org&#34;</span>))
</span></span></code></pre></div><h4 id="open-magit-for-yadm">Open Magit for yadm</h4>
<p>Idea:</p>
<ul>
<li><a href="https://www.reddit.com/r/emacs/comments/gjukb3/yadm_magit/">https://www.reddit.com/r/emacs/comments/gjukb3/yadm_magit/</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;tramp</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;tramp-methods</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#666">`</span>(<span style="color:#ba2121">&#34;yadm&#34;</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">tramp-login-program</span> <span style="color:#ba2121">&#34;yadm&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">tramp-login-args</span> ((<span style="color:#ba2121">&#34;enter&#34;</span>)))
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">tramp-login-env</span> ((<span style="color:#ba2121">&#34;SHELL&#34;</span>) <span style="color:#ba2121">&#34;/bin/sh&#34;</span>))
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">tramp-remote-shell</span> <span style="color:#ba2121">&#34;/bin/sh&#34;</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">tramp-remote-shell-args</span> (<span style="color:#ba2121">&#34;-c&#34;</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/yadm-magit</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">magit-status</span> <span style="color:#ba2121">&#34;/yadm::&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;cm&#34;</span> <span style="color:#19177c">&#39;my/yadm-magit</span>)
</span></span></code></pre></div><h4 id="open-a-dotfile">Open a dotfile</h4>
<p>Open a file managed by yadm.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/open-yadm-file</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Open a file managed by yadm&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">find-file</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">concat</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">file-name-as-directory</span> (<span style="color:#19177c">getenv</span> <span style="color:#ba2121">&#34;HOME&#34;</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">completing-read</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ba2121">&#34;yadm files: &#34;</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">split-string</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">shell-command-to-string</span> <span style="color:#ba2121">&#34;yadm ls-files $HOME --full-name&#34;</span>) <span style="color:#ba2121">&#34;\n&#34;</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;C-c f&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">my/open-yadm-file</span> <span style="color:#008000">:wk</span> <span style="color:#ba2121">&#34;yadm file&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;cf&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">my/open-yadm-file</span> <span style="color:#008000">:wk</span> <span style="color:#ba2121">&#34;yadm file&#34;</span>))
</span></span></code></pre></div><h3 id="elfeed">Elfeed</h3>
<p><a href="https://github.com/skeeto/elfeed">elfeed</a> is one of the most popular Emacs packages, and it&rsquo;s also one in which I ended up investing a lot of effort.</p>
<p>There&rsquo;s a lot of stuff in this section, so it&rsquo;s here and not in &ldquo;Internet and Multimedia&rdquo;.</p>
<h4 id="general-settings-4">General settings</h4>
<p>The advice there sets <code>shr-use-fonts</code> to nil while rendering HTML, so the <code>elfeed-show</code> buffer will use monospace font.</p>
<p>Using my own fork until the modifications are merged into master.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">elfeed</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;SqrtMinusOne/elfeed&#34;</span> <span style="color:#008000">:host</span> <span style="color:#19177c">github</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">elfeed</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;ae&#34;</span> (<span style="color:#19177c">my/command-in-persp</span> <span style="color:#ba2121">&#34;elfeed&#34;</span> <span style="color:#ba2121">&#34;elfeed&#34;</span> <span style="color:#666">0</span> (<span style="color:#19177c">elfeed-summary</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">elfeed-db-directory</span> <span style="color:#ba2121">&#34;~/.elfeed&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">elfeed-enclosure-default-dir</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;~/Downloads&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">elfeed-insert-html</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#008000">:around</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">lambda</span> (<span style="color:#19177c">fun</span> <span style="color:#008000">&amp;rest</span> <span style="color:#19177c">r</span>)
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">let</span> ((<span style="color:#19177c">shr-use-fonts</span> <span style="color:#800">nil</span>))
</span></span><span style="display:flex;"><span>		  (<span style="color:#00f">apply</span> <span style="color:#19177c">fun</span> <span style="color:#19177c">r</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;elfeed-search-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;o&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/elfeed-search-filter-source</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">elfeed-search-clear-filter</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gl&#34;</span> (<span style="color:#008000">lambda</span> () (<span style="color:#008000">interactive</span>) (<span style="color:#19177c">elfeed-search-set-filter</span> <span style="color:#ba2121">&#34;+later&#34;</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;elfeed-show-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;ge&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/elfeed-show-visit-eww</span>))
</span></span></code></pre></div><p><a href="https://github.com/remyhonig/elfeed-org">elfeed-org</a> allows configuring Elfeed feeds with an Org file.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">elfeed-org</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">elfeed</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">rmh-elfeed-org-files</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;~/.emacs.d/private.org&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">elfeed-org</span>))
</span></span></code></pre></div><h4 id="some-additions">Some additions</h4>
<p>Filter elfeed search buffer by the feed under the cursor.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/elfeed-search-filter-source</span> (<span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Filter elfeed search buffer by the feed under cursor.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> (<span style="color:#00f">list</span> (<span style="color:#19177c">elfeed-search-selected</span> <span style="color:#008000">:ignore-region</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#19177c">elfeed-entry-p</span> <span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">elfeed-search-set-filter</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">concat</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;@6-months-ago &#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;+unread &#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;=&#34;</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">replace-regexp-in-string</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;?&#34;</span> (<span style="color:#00f">*</span> <span style="color:#19177c">not-newline</span>) <span style="color:#19177c">eos</span>)
</span></span><span style="display:flex;"><span>       <span style="color:#ba2121">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">elfeed-feed-url</span> (<span style="color:#19177c">elfeed-entry-feed</span> <span style="color:#19177c">entry</span>)))))))
</span></span></code></pre></div><p>Open a URL with eww.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/elfeed-show-visit-eww</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Visit the current entry in eww&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">link</span> (<span style="color:#19177c">elfeed-entry-link</span> <span style="color:#19177c">elfeed-show-entry</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> <span style="color:#19177c">link</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">eww</span> <span style="color:#19177c">link</span>))))
</span></span></code></pre></div><h4 id="custom-faces">Custom faces</h4>
<p>Setting up custom faces for certain tags to make the feed look a bit nicer.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defface</span> <span style="color:#19177c">elfeed-videos-entry</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Face for the elfeed entries with tag \&#34;videos\&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defface</span> <span style="color:#19177c">elfeed-twitter-entry</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Face for the elfeed entries with tah \&#34;twitter\&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defface</span> <span style="color:#19177c">elfeed-emacs-entry</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Face for the elfeed entries with tah \&#34;emacs\&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defface</span> <span style="color:#19177c">elfeed-music-entry</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Face for the elfeed entries with tah \&#34;music\&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defface</span> <span style="color:#19177c">elfeed-podcasts-entry</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Face for the elfeed entries with tag \&#34;podcasts\&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defface</span> <span style="color:#19177c">elfeed-blogs-entry</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Face for the elfeed entries with tag \&#34;blogs\&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defface</span> <span style="color:#19177c">elfeed-govt-entry</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Face for the elfeed entries with tag \&#34;blogs\&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my/use-doom-colors</span>
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">elfeed-search-tag-face</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>))
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">elfeed-videos-entry</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;red</span>))
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">elfeed-twitter-entry</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;blue</span>))
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">elfeed-emacs-entry</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;magenta</span>))
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">elfeed-music-entry</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;green</span>))
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">elfeed-podcasts-entry</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>))
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">elfeed-blogs-entry</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;orange</span>))
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">elfeed-govt-entry</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;dark-cyan</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;elfeed</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">elfeed-search-face-alist</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">&#39;</span>((<span style="color:#19177c">podcasts</span> <span style="color:#19177c">elfeed-podcasts-entry</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">music</span> <span style="color:#19177c">elfeed-music-entry</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">gov</span> <span style="color:#19177c">elfeed-govt-entry</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">twitter</span> <span style="color:#19177c">elfeed-twitter-entry</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">videos</span> <span style="color:#19177c">elfeed-videos-entry</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">emacs</span> <span style="color:#19177c">elfeed-emacs-entry</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">blogs</span> <span style="color:#19177c">elfeed-blogs-entry</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">unread</span> <span style="color:#19177c">elfeed-search-unread-title-face</span>))))
</span></span></code></pre></div><p>Also, a function to automatically adjust these colors with the Doom theme.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/update-my-theme-elfeed</span> (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">_</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">custom-theme-set-faces</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">&#39;my-theme-1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#666">`</span>(<span style="color:#19177c">elfeed-videos-entry</span> ((<span style="color:#800">t</span> <span style="color:#008000">:foreground</span> <span style="color:#666">,</span>(<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;red</span>))))
</span></span><span style="display:flex;"><span>   <span style="color:#666">`</span>(<span style="color:#19177c">elfeed-twitter-entry</span> ((<span style="color:#800">t</span> <span style="color:#008000">:foreground</span> <span style="color:#666">,</span>(<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;blue</span>))))
</span></span><span style="display:flex;"><span>   <span style="color:#666">`</span>(<span style="color:#19177c">elfeed-emacs-entry</span> ((<span style="color:#800">t</span> <span style="color:#008000">:foreground</span> <span style="color:#666">,</span>(<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;magenta</span>))))
</span></span><span style="display:flex;"><span>   <span style="color:#666">`</span>(<span style="color:#19177c">elfeed-music-entry</span> ((<span style="color:#800">t</span> <span style="color:#008000">:foreground</span> <span style="color:#666">,</span>(<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;green</span>))))
</span></span><span style="display:flex;"><span>   <span style="color:#666">`</span>(<span style="color:#19177c">elfeed-podcasts-entry</span> ((<span style="color:#800">t</span> <span style="color:#008000">:foreground</span> <span style="color:#666">,</span>(<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;yellow</span>))))
</span></span><span style="display:flex;"><span>   <span style="color:#666">`</span>(<span style="color:#19177c">elfeed-blogs-entry</span> ((<span style="color:#800">t</span> <span style="color:#008000">:foreground</span> <span style="color:#666">,</span>(<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;orange</span>)))))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">enable-theme</span> <span style="color:#19177c">&#39;my-theme-1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;load-theme</span> <span style="color:#008000">:after</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/update-my-theme-elfeed</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">when</span> (<span style="color:#00f">fboundp</span> <span style="color:#19177c">&#39;doom-color</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/update-my-theme-elfeed</span>))
</span></span></code></pre></div><h4 id="elfeed-summary">elfeed-summary</h4>
<p><a href="https://github.com/SqrtMinusOne/elfeed-summary">elfeed-summary</a> is my package that provides a feed summary interface for elfeed.</p>
<p>The default interface of elfeed is just a list of all entries, so it gets hard to navigate when there are a lot of sources with varying frequencies of posts. This is my attempt to address this issue.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">elfeed-summary</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">elfeed-summary</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">elfeed-summary-filter-by-title</span> <span style="color:#800">t</span>))
</span></span></code></pre></div><h4 id="elfeed-sync">elfeed-sync</h4>
<p><a href="https://github.com/SqrtMinusOne/elfeed-sync">elfeed-sync</a> is my package to sync elfeed with <a href="https://tt-rss.org/">tt-rss</a>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">elfeed-sync</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;SqrtMinusOne/elfeed-sync&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> <span style="color:#19177c">elfeed</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">elfeed-sync-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">elfeed-sync-tt-rss-instance</span> <span style="color:#ba2121">&#34;https://sqrtminusone.xyz/tt-rss&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">elfeed-sync-tt-rss-login</span> <span style="color:#ba2121">&#34;sqrtminusone&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">elfeed-sync-tt-rss-password</span> (<span style="color:#19177c">my/password-store-get</span> <span style="color:#ba2121">&#34;Selfhosted/tt-rss&#34;</span>)))
</span></span></code></pre></div><h4 id="youtube-podcasts-and-emms">YouTube, podcasts &amp; EMMS</h4>
<p>Previously this block was opening MPV with <code>start-process</code>, but now I&rsquo;ve managed to hook up MPV with EMMS. So there is the EMMS+elfeed &ldquo;integration&rdquo;.</p>
<p>There are multiple kinds of entries that I want to be opened by EMMS. First, a function that returns a YouTube URL:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/get-youtube-url</span> (<span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">watch-id</span> (<span style="color:#19177c">cadr</span>
</span></span><span style="display:flex;"><span>		   (<span style="color:#00f">assoc</span> <span style="color:#ba2121">&#34;watch?v&#34;</span>
</span></span><span style="display:flex;"><span>			  (<span style="color:#19177c">url-parse-query-string</span>
</span></span><span style="display:flex;"><span>			   (<span style="color:#00f">substring</span>
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">url-filename</span>
</span></span><span style="display:flex;"><span>			     (<span style="color:#19177c">url-generic-parse-url</span> (<span style="color:#19177c">elfeed-entry-link</span> <span style="color:#19177c">entry</span>)))
</span></span><span style="display:flex;"><span>			    <span style="color:#666">1</span>))))))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> <span style="color:#19177c">watch-id</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;https://www.youtube.com/watch?v=&#34;</span> <span style="color:#19177c">watch-id</span>))))
</span></span></code></pre></div><p>Second, a function that returns a URL to an enclosure. This is generally how podcasts are distributed.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/get-enclosures-url</span> (<span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">caar</span> (<span style="color:#19177c">elfeed-entry-enclosures</span> <span style="color:#19177c">entry</span>)))
</span></span></code></pre></div><p>Now, a function to add a YouTube link with metadata from elfeed to EMMS.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;emms</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">define-emms-source</span> <span style="color:#19177c">elfeed</span> (<span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">let</span> ((<span style="color:#19177c">url</span> (<span style="color:#008000">or</span> (<span style="color:#19177c">my/get-enclosures-url</span> <span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>		   (<span style="color:#19177c">my/get-youtube-url</span> <span style="color:#19177c">entry</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">unless</span> <span style="color:#19177c">url</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#d2413a;font-weight:bold">error</span> <span style="color:#ba2121">&#34;URL not found&#34;</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">let</span> ((<span style="color:#19177c">track</span> (<span style="color:#19177c">emms-track</span> <span style="color:#19177c">&#39;url</span> <span style="color:#19177c">url</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">emms-track-set</span> <span style="color:#19177c">track</span> <span style="color:#19177c">&#39;info-title</span> (<span style="color:#19177c">elfeed-entry-title</span> <span style="color:#19177c">entry</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">emms-playlist-insert-track</span> <span style="color:#19177c">track</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/elfeed-add-emms</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">emms-add-elfeed</span> <span style="color:#19177c">elfeed-show-entry</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">elfeed-tag</span> <span style="color:#19177c">elfeed-show-entry</span> <span style="color:#19177c">&#39;watched</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">elfeed-show-refresh</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;elfeed</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;elfeed-show-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gm&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/elfeed-add-emms</span>))
</span></span></code></pre></div><h4 id="rdrview">rdrview</h4>
<p><a href="https://github.com/eafer/rdrview">rdrview</a> is a command-line tool to strip webpages from clutter, extracting only parts related to the actual content. It&rsquo;s a standalone port of the corresponding feature of Firefox, called <a href="https://support.mozilla.org/en-US/kb/firefox-reader-view-clutter-free-web-pages">Reader View</a>.</p>
<p>It seems like the tool <a href="https://repology.org/project/rdrview/versions">isn&rsquo;t available</a> in a whole lot of package repositories, but it&rsquo;s pretty easy to compile. I&rsquo;ve put together a <a href="https://github.com/SqrtMinusOne/channel-q/blob/master/rdrview.scm">Guix definition</a>, which <em>one day</em> I&rsquo;ll submit to upstream.</p>
<h5 id="integrating-rdrview-with-emacs">Integrating rdrview with Emacs</h5>
<p>Let&rsquo;s start by integrating <code>rdrview</code> with Emacs. In the general case, we want to fetch both metadata and the actual content from the page.</p>
<p>However, the interface of <code>rdrview</code> is a bit awkward in this part, so we have the following options:</p>
<ul>
<li>call <code>rdrview</code> two times: with <code>-M</code> flag to fetch the metadata, and without the flag to fetch the HTML;</li>
<li>call <code>rdrview</code> with <code>-T</code> flag to append the metadata to the resulting HTML.</li>
</ul>
<p>I&rsquo;ve decided to go with the second option. Here is a function that calls rdrview with the required flags:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/rdrview-get</span> (<span style="color:#19177c">url</span> <span style="color:#19177c">callback</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Get the rdrview representation of URL.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">Call CALLBACK with the output.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let*</span> ((<span style="color:#19177c">buffer</span> (<span style="color:#19177c">generate-new-buffer</span> <span style="color:#ba2121">&#34;rdrview&#34;</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">proc</span> (<span style="color:#00f">start-process</span> <span style="color:#ba2121">&#34;rdrview&#34;</span> <span style="color:#19177c">buffer</span> <span style="color:#ba2121">&#34;rdrview&#34;</span>
</span></span><span style="display:flex;"><span>			      <span style="color:#19177c">url</span> <span style="color:#ba2121">&#34;-T&#34;</span> <span style="color:#ba2121">&#34;title,sitename,body&#34;</span>
</span></span><span style="display:flex;"><span>			      <span style="color:#ba2121">&#34;-H&#34;</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">set-process-sentinel</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">proc</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">lambda</span> (<span style="color:#19177c">process</span> <span style="color:#19177c">_msg</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">let</span> ((<span style="color:#19177c">status</span> (<span style="color:#00f">process-status</span> <span style="color:#19177c">process</span>))
</span></span><span style="display:flex;"><span>	     (<span style="color:#19177c">code</span> (<span style="color:#00f">process-exit-status</span> <span style="color:#19177c">process</span>)))
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">cond</span> ((<span style="color:#008000">and</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">status</span> <span style="color:#19177c">&#39;exit</span>) (<span style="color:#00f">=</span> <span style="color:#19177c">code</span> <span style="color:#666">0</span>))
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>		  (<span style="color:#00f">funcall</span> <span style="color:#19177c">callback</span>
</span></span><span style="display:flex;"><span>			   (<span style="color:#008000">with-current-buffer</span> (<span style="color:#00f">process-buffer</span> <span style="color:#19177c">process</span>)
</span></span><span style="display:flex;"><span>			     (<span style="color:#00f">buffer-string</span>)))
</span></span><span style="display:flex;"><span>		  (<span style="color:#00f">kill-buffer</span> (<span style="color:#00f">process-buffer</span> <span style="color:#19177c">process</span>))) )
</span></span><span style="display:flex;"><span>	       ((<span style="color:#008000">or</span> (<span style="color:#008000">and</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">status</span> <span style="color:#19177c">&#39;exit</span>) (<span style="color:#00f">&gt;</span> <span style="color:#19177c">code</span> <span style="color:#666">0</span>))
</span></span><span style="display:flex;"><span>		    (<span style="color:#00f">eq</span> <span style="color:#19177c">status</span> <span style="color:#19177c">&#39;signal</span>))
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">let</span> ((<span style="color:#19177c">err</span> (<span style="color:#008000">with-current-buffer</span> (<span style="color:#00f">process-buffer</span> <span style="color:#19177c">process</span>)
</span></span><span style="display:flex;"><span>			     (<span style="color:#00f">buffer-string</span>))))
</span></span><span style="display:flex;"><span>		  (<span style="color:#00f">kill-buffer</span> (<span style="color:#00f">process-buffer</span> <span style="color:#19177c">process</span>))
</span></span><span style="display:flex;"><span>		  (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;Error in rdrview: %s&#34;</span> <span style="color:#19177c">err</span>)))))))
</span></span><span style="display:flex;"><span>    <span style="color:#19177c">proc</span>))
</span></span></code></pre></div><p>The function calls <code>callback</code> with the output of <code>rdrview</code>. This usually doesn&rsquo;t take long, but it&rsquo;s still nice to avoid freezing Emacs that way.</p>
<p>Now we have to parse the output. The <code>-T</code> flag puts the title in the <code>&lt;h1&gt;</code> tag, the site name site in the <code>&lt;h2&gt;</code> tag, and the content in a <code>&lt;div&gt;</code>. What&rsquo;s more, headers of the content are often shifted, e.g. the top-level header may well end up being and <code>&lt;h2&gt;</code> or <code>&lt;h3&gt;</code>, which does not look great in LaTeX.</p>
<p>With that said, here&rsquo;s a function that does the required changes:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/rdrview-parse</span> (<span style="color:#19177c">dom-string</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">dom</span> (<span style="color:#008000">with-temp-buffer</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#00f">insert</span> <span style="color:#19177c">dom-string</span>)
</span></span><span style="display:flex;"><span>	       (<span style="color:#00f">libxml-parse-html-region</span> (<span style="color:#00f">point-min</span>) (<span style="color:#00f">point-max</span>)))))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">let</span> (<span style="color:#19177c">title</span> <span style="color:#19177c">sitename</span> <span style="color:#19177c">content</span> (<span style="color:#19177c">i</span> <span style="color:#666">0</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">dolist</span> (<span style="color:#19177c">child</span> (<span style="color:#19177c">dom-children</span> (<span style="color:#00f">car</span> (<span style="color:#19177c">dom-by-id</span> <span style="color:#19177c">dom</span> <span style="color:#ba2121">&#34;readability-page-1&#34;</span>))))
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">when</span> (<span style="color:#00f">listp</span> <span style="color:#19177c">child</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">cond</span>
</span></span><span style="display:flex;"><span>	   ((<span style="color:#00f">eq</span> (<span style="color:#00f">car</span> <span style="color:#19177c">child</span>) <span style="color:#19177c">&#39;h1</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">setq</span> <span style="color:#19177c">title</span> (<span style="color:#19177c">dom-text</span> <span style="color:#19177c">child</span>)))
</span></span><span style="display:flex;"><span>	   ((<span style="color:#00f">eq</span> (<span style="color:#00f">car</span> <span style="color:#19177c">child</span>) <span style="color:#19177c">&#39;h2</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">setq</span> <span style="color:#19177c">sitename</span> (<span style="color:#19177c">dom-text</span> <span style="color:#19177c">child</span>)))
</span></span><span style="display:flex;"><span>	   ((<span style="color:#00f">eq</span> (<span style="color:#00f">car</span> <span style="color:#19177c">child</span>) <span style="color:#19177c">&#39;div</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">setq</span> <span style="color:#19177c">content</span> <span style="color:#19177c">child</span>)))))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">while</span> (<span style="color:#008000">and</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">not</span> (<span style="color:#19177c">dom-by-tag</span> <span style="color:#19177c">content</span> <span style="color:#19177c">&#39;h1</span>))
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">dom-search</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#19177c">content</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#008000">lambda</span> (<span style="color:#19177c">el</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#008000">when</span> (<span style="color:#00f">listp</span> <span style="color:#19177c">el</span>)
</span></span><span style="display:flex;"><span>		   (<span style="color:#008000">pcase</span> (<span style="color:#00f">car</span> <span style="color:#19177c">el</span>)
</span></span><span style="display:flex;"><span>		     (<span style="color:#19177c">&#39;h2</span> (<span style="color:#008000">setf</span> (<span style="color:#00f">car</span> <span style="color:#19177c">el</span>) <span style="color:#19177c">&#39;h1</span>))
</span></span><span style="display:flex;"><span>		     (<span style="color:#19177c">&#39;h3</span> (<span style="color:#008000">setf</span> (<span style="color:#00f">car</span> <span style="color:#19177c">el</span>) <span style="color:#19177c">&#39;h2</span>))
</span></span><span style="display:flex;"><span>		     (<span style="color:#19177c">&#39;h4</span> (<span style="color:#008000">setf</span> (<span style="color:#00f">car</span> <span style="color:#19177c">el</span>) <span style="color:#19177c">&#39;h3</span>))
</span></span><span style="display:flex;"><span>		     (<span style="color:#19177c">&#39;h5</span> (<span style="color:#008000">setf</span> (<span style="color:#00f">car</span> <span style="color:#19177c">el</span>) <span style="color:#19177c">&#39;h4</span>))
</span></span><span style="display:flex;"><span>		     (<span style="color:#19177c">&#39;h6</span> (<span style="color:#008000">setf</span> (<span style="color:#00f">car</span> <span style="color:#19177c">el</span>) <span style="color:#19177c">&#39;h5</span>))))))))
</span></span><span style="display:flex;"><span>      <span style="color:#666">`</span>((<span style="color:#19177c">title</span> <span style="color:#666">.</span> <span style="color:#666">,</span><span style="color:#19177c">title</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">sitename</span> <span style="color:#666">.</span> <span style="color:#666">,</span><span style="color:#19177c">sitename</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">content</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#008000">with-temp-buffer</span>
</span></span><span style="display:flex;"><span>		      (<span style="color:#19177c">dom-print</span> <span style="color:#19177c">content</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#00f">buffer-string</span>)))))))
</span></span></code></pre></div><h5 id="using-rdrview-from-elfeed">Using rdrview from elfeed</h5>
<p>Because I didn&rsquo;t find a smart way to advise the desired behavior into elfeed, here&rsquo;s a modification of the <code>elfeed-show-refresh--mail-style</code> function with two changes:</p>
<ul>
<li>it uses <code>rdrview</code> to fetch the HTML;</li>
<li>it saves the resulting HTML into a buffer-local variable (we&rsquo;ll need that later).</li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defvar-local</span> <span style="color:#19177c">my/elfeed-show-rdrview-html</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/rdrview-elfeed-show</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> <span style="color:#19177c">elfeed-show-entry</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;No elfeed entry in this buffer!&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/rdrview-get</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">elfeed-entry-link</span> <span style="color:#19177c">elfeed-show-entry</span>)
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">result</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">let*</span> ((<span style="color:#19177c">data</span> (<span style="color:#19177c">my/rdrview-parse</span> <span style="color:#19177c">result</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">inhibit-read-only</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">title</span> (<span style="color:#19177c">elfeed-entry-title</span> <span style="color:#19177c">elfeed-show-entry</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">date</span> (<span style="color:#19177c">seconds-to-time</span> (<span style="color:#19177c">elfeed-entry-date</span> <span style="color:#19177c">elfeed-show-entry</span>)))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">authors</span> (<span style="color:#19177c">elfeed-meta</span> <span style="color:#19177c">elfeed-show-entry</span> <span style="color:#008000">:authors</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">link</span> (<span style="color:#19177c">elfeed-entry-link</span> <span style="color:#19177c">elfeed-show-entry</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">tags</span> (<span style="color:#19177c">elfeed-entry-tags</span> <span style="color:#19177c">elfeed-show-entry</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">tagsstr</span> (<span style="color:#00f">mapconcat</span> <span style="color:#00f">#&#39;symbol-name</span> <span style="color:#19177c">tags</span> <span style="color:#ba2121">&#34;, &#34;</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">nicedate</span> (<span style="color:#00f">format-time-string</span> <span style="color:#ba2121">&#34;%a, %e %b %Y %T %Z&#34;</span> <span style="color:#19177c">date</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">content</span> (<span style="color:#19177c">alist-get</span> <span style="color:#19177c">&#39;content</span> <span style="color:#19177c">data</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">feed</span> (<span style="color:#19177c">elfeed-entry-feed</span> <span style="color:#19177c">elfeed-show-entry</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">feed-title</span> (<span style="color:#19177c">elfeed-feed-title</span> <span style="color:#19177c">feed</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">base</span> (<span style="color:#008000">and</span> <span style="color:#19177c">feed</span> (<span style="color:#19177c">elfeed-compute-base</span> (<span style="color:#19177c">elfeed-feed-url</span> <span style="color:#19177c">feed</span>)))))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">erase-buffer</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">insert</span> (<span style="color:#00f">format</span> (<span style="color:#00f">propertize</span> <span style="color:#ba2121">&#34;Title: %s\n&#34;</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-name</span>)
</span></span><span style="display:flex;"><span>		       (<span style="color:#00f">propertize</span> <span style="color:#19177c">title</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-subject</span>)))
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">when</span> <span style="color:#19177c">elfeed-show-entry-author</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">dolist</span> (<span style="color:#19177c">author</span> <span style="color:#19177c">authors</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">let</span> ((<span style="color:#19177c">formatted</span> (<span style="color:#19177c">elfeed--show-format-author</span> <span style="color:#19177c">author</span>)))
</span></span><span style="display:flex;"><span>	     (<span style="color:#00f">insert</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">format</span> (<span style="color:#00f">propertize</span> <span style="color:#ba2121">&#34;Author: %s\n&#34;</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-name</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#00f">propertize</span> <span style="color:#19177c">formatted</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-to</span>))))))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">insert</span> (<span style="color:#00f">format</span> (<span style="color:#00f">propertize</span> <span style="color:#ba2121">&#34;Date: %s\n&#34;</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-name</span>)
</span></span><span style="display:flex;"><span>		       (<span style="color:#00f">propertize</span> <span style="color:#19177c">nicedate</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-other</span>)))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">insert</span> (<span style="color:#00f">format</span> (<span style="color:#00f">propertize</span> <span style="color:#ba2121">&#34;Feed: %s\n&#34;</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-name</span>)
</span></span><span style="display:flex;"><span>		       (<span style="color:#00f">propertize</span> <span style="color:#19177c">feed-title</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-other</span>)))
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">when</span> <span style="color:#19177c">tags</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#00f">insert</span> (<span style="color:#00f">format</span> (<span style="color:#00f">propertize</span> <span style="color:#ba2121">&#34;Tags: %s\n&#34;</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-name</span>)
</span></span><span style="display:flex;"><span>			 (<span style="color:#00f">propertize</span> <span style="color:#19177c">tagsstr</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-other</span>))))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">insert</span> (<span style="color:#00f">propertize</span> <span style="color:#ba2121">&#34;Link: &#34;</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-name</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">elfeed-insert-link</span> <span style="color:#19177c">link</span> <span style="color:#19177c">link</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">insert</span> <span style="color:#ba2121">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">enclosure</span> <span style="color:#19177c">in</span> (<span style="color:#19177c">elfeed-entry-enclosures</span> <span style="color:#19177c">elfeed-show-entry</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#008000">do</span> (<span style="color:#00f">insert</span> (<span style="color:#00f">propertize</span> <span style="color:#ba2121">&#34;Enclosure: &#34;</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;message-header-name</span>))
</span></span><span style="display:flex;"><span>		<span style="color:#008000">do</span> (<span style="color:#19177c">elfeed-insert-link</span> (<span style="color:#00f">car</span> <span style="color:#19177c">enclosure</span>))
</span></span><span style="display:flex;"><span>		<span style="color:#008000">do</span> (<span style="color:#00f">insert</span> <span style="color:#ba2121">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">insert</span> <span style="color:#ba2121">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">if</span> <span style="color:#19177c">content</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">elfeed-insert-html</span> <span style="color:#19177c">content</span> <span style="color:#19177c">base</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#00f">insert</span> (<span style="color:#00f">propertize</span> <span style="color:#ba2121">&#34;(empty)\n&#34;</span> <span style="color:#19177c">&#39;face</span> <span style="color:#19177c">&#39;italic</span>)))
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">setq-local</span> <span style="color:#19177c">my/elfeed-show-rdrview-html</span> <span style="color:#19177c">content</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">goto-char</span> (<span style="color:#00f">point-min</span>))))))
</span></span></code></pre></div><p>That way, calling <code>M-x my/rdrview-elfeed-show</code> replaces the original content with one from <code>rdrview</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;elfeed</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;elfeed-show-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gp&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/rdrview-elfeed-show</span>))
</span></span></code></pre></div><h5 id="how-well-does-it-work">How well does it work?</h5>
<p>Rather ironically, it works well with sites that already ship with proper RSS, like <a href="https://protesilaos.com/">Protesilaos Stavrou&rsquo;s</a> or <a href="https://karthinks.com/software/simple-folding-with-hideshow/">Karthik Chikmagalur&rsquo;s</a> blogs or <a href="https://www.theatlantic.com/world/">The Atlantic</a> magazine.</p>
<p>Of my other subscriptions, it does a pretty good job with <a href="https://www.theverge.com/">The Verge</a>, which by default sends entries truncated by the words &ldquo;Read the full article&rdquo;. For <a href="https://arstechnica.com/">Ars Technica</a>, it works only if the story is not large enough, otherwise the site returns its HTML-based pagination interface.</p>
<p>For paywalled sites such as <a href="https://www.nytimes.com/">New York Times</a> or <a href="https://www.economist.com/">The Economist</a>, this usually doesn&rsquo;t work (by the way, what&rsquo;s the problem with providing individual RSS feeds for subscribers?). If you need this kind of thing, I&rsquo;d suggest using the <a href="https://github.com/RSS-Bridge/rss-bridge">RSS-Bridge</a> project. And if something is not available, contributing business logic there definitely makes more sense than implementing workarounds in Emacs Lisp.</p>
<h4 id="latex-and-pandoc">LaTeX and pandoc</h4>
<p>However, I also find that I&rsquo;m not really a fan of reading articles from Emacs. Somehow what works for program code doesn&rsquo;t work that well for natural text. When I have to, I usually switch the Emacs theme to a light one.</p>
<p>But the best solution I&rsquo;ve found so far is to render the required articles as PDFs. I may even print out some large articles I want to read.</p>
<h5 id="template">Template</h5>
<p>So first, we need a LaTeX template. Pandoc already ships with one, but I don&rsquo;t like it too much, so I&rsquo;ve put up a template from my LaTeX styles, targeting my preferred XeLaTeX engine.</p>
<p>The code for the template is available <a href=".emacs.d/rdrview.tex">dotfiles repo</a>. If you use LaTeX, you&rsquo;ll probably be better off using your own setup. Be sure to define the following variables:</p>
<ul>
<li><code>main-lang</code> and <code>other-lang</code> for polyglossia (or remove them if you have only one language)</li>
<li><code>title</code></li>
<li><code>subtitle</code></li>
<li><code>author</code></li>
<li><code>date</code></li>
</ul>
<h5 id="invoking-pandoc">Invoking pandoc</h5>
<p>Now that we have the template, let&rsquo;s save it somewhere and store the path to a variable:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/rdrview-template</span> (<span style="color:#00f">expand-file-name</span>
</span></span><span style="display:flex;"><span>			   (<span style="color:#00f">concat</span> <span style="color:#19177c">user-emacs-directory</span> <span style="color:#ba2121">&#34;rdrview.tex&#34;</span>)))
</span></span></code></pre></div><p>And let&rsquo;s invoke pandoc. We need to pass the following flags:</p>
<ul>
<li><code>--pdf-engine=xelatex</code>, of course</li>
<li><code>--template &lt;path-to-template&gt;</code>;</li>
<li><code>-o &lt;path-to-pdf&gt;</code>;</li>
<li><code>--variable key=value</code>.</li>
</ul>
<p>In fact, pandoc is a pretty awesome tool in the sense that it allows for feeding custom variables to rich-language templates.</p>
<p>So, the rendering function is as follows:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">cl-defun</span> <span style="color:#19177c">my/rdrview-render</span> (<span style="color:#19177c">content</span> <span style="color:#19177c">type</span> <span style="color:#19177c">variables</span> <span style="color:#19177c">callback</span>
</span></span><span style="display:flex;"><span>				     <span style="color:#008000">&amp;key</span> <span style="color:#19177c">file-name</span> <span style="color:#19177c">overwrite</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Render CONTENT with pandoc.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">TYPE is a file extension as supported by pandoc, for instance,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">html or txt.  VARIABLES is an alist that is fed into the
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">template.  After the rendering is complete successfully, CALLBACK
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">is called with the resulting PDF.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">FILE-NAME is a path to the resulting PDF. If nil it&#39;s generated
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">randomly.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">If a file with the given FILE-NAME already exists, the function will
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">invoke CALLBACK straight away without doing the rendering, unless
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">OVERWRITE is non-nil.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> <span style="color:#19177c">file-name</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq</span> <span style="color:#19177c">file-name</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;/tmp/%d.pdf&#34;</span> (<span style="color:#00f">random</span> <span style="color:#666">100000000</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> (<span style="color:#19177c">params</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">temp-file-name</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;/tmp/%d.%s&#34;</span> (<span style="color:#00f">random</span> <span style="color:#666">100000000</span>) <span style="color:#19177c">type</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> (<span style="color:#19177c">key</span> <span style="color:#666">.</span> <span style="color:#19177c">value</span>) <span style="color:#19177c">in</span> <span style="color:#19177c">variables</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#008000">when</span> <span style="color:#19177c">value</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#008000">do</span> (<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>		  (<span style="color:#008000">push</span> <span style="color:#ba2121">&#34;--variable&#34;</span> <span style="color:#19177c">params</span>)
</span></span><span style="display:flex;"><span>		  (<span style="color:#008000">push</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;%s=%s&#34;</span> <span style="color:#19177c">key</span> <span style="color:#19177c">value</span>) <span style="color:#19177c">params</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq</span> <span style="color:#19177c">params</span> (<span style="color:#00f">nreverse</span> <span style="color:#19177c">params</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> (<span style="color:#008000">and</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#19177c">file-name</span>) (<span style="color:#19177c">not</span> <span style="color:#19177c">overwrite</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">funcall</span> <span style="color:#19177c">callback</span> <span style="color:#19177c">file-name</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">with-temp-file</span> <span style="color:#19177c">temp-file-name</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">insert</span> <span style="color:#19177c">content</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">let</span> ((<span style="color:#19177c">proc</span> (<span style="color:#00f">apply</span> <span style="color:#00f">#&#39;start-process</span>
</span></span><span style="display:flex;"><span>			 <span style="color:#ba2121">&#34;pandoc&#34;</span> (<span style="color:#00f">get-buffer-create</span> <span style="color:#ba2121">&#34;*Pandoc*&#34;</span>) <span style="color:#ba2121">&#34;pandoc&#34;</span>
</span></span><span style="display:flex;"><span>			 <span style="color:#19177c">temp-file-name</span> <span style="color:#ba2121">&#34;-o&#34;</span> <span style="color:#19177c">file-name</span>
</span></span><span style="display:flex;"><span>			 <span style="color:#ba2121">&#34;--pdf-engine=xelatex&#34;</span> <span style="color:#ba2121">&#34;--template&#34;</span> <span style="color:#19177c">my/rdrview-template</span>
</span></span><span style="display:flex;"><span>			 <span style="color:#19177c">params</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">set-process-sentinel</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#19177c">proc</span>
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">lambda</span> (<span style="color:#19177c">process</span> <span style="color:#19177c">_msg</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">let</span> ((<span style="color:#19177c">status</span> (<span style="color:#00f">process-status</span> <span style="color:#19177c">process</span>))
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">code</span> (<span style="color:#00f">process-exit-status</span> <span style="color:#19177c">process</span>)))
</span></span><span style="display:flex;"><span>	     (<span style="color:#008000">cond</span> ((<span style="color:#008000">and</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">status</span> <span style="color:#19177c">&#39;exit</span>) (<span style="color:#00f">=</span> <span style="color:#19177c">code</span> <span style="color:#666">0</span>))
</span></span><span style="display:flex;"><span>		    (<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>		      (<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;Done!&#34;</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#00f">funcall</span> <span style="color:#19177c">callback</span> <span style="color:#19177c">file-name</span>)))
</span></span><span style="display:flex;"><span>		   ((<span style="color:#008000">or</span> (<span style="color:#008000">and</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">status</span> <span style="color:#19177c">&#39;exit</span>) (<span style="color:#00f">&gt;</span> <span style="color:#19177c">code</span> <span style="color:#666">0</span>))
</span></span><span style="display:flex;"><span>			(<span style="color:#00f">eq</span> <span style="color:#19177c">status</span> <span style="color:#19177c">&#39;signal</span>))
</span></span><span style="display:flex;"><span>		    (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;Error in pandoc. Check the *Pandoc* buffer&#34;</span>))))))))))
</span></span></code></pre></div><h5 id="opening-elfeed-entries">Opening elfeed entries</h5>
<p>Now we have everything required to open elfeed entries.</p>
<p>Also, in my case elfeed entries come in two languages, so I have to set <code>main-lang</code> and <code>other-lang</code> variables accordingly. Here&rsquo;s the main function:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/elfeed-pdf-dir</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;~/.elfeed/pdf/&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/elfeed-open-pdf</span> (<span style="color:#19177c">entry</span> <span style="color:#19177c">overwrite</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Open the current elfeed ENTRY with a pdf viewer.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">If OVERWRITE is non-nil, do the rendering even if the resulting
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">PDF already exists.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> (<span style="color:#00f">list</span> <span style="color:#19177c">elfeed-show-entry</span> <span style="color:#19177c">current-prefix-arg</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">authors</span> (<span style="color:#00f">mapcar</span> (<span style="color:#008000">lambda</span> (<span style="color:#19177c">m</span>) (<span style="color:#00f">plist-get</span> <span style="color:#19177c">m</span> <span style="color:#008000">:name</span>)) (<span style="color:#19177c">elfeed-meta</span> <span style="color:#19177c">entry</span> <span style="color:#008000">:authors</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">feed-title</span> (<span style="color:#19177c">elfeed-feed-title</span> (<span style="color:#19177c">elfeed-entry-feed</span> <span style="color:#19177c">entry</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">tags</span> (<span style="color:#00f">mapconcat</span> <span style="color:#00f">#&#39;symbol-name</span> (<span style="color:#19177c">elfeed-entry-tags</span> <span style="color:#19177c">entry</span>) <span style="color:#ba2121">&#34;, &#34;</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">date</span> (<span style="color:#00f">format-time-string</span> <span style="color:#ba2121">&#34;%a, %e %b %Y&#34;</span>
</span></span><span style="display:flex;"><span>				  (<span style="color:#19177c">seconds-to-time</span> (<span style="color:#19177c">elfeed-entry-date</span> <span style="color:#19177c">entry</span>))))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">content</span> (<span style="color:#19177c">elfeed-deref</span> (<span style="color:#19177c">elfeed-entry-content</span> <span style="color:#19177c">entry</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">file-name</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">my/elfeed-pdf-dir</span>
</span></span><span style="display:flex;"><span>			   (<span style="color:#19177c">elfeed-ref-id</span> (<span style="color:#19177c">elfeed-entry-content</span> <span style="color:#19177c">entry</span>))
</span></span><span style="display:flex;"><span>			   <span style="color:#ba2121">&#34;.pdf&#34;</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">main-language</span> <span style="color:#ba2121">&#34;english&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">other-language</span> <span style="color:#ba2121">&#34;russian&#34;</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">unless</span> <span style="color:#19177c">content</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;No content!&#34;</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq</span> <span style="color:#19177c">subtitle</span>
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">cond</span>
</span></span><span style="display:flex;"><span>	   ((<span style="color:#19177c">seq-empty-p</span> <span style="color:#19177c">authors</span>) <span style="color:#19177c">feed-title</span>)
</span></span><span style="display:flex;"><span>	   ((<span style="color:#008000">and</span> (<span style="color:#19177c">not</span> (<span style="color:#19177c">seq-empty-p</span> (<span style="color:#00f">car</span> <span style="color:#19177c">authors</span>)))
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">string-match-p</span> (<span style="color:#00f">regexp-quote</span> (<span style="color:#00f">car</span> <span style="color:#19177c">authors</span>)) <span style="color:#19177c">feed-title</span>)) <span style="color:#19177c">feed-title</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#800">t</span> (<span style="color:#00f">concat</span> (<span style="color:#19177c">string-join</span> <span style="color:#19177c">authors</span> <span style="color:#ba2121">&#34;, &#34;</span>) <span style="color:#ba2121">&#34;\\\\&#34;</span> <span style="color:#19177c">feed-title</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> (<span style="color:#00f">member</span> <span style="color:#19177c">&#39;ru</span> (<span style="color:#19177c">elfeed-entry-tags</span> <span style="color:#19177c">entry</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">setq</span> <span style="color:#19177c">main-language</span> <span style="color:#ba2121">&#34;russian&#34;</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">setq</span> <span style="color:#19177c">other-language</span> <span style="color:#ba2121">&#34;english&#34;</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/rdrview-render</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">if</span> (<span style="color:#19177c">bound-and-true-p</span> <span style="color:#19177c">my/elfeed-show-rdrview-html</span>)
</span></span><span style="display:flex;"><span>	 <span style="color:#19177c">my/elfeed-show-rdrview-html</span>
</span></span><span style="display:flex;"><span>       <span style="color:#19177c">content</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">elfeed-entry-content-type</span> <span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#666">`</span>((<span style="color:#19177c">title</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#19177c">elfeed-entry-title</span> <span style="color:#19177c">entry</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">subtitle</span> <span style="color:#666">.</span> <span style="color:#666">,</span><span style="color:#19177c">subtitle</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">date</span> <span style="color:#666">.</span> <span style="color:#666">,</span><span style="color:#19177c">date</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">tags</span> <span style="color:#666">.</span> <span style="color:#666">,</span><span style="color:#19177c">tags</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">main-lang</span> <span style="color:#666">.</span> <span style="color:#666">,</span><span style="color:#19177c">main-language</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">other-lang</span> <span style="color:#666">.</span> <span style="color:#666">,</span><span style="color:#19177c">other-language</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file-name</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#00f">start-process</span> <span style="color:#ba2121">&#34;xdg-open&#34;</span> <span style="color:#800">nil</span> <span style="color:#ba2121">&#34;xdg-open&#34;</span> <span style="color:#19177c">file-name</span>))
</span></span><span style="display:flex;"><span>     <span style="color:#008000">:file-name</span> <span style="color:#19177c">file-name</span>
</span></span><span style="display:flex;"><span>     <span style="color:#008000">:overwrite</span> <span style="color:#19177c">current-prefix-arg</span>)))
</span></span></code></pre></div><p>If the <code>my/elfeed-show-rdrview-html</code> variable is bound and true, then the content in this buffer was retrieved via <code>rdrview</code>, so we&rsquo;ll use that instead of the output of <code>elfeed-deref</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;elfeed</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">elfeed-show-mode-map</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gv&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/elfeed-open-pdf</span>))
</span></span></code></pre></div><p>Now we can open elfeed entries in a PDF viewer, which I find much nicer to read. Given that RSS feeds generally ship with simpler HTML than the regular websites, results usually look awesome.</p>
<h5 id="opening-arbitrary-sites">Opening arbitrary sites</h5>
<p>As you may have noticed, we also can display arbitrary web pages with this setup, so let&rsquo;s go ahead and implement that:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/get-languages</span> (<span style="color:#19177c">url</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">main-lang</span> <span style="color:#ba2121">&#34;english&#34;</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">other-lang</span> <span style="color:#ba2121">&#34;russian&#34;</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> (<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;.ru&#34;</span>) <span style="color:#19177c">url</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">setq</span> <span style="color:#19177c">main-lang</span> <span style="color:#ba2121">&#34;russian&#34;</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#19177c">other-lang</span> <span style="color:#ba2121">&#34;english&#34;</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">list</span> <span style="color:#19177c">main-lang</span> <span style="color:#19177c">other-lang</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/rdrview-open</span> (<span style="color:#19177c">url</span> <span style="color:#19177c">overwrite</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">let</span> ((<span style="color:#19177c">url</span> (<span style="color:#00f">read-from-minibuffer</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#ba2121">&#34;URL: &#34;</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#008000">if</span> (<span style="color:#19177c">bound-and-true-p</span> <span style="color:#19177c">elfeed-show-entry</span>)
</span></span><span style="display:flex;"><span>		   (<span style="color:#19177c">elfeed-entry-link</span> <span style="color:#19177c">elfeed-show-entry</span>)))))
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">when</span> (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">url</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;URL is empty&#34;</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#00f">list</span> <span style="color:#19177c">url</span> <span style="color:#19177c">current-prefix-arg</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/rdrview-get</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">url</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">res</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">let</span> ((<span style="color:#19177c">data</span> (<span style="color:#19177c">my/rdrview-parse</span> <span style="color:#19177c">res</span>))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">langs</span> (<span style="color:#19177c">my/get-languages</span> <span style="color:#19177c">url</span>)))
</span></span><span style="display:flex;"><span>       (<span style="color:#19177c">my/rdrview-render</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">alist-get</span> <span style="color:#19177c">&#39;content</span> <span style="color:#19177c">data</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#19177c">&#39;html</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">`</span>((<span style="color:#19177c">title</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#19177c">alist-get</span> <span style="color:#19177c">&#39;title</span> <span style="color:#19177c">data</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">subtitle</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#19177c">alist-get</span> <span style="color:#19177c">&#39;sitename</span> <span style="color:#19177c">data</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">main-lang</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#00f">nth</span> <span style="color:#666">0</span> <span style="color:#19177c">langs</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">other-lang</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#00f">nth</span> <span style="color:#666">1</span> <span style="color:#19177c">langs</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">lambda</span> (<span style="color:#19177c">file-name</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#00f">start-process</span> <span style="color:#ba2121">&#34;xdg-open&#34;</span> <span style="color:#800">nil</span> <span style="color:#ba2121">&#34;xdg-open&#34;</span> <span style="color:#19177c">file-name</span>)))))))
</span></span></code></pre></div><p>Unfortunately, this part doesn&rsquo;t work that well, so we can&rsquo;t just uninstall Firefox or Chromium and browse the web from a PDF viewer.</p>
<p>The most common problem I&rsquo;ve encountered is incorrectly formed pictures, such as <code>.png</code> files without the boundary info. I&rsquo;m sure you&rsquo;ve also come across this if you ever tried to insert a lot of Internet pictures into a LaTeX document.</p>
<p>However, sans the pictures issue, for certain sites like Wikipedia this is usable.</p>
<h4 id="youtube-transcripts">YouTube transcripts</h4>
<h5 id="getting-subtitles">Getting subtitles</h5>
<p>Finally, let&rsquo;s get to transcripts.</p>
<p>In principle, the YouTube API allows for downloading subtitles, but I&rsquo;ve found <a href="https://github.com/jdepoix/youtube-transcript-api">this awesome Python script</a> which does the same. You can install it from <code>pip</code>, or here&rsquo;s mine <a href="https://github.com/SqrtMinusOne/channel-q/blob/master/youtube-transcript-api.scm">Guix definition</a> once again.</p>
<p>Much like the previous cases, we need to invoke the program and save the output. The <a href="https://en.wikipedia.org/wiki/WebVTT">WebVTT</a> format will work well enough for our purposes. Here comes the function:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">cl-defun</span> <span style="color:#19177c">my/youtube-subtitles-get</span> (<span style="color:#19177c">video-id</span> <span style="color:#19177c">callback</span> <span style="color:#008000">&amp;key</span> <span style="color:#19177c">file-name</span> <span style="color:#19177c">overwrite</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Get subtitles for VIDEO-ID in WebVTT format.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">Call CALLBACK when done.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">FILE-NAME is a path to the resulting WebVTT file. If nil it&#39;s
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">generated randomly.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">If a file with the given FILE-NAME already exists, the function will
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">invoke CALLBACK straight away without doing the rendering, unless
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">OVERWRITE is non-nil.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> <span style="color:#19177c">file-name</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq</span> <span style="color:#19177c">file-name</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;/tmp/%d.vtt&#34;</span> (<span style="color:#00f">random</span> <span style="color:#666">100000000</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">if</span> (<span style="color:#008000">and</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#19177c">file-name</span>) (<span style="color:#19177c">not</span> <span style="color:#19177c">overwrite</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">funcall</span> <span style="color:#19177c">callback</span> <span style="color:#19177c">file-name</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">let*</span> ((<span style="color:#19177c">buffer</span> (<span style="color:#19177c">generate-new-buffer</span> <span style="color:#ba2121">&#34;youtube-transcripts&#34;</span>))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">proc</span> (<span style="color:#00f">start-process</span> <span style="color:#ba2121">&#34;youtube_transcript_api&#34;</span> <span style="color:#19177c">buffer</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;youtube_transcript_api&#34;</span> <span style="color:#19177c">video-id</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;--languages&#34;</span> <span style="color:#ba2121">&#34;en&#34;</span> <span style="color:#ba2121">&#34;ru&#34;</span> <span style="color:#ba2121">&#34;de&#34;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;--format&#34;</span> <span style="color:#ba2121">&#34;webvtt&#34;</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">set-process-sentinel</span>
</span></span><span style="display:flex;"><span>       <span style="color:#19177c">proc</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">lambda</span> (<span style="color:#19177c">process</span> <span style="color:#19177c">_msg</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">let</span> ((<span style="color:#19177c">status</span> (<span style="color:#00f">process-status</span> <span style="color:#19177c">process</span>))
</span></span><span style="display:flex;"><span>	       (<span style="color:#19177c">code</span> (<span style="color:#00f">process-exit-status</span> <span style="color:#19177c">process</span>)))
</span></span><span style="display:flex;"><span>	   (<span style="color:#008000">cond</span> ((<span style="color:#008000">and</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">status</span> <span style="color:#19177c">&#39;exit</span>) (<span style="color:#00f">=</span> <span style="color:#19177c">code</span> <span style="color:#666">0</span>))
</span></span><span style="display:flex;"><span>		  (<span style="color:#008000">progn</span>
</span></span><span style="display:flex;"><span>		    (<span style="color:#008000">with-current-buffer</span> (<span style="color:#00f">process-buffer</span> <span style="color:#19177c">process</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#008000">setq</span> <span style="color:#00f">buffer-file-name</span> <span style="color:#19177c">file-name</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#19177c">save-buffer</span>))
</span></span><span style="display:flex;"><span>		    (<span style="color:#00f">kill-buffer</span> (<span style="color:#00f">process-buffer</span> <span style="color:#19177c">process</span>))
</span></span><span style="display:flex;"><span>		    (<span style="color:#00f">funcall</span> <span style="color:#19177c">callback</span> <span style="color:#19177c">file-name</span>)))
</span></span><span style="display:flex;"><span>		 ((<span style="color:#008000">or</span> (<span style="color:#008000">and</span> (<span style="color:#00f">eq</span> <span style="color:#19177c">status</span> <span style="color:#19177c">&#39;exit</span>) (<span style="color:#00f">&gt;</span> <span style="color:#19177c">code</span> <span style="color:#666">0</span>))
</span></span><span style="display:flex;"><span>		      (<span style="color:#00f">eq</span> <span style="color:#19177c">status</span> <span style="color:#19177c">&#39;signal</span>))
</span></span><span style="display:flex;"><span>		  (<span style="color:#008000">let</span> ((<span style="color:#19177c">err</span> (<span style="color:#008000">with-current-buffer</span> (<span style="color:#00f">process-buffer</span> <span style="color:#19177c">process</span>)
</span></span><span style="display:flex;"><span>			       (<span style="color:#00f">buffer-string</span>))))
</span></span><span style="display:flex;"><span>		    (<span style="color:#00f">kill-buffer</span> (<span style="color:#00f">process-buffer</span> <span style="color:#19177c">process</span>))
</span></span><span style="display:flex;"><span>		    (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;Error in youtube_transcript_api: %s&#34;</span> <span style="color:#19177c">err</span>)))))))
</span></span><span style="display:flex;"><span>      <span style="color:#19177c">proc</span>)))
</span></span></code></pre></div><h5 id="elfeed-and-subed">elfeed and subed</h5>
<p>Now that we have a standalone function, let&rsquo;s invoke it with the current <code>elfeed-show-entry</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/elfeed-srt-dir</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;~/.elfeed/srt/&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/elfeed-youtube-subtitles</span> (<span style="color:#19177c">entry</span> <span style="color:#008000">&amp;optional</span> <span style="color:#19177c">arg</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Get subtitles for the current elfeed ENTRY.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">Works only in the entry is a YouTube video.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">If ARG is non-nil, re-fetch the subtitles regardless of whether
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">they were fetched before.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> (<span style="color:#00f">list</span> <span style="color:#19177c">elfeed-show-entry</span> <span style="color:#19177c">current-prefix-arg</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">video-id</span> (<span style="color:#19177c">cadr</span>
</span></span><span style="display:flex;"><span>		   (<span style="color:#00f">assoc</span> <span style="color:#ba2121">&#34;watch?v&#34;</span>
</span></span><span style="display:flex;"><span>			  (<span style="color:#19177c">url-parse-query-string</span>
</span></span><span style="display:flex;"><span>			   (<span style="color:#00f">substring</span>
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">url-filename</span>
</span></span><span style="display:flex;"><span>			     (<span style="color:#19177c">url-generic-parse-url</span> (<span style="color:#19177c">elfeed-entry-link</span> <span style="color:#19177c">entry</span>)))
</span></span><span style="display:flex;"><span>			    <span style="color:#666">1</span>))))))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">unless</span> <span style="color:#19177c">video-id</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;Can&#39;t get video ID from the entry&#34;</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/youtube-subtitles-get</span>
</span></span><span style="display:flex;"><span>     <span style="color:#19177c">video-id</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">lambda</span> (<span style="color:#19177c">file-name</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008000">with-current-buffer</span> (<span style="color:#19177c">find-file-other-window</span> <span style="color:#19177c">file-name</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#008000">setq-local</span> <span style="color:#19177c">elfeed-show-entry</span> <span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>	 (<span style="color:#00f">goto-char</span> (<span style="color:#00f">point-min</span>))))
</span></span><span style="display:flex;"><span>     <span style="color:#008000">:file-name</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">my/elfeed-srt-dir</span>
</span></span><span style="display:flex;"><span>			(<span style="color:#19177c">elfeed-ref-id</span> (<span style="color:#19177c">elfeed-entry-content</span> <span style="color:#19177c">entry</span>))
</span></span><span style="display:flex;"><span>			<span style="color:#ba2121">&#34;.vtt&#34;</span>)
</span></span><span style="display:flex;"><span>     <span style="color:#008000">:overwrite</span> <span style="color:#19177c">arg</span>)))
</span></span></code></pre></div><p>That opens up a <code>.vtt</code> buffer with the subtitles for the current video, which means now we can use the functionality of Sacha Chua&rsquo;s awesome package called <a href="https://github.com/sachac/subed">subed</a>.</p>
<p>This package, besides syntax highlighting, allows for controlling the MPV playback, for instance by moving the cursor in the subtitles buffer. Using that requires having the URL of the video in this buffer, which necessitates the line with <code>setq-local</code> in the previous function.</p>
<p>Also, the package launches its own instance of MPV to control it via JSON-IPC, so there seems to be no easy way to integrate it with EMMS. But at least I can reuse the <code>emms-player-mpv-parameters</code> variable, the method of setting which I&rsquo;ve discussed above. The function is as follows:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/subed-elfeed</span> (<span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Open the video file from elfeed ENTRY in MPV.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">This has to be launched from inside the subtitles buffer, opened
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">by the </span><span style="color:#19177c">`my/elfeed-youtube-subtitles&#39;</span><span style="color:#ba2121"> function.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> (<span style="color:#00f">list</span> <span style="color:#19177c">elfeed-show-entry</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> <span style="color:#19177c">entry</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;No entry!&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> (<span style="color:#19177c">derived-mode-p</span> <span style="color:#19177c">&#39;subed-mode</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#d2413a;font-weight:bold">user-error</span> <span style="color:#ba2121">&#34;Not subed mode!&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">subed-mpv-arguments</span>
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">seq-uniq</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#00f">append</span> <span style="color:#19177c">subed-mpv-arguments</span> <span style="color:#19177c">emms-player-mpv-parameters</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">subed-mpv-video-file</span> (<span style="color:#19177c">elfeed-entry-link</span> <span style="color:#19177c">entry</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">subed-mpv--play</span> <span style="color:#19177c">subed-mpv-video-file</span>))
</span></span></code></pre></div><p>Keep in mind that this function has to be launched inside the buffer opened by the <code>my/elfeed-youtube-subtitles</code> function.</p>
<h3 id="internet-and-multimedia">Internet &amp; Multimedia</h3>
<h4 id="notmuch">Notmuch</h4>
<p>My notmuch config now resides in <a href="/configs/mail/">Mail.org</a>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">unless</span> (<span style="color:#008000">or</span> <span style="color:#19177c">my/is-termux</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">mail-file</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;mail.el&#34;</span> <span style="color:#19177c">user-emacs-directory</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#19177c">mail-file</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">load-file</span> <span style="color:#19177c">mail-file</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;Can&#39;t load mail.el&#34;</span>))))
</span></span></code></pre></div><h4 id="emms">EMMS</h4>
<p>EMMS is the Emacs Multi-Media System. I use it to control MPD &amp; MPV.</p>
<p>References:</p>
<ul>
<li><a href="https://www.gnu.org/software/emms/manual/">EMMS Manual</a></li>
<li><a href="https://www.youtube.com/watch?v=xTVN8UDScqk">Uncle Dave&rsquo;s video</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">emms</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">emms-smart-browse</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">emms-browser</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">emms-add-url</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">emms-add-file</span>
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">emms-add-find</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">my/is-termux</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;as&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;emms&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;s&#34;</span> (<span style="color:#19177c">my/command-in-persp</span> <span style="color:#ba2121">&#34;emms&#34;</span> <span style="color:#ba2121">&#34;EMMS&#34;</span> <span style="color:#666">0</span> (<span style="color:#19177c">emms-smart-browse</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;b&#34;</span> <span style="color:#19177c">&#39;emms-browser</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;p&#34;</span> <span style="color:#19177c">&#39;emms-pause</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#19177c">&#39;emms-stop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;h&#34;</span> <span style="color:#19177c">&#39;emms-previous</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;l&#34;</span> <span style="color:#19177c">&#39;emms-next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#19177c">&#39;emms-player-mpd-connect</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;ww&#34;</span> <span style="color:#19177c">&#39;emms-lyrics</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;wb&#34;</span> <span style="color:#19177c">&#39;emms-lyrics-toggle-display-on-minibuffer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;wm&#34;</span> <span style="color:#19177c">&#39;emms-lyrics-toggle-display-on-modeline</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">emms-mode-line-icon-enabled-p</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;emms-setup</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;emms-player-mpd</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;emms-player-mpv</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">emms-all</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; MPD setup</span>
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">&lt;&lt;emms-mpd-setup&gt;&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; MPV setup</span>
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">&lt;&lt;emms-mpv-setup&gt;&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; evil-lion and evil-commentary shadow some gX bindings</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (add-hook &#39;emms-browser-mode-hook</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (lambda ()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (evil-lion-mode -1)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; (evil-commentary-mode -1)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; ))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; I have everything I need in polybar</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">emms-mode-line-mode</span> <span style="color:#666">-1</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">emms-playing-time-display-mode</span> <span style="color:#666">-1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#19177c">&lt;&lt;emms-fixes&gt;&gt;</span>)
</span></span></code></pre></div><h5 id="mpd">MPD</h5>
<p><a href="https://www.musicpd.org/">mpd</a> is a server for playing music. It has a couple of first-class clients, including curses-based <a href="https://github.com/ncmpcpp/ncmpcpp">ncmpcpp</a>, but of course, I want to use Emacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">emms-source-file-default-directory</span> (<span style="color:#00f">expand-file-name</span> <span style="color:#ba2121">&#34;~/Music/&#34;</span>))
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;emms-info-functions</span> <span style="color:#19177c">&#39;emms-info-mpd</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;emms-player-list</span> <span style="color:#19177c">&#39;emms-player-mpd</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">emms-player-mpd-server-name</span> <span style="color:#ba2121">&#34;localhost&#34;</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">emms-player-mpd-server-port</span> <span style="color:#ba2121">&#34;6600&#34;</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">emms-player-mpd-music-directory</span> <span style="color:#ba2121">&#34;~/Music&#34;</span>)
</span></span></code></pre></div><p>Connect on setup. For some reason, it stops the mpd playback whenever it connects, but it is not a big issue.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">emms-player-mpd-connect</span>)
</span></span></code></pre></div><p>Clear MPD playlist on clearing EMMS playlist. IDK if this is fine for MPD library playlist, I don&rsquo;t use them anyhow.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;emms-playlist-cleared-hook</span> <span style="color:#19177c">&#39;emms-player-mpd-clear</span>)
</span></span></code></pre></div><p>Set a custom regex for MPD. EMMS sets up the default one from MPD&rsquo;s diagnostic output so that regex opens basically everything, including videos, https links, etc. That is fine if MPD is the only player in EMMS, but as I want to use MPV as well, I override the regex.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">emms-player-set</span> <span style="color:#19177c">emms-player-mpd</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#19177c">&#39;regex</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#008000">rx</span> (<span style="color:#008000">or</span> (<span style="color:#666">:</span> <span style="color:#ba2121">&#34;https://&#34;</span> (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>) (<span style="color:#008000">or</span> <span style="color:#ba2121">&#34;acast.com&#34;</span>) (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>))
</span></span><span style="display:flex;"><span>			 (<span style="color:#00f">+</span> (<span style="color:#ba2121">? </span>(<span style="color:#008000">or</span> <span style="color:#ba2121">&#34;https://&#34;</span> <span style="color:#ba2121">&#34;http://&#34;</span>))
</span></span><span style="display:flex;"><span>			    (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>)
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">regexp</span> (<span style="color:#00f">eval</span> (<span style="color:#19177c">emms-player-simple-regexp</span>
</span></span><span style="display:flex;"><span>					   <span style="color:#ba2121">&#34;m3u&#34;</span> <span style="color:#ba2121">&#34;ogg&#34;</span> <span style="color:#ba2121">&#34;flac&#34;</span> <span style="color:#ba2121">&#34;mp3&#34;</span> <span style="color:#ba2121">&#34;wav&#34;</span> <span style="color:#ba2121">&#34;mod&#34;</span> <span style="color:#ba2121">&#34;au&#34;</span> <span style="color:#ba2121">&#34;aiff&#34;</span> <span style="color:#ba2121">&#34;m4a&#34;</span>)))))))
</span></span></code></pre></div><p>After all this is done, run <code>M-x emms-cache-set-from-mpd-all</code> to set cache from MPD. If everything is correct, EMMS browser will be populated with MPD database.</p>
<h5 id="mpv">MPV</h5>
<table>
<thead>
<tr>
<th>Guix dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td>mpv</td>
</tr>
<tr>
<td>yt-dlp</td>
</tr>
</tbody>
</table>
<p><a href="https://mpv.io/">mpv</a> is a decent media player, which has found a place in this configuration because it integrates with <del>youtube-dl</del> yt-dlp.</p>
<p>It looks like YouTube has started to throttle youtube-dl, and yt-dlp has a workaround for that particular case. Just don&rsquo;t forget to add the following like to the mpv config:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#7d9029">script-opts</span><span style="color:#666">=</span><span style="color:#ba2121">ytdl_hook-ytdl_path=yt-dlp</span>
</span></span></code></pre></div><p>It seems a bit strange to keep the MPV config in this file, but I don&rsquo;t use the program outside Emacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;emms-player-list</span> <span style="color:#19177c">&#39;emms-player-mpv</span>)
</span></span></code></pre></div><p>Also a custom regex. My demands for MPV include running <code>yt-dlp</code>, so there is a regex that matches youtube.com or some of the video formats.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">emms-player-set</span> <span style="color:#19177c">emms-player-mpv</span>
</span></span><span style="display:flex;"><span>		 <span style="color:#19177c">&#39;regex</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#008000">rx</span> (<span style="color:#008000">or</span> (<span style="color:#666">:</span> <span style="color:#ba2121">&#34;https://&#34;</span> (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>) <span style="color:#ba2121">&#34;youtube.com&#34;</span> (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>))
</span></span><span style="display:flex;"><span>			 (<span style="color:#00f">+</span> (<span style="color:#ba2121">? </span>(<span style="color:#008000">or</span> <span style="color:#ba2121">&#34;https://&#34;</span> <span style="color:#ba2121">&#34;http://&#34;</span>))
</span></span><span style="display:flex;"><span>			    (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>)
</span></span><span style="display:flex;"><span>			    (<span style="color:#19177c">regexp</span> (<span style="color:#00f">eval</span> (<span style="color:#19177c">emms-player-simple-regexp</span>
</span></span><span style="display:flex;"><span>			    <span style="color:#ba2121">&#34;mp4&#34;</span> <span style="color:#ba2121">&#34;mov&#34;</span> <span style="color:#ba2121">&#34;wmv&#34;</span> <span style="color:#ba2121">&#34;webm&#34;</span> <span style="color:#ba2121">&#34;flv&#34;</span> <span style="color:#ba2121">&#34;avi&#34;</span> <span style="color:#ba2121">&#34;mkv&#34;</span>)))))))
</span></span></code></pre></div><p>By default, MPV plays the video in the best possible quality, which may be pretty high, even too high with limited bandwidth. So here is the logic to choose the quality.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/youtube-dl-quality-list</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;bestvideo[height&lt;=720]+bestaudio/best[height&lt;=720]&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ba2121">&#34;bestvideo[height&lt;=480]+bestaudio/best[height&lt;=480]&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ba2121">&#34;bestvideo[height&lt;=1080]+bestaudio/best[height&lt;=1080]&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">my/default-emms-player-mpv-parameters</span>
</span></span><span style="display:flex;"><span>      <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;--quiet&#34;</span> <span style="color:#ba2121">&#34;--really-quiet&#34;</span> <span style="color:#ba2121">&#34;--no-audio-display&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/set-emms-mpd-youtube-quality</span> (<span style="color:#19177c">quality</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> <span style="color:#ba2121">&#34;P&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">unless</span> <span style="color:#19177c">quality</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">setq</span> <span style="color:#19177c">quality</span> (<span style="color:#00f">completing-read</span> <span style="color:#ba2121">&#34;Quality: &#34;</span> <span style="color:#19177c">my/youtube-dl-quality-list</span> <span style="color:#800">nil</span> <span style="color:#800">t</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">emms-player-mpv-parameters</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">`</span>(<span style="color:#666">,@</span><span style="color:#19177c">my/default-emms-player-mpv-parameters</span> <span style="color:#666">,</span>(<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;--ytdl-format=%s&#34;</span> <span style="color:#19177c">quality</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my/set-emms-mpd-youtube-quality</span> (<span style="color:#00f">car</span> <span style="color:#19177c">my/youtube-dl-quality-list</span>))
</span></span></code></pre></div><p>Now <code>emms-add-url</code> should work on YouTube URLs just fine. Just keep in mind that it will only add the URL to the playlist, not play it right away.</p>
<h5 id="cache-cleanup">Cache cleanup</h5>
<p>All the added URLs reside in the EMMS cache after being played. I don&rsquo;t want them to stay there for a long time, so here is a handy function to clean it.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/emms-cleanup-urls</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">keys-to-delete</span> <span style="color:#666">&#39;</span>()))
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">maphash</span> (<span style="color:#008000">lambda</span> (<span style="color:#19177c">key</span> <span style="color:#19177c">value</span>)
</span></span><span style="display:flex;"><span>	       (<span style="color:#008000">when</span> (<span style="color:#00f">eq</span> (<span style="color:#00f">cdr</span> (<span style="color:#00f">assoc</span> <span style="color:#19177c">&#39;type</span> <span style="color:#19177c">value</span>)) <span style="color:#19177c">&#39;url</span>)
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;keys-to-delete</span> <span style="color:#19177c">key</span>)))
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">emms-cache-db</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">dolist</span> (<span style="color:#19177c">key</span> <span style="color:#19177c">keys-to-delete</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#00f">remhash</span> <span style="color:#19177c">key</span> <span style="color:#19177c">emms-cache-db</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">emms-cache-dirty</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;asc&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/emms-cleanup-urls</span>)
</span></span></code></pre></div><h5 id="fetching-lyrics">Fetching lyrics</h5>
<p>My package for fetching EMMS lyrics and album covers.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">lyrics-fetcher</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">emms</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;ast&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">lyrics-fetcher-show-lyrics</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;asT&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">lyrics-fetcher-show-lyrics-query</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">lyrics-fetcher-genius-access-token</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">my/password-store-get</span> <span style="color:#ba2121">&#34;My_Online/APIs/genius.com&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">emacs</span> <span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;emms-browser-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gl&#34;</span> <span style="color:#19177c">&#39;lyrics-fetcher-emms-browser-show-at-point</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gC&#34;</span> <span style="color:#19177c">&#39;lyrics-fetcher-emms-browser-fetch-covers-at-point</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;go&#34;</span> <span style="color:#19177c">&#39;lyrics-fetcher-emms-browser-open-large-cover-at-point</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">emms-lyrics-mode-line</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#008000">:override</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/emms-lyrics-mode-line-override</span>))
</span></span></code></pre></div><p>Also advice to change the location of the lyrics in the mode line.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/emms-lyrics-mode-line-override</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;global-mode-string</span>
</span></span><span style="display:flex;"><span>	       <span style="color:#666">&#39;</span>(<span style="color:#008000">:eval</span> <span style="color:#19177c">emms-lyrics-mode-line-string</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/emms-lyrics-restore-mode-line-override</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Restore the mode line.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">global-mode-string</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">remove</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:eval</span> <span style="color:#19177c">emms-lyrics-mode-line-string</span>) <span style="color:#19177c">global-mode-string</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">force-mode-line-update</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;emms-lyrics</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">emms-lyrics-mode-line</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#008000">:override</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/emms-lyrics-mode-line-override</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">emms-lyrics-restore-mode-line</span>
</span></span><span style="display:flex;"><span>	      <span style="color:#008000">:override</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/emms-lyrics-restore-mode-line-override</span>))
</span></span></code></pre></div><h5 id="some-keybindings">Some keybindings</h5>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;emms-browser</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;emms-browser-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#19177c">&#39;quit-window</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;emms</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;emms-playlist-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#19177c">&#39;quit-window</span>))
</span></span></code></pre></div><h5 id="emms-and-mpd-fixes">EMMS &amp; mpd Fixes</h5>
<p><del>Some fixes until I submit a patch.</del> I&rsquo;ve submitted a patch for with these fixes, so I&rsquo;ll remove this section eventually.</p>
<p>For some reason EMMS doesn&rsquo;t fetch <code>albumartist</code> from MPD. Overriding this function fixes that.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">emms-info-mpd-process</span> (<span style="color:#19177c">track</span> <span style="color:#19177c">info</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">dolist</span> (<span style="color:#19177c">data</span> <span style="color:#19177c">info</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">let</span> ((<span style="color:#19177c">name</span> (<span style="color:#00f">car</span> <span style="color:#19177c">data</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">value</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">data</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">setq</span> <span style="color:#19177c">name</span> (<span style="color:#008000">cond</span> ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;artist&#34;</span>) <span style="color:#19177c">&#39;info-artist</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;albumartist&#34;</span>) <span style="color:#19177c">&#39;info-albumartist</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;composer&#34;</span>) <span style="color:#19177c">&#39;info-composer</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;performer&#34;</span>) <span style="color:#19177c">&#39;info-performer</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;title&#34;</span>) <span style="color:#19177c">&#39;info-title</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;album&#34;</span>) <span style="color:#19177c">&#39;info-album</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;track&#34;</span>) <span style="color:#19177c">&#39;info-tracknumber</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;disc&#34;</span>) <span style="color:#19177c">&#39;info-discnumber</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;date&#34;</span>) <span style="color:#19177c">&#39;info-year</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;genre&#34;</span>) <span style="color:#19177c">&#39;info-genre</span>)
</span></span><span style="display:flex;"><span>		       ((<span style="color:#19177c">string=</span> <span style="color:#19177c">name</span> <span style="color:#ba2121">&#34;time&#34;</span>)
</span></span><span style="display:flex;"><span>			(<span style="color:#008000">setq</span> <span style="color:#19177c">value</span> (<span style="color:#00f">string-to-number</span> <span style="color:#19177c">value</span>))
</span></span><span style="display:flex;"><span>			<span style="color:#19177c">&#39;info-playing-time</span>)
</span></span><span style="display:flex;"><span>		       (<span style="color:#800">t</span> <span style="color:#800">nil</span>)))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> <span style="color:#19177c">name</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">emms-track-set</span> <span style="color:#19177c">track</span> <span style="color:#19177c">name</span> <span style="color:#19177c">value</span>)))))
</span></span></code></pre></div><p>Also, <code>emms-player-mpd-get-alists</code> has an interesting bug. This function parses the response to <code>listallinfo</code>, which looks something like this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>tag1: value1
</span></span><span style="display:flex;"><span>tag2: value2
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>tag1: value1&#39;
</span></span><span style="display:flex;"><span>tag2: value2&#39;
</span></span></code></pre></div><p>This structure has to be converted to list of alists, which looks like:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>((&#34;tag1&#34; . &#34;value1&#34;
</span></span><span style="display:flex;"><span>  &#34;tag2&#34; . &#34;value2&#34;)
</span></span><span style="display:flex;"><span>  (&#34;tag1&#34; . &#34;value1&#39;&#34;
</span></span><span style="display:flex;"><span>  (&#34;tag2&#34; . &#34;value2&#39;&#34;)))
</span></span></code></pre></div><p>The original implementation creates a new alist whenever it encounters a tag it has already put in the current alist. Which doesn&rsquo;t work too well if some tags don&rsquo;t repeat, if the order is messed up, etc.</p>
<p>Fortunately, according to the <a href="https://mpd.readthedocs.io/en/latest/protocol.html#command-lsinfo">protocol specification</a>, each new record has to start with <code>file</code>, <code>directory</code> or <code>playlist</code>. I&rsquo;ve overridden the function with that in mind and it fixed the import, at least for my case.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">emms-player-mpd-get-alists</span> (<span style="color:#19177c">info</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Turn the given parsed INFO from MusicPD into an list of alists.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">The list will be in reverse order.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">when</span> (<span style="color:#008000">and</span> <span style="color:#19177c">info</span>
</span></span><span style="display:flex;"><span>	     (<span style="color:#00f">null</span> (<span style="color:#00f">car</span> <span style="color:#19177c">info</span>))          <span style="color:#408080;font-style:italic">; no error has occurred</span>
</span></span><span style="display:flex;"><span>	     (<span style="color:#00f">cdr</span> <span style="color:#19177c">info</span>))                <span style="color:#408080;font-style:italic">; data exists</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">let</span> ((<span style="color:#19177c">alists</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#19177c">alist</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>	  <span style="color:#19177c">cell</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">dolist</span> (<span style="color:#19177c">line</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">info</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">when</span> (<span style="color:#008000">setq</span> <span style="color:#19177c">cell</span> (<span style="color:#19177c">emms-player-mpd-parse-line</span> <span style="color:#19177c">line</span>))
</span></span><span style="display:flex;"><span>	  (<span style="color:#008000">if</span> (<span style="color:#00f">member</span> (<span style="color:#00f">car</span> <span style="color:#19177c">cell</span>) <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;file&#34;</span> <span style="color:#ba2121">&#34;directory&#34;</span> <span style="color:#ba2121">&#34;playlist&#34;</span>))
</span></span><span style="display:flex;"><span>	      (<span style="color:#008000">setq</span> <span style="color:#19177c">alists</span> (<span style="color:#00f">cons</span> <span style="color:#19177c">alist</span> <span style="color:#19177c">alists</span>)
</span></span><span style="display:flex;"><span>		    <span style="color:#19177c">alist</span> (<span style="color:#00f">list</span> <span style="color:#19177c">cell</span>))
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">setq</span> <span style="color:#19177c">alist</span> (<span style="color:#00f">cons</span> <span style="color:#19177c">cell</span> <span style="color:#19177c">alist</span>)))))
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> <span style="color:#19177c">alist</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#008000">setq</span> <span style="color:#19177c">alists</span> (<span style="color:#00f">cons</span> <span style="color:#19177c">alist</span> <span style="color:#19177c">alists</span>)))
</span></span><span style="display:flex;"><span>      <span style="color:#19177c">alists</span>)))
</span></span></code></pre></div><h4 id="ytel">ytel</h4>
<p><a href="https://github.com/gRastello/ytel">ytel</a> is a YouTube (actually Invidious) frontend, which lets one search YouTube (whereas the setup with elfeed just lets one view the pre-defined subscriptions).</p>
<p>The package doesn&rsquo;t provide evil bindings, so I define my own.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ytel</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">ytel</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">ytel-invidious-api-url</span> <span style="color:#ba2121">&#34;https://invidio.xamh.de/&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;ytel-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">ytel-quit</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;s&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">ytel-search</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;L&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">ytel-search-next-page</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;H&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">ytel-search-previous-page</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;RET&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/ytel-add-emms</span>))
</span></span></code></pre></div><p>And here is the same kind of integration with EMMS as in the elfeed setup:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;emms</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">define-emms-source</span> <span style="color:#19177c">ytel</span> (<span style="color:#19177c">video</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">let</span> ((<span style="color:#19177c">track</span> (<span style="color:#19177c">emms-track</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#19177c">&#39;url</span> (<span style="color:#00f">concat</span> <span style="color:#ba2121">&#34;https://www.youtube.com/watch?v=&#34;</span>
</span></span><span style="display:flex;"><span>			       (<span style="color:#19177c">ytel-video-id</span> <span style="color:#19177c">video</span>)))))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">emms-track-set</span> <span style="color:#19177c">track</span> <span style="color:#19177c">&#39;info-title</span> (<span style="color:#19177c">ytel-video-title</span> <span style="color:#19177c">video</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">emms-track-set</span> <span style="color:#19177c">track</span> <span style="color:#19177c">&#39;info-artist</span> (<span style="color:#19177c">ytel-video-author</span> <span style="color:#19177c">video</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">emms-playlist-insert-track</span> <span style="color:#19177c">track</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/ytel-add-emms</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">emms-add-ytel</span> (<span style="color:#19177c">ytel-get-current-video</span>)))
</span></span></code></pre></div><h4 id="wallabag">wallabag</h4>
<p><a href="https://github.com/wallabag/wallabag">Wallabag</a> is a self-hosted read-it-later project. I&rsquo;m not yet sold on integrating it in my workflow, but let&rsquo;s keep it here for now.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">wallabag</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;chenyanming/wallabag.el&#34;</span> <span style="color:#008000">:files</span> (<span style="color:#008000">:defaults</span> <span style="color:#ba2121">&#34;default.css&#34;</span> <span style="color:#ba2121">&#34;emojis.alist&#34;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">wallabag</span> <span style="color:#19177c">wallabag-add-entry</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">wallabag-host</span> <span style="color:#ba2121">&#34;https://wallabag.sqrtminusone.xyz&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">wallabag-username</span> <span style="color:#ba2121">&#34;sqrtminusone&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">wallabag-password</span> (<span style="color:#19177c">my/password-store-get</span> <span style="color:#ba2121">&#34;Selfhosted/wallabag&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">wallabag-clientid</span> (<span style="color:#19177c">password-store-get-field</span> <span style="color:#ba2121">&#34;Selfhosted/wallabag&#34;</span> <span style="color:#ba2121">&#34;client_id&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">wallabag-secret</span> (<span style="color:#19177c">password-store-get-field</span> <span style="color:#ba2121">&#34;Selfhosted/wallabag&#34;</span> <span style="color:#ba2121">&#34;client_secret&#34;</span>)))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/elfeed-wallabag</span> (<span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span> (<span style="color:#00f">list</span> <span style="color:#19177c">elfeed-show-entry</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">wallabag-add-entry</span> (<span style="color:#19177c">elfeed-entry-link</span> <span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#00f">mapconcat</span> <span style="color:#00f">#&#39;symbol-name</span> (<span style="color:#19177c">elfeed-entry-tags</span> <span style="color:#19177c">entry</span>) <span style="color:#ba2121">&#34;,&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">elfeed-recommender--rate-current</span> <span style="color:#666">2</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">with-eval-after-load</span> <span style="color:#19177c">&#39;elfeed</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">elfeed-show-mode-map</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gw&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/elfeed-wallabag</span>))
</span></span></code></pre></div><h4 id="eww">EWW</h4>
<p>Emacs built-in web browser. <del>I wonder if anyone actually uses it.</del></p>
<p>I use it occasionally to open links in elfeed.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/toggle-shr-use-fonts</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Toggle the shr-use-fonts variable in buffer&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">shr-use-fonts</span> (<span style="color:#19177c">not</span> <span style="color:#19177c">shr-use-fonts</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;aw&#34;</span> <span style="color:#19177c">&#39;eww</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;eww-mode-map</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;+&#34;</span> <span style="color:#19177c">&#39;text-scale-increase</span>
</span></span><span style="display:flex;"><span> <span style="color:#ba2121">&#34;-&#34;</span> <span style="color:#19177c">&#39;text-scale-decrease</span>)
</span></span></code></pre></div><h4 id="erc">ERC</h4>
<p>ERC is a built-it Emacs IRC client.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">erc</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">erc</span> <span style="color:#19177c">erc-tls</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:type</span> <span style="color:#19177c">built-in</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">erc-log-channels-directory</span> <span style="color:#ba2121">&#34;~/.erc/logs&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">erc-save-buffer-on-part</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;erc-modules</span> <span style="color:#19177c">&#39;autojoin</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;erc-modules</span> <span style="color:#19177c">&#39;notifications</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;erc-modules</span> <span style="color:#19177c">&#39;log</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">erc-update-modules</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">erc-autojoin-channels-alist</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">`</span>((<span style="color:#666">,</span>(<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;libera.chat&#34;</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#ba2121">&#34;#systemcrafters&#34;</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#ba2121">&#34;#emacs&#34;</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#ba2121">&#34;#guix&#34;</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">erc-kill-buffer-on-part</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">erc-track-shorten-start</span> <span style="color:#666">8</span>))
</span></span></code></pre></div><p>Exclude everything but actual messages from notifications.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">erc-track-exclude-types</span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;NICK&#34;</span> <span style="color:#ba2121">&#34;JOIN&#34;</span> <span style="color:#ba2121">&#34;LEAVE&#34;</span> <span style="color:#ba2121">&#34;QUIT&#34;</span> <span style="color:#ba2121">&#34;PART&#34;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;301&#34;</span>   <span style="color:#408080;font-style:italic">; away notice</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;305&#34;</span>   <span style="color:#408080;font-style:italic">; return from awayness</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;306&#34;</span>   <span style="color:#408080;font-style:italic">; set awayness</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;324&#34;</span>   <span style="color:#408080;font-style:italic">; modes</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;329&#34;</span>   <span style="color:#408080;font-style:italic">; channel creation date</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;332&#34;</span>   <span style="color:#408080;font-style:italic">; topic notice</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;333&#34;</span>   <span style="color:#408080;font-style:italic">; who set the topic</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ba2121">&#34;353&#34;</span>   <span style="color:#408080;font-style:italic">; Names notice</span>
</span></span><span style="display:flex;"><span>				))
</span></span></code></pre></div><p>A plugin to highlight IRC nicknames:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">erc-hl-nicks</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:hook</span> (<span style="color:#19177c">erc-mode</span> <span style="color:#666">.</span> <span style="color:#19177c">erc-hl-nicks-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">erc</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>)
</span></span></code></pre></div><p>ZNC support. Seems to provide a few nice features for ZNC.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">znc</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">znc-erc</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;ai&#34;</span> (<span style="color:#19177c">my/command-in-persp</span> <span style="color:#ba2121">&#34;erc&#34;</span> <span style="color:#ba2121">&#34;ERC&#34;</span> <span style="color:#666">0</span> (<span style="color:#19177c">znc-erc</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">znc-servers</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">`</span>((<span style="color:#ba2121">&#34;sqrtminusone.xyz&#34;</span> <span style="color:#666">6697</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>	   ((<span style="color:#19177c">libera</span> <span style="color:#ba2121">&#34;sqrtminusone&#34;</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#666">,</span>(<span style="color:#19177c">my/password-store-get</span> <span style="color:#ba2121">&#34;Selfhosted/ZNC&#34;</span>)))))))
</span></span></code></pre></div><p>Send <code>/detach</code> to all servers. Kinda strange that there&rsquo;s no such function already</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/erc-detach-all</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">cl-loop</span> <span style="color:#19177c">for</span> <span style="color:#19177c">buf</span> <span style="color:#19177c">being</span> <span style="color:#19177c">the</span> <span style="color:#19177c">buffers</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#008000">if</span> (<span style="color:#00f">eq</span> (<span style="color:#00f">buffer-local-value</span> <span style="color:#19177c">&#39;major-mode</span> <span style="color:#19177c">buf</span>) <span style="color:#19177c">&#39;erc-mode</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#008000">do</span> (<span style="color:#008000">with-current-buffer</span> <span style="color:#19177c">buf</span>
</span></span><span style="display:flex;"><span>		(<span style="color:#008000">when</span> (<span style="color:#19177c">erc-server-process-alive</span>)
</span></span><span style="display:flex;"><span>		  (<span style="color:#008000">let</span> ((<span style="color:#19177c">tgt</span> (<span style="color:#19177c">erc-default-target</span>)))
</span></span><span style="display:flex;"><span>		    (<span style="color:#19177c">erc-server-send</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;DETACH %s&#34;</span> <span style="color:#19177c">tgt</span>) <span style="color:#800">nil</span> <span style="color:#19177c">tgt</span>))))))
</span></span></code></pre></div><h4 id="ement-dot-el">ement.el</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">plz</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;alphapapa/plz.el&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">ement</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;alphapapa/ement.el&#34;</span>))
</span></span></code></pre></div><h4 id="off--jabber"><span class="org-todo done OFF">OFF</span> (OFF) jabber</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">srv</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">fsm</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:defer</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">emacs-jabber</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#19177c">jabber</span> <span style="color:#008000">:host</span> <span style="color:#800">nil</span> <span style="color:#008000">:repo</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#ba2121">&#34;https://tildegit.org/wgreenhouse/emacs-jabber&#34;</span>))
</span></span></code></pre></div><h4 id="google-translate">Google Translate</h4>
<p>Emacs interface to Google Translate.</p>
<p>Can&rsquo;t make it load lazily for some strange reason.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/atykhonov/google-translate">google-translate repo</a></li>
<li><a href="https://github.com/atykhonov/google-translate/issues/137#issuecomment-728278849">issue with ttk error fix</a></li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">google-translate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:functions</span> (<span style="color:#19177c">my-google-translate-at-point</span> <span style="color:#19177c">google-translate--search-tkk</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:custom</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">google-translate-backend-method</span> <span style="color:#19177c">&#39;curl</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">require</span> <span style="color:#19177c">&#39;facemenu</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">google-translate--search-tkk</span> ()
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;Search TKK.&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#00f">list</span> <span style="color:#666">430675</span> <span style="color:#666">2721866130</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">my-google-translate-at-point</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;reverse translate if prefix&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">if</span> <span style="color:#19177c">current-prefix-arg</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#19177c">google-translate-at-point</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">google-translate-at-point-reverse</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">google-translate-translation-directions-alist</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666">&#39;</span>((<span style="color:#ba2121">&#34;en&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;ru&#34;</span>)
</span></span><span style="display:flex;"><span>	  (<span style="color:#ba2121">&#34;ru&#34;</span> <span style="color:#666">.</span> <span style="color:#ba2121">&#34;en&#34;</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:infix</span> <span style="color:#ba2121">&#34;at&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;&#34;</span> <span style="color:#666">&#39;</span>(<span style="color:#008000">:which-key</span> <span style="color:#ba2121">&#34;google translate&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;p&#34;</span> <span style="color:#19177c">&#39;google-translate-at-point</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;P&#34;</span> <span style="color:#19177c">&#39;google-translate-at-point-reverse</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#19177c">&#39;google-translate-query-translate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;Q&#34;</span> <span style="color:#19177c">&#39;google-translate-query-translate-reverse</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;t&#34;</span> <span style="color:#19177c">&#39;google-translate-smooth-translate</span>)
</span></span></code></pre></div><h3 id="reading-documentation">Reading documentation</h3>
<h4 id="tldr">tldr</h4>
<p><a href="https://tldr.sh/">tldr</a> is a collaborative project providing cheatsheets for various console commands. For some reason, the built-in download in the package is broken, so I use my own function.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">tldr</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">tldr</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">tldr-source-zip-url</span> <span style="color:#ba2121">&#34;https://github.com/tldr-pages/tldr/archive/refs/heads/main.zip&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">defun</span> <span style="color:#19177c">tldr-update-docs</span> ()
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">shell-command-to-string</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;curl -L %s --output %s&#34;</span> <span style="color:#19177c">tldr-source-zip-url</span> <span style="color:#19177c">tldr-saved-zip-path</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#ba2121">&#34;/tmp/tldr&#34;</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">delete-directory</span> <span style="color:#ba2121">&#34;/tmp/tldr&#34;</span> <span style="color:#800">t</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">shell-command-to-string</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;unzip -d /tmp/tldr/ %s&#34;</span> <span style="color:#19177c">tldr-saved-zip-path</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">when</span> (<span style="color:#00f">file-exists-p</span> <span style="color:#19177c">tldr-directory-path</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#19177c">delete-directory</span> <span style="color:#19177c">tldr-directory-path</span> <span style="color:#19177c">&#39;recursive</span> <span style="color:#19177c">&#39;no-trash</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">shell-command-to-string</span> (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;mv %s %s&#34;</span> <span style="color:#ba2121">&#34;/tmp/tldr/tldr-main&#34;</span> <span style="color:#19177c">tldr-directory-path</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;hT&#34;</span> <span style="color:#19177c">&#39;tldr</span>)
</span></span></code></pre></div><h4 id="man-and-info">man &amp; info</h4>
<p>Of course, Emacs can also display man and info pages.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">Man-width-max</span> <span style="color:#666">180</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;hM&#34;</span> <span style="color:#19177c">&#39;man</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span> <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;Info-mode-map</span>
</span></span><span style="display:flex;"><span> (<span style="color:#19177c">kbd</span> <span style="color:#ba2121">&#34;RET&#34;</span>) <span style="color:#19177c">&#39;Info-follow-nearest-node</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/man-fix-width</span> (<span style="color:#008000">&amp;rest</span> <span style="color:#19177c">_</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq-local</span> <span style="color:#19177c">Man-width</span> (<span style="color:#00f">-</span> (<span style="color:#19177c">window-width</span>) <span style="color:#666">4</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">advice-add</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">Man-update-manpage</span> <span style="color:#008000">:before</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/man-fix-width</span>)
</span></span></code></pre></div><h4 id="devdocs-dot-io">devdocs.io</h4>
<p>Finally, there is also an Emacs plugin for <a href="https://devdocs.io">devdocs.io</a>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">devdocs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">devdocs-install</span> <span style="color:#19177c">devdocs-lookup</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;devdocs-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;H&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">devdocs-go-back</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;L&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">devdocs-go-forward</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;o&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">devdocs-lookup</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;[&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">devdocs-previous-page</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;]&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">devdocs-next-page</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;he&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">devdocs-lookup</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;hE&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">devdocs-install</span>))
</span></span></code></pre></div><h4 id="stackexchange">StackExchange</h4>
<p><a href="https://github.com/vermiculus/sx.el">sx.el</a> is a StackExchange client for Emacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">sx</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">sx-question-mode-map</span> <span style="color:#19177c">sx-question-list-mode-map</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;go&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-visit-externally</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;q&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">quit-window</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;s*&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-starred</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sU&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-unanswered-my-tags</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sa&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-ask</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sf&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-featured</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sh&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-frontpage</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;si&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-inbox</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sm&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-meta-or-main</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sn&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-newest</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;su&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-unanswered</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sv&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-topvoted</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;sw&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-week</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;u&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-upvote</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;d&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-downvote</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;j&#34;</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;k&#34;</span> <span style="color:#800">nil</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">sx-question-mode-map</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;gr&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-question-mode-refresh</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;J&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-question-mode-next-section</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;K&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-question-mode-previous-section</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;a&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-answer</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;e&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-edit</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;D&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-delete</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;c&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-comment</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">sx-question-list-mode-map</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;RET&#34;</span> <span style="color:#19177c">&#39;sx-display</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;j&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-question-list-next</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;k&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-question-list-previous</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;S&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-search</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;m&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-question-list-mark-read</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;O&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-question-list-order-by</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;t&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-switch</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;hs&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-search</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;hS&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">sx-tab-frontpage</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/use-doom-colors</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">sx-question-mode-accepted</span> <span style="color:#008000">:foreground</span> (<span style="color:#19177c">doom-color</span> <span style="color:#19177c">&#39;green</span>)
</span></span><span style="display:flex;"><span>			      <span style="color:#008000">:weight</span> <span style="color:#19177c">&#39;bold</span>)
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">sx-question-mode-content</span> <span style="color:#008000">:background</span> <span style="color:#800">nil</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;sx-question-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">doom-modeline-mode</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;sx-question-list-mode-hook</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">doom-modeline-mode</span>))
</span></span></code></pre></div><h3 id="utilities">Utilities</h3>
<h4 id="pass">pass</h4>
<p>I use <a href="https://www.passwordstore.org/">pass</a> as my password manager. Expectedly, there is Emacs frontend for it.</p>
<p>This package is pretty good to manage the password database. I use <a href="https://github.com/SqrtMinusOne/password-store-ivy">password-store-ivy</a> (another package of mine) to actually type passwords. <a href="https://github.com/carnager/rofi-pass">rofi-pass</a> is another good option.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">pass</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">pass</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;ak&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">pass</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">pass-show-keybindings</span> <span style="color:#800">nil</span>))
</span></span></code></pre></div><p>Also I use <code>password-store-get</code> in a few places in my config, and by default it returns <code>nil</code> if I make an error in the password, which is not too convinient. So:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/password-store-get</span> (<span style="color:#19177c">entry</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">if-let</span> ((<span style="color:#19177c">res</span> (<span style="color:#19177c">password-store-get</span> <span style="color:#19177c">entry</span>)))
</span></span><span style="display:flex;"><span>      <span style="color:#19177c">res</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">my/password-store-get</span> <span style="color:#19177c">entry</span>)))
</span></span></code></pre></div><h4 id="docker-1">Docker</h4>
<p>A package to manage docker containers from Emacs.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">docker</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">docker</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;ao&#34;</span> <span style="color:#19177c">&#39;docker</span>))
</span></span></code></pre></div><h4 id="progidy">Progidy</h4>
<p><a href="https://github.com/rejeep/prodigy.el">prodigy.el</a> is a package to manage services. I&rsquo;ve been using <a href="https://github.com/tmux/tmux">tmux</a> + <a href="https://github.com/tmux-python/tmuxp">tmuxp</a> for quite a long time, but want to try this package as well.</p>
<p>The actual service definitions are in my <code>~/.emacs.d/private.org</code>, which is encrypted by <code>yadm</code>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">prodigy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">prodigy</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;aP&#34;</span> (<span style="color:#19177c">my/command-in-persp</span>
</span></span><span style="display:flex;"><span>		       <span style="color:#ba2121">&#34;deploy&#34;</span> <span style="color:#ba2121">&#34;prodigy&#34;</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>		       (<span style="color:#19177c">prodigy</span>)
</span></span><span style="display:flex;"><span>		       (<span style="color:#19177c">delete-other-windows</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">general-define-key</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:states</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">normal</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#008000">:keymaps</span> <span style="color:#19177c">&#39;prodigy-view-mode-map</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-h&#34;</span> <span style="color:#19177c">&#39;evil-window-left</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-l&#34;</span> <span style="color:#19177c">&#39;evil-window-right</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-k&#34;</span> <span style="color:#19177c">&#39;evil-window-up</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ba2121">&#34;C-j&#34;</span> <span style="color:#19177c">&#39;evil-window-down</span>))
</span></span></code></pre></div><p>A few functions to work with apps on ports.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/get-apps-on-ports</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">mapcar</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#008000">lambda</span> (<span style="color:#19177c">line</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#008000">let*</span> ((<span style="color:#19177c">split</span> (<span style="color:#19177c">split-string</span> <span style="color:#19177c">line</span> (<span style="color:#008000">rx</span> (<span style="color:#19177c">|</span> (<span style="color:#00f">+</span> <span style="color:#ba2121">&#34; &#34;</span>) (<span style="color:#00f">+</span> <span style="color:#ba2121">&#34;\t&#34;</span>)))))
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">process</span> (<span style="color:#00f">elt</span> <span style="color:#19177c">split</span> <span style="color:#666">6</span>)))
</span></span><span style="display:flex;"><span>       <span style="color:#666">`</span>((<span style="color:#19177c">netid</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#00f">elt</span> <span style="color:#19177c">split</span> <span style="color:#666">0</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">state</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#00f">elt</span> <span style="color:#19177c">split</span> <span style="color:#666">1</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">recv-q</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#00f">elt</span> <span style="color:#19177c">split</span> <span style="color:#666">2</span>))
</span></span><span style="display:flex;"><span>	 (<span style="color:#19177c">send-q</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#00f">elt</span> <span style="color:#19177c">split</span> <span style="color:#666">3</span>))
</span></span><span style="display:flex;"><span>	 <span style="color:#666">,@</span>(<span style="color:#008000">let</span> ((<span style="color:#19177c">data</span> (<span style="color:#00f">elt</span> <span style="color:#19177c">split</span> <span style="color:#666">4</span>)))
</span></span><span style="display:flex;"><span>	     (<span style="color:#008000">save-match-data</span>
</span></span><span style="display:flex;"><span>	       (<span style="color:#00f">string-match</span> (<span style="color:#008000">rx</span> (<span style="color:#19177c">group-n</span> <span style="color:#666">1</span> (<span style="color:#00f">*</span> <span style="color:#19177c">nonl</span>)) <span style="color:#ba2121">&#34;:&#34;</span> (<span style="color:#19177c">group-n</span> <span style="color:#666">2</span> (<span style="color:#008000">or</span> (<span style="color:#00f">+</span> <span style="color:#19177c">num</span>) <span style="color:#ba2121">&#34;*&#34;</span>))) <span style="color:#19177c">data</span>)
</span></span><span style="display:flex;"><span>	       <span style="color:#666">`</span>((<span style="color:#19177c">local-address</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#19177c">match-string</span> <span style="color:#666">1</span> <span style="color:#19177c">data</span>))
</span></span><span style="display:flex;"><span>		 (<span style="color:#19177c">local-port</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#19177c">match-string</span> <span style="color:#666">2</span> <span style="color:#19177c">data</span>)))))
</span></span><span style="display:flex;"><span>	 <span style="color:#666">,@</span>(<span style="color:#008000">unless</span> (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">process</span>)
</span></span><span style="display:flex;"><span>	     <span style="color:#666">`</span>((<span style="color:#19177c">pid</span> <span style="color:#666">.</span> <span style="color:#666">,</span>(<span style="color:#008000">save-match-data</span>
</span></span><span style="display:flex;"><span>			 (<span style="color:#00f">string-match</span> (<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;pid=&#34;</span> (<span style="color:#00f">+</span> <span style="color:#19177c">num</span>)) <span style="color:#19177c">process</span>)
</span></span><span style="display:flex;"><span>			 (<span style="color:#00f">string-to-number</span> (<span style="color:#00f">substring</span> (<span style="color:#19177c">match-string</span> <span style="color:#666">0</span> <span style="color:#19177c">process</span>) <span style="color:#666">4</span>)))))))))
</span></span><span style="display:flex;"><span>   (<span style="color:#19177c">seq-filter</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">lambda</span> (<span style="color:#19177c">s</span>) (<span style="color:#19177c">not</span> (<span style="color:#19177c">string-empty-p</span> <span style="color:#19177c">s</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">split-string</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#19177c">shell-command-to-string</span> <span style="color:#ba2121">&#34;ss -tulpnH | grep LISTEN&#34;</span>) <span style="color:#ba2121">&#34;\n&#34;</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/kill-app-on-port</span> (<span style="color:#19177c">port</span> <span style="color:#008000">&amp;optional</span> <span style="color:#d2413a;font-weight:bold">signal</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">let</span> ((<span style="color:#19177c">apps</span> (<span style="color:#19177c">my/get-apps-on-ports</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#008000">dolist</span> (<span style="color:#19177c">app</span> <span style="color:#19177c">apps</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#008000">when</span> (<span style="color:#00f">string-equal</span> (<span style="color:#00f">cdr</span> (<span style="color:#00f">assoc</span> <span style="color:#19177c">&#39;local-port</span> <span style="color:#19177c">app</span>)) <span style="color:#19177c">port</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">signal-process</span> (<span style="color:#00f">cdr</span> (<span style="color:#00f">assoc</span> <span style="color:#19177c">&#39;pid</span> <span style="color:#19177c">app</span>)) (<span style="color:#008000">or</span> <span style="color:#d2413a;font-weight:bold">signal</span> <span style="color:#666">15</span>))
</span></span><span style="display:flex;"><span>	(<span style="color:#00f">message</span> <span style="color:#ba2121">&#34;Sent %d to %d&#34;</span> (<span style="color:#008000">or</span> <span style="color:#d2413a;font-weight:bold">signal</span> <span style="color:#666">15</span>) (<span style="color:#00f">cdr</span> (<span style="color:#00f">assoc</span> <span style="color:#19177c">&#39;pid</span> <span style="color:#19177c">app</span>)))))))
</span></span></code></pre></div><h4 id="screenshot-dot-el">screenshot.el</h4>
<p>Tecosaur&rsquo;s plugin to make beautiful code screenshots.</p>
<table>
<thead>
<tr>
<th>Guix dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td>imagemagick</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">screenshot</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;tecosaur/screenshot&#34;</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#008000">:host</span> <span style="color:#19177c">github</span>
</span></span><span style="display:flex;"><span>		   <span style="color:#008000">:build</span> (<span style="color:#008000">:not</span> <span style="color:#19177c">compile</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#19177c">display-graphic-p</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">screenshot</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;S&#34;</span> <span style="color:#19177c">&#39;screenshot</span>))
</span></span></code></pre></div><h4 id="proced">proced</h4>
<p>proced is an Emacs built-it process viewer, like top.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;ah&#34;</span> <span style="color:#19177c">&#39;proced</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">proced-auto-update-interval</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;proced-mode-hook</span> (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>			      (<span style="color:#19177c">visual-line-mode</span> <span style="color:#666">-1</span>)
</span></span><span style="display:flex;"><span>			      (<span style="color:#008000">setq-local</span> <span style="color:#19177c">truncate-lines</span> <span style="color:#800">t</span>)
</span></span><span style="display:flex;"><span>			      (<span style="color:#19177c">proced-toggle-auto-update</span> <span style="color:#666">1</span>)))
</span></span></code></pre></div><h4 id="guix">Guix</h4>
<p>An Emacs package to help managing GNU Guix.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">guix</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">guix</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;ag&#34;</span> <span style="color:#19177c">&#39;guix</span>))
</span></span></code></pre></div><h3 id="productivity">Productivity</h3>
<h4 id="pomm">pomm</h4>
<p>My package for doing Pomodoro timer.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">pomm</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;SqrtMinusOne/pomm.el&#34;</span> <span style="color:#008000">:files</span> (<span style="color:#008000">:defaults</span> <span style="color:#ba2121">&#34;resources&#34;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic">;; :straight (:local-repo &#34;~/Code/Emacs/pomm&#34; :files (:defaults &#34;resources&#34;))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">pomm</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:init</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my-leader-def</span> <span style="color:#ba2121">&#34;ap&#34;</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">pomm</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">alert-default-style</span> <span style="color:#19177c">&#39;libnotify</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;pomm-on-tick-hook</span> <span style="color:#19177c">&#39;pomm-update-mode-line-string</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;pomm-on-status-changed-hook</span> <span style="color:#19177c">&#39;pomm-update-mode-line-string</span>))
</span></span></code></pre></div><h4 id="hledger">hledger</h4>
<p>is a plain-text double-entry accounting software. I use it for managing my personal finances, and thus far it&rsquo;s great.</p>
<table>
<thead>
<tr>
<th>Guix dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td>hledger</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">hledger-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:mode</span> (<span style="color:#008000">rx</span> <span style="color:#ba2121">&#34;.journal&#34;</span> <span style="color:#19177c">eos</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">hledger-jfile</span> (<span style="color:#00f">concat</span> <span style="color:#19177c">org-directory</span> <span style="color:#ba2121">&#34;/ledger/ledger.journal&#34;</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">add-hook</span> <span style="color:#19177c">&#39;hledger-mode-hook</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#008000">lambda</span> ()
</span></span><span style="display:flex;"><span>	      (<span style="color:#00f">make-local-variable</span> <span style="color:#19177c">&#39;company-backends</span>)
</span></span><span style="display:flex;"><span>	      (<span style="color:#19177c">add-to-list</span> <span style="color:#19177c">&#39;company-backends</span> <span style="color:#19177c">&#39;hledger-company</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">flycheck-hledger</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:after</span> (<span style="color:#19177c">hledger-mode</span>))
</span></span></code></pre></div><h4 id="calendar">Calendar</h4>
<p>Emacs&rsquo; built-in calendar. Can even calculate sunrise and sunset times.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">calendar-date-style</span> <span style="color:#19177c">&#39;iso</span>) <span style="color:#408080;font-style:italic">;; YYYY/mm/dd</span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">calendar-week-start-day</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">calendar-time-display-form</span> <span style="color:#666">&#39;</span>(<span style="color:#19177c">24-hours</span> <span style="color:#ba2121">&#34;:&#34;</span> <span style="color:#19177c">minutes</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">calendar-latitude</span> <span style="color:#666">59.9375</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#008000">setq</span> <span style="color:#19177c">calendar-longitude</span> <span style="color:#666">30.308611</span>)
</span></span></code></pre></div><h3 id="fun">Fun</h3>
<h4 id="discord-integration">Discord integration</h4>
<p>Integration with Discord. Shows which file is being edited in Emacs.</p>
<p>In order for this to work in Guix, a service is necessary - <a href="/configs/desktop/#discord-rich-presence">Discord rich presence</a>.</p>
<p>Some functions to override the displayed message:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/elcord-mask-buffer-name</span> (<span style="color:#19177c">name</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">cond</span>
</span></span><span style="display:flex;"><span>   ((<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> <span style="color:#19177c">bos</span> (<span style="color:#ba2121">? </span><span style="color:#ba2121">&#34;CAPTURE-&#34;</span>) (<span style="color:#00f">=</span> <span style="color:#666">14</span> <span style="color:#19177c">num</span>) <span style="color:#ba2121">&#34;-&#34;</span> (<span style="color:#00f">*</span> <span style="color:#19177c">not-newline</span>) <span style="color:#ba2121">&#34;.org&#34;</span> <span style="color:#19177c">eos</span>) <span style="color:#19177c">name</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;&lt;ORG-ROAM&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>   ((<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> <span style="color:#19177c">bos</span> (<span style="color:#00f">+</span> <span style="color:#19177c">num</span>) <span style="color:#ba2121">&#34;-&#34;</span> (<span style="color:#00f">+</span> <span style="color:#19177c">num</span>) <span style="color:#ba2121">&#34;-&#34;</span> (<span style="color:#00f">+</span> <span style="color:#19177c">num</span>) <span style="color:#ba2121">&#34;.org&#34;</span> <span style="color:#19177c">eos</span>) <span style="color:#19177c">name</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;&lt;ORG-JOURNAL&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>   ((<span style="color:#19177c">string-match-p</span> (<span style="color:#008000">rx</span> <span style="color:#19177c">bos</span> <span style="color:#ba2121">&#34;EXWM&#34;</span>) <span style="color:#19177c">name</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;&lt;EXWM&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>   (<span style="color:#800">t</span> <span style="color:#19177c">name</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/elcord-buffer-details-format-functions</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">format</span> <span style="color:#ba2121">&#34;Editing %s&#34;</span> (<span style="color:#19177c">my/elcord-mask-buffer-name</span> (<span style="color:#00f">buffer-name</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/elcord-update-presence-mask-advice</span> (<span style="color:#19177c">r</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">list</span> (<span style="color:#19177c">my/elcord-mask-buffer-name</span> (<span style="color:#00f">nth</span> <span style="color:#666">0</span> <span style="color:#19177c">r</span>)) (<span style="color:#00f">nth</span> <span style="color:#666">1</span> <span style="color:#19177c">r</span>)))
</span></span></code></pre></div><p>And the package configuration:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">elcord</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> <span style="color:#800">t</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:if</span> (<span style="color:#008000">and</span> (<span style="color:#008000">or</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">string=</span> (<span style="color:#00f">system-name</span>) <span style="color:#ba2121">&#34;indigo&#34;</span>)
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">string=</span> (<span style="color:#00f">system-name</span>) <span style="color:#ba2121">&#34;eminence&#34;</span>))
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">not</span> <span style="color:#19177c">my/slow-ssh</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#19177c">not</span> <span style="color:#19177c">my/remote-server</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">elcord-buffer-details-format-function</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/elcord-buffer-details-format-functions</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">advice-add</span> <span style="color:#19177c">&#39;elcord--try-update-presence</span> <span style="color:#008000">:filter-args</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/elcord-update-presence-mask-advice</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">elcord-mode</span>))
</span></span></code></pre></div><h4 id="snow">Snow</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">snow</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;alphapapa/snow.el&#34;</span> <span style="color:#008000">:host</span> <span style="color:#19177c">github</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">snow</span>))
</span></span></code></pre></div><h4 id="power-mode">Power mode</h4>
<p>When Emacs doesn&rsquo;t feel powerful enough.</p>
<p>Watch out if you are using EXWM.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">power-mode</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;elizagamedev/power-mode.el&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:disabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">power-mode</span>))
</span></span></code></pre></div><h4 id="redacted">Redacted</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">redacted</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:commands</span> (<span style="color:#19177c">redacted-mode</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:straight</span> (<span style="color:#008000">:host</span> <span style="color:#19177c">github</span> <span style="color:#008000">:repo</span> <span style="color:#ba2121">&#34;bkaestner/redacted.el&#34;</span>))
</span></span></code></pre></div><h4 id="zone">Zone</h4>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">use-package</span> <span style="color:#19177c">zone</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:ensure</span> <span style="color:#800">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">setq</span> <span style="color:#19177c">original-zone-programs</span> (<span style="color:#00f">copy-sequence</span> <span style="color:#19177c">zone-programs</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/zone-with-select</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">ivy-read</span> <span style="color:#ba2121">&#34;Zone programs&#34;</span>
</span></span><span style="display:flex;"><span>	    (<span style="color:#19177c">cl-pairlis</span>
</span></span><span style="display:flex;"><span>	     (<span style="color:#19177c">cl-mapcar</span> <span style="color:#19177c">&#39;symbol-name</span> <span style="color:#19177c">original-zone-programs</span>)
</span></span><span style="display:flex;"><span>	     <span style="color:#19177c">original-zone-programs</span>)
</span></span><span style="display:flex;"><span>	    <span style="color:#008000">:action</span> (<span style="color:#008000">lambda</span> (<span style="color:#19177c">elem</span>)
</span></span><span style="display:flex;"><span>		      (<span style="color:#008000">setq</span> <span style="color:#19177c">zone-programs</span> (<span style="color:#00f">vector</span> (<span style="color:#00f">cdr</span> <span style="color:#19177c">elem</span>)))
</span></span><span style="display:flex;"><span>		      (<span style="color:#19177c">zone</span>))))
</span></span></code></pre></div><p>Also, a function to copy a URL to the video under cursor.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">defun</span> <span style="color:#19177c">my/ytel-kill-url</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#008000">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">kill-new</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#00f">concat</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;https://www.youtube.com/watch?v=&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#19177c">ytel-video-id</span> (<span style="color:#19177c">ytel-get-current-video</span>)))))
</span></span></code></pre></div><h2 id="guix-settings">Guix settings</h2>
<table>
<thead>
<tr>
<th>Guix dependency</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>emacs-vterm</td>
<td>A vterm package</td>
</tr>
<tr>
<td>ripgrep</td>
<td>A recursive search tool</td>
</tr>
<tr>
<td>the-silver-searcher</td>
<td>Another recursive search tool</td>
</tr>
</tbody>
</table>
<p><a id="code-snippet--packages"></a></p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#008000">when</span> (<span style="color:#00f">fboundp</span> <span style="color:#00f">#&#39;</span><span style="color:#19177c">my/format-guix-dependencies</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#19177c">my/format-guix-dependencies</span>))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00f">specifications-&gt;manifest</span>
</span></span><span style="display:flex;"><span> <span style="color:#666">&#39;</span>(<span style="color:#ba2121">&#34;emacs-native-comp&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#19177c">&lt;&lt;packages</span>()<span style="color:#19177c">&gt;&gt;</span>))
</span></span></code></pre></div>
    </div>
    <div class="table-of-contents">
        <div class="table-of-contents-text">
            <b><a href="#">Table of Contents</a></b>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#some-remarks">Some remarks</a></li>
    <li><a href="#bootstrap">Bootstrap</a>
      <ul>
        <li><a href="#packages">Packages</a>
          <ul>
            <li><a href="#straight-dot-el">straight.el</a></li>
            <li><a href="#use-package">use-package</a></li>
          </ul>
        </li>
        <li><a href="#variables-and-environment">Variables &amp; environment</a></li>
        <li><a href="#performance">Performance</a>
          <ul>
            <li><a href="#measure-startup-speed">Measure startup speed</a></li>
            <li><a href="#garbage-collection">Garbage collection</a></li>
            <li><a href="#run-garbage-collection-when-emacs-is-unfocused">Run garbage collection when Emacs is unfocused</a></li>
            <li><a href="#measure-ram-usage">Measure RAM usage</a></li>
          </ul>
        </li>
        <li><a href="#anaconda">Anaconda</a></li>
        <li><a href="#config-files">Config files</a>
          <ul>
            <li><a href="#custom-file-location">Custom file location</a></li>
            <li><a href="#authinfo">authinfo</a></li>
            <li><a href="#private-config">Private config</a></li>
            <li><a href="#no-littering">No littering</a></li>
          </ul>
        </li>
        <li><a href="#prevent-emacs-from-closing">Prevent Emacs from closing</a></li>
      </ul>
    </li>
    <li><a href="#general-settings">General settings</a>
      <ul>
        <li><a href="#keybindings">Keybindings</a>
          <ul>
            <li><a href="#general-dot-el">general.el</a></li>
            <li><a href="#which-key">which-key</a></li>
            <li><a href="#evil">Evil</a></li>
            <li><a href="#avy">Avy</a></li>
            <li><a href="#my-keybindings">My keybindings</a></li>
          </ul>
        </li>
        <li><a href="#i3-integration-1">i3 integration</a></li>
        <li><a href="#editing-text">Editing text</a>
          <ul>
            <li><a href="#indentation-and-whitespace">Indentation &amp; whitespace</a></li>
            <li><a href="#settings">Settings</a></li>
            <li><a href="#undo-tree">Undo Tree</a></li>
            <li><a href="#snippets">Snippets</a></li>
            <li><a href="#other-small-packages">Other small packages</a></li>
          </ul>
        </li>
        <li><a href="#working-with-projects">Working with projects</a>
          <ul>
            <li><a href="#projectile">Projectile</a></li>
            <li><a href="#git-and-magit">Git &amp; Magit</a></li>
            <li><a href="#editorconfig">Editorconfig</a></li>
            <li><a href="#editing-files">Editing files</a></li>
          </ul>
        </li>
        <li><a href="#completion">Completion</a>
          <ul>
            <li><a href="#ivy-counsel-swiper">Ivy, counsel, swiper</a></li>
            <li><a href="#ivy-rich">ivy-rich</a></li>
            <li><a href="#prescient">prescient</a></li>
            <li><a href="#keybindings-1">keybindings</a></li>
            <li><a href="#company">company</a></li>
          </ul>
        </li>
        <li><a href="#help">Help</a></li>
        <li><a href="#time-trackers">Time trackers</a>
          <ul>
            <li><a href="#wakatime">WakaTime</a></li>
            <li><a href="#activitywatch">ActivityWatch</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#ui-settings">UI settings</a>
      <ul>
        <li><a href="#general-settings-1">General settings</a>
          <ul>
            <li><a href="#miscellaneous">Miscellaneous</a></li>
            <li><a href="#line-numbers">Line numbers</a></li>
            <li><a href="#word-wrapping">Word wrapping</a></li>
            <li><a href="#custom-frame-format">Custom frame format</a></li>
            <li><a href="#olivetti">Olivetti</a></li>
            <li><a href="#keycast">Keycast</a></li>
          </ul>
        </li>
        <li><a href="#themes-and-colors">Themes and colors</a>
          <ul>
            <li><a href="#doom-themes">Doom themes</a></li>
            <li><a href="#custom-theme">Custom theme</a></li>
            <li><a href="#dim-inactive-buffers">Dim inactive buffers</a></li>
            <li><a href="#toggle-light-dark">Toggle light/dark</a></li>
            <li><a href="#ansi-colors">ANSI colors</a></li>
          </ul>
        </li>
        <li><a href="#fonts">Fonts</a>
          <ul>
            <li><a href="#frame-font">Frame font</a></li>
            <li><a href="#ligatures">Ligatures</a></li>
            <li><a href="#icons">Icons</a></li>
          </ul>
        </li>
        <li><a href="#text-highlight">Text highlight</a></li>
        <li><a href="#doom-modeline">Doom Modeline</a></li>
        <li><a href="#perspective-dot-el">perspective.el</a>
          <ul>
            <li><a href="#functions-to-manage-buffers">Functions to manage buffers</a></li>
            <li><a href="#automating-perspectives">Automating perspectives</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#programming">Programming</a>
      <ul>
        <li><a href="#general-setup">General setup</a>
          <ul>
            <li><a href="#treemacs">Treemacs</a></li>
            <li><a href="#lsp">LSP</a></li>
            <li><a href="#flycheck">Flycheck</a></li>
            <li><a href="#tree-sitter">Tree Sitter</a></li>
            <li><a href="#dap">DAP</a></li>
            <li><a href="#reformatter">Reformatter</a></li>
            <li><a href="#copilot">copilot</a></li>
            <li><a href="#general-additional-config">General additional config</a></li>
          </ul>
        </li>
        <li><a href="#web-development">Web development</a>
          <ul>
            <li><a href="#emmet">Emmet</a></li>
            <li><a href="#prettier">Prettier</a></li>
            <li><a href="#typescript">TypeScript</a></li>
            <li><a href="#javascript">JavaScript</a></li>
            <li><a href="#jest">Jest</a></li>
            <li><a href="#web-mode">web-mode</a></li>
          </ul>
        </li>
        <li><a href="#latex">LaTeX</a>
          <ul>
            <li><a href="#auctex">AUCTeX</a></li>
            <li><a href="#bibtex">BibTeX</a></li>
            <li><a href="#import-dot-sty">Import *.sty</a></li>
            <li><a href="#snippets-1">Snippets</a></li>
          </ul>
        </li>
        <li><a href="#other-markup-and-natural-languages">Other markup &amp; natural languages</a>
          <ul>
            <li><a href="#markdown">Markdown</a></li>
            <li><a href="#plantuml">PlantUML</a></li>
            <li><a href="#subtitles">Subtitles</a></li>
            <li><a href="#languagetool">LanguageTool</a></li>
          </ul>
        </li>
        <li><a href="#lisp">Lisp</a>
          <ul>
            <li><a href="#meta-lisp">Meta Lisp</a></li>
            <li><a href="#emacs-lisp">Emacs Lisp</a></li>
            <li><a href="#common-lisp">Common lisp</a></li>
            <li><a href="#clojure">Clojure</a></li>
            <li><a href="#hy">Hy</a></li>
            <li><a href="#scheme">Scheme</a></li>
            <li><a href="#clips">CLIPS</a></li>
          </ul>
        </li>
        <li><a href="#python">Python</a>
          <ul>
            <li><a href="#ein">ein</a></li>
            <li><a href="#pyright">pyright</a></li>
            <li><a href="#pipenv">pipenv</a></li>
            <li><a href="#yapf">yapf</a></li>
            <li><a href="#isort">isort</a></li>
            <li><a href="#sphinx-doc">sphinx-doc</a></li>
            <li><a href="#pytest">pytest</a></li>
            <li><a href="#code-cells">code-cells</a></li>
            <li><a href="#tensorboard">tensorboard</a></li>
          </ul>
        </li>
        <li><a href="#data-serialization">Data serialization</a>
          <ul>
            <li><a href="#json">JSON</a></li>
            <li><a href="#csv">CSV</a></li>
            <li><a href="#yaml">YAML</a></li>
          </ul>
        </li>
        <li><a href="#configuration">Configuration</a>
          <ul>
            <li><a href="#dot-env">.env</a></li>
            <li><a href="#dot-gitignore">.gitignore</a></li>
            <li><a href="#docker">Docker</a></li>
            <li><a href="#jenkins">Jenkins</a></li>
            <li><a href="#crontab">crontab</a></li>
          </ul>
        </li>
        <li><a href="#shell">Shell</a>
          <ul>
            <li><a href="#sh">sh</a></li>
            <li><a href="#fish">fish</a></li>
          </ul>
        </li>
        <li><a href="#x509">x509</a></li>
        <li><a href="#java">Java</a></li>
        <li><a href="#go">Go</a></li>
        <li><a href="#dot-net">.NET</a>
          <ul>
            <li><a href="#c">C#</a></li>
            <li><a href="#msbuild">MSBuild</a></li>
          </ul>
        </li>
        <li><a href="#haskell">Haskell</a></li>
        <li><a href="#nix">nix</a></li>
        <li><a href="#lua">Lua</a></li>
        <li><a href="#sql">SQL</a></li>
        <li><a href="#sparql">SPARQL</a></li>
      </ul>
    </li>
    <li><a href="#org-mode">Org Mode</a>
      <ul>
        <li><a href="#installation-and-basic-settings">Installation &amp; basic settings</a>
          <ul>
            <li><a href="#encryption">Encryption</a></li>
            <li><a href="#org-contrib">org-contrib</a></li>
            <li><a href="#org-tempo">org-tempo</a></li>
            <li><a href="#evil-org">evil-org</a></li>
          </ul>
        </li>
        <li><a href="#literate-programing">Literate programing</a>
          <ul>
            <li><a href="#python-and-jupyter">Python &amp; Jupyter</a></li>
            <li><a href="#hy-1">Hy</a></li>
            <li><a href="#view-html-in-browser">View HTML in browser</a></li>
            <li><a href="#plantuml-1">PlantUML</a></li>
            <li><a href="#restclient">Restclient</a></li>
            <li><a href="#setup-1">Setup</a></li>
            <li><a href="#managing-jupyter-kernels">Managing Jupyter kernels</a></li>
            <li><a href="#output-post-processing">Output post-processing</a></li>
            <li><a href="#executing-stuff">Executing stuff</a></li>
            <li><a href="#managing-a-literate-programming-project">Managing a literate programming project</a></li>
          </ul>
        </li>
        <li><a href="#tools">Tools</a>
          <ul>
            <li><a href="#presentations">Presentations</a></li>
            <li><a href="#toc">TOC</a></li>
            <li><a href="#screenshots">Screenshots</a></li>
            <li><a href="#transclusion">Transclusion</a></li>
          </ul>
        </li>
        <li><a href="#productivity-and-knowledge-management">Productivity &amp; Knowledge management</a>
          <ul>
            <li><a href="#capture-templates-and-various-settings">Capture templates &amp; various settings</a></li>
            <li><a href="#off--trello-sync"><span class="org-todo done OFF">OFF</span> (OFF) Trello sync</a></li>
            <li><a href="#org-ql">org-ql</a></li>
            <li><a href="#custom-agendas">Custom agendas</a></li>
            <li><a href="#org-journal">Org Journal</a></li>
            <li><a href="#org-roam">Org Roam</a></li>
            <li><a href="#review-workflow">Review workflow</a></li>
            <li><a href="#org-ref">org-ref</a></li>
            <li><a href="#org-roam-bibtex">org-roam-bibtex</a></li>
            <li><a href="#org-contacts">org-contacts</a></li>
            <li><a href="#managing-tables">Managing tables</a></li>
          </ul>
        </li>
        <li><a href="#ui">UI</a>
          <ul>
            <li><a href="#off--instant-equations-preview"><span class="org-todo done OFF">OFF</span> (OFF) Instant equations preview</a></li>
            <li><a href="#latex-fragments">LaTeX fragments</a></li>
            <li><a href="#better-headers">Better headers</a></li>
            <li><a href="#override-colors">Override colors</a></li>
          </ul>
        </li>
        <li><a href="#export">Export</a>
          <ul>
            <li><a href="#hugo">Hugo</a></li>
            <li><a href="#jupyter-notebook">Jupyter Notebook</a></li>
            <li><a href="#html-export">Html export</a></li>
            <li><a href="#latex-1">LaTeX</a></li>
          </ul>
        </li>
        <li><a href="#keybindings-and-stuff">Keybindings &amp; stuff</a>
          <ul>
            <li><a href="#general-keybindings">General keybindings</a></li>
            <li><a href="#copy-a-link">Copy a link</a></li>
            <li><a href="#navigating-source-blocks">Navigating source blocks</a></li>
            <li><a href="#open-a-file-from-org-directory">Open a file from <code>org-directory</code></a></li>
          </ul>
        </li>
        <li><a href="#system-configuration">System configuration</a>
          <ul>
            <li><a href="#tables-for-guix-dependencies">Tables for Guix Dependencies</a></li>
            <li><a href="#noweb-evaluations">Noweb evaluations</a></li>
            <li><a href="#yadm-hook">yadm hook</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#applications">Applications</a>
      <ul>
        <li><a href="#dired-1">Dired</a>
          <ul>
            <li><a href="#basic-config-and-keybindings">Basic config &amp; keybindings</a></li>
            <li><a href="#addons-1">Addons</a></li>
            <li><a href="#subdirectories">Subdirectories</a></li>
            <li><a href="#tramp-1">TRAMP</a></li>
            <li><a href="#bookmarks">Bookmarks</a></li>
          </ul>
        </li>
        <li><a href="#shells">Shells</a>
          <ul>
            <li><a href="#vterm">vterm</a></li>
            <li><a href="#eshell">Eshell</a></li>
          </ul>
        </li>
        <li><a href="#managing-dotfiles">Managing dotfiles</a>
          <ul>
            <li><a href="#open-emacs-config">Open Emacs config</a></li>
            <li><a href="#open-magit-for-yadm">Open Magit for yadm</a></li>
            <li><a href="#open-a-dotfile">Open a dotfile</a></li>
          </ul>
        </li>
        <li><a href="#elfeed">Elfeed</a>
          <ul>
            <li><a href="#general-settings-4">General settings</a></li>
            <li><a href="#some-additions">Some additions</a></li>
            <li><a href="#custom-faces">Custom faces</a></li>
            <li><a href="#elfeed-summary">elfeed-summary</a></li>
            <li><a href="#elfeed-sync">elfeed-sync</a></li>
            <li><a href="#youtube-podcasts-and-emms">YouTube, podcasts &amp; EMMS</a></li>
            <li><a href="#rdrview">rdrview</a></li>
            <li><a href="#latex-and-pandoc">LaTeX and pandoc</a></li>
            <li><a href="#youtube-transcripts">YouTube transcripts</a></li>
          </ul>
        </li>
        <li><a href="#internet-and-multimedia">Internet &amp; Multimedia</a>
          <ul>
            <li><a href="#notmuch">Notmuch</a></li>
            <li><a href="#emms">EMMS</a></li>
            <li><a href="#ytel">ytel</a></li>
            <li><a href="#wallabag">wallabag</a></li>
            <li><a href="#eww">EWW</a></li>
            <li><a href="#erc">ERC</a></li>
            <li><a href="#ement-dot-el">ement.el</a></li>
            <li><a href="#off--jabber"><span class="org-todo done OFF">OFF</span> (OFF) jabber</a></li>
            <li><a href="#google-translate">Google Translate</a></li>
          </ul>
        </li>
        <li><a href="#reading-documentation">Reading documentation</a>
          <ul>
            <li><a href="#tldr">tldr</a></li>
            <li><a href="#man-and-info">man &amp; info</a></li>
            <li><a href="#devdocs-dot-io">devdocs.io</a></li>
            <li><a href="#stackexchange">StackExchange</a></li>
          </ul>
        </li>
        <li><a href="#utilities">Utilities</a>
          <ul>
            <li><a href="#pass">pass</a></li>
            <li><a href="#docker-1">Docker</a></li>
            <li><a href="#progidy">Progidy</a></li>
            <li><a href="#screenshot-dot-el">screenshot.el</a></li>
            <li><a href="#proced">proced</a></li>
            <li><a href="#guix">Guix</a></li>
          </ul>
        </li>
        <li><a href="#productivity">Productivity</a>
          <ul>
            <li><a href="#pomm">pomm</a></li>
            <li><a href="#hledger">hledger</a></li>
            <li><a href="#calendar">Calendar</a></li>
          </ul>
        </li>
        <li><a href="#fun">Fun</a>
          <ul>
            <li><a href="#discord-integration">Discord integration</a></li>
            <li><a href="#snow">Snow</a></li>
            <li><a href="#power-mode">Power mode</a></li>
            <li><a href="#redacted">Redacted</a></li>
            <li><a href="#zone">Zone</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#guix-settings">Guix settings</a></li>
  </ul>
</nav>
        </div>
        <a id="unhide-all-button" class="hidden">&lt;Expand&gt;</a>
        <a id="hide-all-button" class="hidden">&lt;Collapse&gt;</a>
    </div>
</div>

        </div><div id="footer" class="mb-5">
    <hr>
    <div class="container text-center">
        
    </div>
    
    <div class="container text-center">
        <a href="https://sqrtminusone.xyz/" title="Pavel Korytov, 2022"><small>Pavel Korytov, 2022</small></a>
        
        <br>
        <a href="https://creativecommons.org/licenses/by/4.0/legalcode" title="Licensed under CC-BY 4.0"><small>Licensed under CC-BY 4.0</small></a>
        
    </div>
    
</div>
</body>
</html>
